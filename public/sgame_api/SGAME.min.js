iso8601Parser=function(d){return{getDuration:function(g){var a=[31104E3,2592E3,604800,86400,3600,60,1];try{var d;var m=g;g=[2,3,4,5,7,8,9];var u=[0,0,0,0,0,0,0],q;if(m=m.toUpperCase()){if("string"!==typeof m)throw Error("Invalid iso8601 period string '"+m+"'");if(q=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(m))for(m=0;m<g.length;m++){var r=g[m];u[m]=q[r]?+q[r].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+m+"' is not a valid ISO8601 period.");}d=u}catch(s){return null}for(r=
q=0;r<d.length;r++)q+=d[r]*a[r];return q}}}();function Local_API_1484_11(d){function g(n,a){e.diganostic="The "+n+" of "+a+" must be a proper vocabulary element.";e.errorCode=406;return"false"}function a(n){e.errorCode=402;e.diagnostic="The value for key "+n+" has not been created yet.";return"false"}function p(n,a){e.errorCode=201;e.diagnostic="The value for key "+n+" is not valid.";return"false"}function m(n,a,c){n=n.split(/\./);2>n.length?c[n[0]]=a:(c[n[0]]||(c[n[0]]={}),c=c[n.shift()],m(n.join("."),a,c))}function u(n,c){var b=n.split(/\./),
e;if(2>b.length)try{return c[b[0]]}catch(l){return a(n),"false"}else{e=b.shift();if(c[e])return String(u(b.join("."),c[e]));a(n);return"false"}}function q(n){var a,c=0;for(a in n)n.hasOwnProperty(a)&&(c+=1);return c}function r(n,a){if(e.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(n);break;case 2:console.warn(n);break;case 4:console.info(n);
break;case 3:console.log(n);break;default:return console.log(n),!1}return!0}3>a&&e.throw_alerts&&alert(n);return!1}function s(a,c){if("function"==typeof e.listeners[a]&&"undefined"!=typeof c)e.listeners[a](c)}function f(a,c){for(var b in c)c.hasOwnProperty(b)&&("object"==typeof a[b]?"object"==typeof c[b]&&(a[b]=f(a[b],c[b])):a[b]=c[b]);return a}function c(a,c){(function(){function a(c,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(c,n.bubbles,
n.cancelable,n.detail);return b}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:c}))}function t(a){return"object"!==type(a)||a.nodeType||isWindow(a)?!1:!(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))}var e=f({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},d),b={},l={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},h=this;"object"===typeof e.user&&("string"===typeof e.user.name&&(e.CMI.learner_name=e.user.name),"string"===typeof e.user.id&&(e.CMI.learner_id=e.user.id));this.isRunning=function(){return 1===e.initialized&&0===e.terminated};this.Initialize=function(){r(e.prefix+
":  Initializing...",3);e.cmi?(b=e.cmi,"suspend"===b.exit&&(b.entry="resume")):b=e.CMI;e.initialized=1;e.terminated=0;return"true"};this.GetValue=function(a){e.errorCode=0;var c="false";a=a.toString();var l=[];if(this.isRunning()){l=a.split(".");if(0<="|exit|session_time|".indexOf("|"+l[l.length-1]+"|"))return r(e.prefix+": This "+a+" is write only",4),e.errorCode=405,"false";l=a.toLowerCase().split(".");switch(l[0]){case "cmi":switch(c="false",a){case "cmi.exit":case "cmi.session_time":e.errorCode=
405;e.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;case "cmi.learner_name":c=e.CMI.learner_name;break;default:c=u(a.substr(4,a.length),b),"undefined"===c&&(e.errorCode=401,e.diagnostic="Sorry, there was a undefined response from "+a,c="false"),r(e.prefix+": GetValue "+a+" = "+c,4)}}return c}e.errorCode=123;return c};this.SetValue=function(a,c){r(e.prefix+": SetValue: "+a+" = "+c,4);e.errorCode=0;var l=[],k=a.toString(),d=c.toString(),h=0,f=0,h=[];if(this.isRunning()){h=
k.split(".");if("adl"===h[0]&&"id"===h[4]||"comments_from_lms"===h[1]||("comments_from_learner"===h[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+h[h.length-1]+"|")))return r(e.prefix+": This "+k+" is read only",4),e.errorCode=404,"false";l=k.split(".");switch(l[0]){case "cmi":switch(a){case "cmi.location":1E3<d.length&&r(e.prefix+": Some LMS's might truncate your bookmark as you've passed "+
d.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":h=parseFloat(d);if("number"!=typeof h||isNaN(h))return p(a,d);h=Math.max(0,Math.min(1,h));s(a,h);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+d+"|"))return g(a,d);s(a,d);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+d+"|"))return g(a,d);break;case "cmi.score.scaled":h=parseFloat(d);if("number"!=typeof h||isNaN(h))return p(a,d);h=Math.max(0,
Math.min(1,h));s(a,h);break;case "cmi.score.min":h=parseFloat(d);if("number"!=typeof h||isNaN(h))return p(a,d);e.CMI.score.min=h;break;case "cmi.score.max":h=parseFloat(d);if("number"!=typeof h||isNaN(h))return p(a,d);e.CMI.score.max=h;break;case "cmi.score.raw":h=parseFloat(d);if("number"!=typeof h||isNaN(h))return p(a,d);f=parseFloat(e.CMI.score.max);f="number"!=typeof f||isNaN(f)?100:f;l=parseFloat(e.CMI.score.min);l="number"!=typeof l||isNaN(l)?0:l;f-=l;0>=f&&(f=100);h=Math.max(0,Math.min(1,(h-
l)/f));s("cmi.score.scaled",h);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+d+"|"))return g(a,d);s(a,d);break;default:switch(l[1]){case "comments_from_lms":return e.errorCode="404",e.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===b.comments_from_learner._children.indexOf(l[3]))return g(a,d);m(k.substr(4,k.length),d,b);b.comments_from_learner._count=(q(b.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===b.interactions._children.indexOf(l[3]))return g(a,d);b.interactions._count=(q(b.interactions)-2).toString();if(isNaN(parseInt(l[2],10)))return"false";if(!t(b.interactions[l[2]])){if("id"===l[3])return b.interactions[l[2]]={},m(k.substr(4,k.length),d,b),b.interactions._count=(q(b.interactions)-2).toString(),t(b.interactions[l[2]].objectives)||(r(e.prefix+": Constructing objectives object for new interaction",4),b.interactions[l[2]].objectives={},b.interactions[l[2]].objectives._count=
"-1"),t(b.interactions[l[2]].correct_responses)||(r(e.prefix+": Constructing correct responses object for new interaction",4),b.interactions[l[2]].correct_responses={},b.interactions[l[2]].correct_responses._count="-1"),"true";r("Can't add interaction without ID first!",3);return"false"}if("objectives"===l[3]){if("id"===l[5])for(f=parseInt(b.interactions[l[2]].objectives._count,10),h=0;h<f;h+=1){if(b.interactions[l[2]].objectives[h].id===d)return k=a,e.errorCode="351",e.diagnostic="The "+k+" element must be unique.  The value '"+
d+"' has already been set in #"+h,"false"}else return g(a,d);m(k.substr(4,k.length),d,b);b.interactions[l[2]].objectives._count=(q(b.interactions[l[2]].objectives)-1).toString();return"true"}"correct_responses"===l[3]&&(m(k.substr(4,k.length),d,b),b.interactions[l[2]].correct_responses._count=(q(b.interactions[l[2]].correct_responses)-1).toString());m(k.substr(4,k.length),d,b);b.interactions._count=(q(b.interactions)-2).toString();return"true";case "objectives":if("id"===l[3])for(f=parseInt(b.objectives._count,
10),h=0;h<f;h+=1)if(b.objectives[h].id===d)return e.errorCode="351",e.diagnostic="The objectives.id element must be unique.  The value '"+d+"' has already been set in objective #"+h,"false";if("id"!==l[3]&&(h=parseInt(l[2],10),void 0===b.objectives[h]))return e.errorCode="408",e.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(l[2],10)))return"false";m(k.substr(4,k.length),d,b);b.objectives._count=(q(b.objectives)-2).toString();return"true"}}m(k.substr(4,
k.length),d,b)}return"true"}e.errorCode=e.terminated?133:132;return"false"};this.Commit=function(){r(e.prefix+": Commit CMI Object:",4);r(b);r(e.prefix+": Suspend Data Usage "+(Math.round(100*(b.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));c("StoreData",{runtimedata:b});return"true"};this.Terminate=function(){h.Commit();e.terminated=1;e.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==l[a])?l[a]:""};this.GetLastError=function(){return e.errorCode};
this.GetDiagnostic=function(){return e.diagnostic};this.setCMILMSValue=function(a,c){"string"==typeof a&&(e.CMI[a]=c)};this.addListener=function(a,c){"string"==typeof a&&"function"==typeof c&&(e.listeners[a]=c)}};function Local_API_SCORM_12(d){function g(a,b){c.diganostic="The "+a+" of "+b+" must be a proper vocabulary element.";c.errorCode=406;return"false"}function a(a){c.errorCode=402;c.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function p(a,b){c.errorCode=201;c.diagnostic="The value for key "+a+" is not valid.";return"false"}function m(a,c,b){a=a.split(/\./);2>a.length?b[a[0]]=c:(b[a[0]]||(b[a[0]]={}),b=b[a.shift()],m(a.join("."),c,b))}function u(c,b){var e=c.split(/\./),
d;if(2>e.length)try{return b[e[0]]}catch(g){return a(c),"false"}else{d=e.shift();if(b[d])return String(u(e.join("."),b[d]));a(c);return"false"}}function q(a,b){if(c.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(b){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>b&&c.throw_alerts&&alert(a);return!1}function r(a,b){if("function"==typeof c.listeners[a]&&"undefined"!=typeof b)c.listeners[a](b)}function s(a,c){for(var b in c)c.hasOwnProperty(b)&&("object"==typeof a[b]?"object"==typeof c[b]&&(a[b]=s(a[b],c[b])):a[b]=c[b]);return a}function f(a,c){(function(){function a(c,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");e.initCustomEvent(c,b.bubbles,b.cancelable,b.detail);return e}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:c}))}var c=s({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},d),t={},e={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},b=this;"object"===typeof c.user&&("string"===typeof c.user.name&&(c.CMI.core.student_name=c.user.name),"string"===typeof c.user.id&&(c.CMI.core.student_id=c.user.id));this.isRunning=function(){return 1===c.initialized&&0===c.terminated};this.LMSInitialize=function(){q(c.prefix+":  Initializing...",3);t=c.CMI;c.initialized=1;c.terminated=
0;return"true"};this.LMSGetValue=function(a){c.errorCode=0;var b="false";a=a.toString();var e=[];if(this.isRunning()){e=a.split(".");if(0<="|exit|session_time|".indexOf("|"+e[e.length-1]+"|"))return c.errorCode=405,"false";e=a.toLowerCase().split(".");switch(e[0]){case "cmi":b=a;a="false";switch(b){case "cmi.core.exit":case "cmi.core.session_time":c.errorCode=405;c.diagnostic="Sorry, this has been specified as a read-only value for "+b;break;default:b=b.replace("cmi.",""),a=u(b,t),"undefined"===a&&
(c.errorCode=401,c.diagnostic="Sorry, there was a undefined response from "+b,a="false")}b=a}return b}c.errorCode=123;return b};this.LMSSetValue=function(a,b){q(c.prefix+": SetValue: "+a+" = "+b,4);c.errorCode=0;var e=[],d=a.toString(),f=b.toString();if(this.isRunning()){var e=d.split("."),k=e[e.length-1],e="adl"===e[0]&&"id"===e[4]?!0:"comments_from_lms"===e[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
k+"|");if(e)return c.errorCode=404,"false";e=d.split(".");switch(e[0]){case "cmi":switch(a){case "cmi.core.lesson_location":1E3<f.length&&q(c.prefix+": Some LMS's might truncate your bookmark as you've passed "+f.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+f+"|"))return g(a,f);r(a,f);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+f+"|"))return g(a,
f);break;case "cmi.core.score.min":e=parseFloat(f);if("number"!=typeof e||isNaN(e))return p(a,f);c.CMI.core.score.min=e;break;case "cmi.core.score.max":e=parseFloat(f);if("number"!=typeof e||isNaN(e))return p(a,f);c.CMI.core.score.max=e;break;case "cmi.core.score.raw":e=parseFloat(f);if("number"!=typeof e||isNaN(e))return p(a,f);var s=parseFloat(c.CMI.core.score.max),s="number"!=typeof s||isNaN(s)?100:s,k=parseFloat(c.CMI.core.score.min),k="number"!=typeof k||isNaN(k)?0:k,s=s-k;0>=s&&(s=100);e=Math.max(0,
Math.min(1,(e-k)/s));r("cmi.score.scaled",e)}d=d.replace("cmi.","");m(d,f,t)}return"true"}c.errorCode=c.terminated?133:132;return"false"};this.LMSCommit=function(){f("StoreData",{runtimedata:t});return"true"};this.LMSTerminate=function(){b.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSFinish=function(){b.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==e[a])?e[a]:""};this.LMSGetLastError=function(){return c.errorCode};
this.LMSGetDiagnostic=function(){return c.diagnostic};this.setCMILMSValue=function(a,b){"string"==typeof a&&(c.CMI[a]=b)};this.addListener=function(a,b){"string"==typeof a&&"function"==typeof b&&(c.listeners[a]=b)}};SGAME=function(){return{init:function(d){return SGAME.CORE.init(d)},loadSettings:function(d){return SGAME.CORE.loadSettings(d)},triggerLO:function(d,g){return SGAME.CORE.triggerLO(d,g)},showLO:function(d,g){return SGAME.CORE.showLO(d,g)},showRandomLO:function(d){return SGAME.CORE.showRandomLO(d)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(d){return SGAME.CORE.losCanBeShown(d)},successWhenNoLOs:function(d){return SGAME.CORE.successWhenNoLOs(d)}}}();
SGAME.VERSION="0.6";SGAME.AUTHORS="Aldo Gordillo, Enrique Barra";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var d=!1;return{init:function(g){!0===g&&(d=g)},isDebugging:function(){return d},log:function(g){d&&window.console&&console.log(g)}}}();SGAME.Messenger=function(){function d(a,d){this.data=a||{};-1!==["PROTOCOL","APP"].indexOf(d)?this.type=d:this.type="APP";this.origin=p;this.destination=m}var g=["PROTOCOL","APP"],a=["SGAME_GATEWAY","SGAME_API"],p="SGAME_API",m="SGAME_GATEWAY",u=!1,q=!1,r=function(a){try{window.parent.parent.postMessage(a,"*")}catch(d){}},s=function(a){var d;d="object"!==typeof a||"string"!==typeof a.data?!1:f(a.data);if(d)switch(a=JSON.parse(a.data),a.type){case "PROTOCOL":if(a.data)switch(a.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
a.origin&&!0!==q&&(q=!0,a.data.settings=SGAME.CORE.getSettings(),a.destination=a.origin,a.origin=p,r(JSON.stringify(a)))}break;case "APP":if(a.data&&"string"===typeof a.data.key)switch(a.data.key){case "lms_data":if("object"===typeof a.data.value){d=a.data.value;a={};if("string"===typeof d.name||"number"===typeof d.name)a.name=""+d.name;if("string"===typeof d.id||"number"===typeof d.id)a.id=""+d.id;d=SGAME.CORE.getVLEData();d.user=a;SGAME.CORE.setVLEData(d)}}}},f=function(c){try{if(c=JSON.parse(c),
-1===g.indexOf(c.type)||-1===a.indexOf(c.origin))return!1}catch(d){return!1}return!0};return{init:function(a){if(!u){u=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",s,!1):window.attachEvent&&window.parent.attachEvent("message",s)}catch(d){}}},sendMessage:function(a){u&&q&&(a=JSON.stringify(new d(a,void 0)),f(a)&&r(a))}}}();SGAME.API=function(){var d=function(d,a){var p=new XMLHttpRequest;p.onreadystatechange=function(){if(4==p.readyState&&200==p.status){var d=JSON.parse(p.responseText);a(d)}};p.open("GET",d,!0);p.send("")};return{init:function(){},requestLOMetadata:function(g,a,p){try{d("undefined"==typeof g?"/lo/random/metadata.json":"/lo/"+g+"/metadata.json",function(d){a(d)})}catch(m){p(m)}}}}();SGAME.CORE=function(){var d={},g=void 0,a={},p=!1,m={},u={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},q=["repeat","repeat_unless_successfully_consumed","no_repeat"],r=["percentage_los","n_los_shown","n_times_shown","disabled"],s=["percentage_los","n_los_shown","n_times_shown","disabled"],f="no_more_los all_los_consumed all_los_succesfully_consumed completion_status success_status never".split(" "),c=["success","failure","success_unless_damage","failure_unless_blocking"],
t=!1,e=0,b=0,l=0,h=0,n=0,v=!1,w="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",k=function(b){a=b;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===q.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");
"undefined"===typeof a.game_settings&&(a.game_settings={});-1===r.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");"disabled"!==a.game_settings.completion_status&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;if(-1===r.indexOf(a.game_settings.success_status)||"number"!==typeof a.game_settings.completion_status_n)a.game_settings.success_status="disabled";"disabled"!==a.game_settings.success_status&&"number"===
typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;if(-1===s.indexOf(a.game_settings.success_status)||"number"!==typeof a.game_settings.success_status_n)a.game_settings.success_status="disabled";-1===f.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===c.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&
(w=a.game_settings.completion_notification_text);if("object"===typeof a.los){b=Object.keys(a.los);e=b.length;for(var d=0;d<e;d++)"undefined"!==typeof a.los[b[d]].url&&(a.los[b[d]].url=SGAME.Utils.checkUrlProtocol(a.los[b[d]].url)),a.los[b[d]].can_be_shown=!0,a.los[b[d]].shown=!1,a.los[b[d]].nshown=0,a.los[b[d]].succesfully_consumed=!1,a.los[b[d]].nsuccess=0,a.los[b[d]].acts_as_asset="asset"===a.los[b[d]].scorm_type||"sco"===a.los[b[d]].scorm_type&&!1===a.los[b[d]].report_data,t=!0}},y=function(b){var c=
[];b=a.event_mapping[b];if("undefined"!==typeof b){var d=b.length;if("number"===typeof d)for(var e=0;e<d;e++){if("*"===b[e]){c=[];b=Object.keys(a.los);for(d=0;d<b.length;d++)"undefined"!==typeof a.los[b[d]]&&c.push(a.los[b[d]]);break}"undefined"!==typeof a.los[b[e]]&&c.push(a.los[b[e]])}}return c},z=function(a){for(var b=[],c=a.length,d=0;d<c;d++)!0===a[d].can_be_shown&&b.push(a[d]);return b},x=function(b,c){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof c&&c(null,null):(A(),a.los[b.id].shown=
!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(d){a.los[b.id].succesfully_consumed=d.success;!0===d.success&&(a.los[b.id].nsuccess+=1);switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].succesfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}E();d.more_los=t;F(function(){"function"===typeof c&&c(d.success,d);A()})}))},A=function(){"function"===typeof g&&g()},E=function(){t=!1;for(var c=Object.keys(a.los),
d=c.length,f=0;f<d;f++)!0===a.los[c[f]].shown&&(b+=1,l+=a.los[c[f]].nshown),!0===a.los[c[f]].succesfully_consumed&&(h+=1,n+=a.los[c[f]].nsuccess),!0===a.los[c[f]].can_be_shown&&(t=!0);c=0;d="incompleted";if("number"===typeof a.game_settings.completion_status_n){switch(a.game_settings.completion_status){case "percentage_los":a.game_settings.completion_status_n=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100;c=0>=a.game_settings.completion_status_n||0>=e?1:b/e/a.game_settings.completion_status_n;
break;case "n_los_shown":f=Math.min(a.game_settings.completion_status_n,e);c=0===f?1:b/f;break;case "n_times_shown":c=0>=a.game_settings.completion_status_n?1:l/a.game_settings.completion_status_n}c=Math.max(Math.min(1,+c.toFixed(2)),0);d=1===c?"completed":"incompleted"}var f=0,g="unknown";if("number"===typeof a.game_settings.success_status_n){switch(a.game_settings.success_status){case "percentage_los":a.game_settings.success_status_n=Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;
f=0>=a.game_settings.success_status_n||0>=e?1:h/e/a.game_settings.success_status_n;break;case "n_los_shown":f=Math.min(a.game_settings.success_status_n,e);f=0===f?1:b/f;break;case "n_times_shown":f=0>=a.game_settings.success_status_n?1:n/a.game_settings.success_status_n}f=Math.max(Math.min(1,+f.toFixed(2)),0);g=1===f?"passed":"failed"}u={progress_measure:c,completion_status:d,score:f,success_status:g};SGAME.Messenger.sendMessage({key:"tracking",value:u})},F=function(a){!0!==G()?"function"===typeof a&&
a(!1):H(a)},G=function(){if(!0===v)return!1;switch(a.game_settings.completion_notification){case "no_more_los":return!1===t;case "all_los_consumed":for(var b=Object.keys(a.los),c=b.length,d=0;d<c;d++)if(!1===a.los[b[d]].shown)return!1;return!0;case "all_los_succesfully_consumed":b=Object.keys(a.los);c=b.length;for(d=0;d<c;d++)if(!1===a.los[b[d]].succesfully_consumed)return!1;return!0;case "never":return!1;default:return!1}},H=function(a){v=!0;SGAME.Fancybox.create({dialog:!0,msg:w},function(){"function"===
typeof a&&a(!0)})},C=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:B(a),more_los:t}},B=function(b){var c;p&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof d.behaviour_when_no_more_los?c=d.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&(c=a.game_settings.behaviour_when_no_more_los);
return I(c,b)},I=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=D(b);return"undefined"!==typeof c&&"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=D(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},D=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof d.events&&"undefined"!==typeof d.events[b]?d.events[b]:{}};SGAME.Debugger.init(!1);!1===p&&k({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");
SGAME.Debugger.log(a);(d=a)&&"function"===typeof a.togglePause&&(g=a.togglePause)},loadSettings:function(a){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(a);p=!0;k(a)},triggerLO:function(a,b){var c=y(a);if(1>c.length){if("function"===typeof b){var d=C(a);b(d.success,d)}}else if(c=z(c),0<c.length){for(var e=[],f=0;f<c.length;f++)"undefined"===typeof d&&(d=c[f].nshown),c[f].nshown<d&&(d=c[f].nshown,e=[]),d===c[f].nshown&&e.push(c[f]);selectedLO=SGAME.Utils.getRandomElement(e);x(selectedLO,
b)}else"function"===typeof b&&(d=C(a),b(d.success,d))},showLO:x,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){x(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===t?!1:"undefined"===typeof a?t:0<z(y(a)).length},successWhenNoLOs:function(a){return B(a)},getVLEData:function(){return m},setVLEData:function(a){return m=a}}}();var API,API_1484_11;
SGAME.Fancybox=function(d){var g=d,a=d,p=d,m=function(){"undefined"!=typeof g&&(g.style.display="none",g.parentNode.removeChild(g),"lo"===a&&(API_1484_11=API=d),a=g=d)},u=function(){if("undefined"!=typeof g){var q=a;m();var r;r="lo"===q?SGAME.Observer.stop():!0;var s=p;p=d;setTimeout(function(){"function"===typeof s&&s(r)},50)}};return{init:function(){},create:function(q,r){m();p=r;var s="undefined"!==typeof q&&!0===q.dialog?"dialog":"lo",f=4/3,c,t,e=0.9*window.innerWidth,b=0.9*window.innerHeight;
b*f>e?(c=e,t=c/f):(t=b,c=t*f);if("lo"===s)var l={},h;else var n="";q&&(q.width&&(c=q.width),q.height&&(t=q.height),"lo"===s?q.lo&&(l=q.lo,"string"===typeof l.url&&(h=l.url)):"string"==typeof q.msg&&(n=q.msg));if("lo"===s){if("string"!=typeof h||"undefined"==typeof l.scorm_type)return;var v=d,f=API_1484_11=API=d,w=SGAME.CORE.getVLEData();"object"===typeof w.user&&(f=w.user);"sco"===l.scorm_type&&("1.2"===l.scorm_version?v=API=new Local_API_SCORM_12({user:f,debug:SGAME.Debugger.isDebugging()}):"2004"===
l.scorm_version&&(v=API_1484_11=new Local_API_1484_11({user:f,debug:SGAME.Debugger.isDebugging()})))}f=document.createElement("div");f.style.width=c+"px";f.style.height=t+"px";f.style.maxWidth=e+"px";f.style.maxHeight=b+"px";f.style.overflow="lo"===s?"hidden":"auto";f.style.background="white";f.style.position="absolute";f.style.top=0;f.style.zIndex=9999;f.style.borderRadius="1em";f.style.border="2px solid black";f.setAttribute("id","sgame_fancybox");f.style.marginLeft=(window.innerWidth-c)/2+"px";
f.style.marginTop=(window.innerHeight-t)/2+"px";b=document.createElement("img");b.src="/assets/sgame/close.png";e=Math.max(25,Math.floor(0.05*t));b.style.width=e+"px";b.style.height=e+"px";b.style.padding="5px";b.style.cursor="pointer";b.style.position="absolute";b.style.right=0;b.onclick=function(){u()};f.appendChild(b);if("lo"===s){var k=document.createElement("img");k.id="trafficLight";k.src="/assets/sgame/trafficLight/trafficLight_red.png";n=Math.max(40,Math.floor(0.085*t));b=Math.max(30,Math.floor(0.75*
n));k.style.height=n+"px";k.style.width=b+"px";k.style.padding="4px";k.style.position="absolute";k.style.left="0px";k.style.top="0px";k.style.background="#fff";k.style.borderRadius="0px 0px 20px 0px";k.style.borderRight="2px solid black";k.style.borderBottom="2px solid black";f.appendChild(k);k=document.createElement("iframe");k.src=h;h=Math.ceil(Math.max(e,n))+4;n=Math.floor(0.02*t);e=Math.floor(0.02*c);k.style.marginLeft=e+"px";k.style.marginTop=h+"px";k.style.width=Math.max(0,c-e-e)+"px";k.style.height=
Math.max(0,t-h-n)+"px";k.style.overflow="auto";k.scrolling="yes";k.style.frameBorder="0";k.style.borderStyle="none";k.setAttribute("allowfullscreen","false");f.appendChild(k)}else c=document.createElement("p"),c.id="dialog",c.innerHTML=n,c.style.padding="15px",c.style.marginTop="30px",c.style.marginBottom="20px",c.style.marginRight="20px",c.style.marginLeft="20px",c.style.textAlign="center",c.style.fontSize="24px",c.style.position="relative",c.style.cursor="default",c.style.color="#000",c.style.fontFamily=
"initial",f.appendChild(c);g=f;a=s;document.body.appendChild(f);"lo"===s&&SGAME.Observer.start(k,l,v)},closeCurrentFancybox:u}}();SGAME.Observer=function(d){var g=!0,a=d,p=d,m=d,u,q,r,s,f,c,t=function(){m=p=a=d;u=Date.now();q=!1;c=f=s=r=d},e=function(){!1===p.acts_as_asset&&"undefined"!==typeof m&&(m.addListener("cmi.success_status",function(a){r=a;"passed"===r&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),m.addListener("cmi.score.scaled",function(a){s=a;0.8<=s&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
m.addListener("cmi.completion_status",function(a){f=a}),m.addListener("cmi.progress_measure",function(a){c=a}))};return{start:function(b,c,d){if(!1===g||"undefined"!=typeof a)return null;g=!1;t();a=b;p=c;m=d;e();SGAME.TrafficLight.changeColor("red");if(!0===p.acts_as_asset){b:{b=p.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration)))break b;b=null}b=!b||0>=b?15:Math.min(0.5*
b,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===g||"undefined"==typeof a)return null;g=!0;SGAME.TrafficLight.stop();var b=Math.round((Date.now()-u)/1E3);q="green"===SGAME.TrafficLight.getCurrentColor();b={lo_metadata:p,time:b,success:q};"undefined"!=typeof r&&(b.scorm_success_status=r);"undefined"!=typeof s&&(b.scorm_scaled_score=s);"undefined"!=typeof f&&(b.scorm_completion_status=f);"undefined"!=typeof c&&(b.scorm_progress_measure=
c);t();return b},isStopped:function(){return g}}}();SGAME.TrafficLight=function(d){var g,a,p,m,u,q=function(a){var c=document.getElementById("trafficLight");c&&(g=a,c.src=r(a))},r=function(a){switch(a){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},s=function(a,c){var d=document.getElementById("trafficLight");if(d){var e=!1;m=
setInterval(function(){d&&(e?(d.src=r(null),e=!1):(d.src=r(a),e=!0))},500);u=setTimeout(function(){clearTimeout(m)},1E3*c)}};return{getCurrentColor:function(){return g},changeColor:function(d,c){c?a=setTimeout(function(){q(d)},1E3*c):q(d)},setUpBlink:function(a,c,d){d?p=setTimeout(function(){s(a,c)},1E3*d):s(a,c)},stop:function(){a&&clearTimeout(a);p&&clearTimeout(p);m&&clearTimeout(m);u&&clearTimeout(u)}}}();SGAME.Utils=function(){var d=void 0;return{init:function(d){},getRandomElement:function(d){if("number"==typeof d)return d;var a;a=d.length-1;if("number"!=typeof a)throw{name:"Invalid number format exception"};a=Math.round(0+Math.random()*(a-0));return d[a]},loadScript:function(d,a){if("string"===typeof d&&"function"===typeof a){var p=document.getElementsByTagName("head")[0];if(p){var m=document.createElement("script");m.setAttribute("src",d);m.setAttribute("type","text/javascript");m.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||a()};m.onload=a;p.appendChild(m)}}},getProtocol:function(){if("undefined"!==typeof d)return d;var g;try{g=document.location.protocol}catch(a){}"string"===typeof g&&(g=g.match(/[\w]+/),g=g instanceof Array&&"string"===typeof g[0]?g[0]:void 0);return d="string"===typeof g?g:"unknown"},checkUrlProtocol:function(d){if("string"===typeof d){var a=d.match(/^https?:\/\//);if(a instanceof Array&&1===a.length){var a=a[0].replace("://",""),p=
SGAME.Utils.getProtocol();if(a!==p)switch(p){case "https":d="https"+d.replace(a,"")}}}return d}}}();
