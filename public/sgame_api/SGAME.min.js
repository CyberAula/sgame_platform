iso8601Parser=function(e){return{getDuration:function(l){var e=[31104E3,2592E3,604800,86400,3600,60,1];try{var a;var n=l;l=[2,3,4,5,7,8,9];var d=[0,0,0,0,0,0,0],h;if(n=n.toUpperCase()){if("string"!==typeof n)throw Error("Invalid iso8601 period string '"+n+"'");if(h=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(n))for(n=0;n<l.length;n++){var q=l[n];d[n]=h[q]?+h[q].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+n+"' is not a valid ISO8601 period.");}a=d}catch(p){return null}for(q=
h=0;q<a.length;q++)h+=a[q]*e[q];return h}}}();function Local_API_1484_11(e){function l(a,b){c.diganostic="The "+a+" of "+b+" must be a proper vocabulary element.";c.errorCode=406;return"false"}function k(a){c.errorCode=402;c.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function a(a,b){c.errorCode=201;c.diagnostic="The value for key "+a+" is not valid.";return"false"}function n(a,b,c){a=a.split(/\./);2>a.length?c[a[0]]=b:(c[a[0]]||(c[a[0]]={}),c=c[a.shift()],n(a.join("."),b,c))}function d(a,b){var c=a.split(/\./),
g;if(2>c.length)try{return b[c[0]]}catch(f){return k(a),"false"}else{g=c.shift();if(b[g])return String(d(c.join("."),b[g]));k(a);return"false"}}function h(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&(c+=1);return c}function q(a,b){if(c.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(b){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);
break;case 3:console.log(a);break;default:return console.log(a),!1}return!0}3>b&&c.throw_alerts&&alert(a);return!1}function p(a,b){if("function"==typeof c.listeners[a]&&"undefined"!=typeof b)c.listeners[a](b)}function f(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof a[c]?"object"==typeof b[c]&&(a[c]=f(a[c],b[c])):a[c]=b[c]);return a}function b(a,b){(function(){function a(b,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var v=document.createEvent("CustomEvent");v.initCustomEvent(b,c.bubbles,
c.cancelable,c.detail);return v}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}function s(a){return"object"!==type(a)||a.nodeType||isWindow(a)?!1:!(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))}var c=f({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},e),g={},m={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},r=this;"object"===typeof c.user&&("string"===typeof c.user.name&&(c.CMI.learner_name=c.user.name),"string"===typeof c.user.id&&(c.CMI.learner_id=c.user.id));this.isRunning=function(){return 1===c.initialized&&0===c.terminated};this.Initialize=function(){q(c.prefix+
":  Initializing...",3);c.cmi?(g=c.cmi,"suspend"===g.exit&&(g.entry="resume")):g=c.CMI;c.initialized=1;c.terminated=0;return"true"};this.GetValue=function(a){c.errorCode=0;var b="false";a=a.toString();var f=[];if(this.isRunning()){f=a.split(".");if(0<="|exit|session_time|".indexOf("|"+f[f.length-1]+"|"))return q(c.prefix+": This "+a+" is write only",4),c.errorCode=405,"false";f=a.toLowerCase().split(".");switch(f[0]){case "cmi":switch(b="false",a){case "cmi.exit":case "cmi.session_time":c.errorCode=
405;c.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;case "cmi.learner_name":b=c.CMI.learner_name;break;default:b=d(a.substr(4,a.length),g),"undefined"===b&&(c.errorCode=401,c.diagnostic="Sorry, there was a undefined response from "+a,b="false"),q(c.prefix+": GetValue "+a+" = "+b,4)}}return b}c.errorCode=123;return b};this.SetValue=function(b,f){q(c.prefix+": SetValue: "+b+" = "+f,4);c.errorCode=0;var m=[],r=b.toString(),e=f.toString(),d=0,k=0,d=[];if(this.isRunning()){d=
r.split(".");if("adl"===d[0]&&"id"===d[4]||"comments_from_lms"===d[1]||("comments_from_learner"===d[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+d[d.length-1]+"|")))return q(c.prefix+": This "+r+" is read only",4),c.errorCode=404,"false";m=r.split(".");switch(m[0]){case "cmi":switch(b){case "cmi.location":1E3<e.length&&q(c.prefix+": Some LMS's might truncate your bookmark as you've passed "+
e.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return a(b,e);d=Math.max(0,Math.min(1,d));p(b,d);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+e+"|"))return l(b,e);p(b,e);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return l(b,e);break;case "cmi.score.scaled":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return a(b,e);d=Math.max(0,
Math.min(1,d));p(b,d);break;case "cmi.score.min":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return a(b,e);c.CMI.score.min=d;break;case "cmi.score.max":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return a(b,e);c.CMI.score.max=d;break;case "cmi.score.raw":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return a(b,e);k=parseFloat(c.CMI.score.max);k="number"!=typeof k||isNaN(k)?100:k;m=parseFloat(c.CMI.score.min);m="number"!=typeof m||isNaN(m)?0:m;k-=m;0>=k&&(k=100);d=Math.max(0,Math.min(1,(d-
m)/k));p("cmi.score.scaled",d);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+e+"|"))return l(b,e);p(b,e);break;default:switch(m[1]){case "comments_from_lms":return c.errorCode="404",c.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===g.comments_from_learner._children.indexOf(m[3]))return l(b,e);n(r.substr(4,r.length),e,g);g.comments_from_learner._count=(h(g.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===g.interactions._children.indexOf(m[3]))return l(b,e);g.interactions._count=(h(g.interactions)-2).toString();if(isNaN(parseInt(m[2],10)))return"false";if(!s(g.interactions[m[2]])){if("id"===m[3])return g.interactions[m[2]]={},n(r.substr(4,r.length),e,g),g.interactions._count=(h(g.interactions)-2).toString(),s(g.interactions[m[2]].objectives)||(q(c.prefix+": Constructing objectives object for new interaction",4),g.interactions[m[2]].objectives={},g.interactions[m[2]].objectives._count=
"-1"),s(g.interactions[m[2]].correct_responses)||(q(c.prefix+": Constructing correct responses object for new interaction",4),g.interactions[m[2]].correct_responses={},g.interactions[m[2]].correct_responses._count="-1"),"true";q("Can't add interaction without ID first!",3);return"false"}if("objectives"===m[3]){if("id"===m[5])for(k=parseInt(g.interactions[m[2]].objectives._count,10),d=0;d<k;d+=1){if(g.interactions[m[2]].objectives[d].id===e)return r=b,c.errorCode="351",c.diagnostic="The "+r+" element must be unique.  The value '"+
e+"' has already been set in #"+d,"false"}else return l(b,e);n(r.substr(4,r.length),e,g);g.interactions[m[2]].objectives._count=(h(g.interactions[m[2]].objectives)-1).toString();return"true"}"correct_responses"===m[3]&&(n(r.substr(4,r.length),e,g),g.interactions[m[2]].correct_responses._count=(h(g.interactions[m[2]].correct_responses)-1).toString());n(r.substr(4,r.length),e,g);g.interactions._count=(h(g.interactions)-2).toString();return"true";case "objectives":if("id"===m[3])for(k=parseInt(g.objectives._count,
10),d=0;d<k;d+=1)if(g.objectives[d].id===e)return c.errorCode="351",c.diagnostic="The objectives.id element must be unique.  The value '"+e+"' has already been set in objective #"+d,"false";if("id"!==m[3]&&(d=parseInt(m[2],10),void 0===g.objectives[d]))return c.errorCode="408",c.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(m[2],10)))return"false";n(r.substr(4,r.length),e,g);g.objectives._count=(h(g.objectives)-2).toString();return"true"}}n(r.substr(4,
r.length),e,g)}return"true"}c.errorCode=c.terminated?133:132;return"false"};this.Commit=function(){q(c.prefix+": Commit CMI Object:",4);q(g);q(c.prefix+": Suspend Data Usage "+(Math.round(100*(g.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));b("StoreData",{runtimedata:g});return"true"};this.Terminate=function(){r.Commit();c.terminated=1;c.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==m[a])?m[a]:""};this.GetLastError=function(){return c.errorCode};
this.GetDiagnostic=function(){return c.diagnostic};this.setCMILMSValue=function(a,b){"string"==typeof a&&(c.CMI[a]=b)};this.addListener=function(a,b){"string"==typeof a&&"function"==typeof b&&(c.listeners[a]=b)}};function Local_API_SCORM_12(e){function l(a,c){b.diganostic="The "+a+" of "+c+" must be a proper vocabulary element.";b.errorCode=406;return"false"}function k(a){b.errorCode=402;b.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function a(a,c){b.errorCode=201;b.diagnostic="The value for key "+a+" is not valid.";return"false"}function n(a,b,c){a=a.split(/\./);2>a.length?c[a[0]]=b:(c[a[0]]||(c[a[0]]={}),c=c[a.shift()],n(a.join("."),b,c))}function d(a,b){var c=a.split(/\./),
f;if(2>c.length)try{return b[c[0]]}catch(g){return k(a),"false"}else{f=c.shift();if(b[f])return String(d(c.join("."),b[f]));k(a);return"false"}}function h(a,c){if(b.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(c){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>c&&b.throw_alerts&&alert(a);return!1}function q(a,c){if("function"==typeof b.listeners[a]&&"undefined"!=typeof c)b.listeners[a](c)}function p(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof a[c]?"object"==typeof b[c]&&(a[c]=p(a[c],b[c])):a[c]=b[c]);return a}function f(a,b){(function(){function a(b,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var f=document.createEvent("CustomEvent");f.initCustomEvent(b,c.bubbles,c.cancelable,c.detail);return f}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}var b=p({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},e),s={},c={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},g=this;"object"===typeof b.user&&("string"===typeof b.user.name&&(b.CMI.core.student_name=b.user.name),"string"===typeof b.user.id&&(b.CMI.core.student_id=b.user.id));this.isRunning=function(){return 1===b.initialized&&0===b.terminated};this.LMSInitialize=function(){h(b.prefix+":  Initializing...",3);s=b.CMI;b.initialized=1;b.terminated=
0;return"true"};this.LMSGetValue=function(a){b.errorCode=0;var c="false";a=a.toString();var f=[];if(this.isRunning()){f=a.split(".");if(0<="|exit|session_time|".indexOf("|"+f[f.length-1]+"|"))return b.errorCode=405,"false";f=a.toLowerCase().split(".");switch(f[0]){case "cmi":c=a;a="false";switch(c){case "cmi.core.exit":case "cmi.core.session_time":b.errorCode=405;b.diagnostic="Sorry, this has been specified as a read-only value for "+c;break;default:c=c.replace("cmi.",""),a=d(c,s),"undefined"===a&&
(b.errorCode=401,b.diagnostic="Sorry, there was a undefined response from "+c,a="false")}c=a}return c}b.errorCode=123;return c};this.LMSSetValue=function(c,f){h(b.prefix+": SetValue: "+c+" = "+f,4);b.errorCode=0;var g=[],d=c.toString(),e=f.toString();if(this.isRunning()){var g=d.split("."),k=g[g.length-1],g="adl"===g[0]&&"id"===g[4]?!0:"comments_from_lms"===g[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
k+"|");if(g)return b.errorCode=404,"false";g=d.split(".");switch(g[0]){case "cmi":switch(c){case "cmi.core.lesson_location":1E3<e.length&&h(b.prefix+": Some LMS's might truncate your bookmark as you've passed "+e.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+e+"|"))return l(c,e);q(c,e);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return l(c,
e);break;case "cmi.core.score.min":g=parseFloat(e);if("number"!=typeof g||isNaN(g))return a(c,e);b.CMI.core.score.min=g;break;case "cmi.core.score.max":g=parseFloat(e);if("number"!=typeof g||isNaN(g))return a(c,e);b.CMI.core.score.max=g;break;case "cmi.core.score.raw":g=parseFloat(e);if("number"!=typeof g||isNaN(g))return a(c,e);var p=parseFloat(b.CMI.core.score.max),p="number"!=typeof p||isNaN(p)?100:p,k=parseFloat(b.CMI.core.score.min),k="number"!=typeof k||isNaN(k)?0:k,p=p-k;0>=p&&(p=100);g=Math.max(0,
Math.min(1,(g-k)/p));q("cmi.score.scaled",g)}d=d.replace("cmi.","");n(d,e,s)}return"true"}b.errorCode=b.terminated?133:132;return"false"};this.LMSCommit=function(){f("StoreData",{runtimedata:s});return"true"};this.LMSTerminate=function(){g.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSFinish=function(){g.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==c[a])?c[a]:""};this.LMSGetLastError=function(){return b.errorCode};
this.LMSGetDiagnostic=function(){return b.diagnostic};this.setCMILMSValue=function(a,c){"string"==typeof a&&(b.CMI[a]=c)};this.addListener=function(a,c){"string"==typeof a&&"function"==typeof c&&(b.listeners[a]=c)}};SGAME=function(){return{init:function(e){return SGAME.CORE.init(e)},loadSettings:function(e){return SGAME.CORE.loadSettings(e)},triggerLO:function(e,l){return SGAME.CORE.triggerLO(e,l)},showLO:function(e,l){return SGAME.CORE.showLO(e,l)},showRandomLO:function(e){return SGAME.CORE.showRandomLO(e)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(e){return SGAME.CORE.losCanBeShown(e)},successWhenNoLOs:function(e){return SGAME.CORE.successWhenNoLOs(e)}}}();
SGAME.VERSION="0.7";SGAME.AUTHORS="Aldo Gordillo, Enrique Barra";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var e=!1;return{init:function(l){!0===l&&(e=l)},isDebugging:function(){return e},log:function(l){e&&window.console&&console.log(l)}}}();SGAME.Messenger=function(){function e(b,f){this.data=b||{};-1!==["PROTOCOL","APP"].indexOf(f)?this.type=f:this.type="APP";this.origin=a;this.destination=n}var l=["PROTOCOL","APP"],k=["SGAME_GATEWAY","SGAME_API"],a="SGAME_API",n="SGAME_GATEWAY",d=!1,h=!1,q=function(a){try{window.parent.parent.postMessage(a,"*")}catch(f){}},p=function(b){var d;d="object"!==typeof b||"string"!==typeof b.data?!1:f(b.data);if(d)switch(b=JSON.parse(b.data),b.type){case "PROTOCOL":if(b.data)switch(b.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
b.origin&&!0!==h&&(h=!0,b.data.settings=SGAME.CORE.getSettings(),b.destination=b.origin,b.origin=a,q(JSON.stringify(b)),SGAME.CORE.onConnectedToVLE())}break;case "APP":if(b.data&&"string"===typeof b.data.key)switch(b.data.key){case "lms_data":if("object"===typeof b.data.value){d=b.data.value;b={};if("string"===typeof d.name||"number"===typeof d.name)b.name=""+d.name;if("string"===typeof d.id||"number"===typeof d.id)b.id=""+d.id;d=SGAME.CORE.getVLEData();d.user=b;SGAME.CORE.setVLEData(d)}}}},f=function(a){try{if(a=
JSON.parse(a),-1===l.indexOf(a.type)||-1===k.indexOf(a.origin))return!1}catch(f){return!1}return!0};return{init:function(a){if(!d){d=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",p,!1):window.attachEvent&&window.parent.attachEvent("message",p)}catch(f){}}},isConnected:function(){return h},sendMessage:function(a){d&&h&&(a=JSON.stringify(new e(a,void 0)),f(a)&&q(a))}}}();SGAME.API=function(){var e=function(e,k){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(a.responseText);k(e)}};a.open("GET",e,!0);a.send("")};return{init:function(){},requestLOMetadata:function(l,k,a){try{e("undefined"==typeof l?"/lo/random/metadata.json":"/lo/"+l+"/metadata.json",function(a){k(a)})}catch(n){a(n)}}}}();SGAME.CORE=function(){var e={},l=void 0,k="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},n=!1,d={},h={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},q=["repeat","repeat_unless_successfully_consumed","no_repeat"],p=["no_restrictions","n_times","1_per_timeperiod"],f=["random","linear_completion","linear_success","custom"],b="all_los percentage_los n_los n_times disabled onstart".split(" "),
s="all_los percentage_los n_los n_times disabled onstart oncompletion".split(" "),c="no_more_los all_los_consumed all_los_succesfully_consumed completion_status success_status never".split(" "),g=["success","failure","success_unless_damage","failure_unless_blocking"],m=!1,r=0,v=0,w=0,x=0,t=0,D=!1,z=void 0,E=function(u){a=u;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&
(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===q.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===p.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1===f.indexOf(a.sequencing.approach)&&(a.sequencing.approach="random",delete a.sequencing.sequence);-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||delete a.sequencing.interruptions_n;-1!==
["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===b.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;
-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);-1===s.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;-1!==
["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===c.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===g.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&
(k=a.game_settings.completion_notification_text);if("object"===typeof a.los){u=Object.keys(a.los);r=u.length;for(var d=0;d<r;d++)"undefined"!==typeof a.los[u[d]].url&&(a.los[u[d]].url=SGAME.Utils.checkUrlProtocol(a.los[u[d]].url)),a.los[u[d]].can_be_shown=!0,a.los[u[d]].shown=!1,a.los[u[d]].nshown=0,a.los[u[d]].succesfully_consumed=!1,a.los[u[d]].nsuccess=0,a.los[u[d]].groups=[],a.los[u[d]].acts_as_asset="asset"===a.los[u[d]].scorm_type||"sco"===a.los[u[d]].scorm_type&&!1===a.los[u[d]].report_data,
m=!0}"random"!==a.sequencing.approach&&(u=SGAME.Sequencing.validateSequence(a.sequencing.sequence,a.los),!1===u?(a.sequencing.approach="random",delete a.sequencing.sequence):a.sequencing.sequence=u);if("object"===typeof a.sequencing.sequence)for(u=Object.keys(a.sequencing.sequence),_nGroups=u.length,d=0;d<_nGroups;d++){var e=a.sequencing.sequence[u[d]];e.can_be_shown="undefined"===typeof e.conditions||0===e.conditions.length;e.shown=!1;e.succesfully_consumed=!1;if("undefined"!==typeof e.conditions)for(var h=
0;h<e.conditions.length;h++)e.conditions[h].met=!1;a.sequencing.sequence[u[d]]=e;for(h=0;h<e.los.length;h++)a.los[e.los[h]].groups.push(e.id)}},C=function(b,c){var d=F(b);if(1>d.length)return A(b,c);var g=G(d);if(0<g.length){d=void 0;switch(a.sequencing.approach){case "linear_completion":case "linear_success":case "custom":for(var d=[],f=[],e=[],h=0;h<g.length;h++)e.push(g[h].id);for(var g=Object.keys(a.sequencing.sequence),l=0;l<g.length;l++){var n=a.sequencing.sequence[g[l]];if(!0===n.can_be_shown)for(h=
0;h<n.los.length;h++)-1!==e.indexOf(n.los[h])&&-1===f.indexOf(n.los[h])&&(f.push(n.los[h]),d.push(a.los[n.los[h]]))}d=H(d);break;default:d=H(g)}selectedLO=d;B(selectedLO,c)}else"function"===typeof c&&(d=I(b),c(d.success,d))},A=function(a,b){if("function"===typeof b){var c=I(a);b(c.success,c)}},F=function(b){var c=[];b=a.event_mapping[b];if("undefined"!==typeof b){var d=b.length;if("number"===typeof d)for(var g=0;g<d;g++){if("*"===b[g]){c=[];b=Object.keys(a.los);for(d=0;d<b.length;d++)"undefined"!==
typeof a.los[b[d]]&&c.push(a.los[b[d]]);break}"undefined"!==typeof a.los[b[g]]&&c.push(a.los[b[g]])}}return c},G=function(a){for(var b=[],c=a.length,d=0;d<c;d++)!0===a[d].can_be_shown&&b.push(a[d]);return b},B=function(b,c){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof c&&c(null,null):(z=new Date,y(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(d){!0!==a.los[b.id].succesfully_consumed&&(a.los[b.id].succesfully_consumed=d.success);!0===d.success&&
(a.los[b.id].nsuccess+=1);"random"!==a.sequencing.approach&&(a.sequencing.sequence=SGAME.Sequencing.updateGroupsTracking(a.los[b.id],a.sequencing.sequence,a.los));switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].succesfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}N();d.more_los=m;J(function(){"function"===typeof c&&c(d.success,d);y()})}))},y=function(){"function"===typeof l&&l()},N=function(){var b=Object.keys(a.los),
c=b.length;t=x=w=v=0;m=!1;for(var d=0;d<c;d++)!0===a.los[b[d]].shown&&(v+=1,w+=a.los[b[d]].nshown),!0===a.los[b[d]].succesfully_consumed&&(x+=1,t+=a.los[b[d]].nsuccess),!0===a.los[b[d]].can_be_shown&&(m=!0);b=0;c="incompleted";switch(a.game_settings.completion_status){case "all_los":a.game_settings.completion_status_n=100;case "percentage_los":d=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100;b=0>=d||0>=r?1:v/r/d;break;case "n_los":d=Math.min(a.game_settings.completion_status_n,
r);b=0===d?1:v/d;break;case "n_times":b=0>=a.game_settings.completion_status_n?1:w/a.game_settings.completion_status_n;break;case "onstart":b=1}b=Math.max(Math.min(1,+b.toFixed(2)),0);c=1===b?"completed":"incompleted";d=0;switch(a.game_settings.success_status){case "all_los":a.game_settings.success_status_n=100;case "percentage_los":d=Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;d=0>=d||0>=r?1:x/r/d;break;case "n_los":d=Math.min(a.game_settings.success_status_n,r);d=0===d?1:v/d;
break;case "n_times":d=0>=a.game_settings.success_status_n?1:t/a.game_settings.success_status_n;break;case "oncompletion":d=b;break;case "onstart":d=1}d=Math.max(Math.min(1,+d.toFixed(2)),0);h={progress_measure:b,completion_status:c,score:d,success_status:1===d?"passed":"failed"};SGAME.Messenger.sendMessage({key:"tracking",value:h})},J=function(a){!0!==K()?"function"===typeof a&&a(!1):O(a)},K=function(){if(!0===D)return!1;switch(a.game_settings.completion_notification){case "no_more_los":return!1===
m;case "all_los_consumed":return v>=r;case "all_los_succesfully_consumed":return x>=r;case "completion_status":return"completed"===h.completion_status;case "success_status":return"passed"===h.success_status;case "never":return!1;default:return!1}},O=function(a){D=!0;SGAME.Fancybox.create({dialog:!0,msg:k},function(){"function"===typeof a&&a(!0)})},H=function(a){for(var b=[],c,d=0;d<a.length;d++)"undefined"===typeof c&&(c=a[d].nshown),a[d].nshown<c&&(c=a[d].nshown,b=[]),c===a[d].nshown&&b.push(a[d]);
return SGAME.Utils.getRandomElement(b)},I=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:L(a),more_los:m}},L=function(b){var c;n&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof e.behaviour_when_no_more_los?c=e.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&
(c=a.game_settings.behaviour_when_no_more_los);return P(c,b)},P=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=M(b);return"undefined"!==typeof c&&"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=M(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},M=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof e.events&&"undefined"!==typeof e.events[b]?e.events[b]:{}};SGAME.Debugger.init(!1);
!1===n&&E({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(e=a)&&"function"===typeof a.togglePause&&(l=a.togglePause)},loadSettings:function(a){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(a);n=!0;E(a)},triggerLO:function(b,c){switch(a.sequencing.interruptions){case "no_restrictions":return C(b,c);case "n_times":return w>=a.sequencing.interruptions_n?A(b,c):C(b,c);case "1_per_timeperiod":return"undefined"!==typeof z&&
(new Date-z)/1E3<=a.sequencing.interruptions_n?A(b,c):C(b,c)}},showLO:B,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){B(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===m?!1:"undefined"===typeof a?m:0<G(F(a)).length},successWhenNoLOs:function(a){return L(a)},onConnectedToVLE:function(){"onstart"===a.game_settings.completion_status&&(h.progress_measure=
1,h.completion_status="completed");"onstart"===a.game_settings.success_status&&(h.score=1,h.success_status="passed");if("onstart"===a.game_settings.completion_status||"onstart"===a.game_settings.success_status)SGAME.Messenger.sendMessage({key:"tracking",value:h}),setTimeout(function(){!0===K()&&(y(),J(function(){y()}))},500)},getVLEData:function(){return d},setVLEData:function(a){return d=a}}}();var API,API_1484_11;
SGAME.Fancybox=function(e){var l=e,k=e,a=e,n=function(){"undefined"!=typeof l&&(l.style.display="none",l.parentNode.removeChild(l),"lo"===k&&(API_1484_11=API=e),k=l=e)},d=function(){if("undefined"!=typeof l){var d=k;n();var q;q="lo"===d?SGAME.Observer.stop():!0;var p=a;a=e;setTimeout(function(){"function"===typeof p&&p(q)},50)}};return{init:function(){},create:function(h,q){n();a=q;var p="undefined"!==typeof h&&!0===h.dialog?"dialog":"lo",f=4/3,b,s,c=0.9*window.innerWidth,g=0.9*window.innerHeight;
g*f>c?(b=c,s=b/f):(s=g,b=s*f);if("lo"===p)var m={},r;else var v="";h&&(h.width&&(b=h.width),h.height&&(s=h.height),"lo"===p?h.lo&&(m=h.lo,"string"===typeof m.url&&(r=m.url)):"string"==typeof h.msg&&(v=h.msg));if("lo"===p){if("string"!=typeof r||"undefined"==typeof m.scorm_type)return;var w=e,f=API_1484_11=API=e,x=SGAME.CORE.getVLEData();"object"===typeof x.user&&(f=x.user);"sco"===m.scorm_type&&("1.2"===m.scorm_version?w=API=new Local_API_SCORM_12({user:f,debug:SGAME.Debugger.isDebugging()}):"2004"===
m.scorm_version&&(w=API_1484_11=new Local_API_1484_11({user:f,debug:SGAME.Debugger.isDebugging()})))}f=document.createElement("div");f.style.width=b+"px";f.style.height=s+"px";f.style.maxWidth=c+"px";f.style.maxHeight=g+"px";f.style.overflow="lo"===p?"hidden":"auto";f.style.background="white";f.style.position="absolute";f.style.top=0;f.style.zIndex=9999;f.style.borderRadius="1em";f.style.border="2px solid black";f.setAttribute("id","sgame_fancybox");f.style.marginLeft=(window.innerWidth-b)/2+"px";
f.style.marginTop=(window.innerHeight-s)/2+"px";g=document.createElement("img");g.src="/assets/sgame/close.png";c=Math.max(25,Math.floor(0.05*s));g.style.width=c+"px";g.style.height=c+"px";g.style.padding="5px";g.style.cursor="pointer";g.style.position="absolute";g.style.right=0;g.onclick=function(){d()};f.appendChild(g);if("lo"===p){var t=document.createElement("img");t.id="trafficLight";t.src="/assets/sgame/trafficLight/trafficLight_red.png";v=Math.max(40,Math.floor(0.085*s));g=Math.max(30,Math.floor(0.75*
v));t.style.height=v+"px";t.style.width=g+"px";t.style.padding="4px";t.style.position="absolute";t.style.left="0px";t.style.top="0px";t.style.background="#fff";t.style.borderRadius="0px 0px 20px 0px";t.style.borderRight="2px solid black";t.style.borderBottom="2px solid black";f.appendChild(t);t=document.createElement("iframe");t.src=r;r=Math.ceil(Math.max(c,v))+4;v=Math.floor(0.02*s);c=Math.floor(0.02*b);t.style.marginLeft=c+"px";t.style.marginTop=r+"px";t.style.width=Math.max(0,b-c-c)+"px";t.style.height=
Math.max(0,s-r-v)+"px";t.style.overflow="auto";t.scrolling="yes";t.style.frameBorder="0";t.style.borderStyle="none";t.setAttribute("allowfullscreen","false");f.appendChild(t)}else b=document.createElement("p"),b.id="dialog",b.innerHTML=v,b.style.padding="15px",b.style.marginTop="30px",b.style.marginBottom="20px",b.style.marginRight="20px",b.style.marginLeft="20px",b.style.textAlign="center",b.style.fontSize="24px",b.style.position="relative",b.style.cursor="default",b.style.color="#000",b.style.fontFamily=
"initial",f.appendChild(b);l=f;k=p;document.body.appendChild(f);"lo"===p&&SGAME.Observer.start(t,m,w)},closeCurrentFancybox:d}}();SGAME.Observer=function(e){var l=!0,k=e,a=e,n=e,d,h,q,p,f,b,s=function(){n=a=k=e;d=Date.now();h=!1;b=f=p=q=e},c=function(){!1===a.acts_as_asset&&"undefined"!==typeof n&&(n.addListener("cmi.success_status",function(a){q=a;"passed"===q&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),n.addListener("cmi.score.scaled",function(a){p=a;0.8<=p&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
n.addListener("cmi.completion_status",function(a){f=a}),n.addListener("cmi.progress_measure",function(a){b=a}))};return{start:function(b,d,f){if(!1===l||"undefined"!=typeof k)return null;l=!1;s();k=b;a=d;n=f;c();SGAME.TrafficLight.changeColor("red");if(!0===a.acts_as_asset){b:{b=a.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration)))break b;b=null}b=!b||0>=b?15:Math.min(0.5*
b,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===l||"undefined"==typeof k)return null;l=!0;SGAME.TrafficLight.stop();var c=Math.round((Date.now()-d)/1E3);h="green"===SGAME.TrafficLight.getCurrentColor();c={lo_metadata:a,time:c,success:h};"undefined"!=typeof q&&(c.scorm_success_status=q);"undefined"!=typeof p&&(c.scorm_scaled_score=p);"undefined"!=typeof f&&(c.scorm_completion_status=f);"undefined"!=typeof b&&(c.scorm_progress_measure=
b);s();return c},isStopped:function(){return l}}}();SGAME.Sequencing=function(){var e=["completion","success"],l=function(a){for(var e=Object.keys(a),d=e.length,h=0;h<d;h++){var q=k(a[e[h]],e);!1!==q?a[e[h]]=q:delete a[e[h]]}return Object.keys(a).length===d?a:l(a)},k=function(a,l){if("undefined"===typeof a.conditions)return a;if("object"!==typeof a.conditions)return!1;if(0===a.conditions.length)return delete a.conditions,a;for(var d=[],h=0;h<a.conditions.length;h++){var k=a.conditions[h];-1!==l.indexOf(k.group+"")&&-1!==e.indexOf(k.requirement)&&d.push(k)}a.conditions=
d;return 0===a.conditions.length?!1:a};return{init:function(){},validateSequence:function(a,e){if("object"!==typeof a||"object"!==typeof e)return!1;for(var d=Object.keys(a),h=Object.keys(e),k=0;k<d.length;k++){var p;p=a[d[k]];for(var f=h,b=[],s=0;s<p.los.length;s++){var c=p.los[s];-1!==f.indexOf(c)&&b.push(c)}p.los=b;p=1>p.los.length?!1:p;!1!==p?a[d[k]]=p:delete a[d[k]]}a=l(a);d=Object.keys(a);h=[];for(k=0;k<d.length;k++)for(p=a[d[k]],f=0;f<p.los.length;f++)-1===h.indexOf(p.los[f])&&h.push(p.los[f]);
return 2>typeof d.length||2>h.length?!1:a},updateGroupsTracking:function(a,e,d){for(var h=0;h<a.groups.length;h++){var k=e,l=a.groups[h]+"",f;f=e[a.groups[h]+""];if(!0!==(f.shown&&f.succesfully_consumed)){for(var b=!0,s=!0,c=0;c<f.los.length;c++)var g=d[f.los[c]],b=b&&!0===g.shown,s=s&&!0===g.succesfully_consumed;f.shown=b;f.succesfully_consumed=s;f.succesfully_consumed&&(f.can_be_shown=!1)}k[l]=f}d=Object.keys(e);for(h=0;h<d.length;h++)if(f=e[d[h]],!1===f.can_be_shown&&!1===f.shown&&!1===f.succesfully_consumed){k=
e;l=d[h];b=e;if("undefined"!==typeof f.conditions){s=!0;for(c=0;c<f.conditions.length;c++)if(!1===f.conditions[c].met){switch(f.conditions[c].requirement){case "completion":f.conditions[c].met=!0===b[f.conditions[c].group+""].shown;break;case "success":f.conditions[c].met=!0===b[f.conditions[c].group+""].succesfully_consumed}s=s&&f.conditions[c].met;if(!1===s)break}f.can_be_shown=s}k[l]=f}for(d=0;d<a.groups.length;d++)if(f=e[a.groups[d]+""],!0===f.can_be_shown){h=e;k=a.groups[d]+"";l=f;a:{f=l;b=e;
s=Object.keys(b);for(g=c=0;g<s.length;g++){var m=b[s[g]];if(m.id!=f.id&&"undefined"!==typeof m.conditions)for(var r=0;r<m.conditions.length;r++)if(m.conditions[r].group==f.id&&(c+=1,!1===m.conditions[r].met)){f=!1;break a}}f=0<c}l.can_be_shown=!1===f;h[k]=l}return e}}}();SGAME.TrafficLight=function(e){var l,k,a,n,d,h=function(a){var b=document.getElementById("trafficLight");b&&(l=a,b.src=q(a))},q=function(a){switch(a){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},p=function(a,b){var e=document.getElementById("trafficLight");if(e){var c=!1;n=
setInterval(function(){e&&(c?(e.src=q(null),c=!1):(e.src=q(a),c=!0))},500);d=setTimeout(function(){clearTimeout(n)},1E3*b)}};return{getCurrentColor:function(){return l},changeColor:function(a,b){b?k=setTimeout(function(){h(a)},1E3*b):h(a)},setUpBlink:function(d,b,e){e?a=setTimeout(function(){p(d,b)},1E3*e):p(d,b)},stop:function(){k&&clearTimeout(k);a&&clearTimeout(a);n&&clearTimeout(n);d&&clearTimeout(d)}}}();SGAME.Utils=function(){var e=void 0;return{init:function(e){},getRandomElement:function(e){if("number"==typeof e)return e;var k;k=e.length-1;if("number"!=typeof k)throw{name:"Invalid number format exception"};k=Math.round(0+Math.random()*(k-0));return e[k]},loadScript:function(e,k){if("string"===typeof e&&"function"===typeof k){var a=document.getElementsByTagName("head")[0];if(a){var n=document.createElement("script");n.setAttribute("src",e);n.setAttribute("type","text/javascript");n.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||k()};n.onload=k;a.appendChild(n)}}},getProtocol:function(){if("undefined"!==typeof e)return e;var l;try{l=document.location.protocol}catch(k){}"string"===typeof l&&(l=l.match(/[\w]+/),l=l instanceof Array&&"string"===typeof l[0]?l[0]:void 0);return e="string"===typeof l?l:"unknown"},checkUrlProtocol:function(e){if("string"===typeof e){var k=e.match(/^https?:\/\//);if(k instanceof Array&&1===k.length){var k=k[0].replace("://",""),a=
SGAME.Utils.getProtocol();if(k!==a)switch(a){case "https":e="https"+e.replace(k,"")}}}return e}}}();
