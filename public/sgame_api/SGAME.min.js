iso8601Parser=function(f){return{getDuration:function(d){var f=[31104E3,2592E3,604800,86400,3600,60,1];try{var a;var l=d;d=[2,3,4,5,7,8,9];var r=[0,0,0,0,0,0,0],q;if(l=l.toUpperCase()){if("string"!==typeof l)throw Error("Invalid iso8601 period string '"+l+"'");if(q=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(l))for(l=0;l<d.length;l++){var s=d[l];r[l]=q[s]?+q[s].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+l+"' is not a valid ISO8601 period.");}a=r}catch(u){return null}for(s=
q=0;s<a.length;s++)q+=a[s]*f[s];return q},createTimestamp:function(d){return(new Date).toISOString()}}}();function Local_API_1484_11(f){function d(c,a){h.diganostic="The "+c+" of "+a+" must be a proper vocabulary element.";h.errorCode=406;return"false"}function n(c){h.errorCode=402;h.diagnostic="The value for key "+c+" has not been created yet.";return"false"}function a(c,a){h.errorCode=201;h.diagnostic="The value for key "+c+" is not valid.";return"false"}function l(c,a,k){c=c.split(/\./);2>c.length?k[c[0]]=a:(k[c[0]]||(k[c[0]]={}),k=k[c.shift()],l(c.join("."),a,k))}function r(c,a){var k=c.split(/\./),
b;if(2>k.length)try{return a[k[0]]}catch(e){return n(c),"false"}else{b=k.shift();if(a[b])return String(r(k.join("."),a[b]));n(c);return"false"}}function q(c){var a,k=0;for(a in c)c.hasOwnProperty(a)&&(k+=1);return k}function s(c,a){if(h.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(c);break;case 2:console.warn(c);break;case 4:console.info(c);
break;case 3:console.log(c);break;default:return console.log(c),!1}return!0}3>a&&h.throw_alerts&&alert(c);return!1}function u(c,a){if("function"==typeof h.listeners[c]&&"undefined"!=typeof a)h.listeners[c](a)}function v(c,a){for(var k in a)a.hasOwnProperty(k)&&("object"==typeof c[k]?"object"==typeof a[k]&&(c[k]=v(c[k],a[k])):c[k]=a[k]);return c}function b(c,a){(function(){function c(a,k){k=k||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(a,k.bubbles,
k.cancelable,k.detail);return b}if("function"===typeof window.CustomEvent)return!1;c.prototype=window.Event.prototype;window.CustomEvent=c})();document.dispatchEvent(new CustomEvent(c,{detail:a}))}function t(c){return"object"!==type(c)||c.nodeType||isWindow(c)?!1:!(c.constructor&&!hasOwn.call(c.constructor.prototype,"isPrototypeOf"))}var h=v({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},f),g={},p={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},k=this;"object"===typeof h.user&&("string"===typeof h.user.name&&(h.CMI.learner_name=h.user.name),"string"===typeof h.user.id&&(h.CMI.learner_id=h.user.id));this.isRunning=function(){return 1===h.initialized&&0===h.terminated};this.Initialize=function(){s(h.prefix+
":  Initializing...",3);h.cmi?(g=h.cmi,"suspend"===g.exit&&(g.entry="resume")):g=h.CMI;h.initialized=1;h.terminated=0;return"true"};this.GetValue=function(c){h.errorCode=0;var a="false";c=c.toString();var k=[];if(this.isRunning()){k=c.split(".");if(0<="|exit|session_time|".indexOf("|"+k[k.length-1]+"|"))return s(h.prefix+": This "+c+" is write only",4),h.errorCode=405,"false";k=c.toLowerCase().split(".");switch(k[0]){case "cmi":switch(a="false",c){case "cmi.exit":case "cmi.session_time":h.errorCode=
405;h.diagnostic="Sorry, this has been specified as a read-only value for "+c;break;case "cmi.learner_name":a=h.CMI.learner_name;break;default:a=r(c.substr(4,c.length),g),"undefined"===a&&(h.errorCode=401,h.diagnostic="Sorry, there was a undefined response from "+c,a="false"),s(h.prefix+": GetValue "+c+" = "+a,4)}}return a}h.errorCode=123;return a};this.SetValue=function(c,k){s(h.prefix+": SetValue: "+c+" = "+k,4);h.errorCode=0;var b=[],p=c.toString(),e=k.toString(),m=0,f=0,m=[];if(this.isRunning()){m=
p.split(".");if("adl"===m[0]&&"id"===m[4]||"comments_from_lms"===m[1]||("comments_from_learner"===m[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+m[m.length-1]+"|")))return s(h.prefix+": This "+p+" is read only",4),h.errorCode=404,"false";b=p.split(".");switch(b[0]){case "cmi":switch(c){case "cmi.location":1E3<e.length&&s(h.prefix+": Some LMS's might truncate your bookmark as you've passed "+
e.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":m=parseFloat(e);if("number"!=typeof m||isNaN(m))return a(c,e);m=Math.max(0,Math.min(1,m));u(c,m);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+e+"|"))return d(c,e);u(c,e);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return d(c,e);break;case "cmi.score.scaled":m=parseFloat(e);if("number"!=typeof m||isNaN(m))return a(c,e);m=Math.max(0,
Math.min(1,m));u(c,m);break;case "cmi.score.min":m=parseFloat(e);if("number"!=typeof m||isNaN(m))return a(c,e);h.CMI.score.min=m;break;case "cmi.score.max":m=parseFloat(e);if("number"!=typeof m||isNaN(m))return a(c,e);h.CMI.score.max=m;break;case "cmi.score.raw":m=parseFloat(e);if("number"!=typeof m||isNaN(m))return a(c,e);f=parseFloat(h.CMI.score.max);f="number"!=typeof f||isNaN(f)?100:f;b=parseFloat(h.CMI.score.min);b="number"!=typeof b||isNaN(b)?0:b;f-=b;0>=f&&(f=100);m=Math.max(0,Math.min(1,(m-
b)/f));u("cmi.score.scaled",m);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+e+"|"))return d(c,e);u(c,e);break;default:switch(b[1]){case "comments_from_lms":return h.errorCode="404",h.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===g.comments_from_learner._children.indexOf(b[3]))return d(c,e);l(p.substr(4,p.length),e,g);g.comments_from_learner._count=(q(g.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===g.interactions._children.indexOf(b[3]))return d(c,e);g.interactions._count=(q(g.interactions)-2).toString();if(isNaN(parseInt(b[2],10)))return"false";if(!t(g.interactions[b[2]])){if("id"===b[3])return g.interactions[b[2]]={},l(p.substr(4,p.length),e,g),g.interactions._count=(q(g.interactions)-2).toString(),t(g.interactions[b[2]].objectives)||(s(h.prefix+": Constructing objectives object for new interaction",4),g.interactions[b[2]].objectives={},g.interactions[b[2]].objectives._count=
"-1"),t(g.interactions[b[2]].correct_responses)||(s(h.prefix+": Constructing correct responses object for new interaction",4),g.interactions[b[2]].correct_responses={},g.interactions[b[2]].correct_responses._count="-1"),"true";s("Can't add interaction without ID first!",3);return"false"}if("objectives"===b[3]){if("id"===b[5])for(f=parseInt(g.interactions[b[2]].objectives._count,10),m=0;m<f;m+=1){if(g.interactions[b[2]].objectives[m].id===e)return p=c,h.errorCode="351",h.diagnostic="The "+p+" element must be unique.  The value '"+
e+"' has already been set in #"+m,"false"}else return d(c,e);l(p.substr(4,p.length),e,g);g.interactions[b[2]].objectives._count=(q(g.interactions[b[2]].objectives)-1).toString();return"true"}"correct_responses"===b[3]&&(l(p.substr(4,p.length),e,g),g.interactions[b[2]].correct_responses._count=(q(g.interactions[b[2]].correct_responses)-1).toString());l(p.substr(4,p.length),e,g);g.interactions._count=(q(g.interactions)-2).toString();return"true";case "objectives":if("id"===b[3])for(f=parseInt(g.objectives._count,
10),m=0;m<f;m+=1)if(g.objectives[m].id===e)return h.errorCode="351",h.diagnostic="The objectives.id element must be unique.  The value '"+e+"' has already been set in objective #"+m,"false";if("id"!==b[3]&&(m=parseInt(b[2],10),void 0===g.objectives[m]))return h.errorCode="408",h.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(b[2],10)))return"false";l(p.substr(4,p.length),e,g);g.objectives._count=(q(g.objectives)-2).toString();return"true"}}l(p.substr(4,
p.length),e,g)}return"true"}h.errorCode=h.terminated?133:132;return"false"};this.Commit=function(){s(h.prefix+": Commit CMI Object:",4);s(g);s(h.prefix+": Suspend Data Usage "+(Math.round(100*(g.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));b("StoreData",{runtimedata:g});return"true"};this.Terminate=function(){k.Commit();h.terminated=1;h.initialized=0;return"true"};this.GetErrorString=function(c){return""!==c&&(c=parseInt(c,10),void 0!==p[c])?p[c]:""};this.GetLastError=function(){return h.errorCode};
this.GetDiagnostic=function(){return h.diagnostic};this.setCMILMSValue=function(c,a){"string"==typeof c&&(h.CMI[c]=a)};this.addListener=function(a,k){"string"==typeof a&&"function"==typeof k&&(h.listeners[a]=k)}};function Local_API_SCORM_12(f){function d(a,k){b.diganostic="The "+a+" of "+k+" must be a proper vocabulary element.";b.errorCode=406;return"false"}function n(a){b.errorCode=402;b.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function a(a,k){b.errorCode=201;b.diagnostic="The value for key "+a+" is not valid.";return"false"}function l(a,k,c){a=a.split(/\./);2>a.length?c[a[0]]=k:(c[a[0]]||(c[a[0]]={}),c=c[a.shift()],l(a.join("."),k,c))}function r(a,k){var c=a.split(/\./),
b;if(2>c.length)try{return k[c[0]]}catch(w){return n(a),"false"}else{b=c.shift();if(k[b])return String(r(c.join("."),k[b]));n(a);return"false"}}function q(a,k){if(b.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(k){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>k&&b.throw_alerts&&alert(a);return!1}function s(a,k){if("function"==typeof b.listeners[a]&&"undefined"!=typeof k)b.listeners[a](k)}function u(a,k){for(var c in k)k.hasOwnProperty(c)&&("object"==typeof a[c]?"object"==typeof k[c]&&(a[c]=u(a[c],k[c])):a[c]=k[c]);return a}function v(a,k){(function(){function a(k,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(k,c.bubbles,c.cancelable,c.detail);return b}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:k}))}var b=u({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},f),t={},h={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},g=this;"object"===typeof b.user&&("string"===typeof b.user.name&&(b.CMI.core.student_name=b.user.name),"string"===typeof b.user.id&&(b.CMI.core.student_id=b.user.id));this.isRunning=function(){return 1===b.initialized&&0===b.terminated};this.LMSInitialize=function(){q(b.prefix+":  Initializing...",3);t=b.CMI;b.initialized=1;b.terminated=
0;return"true"};this.LMSGetValue=function(a){b.errorCode=0;var k="false";a=a.toString();var c=[];if(this.isRunning()){c=a.split(".");if(0<="|exit|session_time|".indexOf("|"+c[c.length-1]+"|"))return b.errorCode=405,"false";c=a.toLowerCase().split(".");switch(c[0]){case "cmi":k=a;a="false";switch(k){case "cmi.core.exit":case "cmi.core.session_time":b.errorCode=405;b.diagnostic="Sorry, this has been specified as a read-only value for "+k;break;default:k=k.replace("cmi.",""),a=r(k,t),"undefined"===a&&
(b.errorCode=401,b.diagnostic="Sorry, there was a undefined response from "+k,a="false")}k=a}return k}b.errorCode=123;return k};this.LMSSetValue=function(g,k){q(b.prefix+": SetValue: "+g+" = "+k,4);b.errorCode=0;var c=[],x=g.toString(),w=k.toString();if(this.isRunning()){var c=x.split("."),h=c[c.length-1],c="adl"===c[0]&&"id"===c[4]?!0:"comments_from_lms"===c[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
h+"|");if(c)return b.errorCode=404,"false";c=x.split(".");switch(c[0]){case "cmi":switch(g){case "cmi.core.lesson_location":1E3<w.length&&q(b.prefix+": Some LMS's might truncate your bookmark as you've passed "+w.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+w+"|"))return d(g,w);s(g,w);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+w+"|"))return d(g,
w);break;case "cmi.core.score.min":c=parseFloat(w);if("number"!=typeof c||isNaN(c))return a(g,w);b.CMI.core.score.min=c;break;case "cmi.core.score.max":c=parseFloat(w);if("number"!=typeof c||isNaN(c))return a(g,w);b.CMI.core.score.max=c;break;case "cmi.core.score.raw":c=parseFloat(w);if("number"!=typeof c||isNaN(c))return a(g,w);var e=parseFloat(b.CMI.core.score.max),e="number"!=typeof e||isNaN(e)?100:e,h=parseFloat(b.CMI.core.score.min),h="number"!=typeof h||isNaN(h)?0:h,e=e-h;0>=e&&(e=100);c=Math.max(0,
Math.min(1,(c-h)/e));s("cmi.score.scaled",c)}x=x.replace("cmi.","");l(x,w,t)}return"true"}b.errorCode=b.terminated?133:132;return"false"};this.LMSCommit=function(){v("StoreData",{runtimedata:t});return"true"};this.LMSTerminate=function(){g.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSFinish=function(){g.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==h[a])?h[a]:""};this.LMSGetLastError=function(){return b.errorCode};
this.LMSGetDiagnostic=function(){return b.diagnostic};this.setCMILMSValue=function(a,k){"string"==typeof a&&(b.CMI[a]=k)};this.addListener=function(a,k){"string"==typeof a&&"function"==typeof k&&(b.listeners[a]=k)}};SGAME=function(){return{init:function(f){return SGAME.CORE.init(f)},loadSettings:function(f){return SGAME.CORE.loadSettings(f)},triggerLO:function(f,d){return SGAME.CORE.triggerLO(f,d)},showLO:function(f,d){return SGAME.CORE.showLO(f,d)},showRandomLO:function(f){return SGAME.CORE.showRandomLO(f)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(f){return SGAME.CORE.losCanBeShown(f)},successWhenNoLOs:function(f){return SGAME.CORE.successWhenNoLOs(f)}}}();
SGAME.VERSION="1.0.2";SGAME.AUTHORS="Aldo Gordillo";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var f=!1;return{init:function(d){!0===d&&(f=d)},isDebugging:function(){return f},log:function(d){f&&window.console&&console.log(d)}}}();SGAME.Messenger=function(){function f(b,d){this.data=b||{};-1!==["PROTOCOL","APP"].indexOf(d)?this.type=d:this.type="APP";this.origin=a;this.destination=l}var d=["PROTOCOL","APP"],n=["SGAME_GATEWAY","SGAME_API"],a="SGAME_API",l="SGAME_GATEWAY",r=!1,q=!1,s=function(a){try{window.parent.parent.postMessage(a,"*")}catch(d){}},u=function(b){var d;d="object"!==typeof b||"string"!==typeof b.data?!1:v(b.data);if(d)switch(b=JSON.parse(b.data),b.type){case "PROTOCOL":if(b.data)switch(b.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
b.origin&&!0!==q&&(q=!0,b.data.settings=SGAME.CORE.getSettings(),b.destination=b.origin,b.origin=a,s(JSON.stringify(b)),SGAME.CORE.onConnectedToVLE())}break;case "APP":if(b.data&&"string"===typeof b.data.key)switch(b.data.key){case "lms_data":if("object"===typeof b.data.value){d=b.data.value;b={};if("string"===typeof d.name||"number"===typeof d.name)b.name=""+d.name;if("string"===typeof d.id||"number"===typeof d.id)b.id=""+d.id;d=SGAME.CORE.getVLEData();d.user=b;SGAME.CORE.setVLEData(d)}}}},v=function(a){try{if(a=
JSON.parse(a),-1===d.indexOf(a.type)||-1===n.indexOf(a.origin))return!1}catch(f){return!1}return!0};return{init:function(a){if(!r){r=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",u,!1):window.attachEvent&&window.parent.attachEvent("message",u)}catch(d){}}},isConnected:function(){return q},sendMessage:function(a){r&&q&&(a=JSON.stringify(new f(a,void 0)),v(a)&&s(a))}}}();var API,API_1484_11;
SGAME.Fancybox=function(f){var d=f,n=f,a=f,l,r=function(){"undefined"!=typeof d&&(d.style.display="none",d.parentNode.removeChild(d),"lo"===n&&(API_1484_11=API=f),n=d=f)},q=function(){if("undefined"!=typeof d){var l=n;r();var q;q="lo"===l?SGAME.Observer.stop():!0;var v=a;a=f;setTimeout(function(){"function"===typeof v&&v(q)},50)}};return{init:function(a){"string"===typeof a&&(l=a)},create:function(s,u){r();a=u;var v="undefined"!==typeof s&&!0===s.dialog?"dialog":"lo",b=4/3,t,h,g=0.9*window.innerWidth,
p=0.9*window.innerHeight;p*b>g?(t=g,h=t/b):(h=p,t=h*b);if("lo"===v)var k={},c;else var x="";s&&(s.width&&(t=s.width),s.height&&(h=s.height),"lo"===v?s.lo&&(k=s.lo,"string"===typeof k.url&&(c=k.url)):"string"==typeof s.msg&&(x=s.msg));if("lo"===v){if("string"!=typeof c||"undefined"==typeof k.scorm_type)return;var w=f,b=API_1484_11=API=f,y=SGAME.CORE.getVLEData();"object"===typeof y.user&&(b=y.user);"sco"===k.scorm_type&&("1.2"===k.scorm_version?w=API=new Local_API_SCORM_12({user:b,debug:SGAME.Debugger.isDebugging()}):
"2004"===k.scorm_version&&(w=API_1484_11=new Local_API_1484_11({user:b,debug:SGAME.Debugger.isDebugging()})))}b=document.createElement("div");b.style.width=t+"px";b.style.height=h+"px";b.style.maxWidth=g+"px";b.style.maxHeight=p+"px";b.style.overflow="lo"===v?"hidden":"auto";b.style.background="white";b.style.position="absolute";b.style.top=0;b.style.zIndex=9999;b.style.borderRadius="1em";b.style.border="2px solid black";b.setAttribute("id","sgame_fancybox");b.style.marginLeft=(window.innerWidth-
t)/2+"px";b.style.marginTop=(window.innerHeight-h)/2+"px";p=document.createElement("img");p.src=l+"close.png";g=Math.max(25,Math.floor(0.05*h));p.style.width=g+"px";p.style.height=g+"px";p.style.padding="5px";p.style.cursor="pointer";p.style.position="absolute";p.style.right=0;p.onclick=function(){q()};b.appendChild(p);if("lo"===v){var e=document.createElement("img");e.id="trafficLight";e.src=l+"trafficLight/trafficLight_red.png";x=Math.max(40,Math.floor(0.085*h));p=Math.max(30,Math.floor(0.75*x));
e.style.height=x+"px";e.style.width=p+"px";e.style.padding="4px";e.style.position="absolute";e.style.left="0px";e.style.top="0px";e.style.background="#fff";e.style.borderRadius="0px 0px 20px 0px";e.style.borderRight="2px solid black";e.style.borderBottom="2px solid black";b.appendChild(e);e=document.createElement("iframe");e.src=c;c=Math.ceil(Math.max(g,x))+4;x=Math.floor(0.02*h);g=Math.floor(0.02*t);e.style.marginLeft=g+"px";e.style.marginTop=c+"px";e.style.width=Math.max(0,t-g-g)+"px";e.style.height=
Math.max(0,h-c-x)+"px";e.style.overflow="auto";e.scrolling="yes";e.style.frameBorder="0";e.style.borderStyle="none";e.setAttribute("allowfullscreen","false");b.appendChild(e)}else t=document.createElement("p"),t.id="dialog",t.innerHTML=x,t.style.padding="15px",t.style.marginTop="30px",t.style.marginBottom="20px",t.style.marginRight="20px",t.style.marginLeft="20px",t.style.textAlign="center",t.style.fontSize="24px",t.style.position="relative",t.style.cursor="default",t.style.color="#000",t.style.fontFamily=
"initial",b.appendChild(t);d=b;n=v;document.body.appendChild(b);"lo"===v&&SGAME.Observer.start(e,k,w)},closeCurrentFancybox:q}}();SGAME.TrafficLight=function(f){var d,n,a,l,r,q,s=function(a){var f=document.getElementById("trafficLight");f&&(d=a,f.src=u(a))},u=function(a){switch(a){case "green":return q+"trafficLight/trafficLight_green.png";case "yellow":return q+"trafficLight/trafficLight_yellow.png";case "red":return q+"trafficLight/trafficLight_red.png";default:return q+"trafficLight/trafficLight.png"}},v=function(a,d){var h=document.getElementById("trafficLight");if(h){var g=!1;l=setInterval(function(){h&&(g?(h.src=u(null),
g=!1):(h.src=u(a),g=!0))},500);r=setTimeout(function(){clearTimeout(l)},1E3*d)}};return{init:function(a){"string"===typeof a&&(q=a)},getCurrentColor:function(){return d},changeColor:function(a,d){d?n=setTimeout(function(){s(a)},1E3*d):s(a)},setUpBlink:function(b,d,h){h?a=setTimeout(function(){v(b,d)},1E3*h):v(b,d)},stop:function(){n&&clearTimeout(n);a&&clearTimeout(a);l&&clearTimeout(l);r&&clearTimeout(r)}}}();SGAME.Sequencing=function(){var f,d="completion completion_higher_inmediate success fail score_higher score_higher_inmediate score_lower".split(" "),n=function(a){if("object"!==typeof a)return a;a.met=!1;if("multiple"===a.type&&Array.isArray(a.conditions))for(var c=0;c<a.conditions.length;c++)a.conditions[c]=n(a.conditions[c]);return a},a=function(k){for(var c=Object.keys(k),b=c.length,d=0;d<b;d++)"undefined"!==typeof k[c[d]].condition&&(k[c[d]].condition=l(k[c[d]].condition,c),!1===k[c[d]].condition&&
delete k[c[d]]);return Object.keys(k).length===b?k:a(k)},l=function(a,c){if("object"!==typeof a||"undefined"===typeof a.id)return!1;a.id+="";switch(a.type){case "single":return r(a,c);case "multiple":var b;a:if(-1===["AND","OR"].indexOf(a.operator)||!1===Array.isArray(a.conditions)||1>a.conditions.length)b=!1;else{for(b=0;b<a.conditions.length;b++)if(a.conditions[b]=l(a.conditions[b],c),!1===a.conditions[b]){b=!1;break a}b=a}return b;default:return!1}},r=function(a,c){if("undefined"===typeof a.group)return!1;
a.group+="";if(-1===c.indexOf(a.group)||-1===d.indexOf(a.requirement))return!1;if(-1!==["completion_higher_inmediate","score_higher","score_higher_inmediate","score_lower"].indexOf(a.requirement)){if("string"===typeof a.threshold){if(!0===isNaN(a.threshold))return!1;a.threshold=parseInt(a.threshold)/100}if("number"!==typeof a.threshold||0>a.threshold||1<a.threshold||"score_lower"===a.requirement&&0===a.threshold)return!1}return a},q=function(a,c){if("undefined"===typeof a||!0===a.met)return a;switch(a.type){case "single":var b=
a,d=c[b.group],g=!0===d.shown,e=!1;switch(b.requirement){case "completion":e=g;break;case "completion_higher_inmediate":e=d.nshown/d.los.length>=b.threshold;break;case "success":e=g&&1===d.score;break;case "fail":e=g&&1>d.score;break;case "score_higher":e=g&&d.score>=b.threshold;break;case "score_higher_inmediate":e=d.score>=b.threshold;break;case "score_lower":e=g&&d.score<b.threshold}b.met=e;a=b;break;case "multiple":a:{b=a;for(d=0;d<b.conditions.length;d++)if(b.conditions[d]=q(b.conditions[d],
c),"OR"===b.operator&&!0===b.conditions[d].met){b.met=!0;a=b;break a}else if("AND"===b.operator&&!1===b.conditions[d].met){b.met=!1;a=b;break a}"OR"===b.operator?b.met=!1:"AND"===b.operator&&(b.met=!0);a=b}}return a},s=function(a,c){for(var b=Object.keys(c),d=!1,g=0;g<b.length;g++){var e=c[b[g]];if(e.id!=a.id&&"undefined"!==typeof e.condition)for(var h=u(e.condition,a),l=0;l<h.length;l++){if(!0===h[l].met)return!0;!1===e.unlocked&&(d=!0)}}if(!0===d)return!1;switch(f){case "linear_success":return 1===
a.score;default:return!0===a.shown}},u=function(a,c){switch(a.type){case "single":if(a.group===c.id)return[a];break;case "multiple":for(var b=[],d=0;d<a.conditions.length;d++)b=b.concat(u(a.conditions[d],c));return b}return[]},v=function(a,c,b){for(var d=0;d<a.los.length;d++)c[a.los[d]].can_be_shown=b;return c},b=void 0,t=void 0,h=function(a,c){if("undefined"===typeof t){if("undefined"!==typeof c){for(var d=[],h=Object.keys(c),l=0;l<h.length;l++)"undefined"!==typeof c[h[l]].groups&&0!==c[h[l]].groups.length||
d.push(h[l]);t=d.length}t=0}switch(f){case "linear_success":case "linear_completion":if("undefined"!==typeof b)return b;for(var d=0,h=Object.keys(a),l=h.length,e=0;e<l;e++)d+=a[h[e]].los.length;break;case "custom":d=g(a);break;default:d=0}return b=d+t},g=function(a){a=JSON.parse(JSON.stringify(a));for(var c=Object.keys(a),b=c.length,d=[],h=0;h<b;h++){var e=a[c[h]];if(!1===e.unlocked&&"undefined"!==typeof e.condition&&!1===e.locked)for(var m=0;m<b;m++){var f=a[c[m]];if(!0===f.unlocked&&!1===f.locked&&
f.id!==e.id){var l=u(e.condition,f);if(0<l.length&&!1===l[0].met){var q=l[0],s={conditionsToMet:[],groupsToLock:[],groupsToUnlock:[]};s.conditionsToMet.push({id:q.id,group:e.id});s.groupsToLock.push(f.id);"multiple"===e.condition.type&&"OR"===e.condition.operator||"single"===e.condition.type?s.groupsToUnlock.push(e.id):"multiple"===e.condition.type&&"AND"===e.condition.operator&&!0===p(q.id,JSON.parse(JSON.stringify(e.condition))).met&&s.groupsToUnlock.push(e.id);for(q=0;q<b;q++){var n=a[c[q]];if(!1===
n.unlocked&&!1===n.locked&&n.id!==e.id&&n.id!==f.id&&"undefined"!==typeof n.condition){var r=u(n.condition,f);if(0<r.length&&!1===r[0].met){var t=!1;switch(l[0].requirement){case "completion":case "completion_higher_inmediate":t=!0;break;case "success":t=-1===["fail","score_lower"].indexOf(r[0].requirement);break;case "fail":t=-1!==["score_higher","score_higher_inmediate","score_lower"].indexOf(r[0].requirement)?100!==r[0].threshold:-1===["success"].indexOf(r[0].requirement);break;case "score_higher":case "score_higher_inmediate":t=
-1!==["success"].indexOf(r[0].requirement)?100===l[0].threshold:-1!==["fail"].indexOf(r[0].requirement)?100>l[0].threshold:-1!==["score_lower"].indexOf(r[0].requirement)?r[0].threshold>l[0].threshold:!0;break;case "score_lower":t=-1!==["score_higher","score_higher_inmediate"].indexOf(r[0].requirement)?l[0].threshold>r[0].threshold:-1===["success"].indexOf(r[0].requirement)}t&&(s.conditionsToMet.push({id:r[0].id,group:n.id}),"multiple"===n.condition.type&&"OR"===n.condition.operator||"single"===n.condition.type?
s.groupsToUnlock.push(n.id):"multiple"===n.condition.type&&"AND"===n.condition.operator&&!0===p(r[0].id,JSON.parse(JSON.stringify(n.condition))).met&&s.groupsToUnlock.push(n.id))}}}d.push(s)}}}}c=d.length;if(0===c){d=0;c=Object.keys(a);b=c.length;for(h=0;h<b;h++)e=a[c[h]],!0===e.unlocked&&Array.isArray(e.los)&&(d+=e.los.length);return d}for(h=b=0;h<c;h++){e=JSON.parse(JSON.stringify(a));for(m=0;m<d[h].groupsToLock.length;m++)e[d[h].groupsToLock[m]].locked=!0;for(m=0;m<d[h].groupsToUnlock.length;m++)e[d[h].groupsToUnlock[m]].unlocked=
!0;for(m=0;m<d[h].conditionsToMet.length;m++)e[d[h].conditionsToMet[m].group].condition=p(d[h].conditionsToMet[m].id,e[d[h].conditionsToMet[m].group].condition);e=g(e);e>b&&(b=e)}return b},p=function(a,c){if(c.id===a)c.met=!0;else if("multiple"===c.type){c.met="AND"===c.operator;for(var b=0;b<c.conditions.length;b++)if(c.conditions[b]=p(a,c.conditions[b]),!0!==c.conditions[b].met&&"AND"===c.operator)c.met=!1;else if(!0===c.conditions[b].met&&"OR"===c.operator){c.met=!0;break}}return c};return{init:function(a){f=
a.approach},initGroupSequence:function(a){a.can_be_shown="undefined"===typeof a.condition||0===Object.keys(a.condition).length;a.locked=!1;a.unlocked=a.can_be_shown;a.shown=!1;a.nshown=0;a.score=!1;a.performance=0;a.condition=n(a.condition);return a},validateSequence:function(b,c){if("object"!==typeof b||"object"!==typeof c)return!1;for(var d=Object.keys(b),h=Object.keys(c),g=0;g<d.length;g++){var e;e=b[d[g]];var f=h;if("undefined"===typeof e.id)e=!1;else{e.id+="";for(var l=[],n=0;n<e.los.length;n++){var q=
e.los[n];-1!==f.indexOf(q)&&l.push(q)}e.los=l;e=1>e.los.length?!1:e}!1!==e?b[d[g]]=e:delete b[d[g]]}b=a(b);d=Object.keys(b);h=[];for(g=0;g<d.length;g++)for(e=b[d[g]],f=0;f<e.los.length;f++)-1===h.indexOf(e.los[f])&&h.push(e.los[f]);return 2>typeof d.length||2>h.length?!1:b},getNLOsForTracking:h,updateGroupsTracking:function(a,c,d){for(var g=a.groups.length,f=0;f<g;f++){var e=c[a.groups[f]];if(!0===e.can_be_shown){for(var l=c,n=a.groups[f],r=e.los.length,p=0,t=0,u=0;u<r;u++){var B=d[e.los[u]];!0===
B.shown&&(p+=1);!0===B.successfully_consumed&&(t+=1)}e.shown=p===r;e.nshown=p;e.score=0<r?t/r:0;e.performance=0<p?t/p:0;l[n]=e}}f=!1;n=Object.keys(c);l=n.length;for(r=0;r<l;r++)e=c[n[r]],!1===e.unlocked&&!1===e.locked&&(p=c,t=n[r],!0!==e.locked&&!0!==e.unlocked&&("undefined"!==typeof e.condition?(e.condition=q(e.condition,c),!0===e.condition.met&&(e.unlocked=!0,e.can_be_shown=!0)):(e.unlocked=!0,e.can_be_shown=!0)),p[t]=e,!0===c[n[r]].unlocked&&(d=v(c[n[r]],d,!0),f=!0));for(r=0;r<g;r++)e=c[a.groups[r]],
!0===e.unlocked&&!1===e.locked&&(p=c,t=a.groups[r],!0!==e.locked&&!1!==e.unlocked&&(u=s(e,c),e.locked=u,e.can_be_shown=!1===e.locked),p[t]=e,!0===c[a.groups[r]].locked&&(d=v(c[a.groups[r]],d,!1),f=!0));a=!0;for(g=0;g<l;g++)if(e=c[n[g]],!0===e.unlocked&&!1===e.locked){a=!1;break}if(a)for(g=Object.keys(d),n=0;n<g.length;n++)if("undefined"===typeof d[g[n]].groups||0===d[g[n]].groups.length)d[g[n]].can_be_shown=!0;!0===f&&25>=l&&(b=h(c,d));return{groups:c,los:d,nLOsForTracking:b,finished:a}}}}();SGAME.Analytics=function(f){var d,n,a,l=function(d,f,l,n,v){var b={};"undefined"!==typeof d&&(b.actor={id:d});"undefined"!==typeof f&&(b.verb={id:f});"undefined"!==typeof l&&(b.object={id:l});"undefined"!==typeof n&&(b.result=n);"undefined"!==typeof v&&(b.context=v);b.timestamp=iso8601Parser.createTimestamp();a.push(b);console.log("Recorded statement");console.log(b)};return{init:function(f){"object"==typeof f.player&&"string"==typeof f.player.url&&"string"==typeof f.player.name&&(d={},d.id=f.player.url,
d.name=f.player.name);n=f.game_metadata.url;a=[];l(d,"accessed",n)},onVLEDataReceived:function(a){if("object"===typeof a.user){var f={};"string"===typeof a.user.id&&(f.id=a.user.id);"string"===typeof a.user.name&&(f.name=a.user.name);0<Object.keys(f).length&&(d=f,l(d,"accessed",n))}}}}();SGAME.API=function(){var f=function(d,f){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var d=JSON.parse(a.responseText);f(d)}};a.open("GET",d,!0);a.send("")};return{init:function(){},requestLOMetadata:function(d,n,a){try{f("undefined"==typeof d?"/lo/random/metadata.json":"/lo/"+d+"/metadata.json",function(a){n(a)})}catch(l){a(l)}}}}();SGAME.CORE=function(){var f={},d=void 0,n="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},l=!1,r={},q={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},s=["repeat","repeat_unless_successfully_consumed","no_repeat"],u=["no_restrictions","n_times","1_per_timeperiod"],v=["random","linear_completion","linear_success","custom"],b="all_los percentage_los n_los n_times disabled onstart".split(" "),
t="all_los percentage_los n_los n_times disabled onstart oncompletion".split(" "),h="no_more_los all_los_consumed all_los_successfully_consumed completion_status success_status never".split(" "),g=["success","failure","success_unless_damage","failure_unless_blocking"],p=!1,k=0,c=0,x=0,w=0,y=0,e=!1,m=void 0,z=!1,A=!1,D=0,E=function(b,c){var d=B(b);if(1>d.length)return F(b,c);var e=H(d);if(0<e.length){d=void 0;switch(a.sequencing.approach){case "linear_completion":case "linear_success":case "custom":if(!0===
z&&!1===A){for(var d=[],g=[],h=[],k=0;k<e.length;k++)h.push(e[k].id);e=Object.keys(a.sequencing.sequence);for(k=0;k<e.length;k++){var f=a.sequencing.sequence[e[k]];if(!0===f.can_be_shown)for(var l=0;l<f.los.length;l++)-1!==h.indexOf(f.los[l])&&-1===g.indexOf(f.los[l])&&(g.push(f.los[l]),d.push(a.los[f.los[l]]))}}else d=e;d=I(d);break;default:d=I(e)}selectedLO=d;G(selectedLO,c)}else"function"===typeof c&&(d=J(b),c(d.success,d))},F=function(a,b){if("function"===typeof b){var c=J(a);b(c.success,c)}},
B=function(b){var c=[];b=a.event_mapping[b];if("undefined"!==typeof b){var d=b.length;if("number"===typeof d)for(var e=0;e<d;e++){if("*"===b[e]){c=[];b=Object.keys(a.los);for(d=0;d<b.length;d++)"undefined"!==typeof a.los[b[d]]&&c.push(a.los[b[d]]);break}"undefined"!==typeof a.los[b[e]]&&c.push(a.los[b[e]])}}return c},H=function(a){for(var b=[],c=a.length,d=0;d<c;d++)!0===a[d].can_be_shown&&b.push(a[d]);return b},G=function(b,c){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof c&&c(null,
null):(m=new Date,C(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(d){!0!==a.los[b.id].successfully_consumed&&(a.los[b.id].successfully_consumed=d.success);!0===d.success?a.los[b.id].nsuccess+=1:a.los[b.id].unsuccessfully_consumed=!0;if(!0===z&&!1===A){var e=SGAME.Sequencing.updateGroupsTracking(a.los[b.id],a.sequencing.sequence,a.los);a.sequencing.sequence=e.groups;a.los=e.los;D=e.nLOsForTracking;e.finished&&(A=!0)}switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=
!0!==a.los[b.id].successfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}O();d.more_los=p;K(function(){"function"===typeof c&&c(d.success,d);C()})}))},C=function(){"function"===typeof d&&d()},O=function(){var b=Object.keys(a.los);k=b.length;y=w=x=c=0;p=!1;for(var d=0;d<k;d++)!0===a.los[b[d]].shown&&(c+=1,x+=a.los[b[d]].nshown),!0===a.los[b[d]].successfully_consumed&&(w+=1,y+=a.los[b[d]].nsuccess),!0===a.los[b[d]].can_be_shown&&(p=!0);b=k;!0===z&&(b=!0===A?c:D);var d=0,e="incompleted";
switch(a.game_settings.completion_status){case "all_los":a.game_settings.completion_status_n=100;case "percentage_los":var g=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100,d=0>=g||0>=b?1:c/b/g;break;case "n_los":g=Math.min(a.game_settings.completion_status_n,b);d=0===g?1:c/g;break;case "n_times":d=0>=a.game_settings.completion_status_n?1:x/a.game_settings.completion_status_n;break;case "onstart":d=1}d=Math.max(Math.min(1,+d.toFixed(2)),0);e=1===d?"completed":"incompleted";g=0;switch(a.game_settings.success_status){case "all_los":a.game_settings.success_status_n=
100;case "percentage_los":g=Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;g=0>=g||0>=b?1:w/b/g;break;case "n_los":g=Math.min(a.game_settings.success_status_n,b);g=0===g?1:c/g;break;case "n_times":g=0>=a.game_settings.success_status_n?1:y/a.game_settings.success_status_n;break;case "oncompletion":g=d;break;case "onstart":g=1}g=Math.max(Math.min(1,+g.toFixed(2)),0);q={progress_measure:d,completion_status:e,score:g,success_status:1===g?"passed":"failed"};SGAME.Debugger.log("Tracking");
SGAME.Debugger.log(q);SGAME.Messenger.sendMessage({key:"tracking",value:q})},K=function(a){!0!==L()?"function"===typeof a&&a(!1):P(a)},L=function(){if(!0===e)return!1;var b=k;!0===z&&!0===A&&(b=c);switch(a.game_settings.completion_notification){case "no_more_los":return!1===p;case "all_los_consumed":return c>=b;case "all_los_successfully_consumed":return w>=b;case "completion_status":return"completed"===q.completion_status;case "success_status":return"passed"===q.success_status;case "never":return!1;
default:return!1}},P=function(a){e=!0;SGAME.Fancybox.create({dialog:!0,msg:n},function(){"function"===typeof a&&a(!0)})},I=function(a){for(var b=[],c,d=0;d<a.length;d++)"undefined"===typeof c&&(c=a[d].nshown),a[d].nshown<c&&(c=a[d].nshown,b=[]),c===a[d].nshown&&b.push(a[d]);return SGAME.Utils.getRandomElement(b)},J=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:M(a),more_los:p}},
M=function(b){var c;l&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof f.behaviour_when_no_more_los?c=f.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&(c=a.game_settings.behaviour_when_no_more_los);return Q(c,b)},Q=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=N(b);return"undefined"!==typeof c&&"damage"===c.type?
!1:!0;case "failure_unless_blocking":return c=N(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},N=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof f.events&&"undefined"!==typeof f.events[b]?f.events[b]:{}};SGAME.Debugger.init(!1);return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(f=a)&&"function"===typeof a.togglePause&&(d=a.togglePause)},loadSettings:function(c){SGAME.Debugger.log("SGAME load settings ");
SGAME.Debugger.log(c);l=!0;a=c;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===s.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===u.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1===v.indexOf(a.sequencing.approach)&&(a.sequencing.approach=
"random");-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||delete a.sequencing.interruptions_n;-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===b.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los",
"n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);-1===t.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los",
"n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===h.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===g.indexOf(a.game_settings.behaviour_when_no_more_los)&&
(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&(n=a.game_settings.completion_notification_text);if("object"===typeof a.los){c=Object.keys(a.los);k=c.length;for(var d=0;d<k;d++)"undefined"!==typeof a.los[c[d]].url&&(a.los[c[d]].url=SGAME.Utils.checkUrlProtocol(a.los[c[d]].url)),a.los[c[d]].can_be_shown=!0,a.los[c[d]].shown=!1,a.los[c[d]].nshown=0,a.los[c[d]].successfully_consumed=!1,a.los[c[d]].nsuccess=0,a.los[c[d]].unsuccessfully_consumed=
!1,a.los[c[d]].acts_as_asset="asset"===a.los[c[d]].scorm_type||"sco"===a.los[c[d]].scorm_type&&!1===a.los[c[d]].report_data,p=!0}"random"!==a.sequencing.approach&&(c=SGAME.Sequencing.validateSequence(a.sequencing.sequence,a.los),!1===c?a.sequencing.approach="random":(a.sequencing.sequence=c,z=!0));"random"===a.sequencing.approach&&delete a.sequencing.sequence;if(!0===z){c=Object.keys(a.los);k=c.length;for(d=0;d<k;d++)a.los[c[d]].can_be_shown=!1,a.los[c[d]].groups=[];p=!1;d=Object.keys(a.sequencing.sequence);
_nGroups=d.length;for(var e=0;e<_nGroups;e++){a.sequencing.sequence[d[e]]=SGAME.Sequencing.initGroupSequence(a.sequencing.sequence[d[e]]);for(var f=a.sequencing.sequence[d[e]],m=0;m<f.los.length;m++)a.los[f.los[m]].groups.push(f.id),a.los[f.los[m]].can_be_shown=!0===f.can_be_shown,!0===a.los[f.los[m]].can_be_shown&&(p=!0)}for(d=0;d<k;d++)"undefined"!==typeof a.los[c[d]].groups&&0!==a.los[c[d]].groups.length||delete a.los[c[d]];k=Object.keys(a.los).length}"string"!==typeof a.assets_path&&(a.assets_path=
"/assets/sgame/");SGAME.Messenger.init();SGAME.Fancybox.init(a.assets_path);SGAME.TrafficLight.init(a.assets_path);SGAME.Sequencing.init(a.sequencing);SGAME.Analytics.init(a);!0===z&&(D=SGAME.Sequencing.getNLOsForTracking(a.sequencing.sequence,a.los));SGAME.Debugger.log("SGAME settings loaded");SGAME.Debugger.log(a)},triggerLO:function(b,c){switch(a.sequencing.interruptions){case "no_restrictions":return E(b,c);case "n_times":return x>=a.sequencing.interruptions_n?F(b,c):E(b,c);case "1_per_timeperiod":return"undefined"!==
typeof m&&(new Date-m)/1E3<=a.sequencing.interruptions_n?F(b,c):E(b,c)}},showLO:G,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){G(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===p?!1:"undefined"===typeof a?p:0<H(B(a)).length},successWhenNoLOs:function(a){return M(a)},onConnectedToVLE:function(){"onstart"===a.game_settings.completion_status&&
(q.progress_measure=1,q.completion_status="completed");"onstart"===a.game_settings.success_status&&(q.score=1,q.success_status="passed");if("onstart"===a.game_settings.completion_status||"onstart"===a.game_settings.success_status)SGAME.Messenger.sendMessage({key:"tracking",value:q}),setTimeout(function(){!0===L()&&(C(),K(function(){C()}))},500)},getVLEData:function(){return r},setVLEData:function(a){r=a;SGAME.Analytics.onVLEDataReceived(r)}}}();SGAME.Observer=function(f){var d=!0,n=f,a=f,l=f,r,q,s,u,v,b,t=function(){l=a=n=f;r=Date.now();q=!1;b=v=u=s=f},h=function(){!1===a.acts_as_asset&&"undefined"!==typeof l&&(l.addListener("cmi.success_status",function(a){s=a;"passed"===s&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),l.addListener("cmi.score.scaled",function(a){u=a;0.8<=u&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
l.addListener("cmi.completion_status",function(a){v=a}),l.addListener("cmi.progress_measure",function(a){b=a}))};return{start:function(b,f,k){if(!1===d||"undefined"!=typeof n)return null;d=!1;t();n=b;a=f;l=k;h();SGAME.TrafficLight.changeColor("red");if(!0===a.acts_as_asset){b:{b=a.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration)))break b;b=null}b=!b||0>=b?15:Math.min(0.5*
b,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===d||"undefined"==typeof n)return null;d=!0;SGAME.TrafficLight.stop();var g=Math.round((Date.now()-r)/1E3);q="green"===SGAME.TrafficLight.getCurrentColor();g={lo_metadata:a,time:g,success:q};"undefined"!=typeof s&&(g.scorm_success_status=s);"undefined"!=typeof u&&(g.scorm_scaled_score=u);"undefined"!=typeof v&&(g.scorm_completion_status=v);"undefined"!=typeof b&&(g.scorm_progress_measure=
b);t();return g},isStopped:function(){return d}}}();SGAME.Utils=function(){var f=void 0;return{init:function(d){},getRandomElement:function(d){if("number"==typeof d)return d;var f;f=d.length-1;if("number"!=typeof f)throw{name:"Invalid number format exception"};f=Math.round(0+Math.random()*(f-0));return d[f]},loadScript:function(d,f){if("string"===typeof d&&"function"===typeof f){var a=document.getElementsByTagName("head")[0];if(a){var l=document.createElement("script");l.setAttribute("src",d);l.setAttribute("type","text/javascript");l.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||f()};l.onload=f;a.appendChild(l)}}},getProtocol:function(){if("undefined"!==typeof f)return f;var d;try{d=document.location.protocol}catch(n){}"string"===typeof d&&(d=d.match(/[\w]+/),d=d instanceof Array&&"string"===typeof d[0]?d[0]:void 0);return f="string"===typeof d?d:"unknown"},checkUrlProtocol:function(d){if("string"===typeof d){var f=d.match(/^https?:\/\//);if(f instanceof Array&&1===f.length){var f=f[0].replace("://",""),a=
SGAME.Utils.getProtocol();if(f!==a)switch(a){case "https":d="https"+d.replace(f,"")}}}return d}}}();
