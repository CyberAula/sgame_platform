iso8601Parser=function(g){return{getDuration:function(c){var g=[31104E3,2592E3,604800,86400,3600,60,1];try{var a;var m=c;c=[2,3,4,5,7,8,9];var s=[0,0,0,0,0,0,0],p;if(m=m.toUpperCase()){if("string"!==typeof m)throw Error("Invalid iso8601 period string '"+m+"'");if(p=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(m))for(m=0;m<c.length;m++){var l=c[m];s[m]=p[l]?+p[l].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+m+"' is not a valid ISO8601 period.");}a=s}catch(u){return null}for(l=
p=0;l<a.length;l++)p+=a[l]*g[l];return p},createTimestamp:function(c){return(new Date).toISOString()}}}();function Local_API_1484_11(g){function c(d,a){f.diganostic="The "+d+" of "+a+" must be a proper vocabulary element.";f.errorCode=406;return"false"}function q(d){f.errorCode=402;f.diagnostic="The value for key "+d+" has not been created yet.";return"false"}function a(d,a){f.errorCode=201;f.diagnostic="The value for key "+d+" is not valid.";return"false"}function m(d,a,k){d=d.split(/\./);2>d.length?k[d[0]]=a:(k[d[0]]||(k[d[0]]={}),k=k[d.shift()],m(d.join("."),a,k))}function s(d,a){var k=d.split(/\./),
b;if(2>k.length)try{return a[k[0]]}catch(e){return q(d),"false"}else{b=k.shift();if(a[b])return String(s(k.join("."),a[b]));q(d);return"false"}}function p(d){var a,k=0;for(a in d)d.hasOwnProperty(a)&&(k+=1);return k}function l(d,a){if(f.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(d);break;case 2:console.warn(d);break;case 4:console.info(d);
break;case 3:console.log(d);break;default:return console.log(d),!1}return!0}3>a&&f.throw_alerts&&alert(d);return!1}function u(d,a){if("function"==typeof f.listeners[d]&&"undefined"!=typeof a)f.listeners[d](a)}function v(d,a){for(var k in a)a.hasOwnProperty(k)&&("object"==typeof d[k]?"object"==typeof a[k]&&(d[k]=v(d[k],a[k])):d[k]=a[k]);return d}function b(d,a){(function(){function d(a,k){k=k||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(a,k.bubbles,
k.cancelable,k.detail);return b}if("function"===typeof window.CustomEvent)return!1;d.prototype=window.Event.prototype;window.CustomEvent=d})();document.dispatchEvent(new CustomEvent(d,{detail:a}))}function n(d){return"object"!==type(d)||d.nodeType||isWindow(d)?!1:!(d.constructor&&!hasOwn.call(d.constructor.prototype,"isPrototypeOf"))}var f=v({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},g),h={},r={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},k=this;"object"===typeof f.user&&("string"===typeof f.user.name&&(f.CMI.learner_name=f.user.name),"string"===typeof f.user.id&&(f.CMI.learner_id=f.user.id));this.isRunning=function(){return 1===f.initialized&&0===f.terminated};this.Initialize=function(){l(f.prefix+
":  Initializing...",3);f.cmi?(h=f.cmi,"suspend"===h.exit&&(h.entry="resume")):h=f.CMI;f.initialized=1;f.terminated=0;return"true"};this.GetValue=function(d){f.errorCode=0;var a="false";d=d.toString();var k=[];if(this.isRunning()){k=d.split(".");if(0<="|exit|session_time|".indexOf("|"+k[k.length-1]+"|"))return l(f.prefix+": This "+d+" is write only",4),f.errorCode=405,"false";k=d.toLowerCase().split(".");switch(k[0]){case "cmi":switch(a="false",d){case "cmi.exit":case "cmi.session_time":f.errorCode=
405;f.diagnostic="Sorry, this has been specified as a read-only value for "+d;break;case "cmi.learner_name":a=f.CMI.learner_name;break;default:a=s(d.substr(4,d.length),h),"undefined"===a&&(f.errorCode=401,f.diagnostic="Sorry, there was a undefined response from "+d,a="false"),l(f.prefix+": GetValue "+d+" = "+a,4)}}return a}f.errorCode=123;return a};this.SetValue=function(d,k){l(f.prefix+": SetValue: "+d+" = "+k,4);f.errorCode=0;var b=[],r=d.toString(),e=k.toString(),t=0,g=0,t=[];if(this.isRunning()){t=
r.split(".");if("adl"===t[0]&&"id"===t[4]||"comments_from_lms"===t[1]||("comments_from_learner"===t[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+t[t.length-1]+"|")))return l(f.prefix+": This "+r+" is read only",4),f.errorCode=404,"false";b=r.split(".");switch(b[0]){case "cmi":switch(d){case "cmi.location":1E3<e.length&&l(f.prefix+": Some LMS's might truncate your bookmark as you've passed "+
e.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":t=parseFloat(e);if("number"!=typeof t||isNaN(t))return a(d,e);t=Math.max(0,Math.min(1,t));u(d,t);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+e+"|"))return c(d,e);u(d,e);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return c(d,e);break;case "cmi.score.scaled":t=parseFloat(e);if("number"!=typeof t||isNaN(t))return a(d,e);t=Math.max(0,
Math.min(1,t));u(d,t);break;case "cmi.score.min":t=parseFloat(e);if("number"!=typeof t||isNaN(t))return a(d,e);f.CMI.score.min=t;break;case "cmi.score.max":t=parseFloat(e);if("number"!=typeof t||isNaN(t))return a(d,e);f.CMI.score.max=t;break;case "cmi.score.raw":t=parseFloat(e);if("number"!=typeof t||isNaN(t))return a(d,e);g=parseFloat(f.CMI.score.max);g="number"!=typeof g||isNaN(g)?100:g;b=parseFloat(f.CMI.score.min);b="number"!=typeof b||isNaN(b)?0:b;g-=b;0>=g&&(g=100);t=Math.max(0,Math.min(1,(t-
b)/g));u("cmi.score.scaled",t);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+e+"|"))return c(d,e);u(d,e);break;default:switch(b[1]){case "comments_from_lms":return f.errorCode="404",f.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===h.comments_from_learner._children.indexOf(b[3]))return c(d,e);m(r.substr(4,r.length),e,h);h.comments_from_learner._count=(p(h.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===h.interactions._children.indexOf(b[3]))return c(d,e);h.interactions._count=(p(h.interactions)-2).toString();if(isNaN(parseInt(b[2],10)))return"false";if(!n(h.interactions[b[2]])){if("id"===b[3])return h.interactions[b[2]]={},m(r.substr(4,r.length),e,h),h.interactions._count=(p(h.interactions)-2).toString(),n(h.interactions[b[2]].objectives)||(l(f.prefix+": Constructing objectives object for new interaction",4),h.interactions[b[2]].objectives={},h.interactions[b[2]].objectives._count=
"-1"),n(h.interactions[b[2]].correct_responses)||(l(f.prefix+": Constructing correct responses object for new interaction",4),h.interactions[b[2]].correct_responses={},h.interactions[b[2]].correct_responses._count="-1"),"true";l("Can't add interaction without ID first!",3);return"false"}if("objectives"===b[3]){if("id"===b[5])for(g=parseInt(h.interactions[b[2]].objectives._count,10),t=0;t<g;t+=1){if(h.interactions[b[2]].objectives[t].id===e)return r=d,f.errorCode="351",f.diagnostic="The "+r+" element must be unique.  The value '"+
e+"' has already been set in #"+t,"false"}else return c(d,e);m(r.substr(4,r.length),e,h);h.interactions[b[2]].objectives._count=(p(h.interactions[b[2]].objectives)-1).toString();return"true"}"correct_responses"===b[3]&&(m(r.substr(4,r.length),e,h),h.interactions[b[2]].correct_responses._count=(p(h.interactions[b[2]].correct_responses)-1).toString());m(r.substr(4,r.length),e,h);h.interactions._count=(p(h.interactions)-2).toString();return"true";case "objectives":if("id"===b[3])for(g=parseInt(h.objectives._count,
10),t=0;t<g;t+=1)if(h.objectives[t].id===e)return f.errorCode="351",f.diagnostic="The objectives.id element must be unique.  The value '"+e+"' has already been set in objective #"+t,"false";if("id"!==b[3]&&(t=parseInt(b[2],10),void 0===h.objectives[t]))return f.errorCode="408",f.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(b[2],10)))return"false";m(r.substr(4,r.length),e,h);h.objectives._count=(p(h.objectives)-2).toString();return"true"}}m(r.substr(4,
r.length),e,h)}return"true"}f.errorCode=f.terminated?133:132;return"false"};this.Commit=function(){l(f.prefix+": Commit CMI Object:",4);l(h);l(f.prefix+": Suspend Data Usage "+(Math.round(100*(h.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));b("StoreData",{runtimedata:h});return"true"};this.Terminate=function(){k.Commit();f.terminated=1;f.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==r[a])?r[a]:""};this.GetLastError=function(){return f.errorCode};
this.GetDiagnostic=function(){return f.diagnostic};this.setCMILMSValue=function(a,k){"string"==typeof a&&(f.CMI[a]=k)};this.addListener=function(a,k){"string"==typeof a&&"function"==typeof k&&(f.listeners[a]=k)}};function Local_API_SCORM_12(g){function c(a,k){b.diganostic="The "+a+" of "+k+" must be a proper vocabulary element.";b.errorCode=406;return"false"}function q(a){b.errorCode=402;b.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function a(a,k){b.errorCode=201;b.diagnostic="The value for key "+a+" is not valid.";return"false"}function m(a,k,d){a=a.split(/\./);2>a.length?d[a[0]]=k:(d[a[0]]||(d[a[0]]={}),d=d[a.shift()],m(a.join("."),k,d))}function s(a,k){var d=a.split(/\./),
b;if(2>d.length)try{return k[d[0]]}catch(w){return q(a),"false"}else{b=d.shift();if(k[b])return String(s(d.join("."),k[b]));q(a);return"false"}}function p(a,k){if(b.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(k){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>k&&b.throw_alerts&&alert(a);return!1}function l(a,k){if("function"==typeof b.listeners[a]&&"undefined"!=typeof k)b.listeners[a](k)}function u(a,k){for(var d in k)k.hasOwnProperty(d)&&("object"==typeof a[d]?"object"==typeof k[d]&&(a[d]=u(a[d],k[d])):a[d]=k[d]);return a}function v(a,k){(function(){function a(k,d){d=d||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(k,d.bubbles,d.cancelable,d.detail);return b}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:k}))}var b=u({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},g),n={},f={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},h=this;"object"===typeof b.user&&("string"===typeof b.user.name&&(b.CMI.core.student_name=b.user.name),"string"===typeof b.user.id&&(b.CMI.core.student_id=b.user.id));this.isRunning=function(){return 1===b.initialized&&0===b.terminated};this.LMSInitialize=function(){p(b.prefix+":  Initializing...",3);n=b.CMI;b.initialized=1;b.terminated=
0;return"true"};this.LMSGetValue=function(a){b.errorCode=0;var k="false";a=a.toString();var d=[];if(this.isRunning()){d=a.split(".");if(0<="|exit|session_time|".indexOf("|"+d[d.length-1]+"|"))return b.errorCode=405,"false";d=a.toLowerCase().split(".");switch(d[0]){case "cmi":k=a;a="false";switch(k){case "cmi.core.exit":case "cmi.core.session_time":b.errorCode=405;b.diagnostic="Sorry, this has been specified as a read-only value for "+k;break;default:k=k.replace("cmi.",""),a=s(k,n),"undefined"===a&&
(b.errorCode=401,b.diagnostic="Sorry, there was a undefined response from "+k,a="false")}k=a}return k}b.errorCode=123;return k};this.LMSSetValue=function(h,k){p(b.prefix+": SetValue: "+h+" = "+k,4);b.errorCode=0;var d=[],x=h.toString(),w=k.toString();if(this.isRunning()){var d=x.split("."),f=d[d.length-1],d="adl"===d[0]&&"id"===d[4]?!0:"comments_from_lms"===d[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
f+"|");if(d)return b.errorCode=404,"false";d=x.split(".");switch(d[0]){case "cmi":switch(h){case "cmi.core.lesson_location":1E3<w.length&&p(b.prefix+": Some LMS's might truncate your bookmark as you've passed "+w.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+w+"|"))return c(h,w);l(h,w);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+w+"|"))return c(h,
w);break;case "cmi.core.score.min":d=parseFloat(w);if("number"!=typeof d||isNaN(d))return a(h,w);b.CMI.core.score.min=d;break;case "cmi.core.score.max":d=parseFloat(w);if("number"!=typeof d||isNaN(d))return a(h,w);b.CMI.core.score.max=d;break;case "cmi.core.score.raw":d=parseFloat(w);if("number"!=typeof d||isNaN(d))return a(h,w);var e=parseFloat(b.CMI.core.score.max),e="number"!=typeof e||isNaN(e)?100:e,f=parseFloat(b.CMI.core.score.min),f="number"!=typeof f||isNaN(f)?0:f,e=e-f;0>=e&&(e=100);d=Math.max(0,
Math.min(1,(d-f)/e));l("cmi.score.scaled",d)}x=x.replace("cmi.","");m(x,w,n)}return"true"}b.errorCode=b.terminated?133:132;return"false"};this.LMSCommit=function(){v("StoreData",{runtimedata:n});return"true"};this.LMSTerminate=function(){h.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSFinish=function(){h.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==f[a])?f[a]:""};this.LMSGetLastError=function(){return b.errorCode};
this.LMSGetDiagnostic=function(){return b.diagnostic};this.setCMILMSValue=function(a,k){"string"==typeof a&&(b.CMI[a]=k)};this.addListener=function(a,k){"string"==typeof a&&"function"==typeof k&&(b.listeners[a]=k)}};SGAME=function(){return{init:function(g){return SGAME.CORE.init(g)},loadSettings:function(g){return SGAME.CORE.loadSettings(g)},triggerLO:function(g,c){return SGAME.CORE.triggerLO(g,c)},showLO:function(g,c){return SGAME.CORE.showLO(g,c)},showRandomLO:function(g){return SGAME.CORE.showRandomLO(g)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(g){return SGAME.CORE.losCanBeShown(g)},successWhenNoLOs:function(g){return SGAME.CORE.successWhenNoLOs(g)}}}();
SGAME.VERSION="1.0.2";SGAME.AUTHORS="Aldo Gordillo";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var g=!1;return{init:function(c){!0===c&&(g=c)},isDebugging:function(){return g},log:function(c){g&&window.console&&console.log(c)}}}();SGAME.Messenger=function(){function g(b,l){this.data=b||{};-1!==["PROTOCOL","APP"].indexOf(l)?this.type=l:this.type="APP";this.origin=a;this.destination=m}var c=["PROTOCOL","APP"],q=["SGAME_GATEWAY","SGAME_API"],a="SGAME_API",m="SGAME_GATEWAY",s=!1,p=!1,l=function(a){try{window.parent.parent.postMessage(a,"*")}catch(l){}},u=function(b){var c;c="object"!==typeof b||"string"!==typeof b.data?!1:v(b.data);if(c)switch(b=JSON.parse(b.data),b.type){case "PROTOCOL":if(b.data)switch(b.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
b.origin&&!0!==p&&(p=!0,b.data.settings=SGAME.CORE.getSettings(),b.destination=b.origin,b.origin=a,l(JSON.stringify(b)),SGAME.CORE.onConnectedToVLE())}break;case "APP":if(b.data&&"string"===typeof b.data.key)switch(b.data.key){case "lms_data":if("object"===typeof b.data.value){c=b.data.value;b={};if("string"===typeof c.name||"number"===typeof c.name)b.name=""+c.name;if("string"===typeof c.id||"number"===typeof c.id)b.id=""+c.id;c=SGAME.CORE.getVLEData();c.user=b;SGAME.CORE.setVLEData(c)}}}},v=function(a){try{if(a=
JSON.parse(a),-1===c.indexOf(a.type)||-1===q.indexOf(a.origin))return!1}catch(l){return!1}return!0};return{init:function(a){if(!s){s=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",u,!1):window.attachEvent&&window.parent.attachEvent("message",u)}catch(c){}}},isConnected:function(){return p},sendMessage:function(a){s&&p&&(a=JSON.stringify(new g(a,void 0)),v(a)&&l(a))}}}();var API,API_1484_11;
SGAME.Fancybox=function(g){var c=g,q=g,a=g,m,s=function(){"undefined"!=typeof c&&(c.style.display="none",c.parentNode.removeChild(c),"lo"===q&&(API_1484_11=API=g),q=c=g)},p=function(){if("undefined"!=typeof c){var l=q;s();var m;m="lo"===l?SGAME.Observer.stop():!0;var p=a;a=g;setTimeout(function(){"function"===typeof p&&p(m)},50)}};return{init:function(a){"string"===typeof a&&(m=a)},create:function(l,u){s();a=u;var v="undefined"!==typeof l&&!0===l.dialog?"dialog":"lo",b=4/3,n,f,h=0.9*window.innerWidth,
r=0.9*window.innerHeight;r*b>h?(n=h,f=n/b):(f=r,n=f*b);if("lo"===v)var k={},d;else var x="";l&&(l.width&&(n=l.width),l.height&&(f=l.height),"lo"===v?l.lo&&(k=l.lo,"string"===typeof k.url&&(d=k.url)):"string"==typeof l.msg&&(x=l.msg));if("lo"===v){if("string"!=typeof d||"undefined"==typeof k.scorm_type)return;var w=g,b=API_1484_11=API=g,y=SGAME.CORE.getVLEData();"object"===typeof y.user&&(b=y.user);"sco"===k.scorm_type&&("1.2"===k.scorm_version?w=API=new Local_API_SCORM_12({user:b,debug:SGAME.Debugger.isDebugging()}):
"2004"===k.scorm_version&&(w=API_1484_11=new Local_API_1484_11({user:b,debug:SGAME.Debugger.isDebugging()})))}b=document.createElement("div");b.style.width=n+"px";b.style.height=f+"px";b.style.maxWidth=h+"px";b.style.maxHeight=r+"px";b.style.overflow="lo"===v?"hidden":"auto";b.style.background="white";b.style.position="absolute";b.style.top=0;b.style.zIndex=9999;b.style.borderRadius="1em";b.style.border="2px solid black";b.setAttribute("id","sgame_fancybox");b.style.marginLeft=(window.innerWidth-
n)/2+"px";b.style.marginTop=(window.innerHeight-f)/2+"px";r=document.createElement("img");r.src=m+"close.png";h=Math.max(25,Math.floor(0.05*f));r.style.width=h+"px";r.style.height=h+"px";r.style.padding="5px";r.style.cursor="pointer";r.style.position="absolute";r.style.right=0;r.onclick=function(){p()};b.appendChild(r);if("lo"===v){var e=document.createElement("img");e.id="trafficLight";e.src=m+"trafficLight/trafficLight_red.png";x=Math.max(40,Math.floor(0.085*f));r=Math.max(30,Math.floor(0.75*x));
e.style.height=x+"px";e.style.width=r+"px";e.style.padding="4px";e.style.position="absolute";e.style.left="0px";e.style.top="0px";e.style.background="#fff";e.style.borderRadius="0px 0px 20px 0px";e.style.borderRight="2px solid black";e.style.borderBottom="2px solid black";b.appendChild(e);e=document.createElement("iframe");e.src=d;d=Math.ceil(Math.max(h,x))+4;x=Math.floor(0.02*f);h=Math.floor(0.02*n);e.style.marginLeft=h+"px";e.style.marginTop=d+"px";e.style.width=Math.max(0,n-h-h)+"px";e.style.height=
Math.max(0,f-d-x)+"px";e.style.overflow="auto";e.scrolling="yes";e.style.frameBorder="0";e.style.borderStyle="none";e.setAttribute("allowfullscreen","false");b.appendChild(e)}else n=document.createElement("p"),n.id="dialog",n.innerHTML=x,n.style.padding="15px",n.style.marginTop="30px",n.style.marginBottom="20px",n.style.marginRight="20px",n.style.marginLeft="20px",n.style.textAlign="center",n.style.fontSize="24px",n.style.position="relative",n.style.cursor="default",n.style.color="#000",n.style.fontFamily=
"initial",b.appendChild(n);c=b;q=v;document.body.appendChild(b);"lo"===v&&SGAME.Observer.start(e,k,w)},closeCurrentFancybox:p}}();SGAME.TrafficLight=function(g){var c,q,a,m,s,p,l=function(a){var l=document.getElementById("trafficLight");l&&(c=a,l.src=u(a))},u=function(a){switch(a){case "green":return p+"trafficLight/trafficLight_green.png";case "yellow":return p+"trafficLight/trafficLight_yellow.png";case "red":return p+"trafficLight/trafficLight_red.png";default:return p+"trafficLight/trafficLight.png"}},v=function(a,c){var f=document.getElementById("trafficLight");if(f){var h=!1;m=setInterval(function(){f&&(h?(f.src=u(null),
h=!1):(f.src=u(a),h=!0))},500);s=setTimeout(function(){clearTimeout(m)},1E3*c)}};return{init:function(a){"string"===typeof a&&(p=a)},getCurrentColor:function(){return c},changeColor:function(a,c){c?q=setTimeout(function(){l(a)},1E3*c):l(a)},setUpBlink:function(b,c,f){f?a=setTimeout(function(){v(b,c)},1E3*f):v(b,c)},stop:function(){q&&clearTimeout(q);a&&clearTimeout(a);m&&clearTimeout(m);s&&clearTimeout(s)}}}();SGAME.Sequencing=function(){var g,c="completion completion_higher_inmediate success fail score_higher score_higher_inmediate score_lower".split(" "),q=function(a){if("object"!==typeof a)return a;a.met=!1;if("multiple"===a.type&&Array.isArray(a.conditions))for(var d=0;d<a.conditions.length;d++)a.conditions[d]=q(a.conditions[d]);return a},a=function(k){for(var d=Object.keys(k),b=d.length,c=0;c<b;c++)"undefined"!==typeof k[d[c]].condition&&(k[d[c]].condition=m(k[d[c]].condition,d),!1===k[d[c]].condition&&
delete k[d[c]]);return Object.keys(k).length===b?k:a(k)},m=function(a,d){if("object"!==typeof a||"undefined"===typeof a.id)return!1;a.id+="";switch(a.type){case "single":return s(a,d);case "multiple":var b;a:if(-1===["AND","OR"].indexOf(a.operator)||!1===Array.isArray(a.conditions)||1>a.conditions.length)b=!1;else{for(b=0;b<a.conditions.length;b++)if(a.conditions[b]=m(a.conditions[b],d),!1===a.conditions[b]){b=!1;break a}b=a}return b;default:return!1}},s=function(a,d){if("undefined"===typeof a.group)return!1;
a.group+="";if(-1===d.indexOf(a.group)||-1===c.indexOf(a.requirement))return!1;if(-1!==["completion_higher_inmediate","score_higher","score_higher_inmediate","score_lower"].indexOf(a.requirement)){if("string"===typeof a.threshold){if(!0===isNaN(a.threshold))return!1;a.threshold=parseInt(a.threshold)/100}if("number"!==typeof a.threshold||0>a.threshold||1<a.threshold||"score_lower"===a.requirement&&0===a.threshold)return!1}return a},p=function(a,d){if("undefined"===typeof a||!0===a.met)return a;switch(a.type){case "single":var b=
a,c=d[b.group],h=!0===c.shown,e=!1;switch(b.requirement){case "completion":e=h;break;case "completion_higher_inmediate":e=c.nshown/c.los.length>=b.threshold;break;case "success":e=h&&1===c.score;break;case "fail":e=h&&1>c.score;break;case "score_higher":e=h&&c.score>=b.threshold;break;case "score_higher_inmediate":e=c.score>=b.threshold;break;case "score_lower":e=h&&c.score<b.threshold}b.met=e;a=b;break;case "multiple":a:{b=a;for(c=0;c<b.conditions.length;c++)if(b.conditions[c]=p(b.conditions[c],
d),"OR"===b.operator&&!0===b.conditions[c].met){b.met=!0;a=b;break a}else if("AND"===b.operator&&!1===b.conditions[c].met){b.met=!1;a=b;break a}"OR"===b.operator?b.met=!1:"AND"===b.operator&&(b.met=!0);a=b}}return a},l=function(a,d){for(var b=Object.keys(d),c=!1,h=0;h<b.length;h++){var e=d[b[h]];if(e.id!=a.id&&"undefined"!==typeof e.condition)for(var f=u(e.condition,a),l=0;l<f.length;l++){if(!0===f[l].met)return!0;!1===e.unlocked&&(c=!0)}}if(!0===c)return!1;switch(g){case "linear_success":return 1===
a.score;default:return!0===a.shown}},u=function(a,d){switch(a.type){case "single":if(a.group===d.id)return[a];break;case "multiple":for(var b=[],c=0;c<a.conditions.length;c++)b=b.concat(u(a.conditions[c],d));return b}return[]},v=function(a,d,b){for(var c=0;c<a.los.length;c++)d[a.los[c]].can_be_shown=b;return d},b=void 0,n=void 0,f=function(a,d){if("undefined"===typeof n){if("undefined"!==typeof d){for(var c=[],f=Object.keys(d),l=0;l<f.length;l++)"undefined"!==typeof d[f[l]].groups&&0!==d[f[l]].groups.length||
c.push(f[l]);n=c.length}n=0}switch(g){case "linear_success":case "linear_completion":if("undefined"!==typeof b)return b;for(var c=0,f=Object.keys(a),l=f.length,e=0;e<l;e++)c+=a[f[e]].los.length;break;case "custom":c=h(a);break;default:c=0}return b=c+n},h=function(a){a=JSON.parse(JSON.stringify(a));for(var d=Object.keys(a),b=d.length,c=[],f=0;f<b;f++){var e=a[d[f]];if(!1===e.unlocked&&"undefined"!==typeof e.condition&&!1===e.locked)for(var l=0;l<b;l++){var g=a[d[l]];if(!0===g.unlocked&&!1===g.locked&&
g.id!==e.id){var m=u(e.condition,g);if(0<m.length&&!1===m[0].met){var p=m[0],q={conditionsToMet:[],groupsToLock:[],groupsToUnlock:[]};q.conditionsToMet.push({id:p.id,group:e.id});q.groupsToLock.push(g.id);"multiple"===e.condition.type&&"OR"===e.condition.operator||"single"===e.condition.type?q.groupsToUnlock.push(e.id):"multiple"===e.condition.type&&"AND"===e.condition.operator&&!0===r(p.id,JSON.parse(JSON.stringify(e.condition))).met&&q.groupsToUnlock.push(e.id);for(p=0;p<b;p++){var n=a[d[p]];if(!1===
n.unlocked&&!1===n.locked&&n.id!==e.id&&n.id!==g.id&&"undefined"!==typeof n.condition){var s=u(n.condition,g);if(0<s.length&&!1===s[0].met){var v=!1;switch(m[0].requirement){case "completion":case "completion_higher_inmediate":v=!0;break;case "success":v=-1===["fail","score_lower"].indexOf(s[0].requirement);break;case "fail":v=-1!==["score_higher","score_higher_inmediate","score_lower"].indexOf(s[0].requirement)?100!==s[0].threshold:-1===["success"].indexOf(s[0].requirement);break;case "score_higher":case "score_higher_inmediate":v=
-1!==["success"].indexOf(s[0].requirement)?100===m[0].threshold:-1!==["fail"].indexOf(s[0].requirement)?100>m[0].threshold:-1!==["score_lower"].indexOf(s[0].requirement)?s[0].threshold>m[0].threshold:!0;break;case "score_lower":v=-1!==["score_higher","score_higher_inmediate"].indexOf(s[0].requirement)?m[0].threshold>s[0].threshold:-1===["success"].indexOf(s[0].requirement)}v&&(q.conditionsToMet.push({id:s[0].id,group:n.id}),"multiple"===n.condition.type&&"OR"===n.condition.operator||"single"===n.condition.type?
q.groupsToUnlock.push(n.id):"multiple"===n.condition.type&&"AND"===n.condition.operator&&!0===r(s[0].id,JSON.parse(JSON.stringify(n.condition))).met&&q.groupsToUnlock.push(n.id))}}}c.push(q)}}}}d=c.length;if(0===d){c=0;d=Object.keys(a);b=d.length;for(f=0;f<b;f++)e=a[d[f]],!0===e.unlocked&&Array.isArray(e.los)&&(c+=e.los.length);return c}for(f=b=0;f<d;f++){e=JSON.parse(JSON.stringify(a));for(l=0;l<c[f].groupsToLock.length;l++)e[c[f].groupsToLock[l]].locked=!0;for(l=0;l<c[f].groupsToUnlock.length;l++)e[c[f].groupsToUnlock[l]].unlocked=
!0;for(l=0;l<c[f].conditionsToMet.length;l++)e[c[f].conditionsToMet[l].group].condition=r(c[f].conditionsToMet[l].id,e[c[f].conditionsToMet[l].group].condition);e=h(e);e>b&&(b=e)}return b},r=function(a,d){if(d.id===a)d.met=!0;else if("multiple"===d.type){d.met="AND"===d.operator;for(var b=0;b<d.conditions.length;b++)if(d.conditions[b]=r(a,d.conditions[b]),!0!==d.conditions[b].met&&"AND"===d.operator)d.met=!1;else if(!0===d.conditions[b].met&&"OR"===d.operator){d.met=!0;break}}return d};return{init:function(a){g=
a.approach},initGroupSequence:function(a){a.can_be_shown="undefined"===typeof a.condition||0===Object.keys(a.condition).length;a.locked=!1;a.unlocked=a.can_be_shown;a.shown=!1;a.nshown=0;a.score=!1;a.performance=0;a.condition=q(a.condition);return a},validateSequence:function(b,d){if("object"!==typeof b||"object"!==typeof d)return!1;for(var c=Object.keys(b),f=Object.keys(d),l=0;l<c.length;l++){var e;e=b[c[l]];var h=f;if("undefined"===typeof e.id)e=!1;else{e.id+="";for(var g=[],m=0;m<e.los.length;m++){var p=
e.los[m];-1!==h.indexOf(p)&&g.push(p)}e.los=g;e=1>e.los.length?!1:e}!1!==e?b[c[l]]=e:delete b[c[l]]}b=a(b);c=Object.keys(b);f=[];for(l=0;l<c.length;l++)for(e=b[c[l]],h=0;h<e.los.length;h++)-1===f.indexOf(e.los[h])&&f.push(e.los[h]);return 2>typeof c.length||2>f.length?!1:b},getNLOsForTracking:f,updateGroupsTracking:function(a,d,c){for(var h=a.groups.length,g=0;g<h;g++){var e=d[a.groups[g]];if(!0===e.can_be_shown){for(var m=d,n=a.groups[g],q=e.los.length,r=0,s=0,u=0;u<q;u++){var B=c[e.los[u]];!0===
B.shown&&(r+=1);!0===B.successfully_consumed&&(s+=1)}e.shown=r===q;e.nshown=r;e.score=0<q?s/q:0;e.performance=0<r?s/r:0;m[n]=e}}g=!1;n=Object.keys(d);m=n.length;for(q=0;q<m;q++)e=d[n[q]],!1===e.unlocked&&!1===e.locked&&(r=d,s=n[q],!0!==e.locked&&!0!==e.unlocked&&("undefined"!==typeof e.condition?(e.condition=p(e.condition,d),!0===e.condition.met&&(e.unlocked=!0,e.can_be_shown=!0)):(e.unlocked=!0,e.can_be_shown=!0)),r[s]=e,!0===d[n[q]].unlocked&&(c=v(d[n[q]],c,!0),g=!0));for(q=0;q<h;q++)e=d[a.groups[q]],
!0===e.unlocked&&!1===e.locked&&(r=d,s=a.groups[q],!0!==e.locked&&!1!==e.unlocked&&(u=l(e,d),e.locked=u,e.can_be_shown=!1===e.locked),r[s]=e,!0===d[a.groups[q]].locked&&(c=v(d[a.groups[q]],c,!1),g=!0));a=!0;for(h=0;h<m;h++)if(e=d[n[h]],!0===e.unlocked&&!1===e.locked){a=!1;break}if(a)for(h=Object.keys(c),n=0;n<h.length;n++)if("undefined"===typeof c[h[n]].groups||0===c[h[n]].groups.length)c[h[n]].can_be_shown=!0;!0===g&&25>=m&&(b=f(d,c));return{groups:d,los:c,nLOsForTracking:b,finished:a}}}}();SGAME.Analytics=function(g){var c,q,a,m,s=function(){return p("http://activitystrea.ms/schema/1.0/access",q)},p=function(l,g,p,b){var n={};"undefined"!==typeof l&&(n.verb={id:l});"undefined"!==typeof g&&(n.object={id:g});"undefined"!==typeof p&&(n.result=p);n.timestamp=iso8601Parser.createTimestamp();!0===b&&(l=n,"undefined"!==typeof c&&(l.actor=c),g={},"object"==typeof l.object&&"string"==typeof l.object.id&&l.object.id!=q&&(g.contextActivities={parent:{id:q}}),"string"===typeof a&&(g.extensions=
{"http://id.tincanapi.com/extension/attempt-id":a}),0<Object.keys(g).length&&(l.context=g),l.authority={name:SGAME.URL,version:SGAME.VERSION},n=l);m.push(n);return n};return{init:function(l){"object"==typeof l.player&&"string"==typeof l.player.url&&"string"==typeof l.player.name&&(c={},c.id=l.player.url,c.name=l.player.name);q=l.game_metadata.url;"string"==typeof l.attemptId&&(a=l.attemptId);m=[];s()},onVLEDataReceived:function(a){if("object"===typeof a.user){var g={};"string"===typeof a.user.id&&
(g.id=a.user.id);"string"===typeof a.user.name&&(g.name=a.user.name);0<Object.keys(g).length&&"undefined"===typeof c&&(c=g,s())}},recordGameAccessed:s,recordGameClosed:function(a){return p("http://activitystrea.ms/schema/1.0/close",q,{completion:"completed"===a.completion_status,success:"passed"===a.success_status,score:{scaled:a.score}})},recordGameCompleted:function(a){return p("http://activitystrea.ms/schema/1.0/complete",q,{completion:"completed"===a.completion_status,success:"passed"===a.success_status,
score:{scaled:a.score}})},recordLOAccessed:function(a){return p("http://activitystrea.ms/schema/1.0/access",a.url)},recordLOClosed:function(a,c){return p("http://activitystrea.ms/schema/1.0/close",a.url,{completion:"completed"===c.scorm_completion_status,success:c.success,score:{scaled:c.scorm_scaled_score}})},storeAnalytics:function(){}}}();SGAME.API=function(){var g=function(c,g){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var c=JSON.parse(a.responseText);g(c)}};a.open("GET",c,!0);a.send("")};return{init:function(){},requestLOMetadata:function(c,q,a){try{g("undefined"==typeof c?"/lo/random/metadata.json":"/lo/"+c+"/metadata.json",function(a){q(a)})}catch(m){a(m)}}}}();SGAME.CORE=function(){var g={},c=void 0,q="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},m=!1,s={},p={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},l=["repeat","repeat_unless_successfully_consumed","no_repeat"],u=["no_restrictions","n_times","1_per_timeperiod"],v=["random","linear_completion","linear_success","custom"],b="all_los percentage_los n_los n_times disabled onstart".split(" "),
n="all_los percentage_los n_los n_times disabled onstart oncompletion".split(" "),f="no_more_los all_los_consumed all_los_successfully_consumed completion_status success_status never".split(" "),h=["success","failure","success_unless_damage","failure_unless_blocking"],r=!1,k=0,d=0,x=0,w=0,y=0,e=!1,t=void 0,z=!1,C=!1,E=0,A=!1,H=function(d){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(d);a=d;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los=
{});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===l.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===u.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1===v.indexOf(a.sequencing.approach)&&(a.sequencing.approach="random");-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||
delete a.sequencing.interruptions_n;-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===b.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||
delete a.game_settings.completion_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);-1===n.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||
delete a.game_settings.success_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===f.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===h.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===
typeof a.game_settings.completion_notification_text&&(q=a.game_settings.completion_notification_text);if("object"===typeof a.los){var c=Object.keys(a.los);k=c.length;for(var e=0;e<k;e++)"undefined"!==typeof a.los[c[e]].url&&(a.los[c[e]].url=SGAME.Utils.checkUrlProtocol(a.los[c[e]].url)),a.los[c[e]].can_be_shown=!0,a.los[c[e]].shown=!1,a.los[c[e]].nshown=0,a.los[c[e]].successfully_consumed=!1,a.los[c[e]].nsuccess=0,a.los[c[e]].unsuccessfully_consumed=!1,a.los[c[e]].acts_as_asset="asset"===a.los[c[e]].scorm_type||
"sco"===a.los[c[e]].scorm_type&&!1===a.los[c[e]].report_data,r=!0}"random"!==a.sequencing.approach&&(c=SGAME.Sequencing.validateSequence(a.sequencing.sequence,a.los),!1===c?a.sequencing.approach="random":(a.sequencing.sequence=c,z=!0));"random"===a.sequencing.approach&&delete a.sequencing.sequence;if(!0===z){c=Object.keys(a.los);k=c.length;for(e=0;e<k;e++)a.los[c[e]].can_be_shown=!1,a.los[c[e]].groups=[];r=!1;e=Object.keys(a.sequencing.sequence);_nGroups=e.length;for(var g=0;g<_nGroups;g++){a.sequencing.sequence[e[g]]=
SGAME.Sequencing.initGroupSequence(a.sequencing.sequence[e[g]]);for(var m=a.sequencing.sequence[e[g]],p=0;p<m.los.length;p++)a.los[m.los[p]].groups.push(m.id),a.los[m.los[p]].can_be_shown=!0===m.can_be_shown,!0===a.los[m.los[p]].can_be_shown&&(r=!0)}for(e=0;e<k;e++)"undefined"!==typeof a.los[c[e]].groups&&0!==a.los[c[e]].groups.length||delete a.los[c[e]];k=Object.keys(a.los).length}"string"!==typeof a.assets_path&&(a.assets_path="/assets/sgame/");A="string"==typeof d.lrs;!0===A&&SGAME.Analytics.init(a);
SGAME.Messenger.init();SGAME.Fancybox.init(a.assets_path);SGAME.TrafficLight.init(a.assets_path);SGAME.Sequencing.init(a.sequencing);!0===z&&(E=SGAME.Sequencing.getNLOsForTracking(a.sequencing.sequence,a.los))},B=function(b,d){var c=I(b);if(1>c.length)return F(b,d);var e=J(c);if(0<e.length){c=void 0;switch(a.sequencing.approach){case "linear_completion":case "linear_success":case "custom":if(!0===z&&!1===C){for(var c=[],h=[],f=[],k=0;k<e.length;k++)f.push(e[k].id);e=Object.keys(a.sequencing.sequence);
for(k=0;k<e.length;k++){var l=a.sequencing.sequence[e[k]];if(!0===l.can_be_shown)for(var g=0;g<l.los.length;g++)-1!==f.indexOf(l.los[g])&&-1===h.indexOf(l.los[g])&&(h.push(l.los[g]),c.push(a.los[l.los[g]]))}}else c=e;c=K(c);break;default:c=K(e)}selectedLO=c;G(selectedLO,d)}else"function"===typeof d&&(c=L(b),d(c.success,c))},F=function(a,b){if("function"===typeof b){var d=L(a);b(d.success,d)}},I=function(b){var d=[];b=a.event_mapping[b];if("undefined"!==typeof b){var c=b.length;if("number"===typeof c)for(var e=
0;e<c;e++){if("*"===b[e]){d=[];b=Object.keys(a.los);for(c=0;c<b.length;c++)"undefined"!==typeof a.los[b[c]]&&d.push(a.los[b[c]]);break}"undefined"!==typeof a.los[b[e]]&&d.push(a.los[b[e]])}}return d},J=function(a){for(var b=[],d=a.length,c=0;c<d;c++)!0===a[c].can_be_shown&&b.push(a[c]);return b},G=function(b,d){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof d&&d(null,null):(t=new Date,D(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,!0===A&&SGAME.Analytics.recordLOAccessed(b),SGAME.Fancybox.create({lo:b},
function(c){!0!==a.los[b.id].successfully_consumed&&(a.los[b.id].successfully_consumed=c.success);!0===c.success?a.los[b.id].nsuccess+=1:a.los[b.id].unsuccessfully_consumed=!0;if(!0===z&&!1===C){var e=SGAME.Sequencing.updateGroupsTracking(a.los[b.id],a.sequencing.sequence,a.los);a.sequencing.sequence=e.groups;a.los=e.los;E=e.nLOsForTracking;e.finished&&(C=!0)}switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].successfully_consumed;break;
case "no_repeat":a.los[b.id].can_be_shown=!1}Q();c.more_los=r;!0===A&&SGAME.Analytics.recordLOClosed(b,c);M(function(){"function"===typeof d&&d(c.success,c);D()})}))},D=function(){"function"===typeof c&&c()},Q=function(){var b=Object.keys(a.los);k=b.length;y=w=x=d=0;r=!1;for(var c=0;c<k;c++)!0===a.los[b[c]].shown&&(d+=1,x+=a.los[b[c]].nshown),!0===a.los[b[c]].successfully_consumed&&(w+=1,y+=a.los[b[c]].nsuccess),!0===a.los[b[c]].can_be_shown&&(r=!0);b=k;!0===z&&(b=!0===C?d:E);var c=0,e="incompleted";
switch(a.game_settings.completion_status){case "all_los":a.game_settings.completion_status_n=100;case "percentage_los":var h=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100,c=0>=h||0>=b?1:d/b/h;break;case "n_los":h=Math.min(a.game_settings.completion_status_n,b);c=0===h?1:d/h;break;case "n_times":c=0>=a.game_settings.completion_status_n?1:x/a.game_settings.completion_status_n;break;case "onstart":c=1}c=Math.max(Math.min(1,+c.toFixed(2)),0);e=1===c?"completed":"incompleted";h=0;switch(a.game_settings.success_status){case "all_los":a.game_settings.success_status_n=
100;case "percentage_los":h=Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;h=0>=h||0>=b?1:w/b/h;break;case "n_los":h=Math.min(a.game_settings.success_status_n,b);h=0===h?1:d/h;break;case "n_times":h=0>=a.game_settings.success_status_n?1:y/a.game_settings.success_status_n;break;case "oncompletion":h=c;break;case "onstart":h=1}h=Math.max(Math.min(1,+h.toFixed(2)),0);p={progress_measure:c,completion_status:e,score:h,success_status:1===h?"passed":"failed"};SGAME.Debugger.log("Tracking");
SGAME.Debugger.log(p);SGAME.Messenger.sendMessage({key:"tracking",value:p})},M=function(a){!0!==N()?"function"===typeof a&&a(!1):R(a)},N=function(){if(!0===e)return!1;var b=k;!0===z&&!0===C&&(b=d);switch(a.game_settings.completion_notification){case "no_more_los":return!1===r;case "all_los_consumed":return d>=b;case "all_los_successfully_consumed":return w>=b;case "completion_status":return"completed"===p.completion_status;case "success_status":return"passed"===p.success_status;case "never":return!1;
default:return!1}},R=function(a){e=!0;!0===A&&SGAME.Analytics.recordGameCompleted(p);SGAME.Fancybox.create({dialog:!0,msg:q},function(){"function"===typeof a&&a(!0)})},K=function(a){for(var b=[],c,d=0;d<a.length;d++)"undefined"===typeof c&&(c=a[d].nshown),a[d].nshown<c&&(c=a[d].nshown,b=[]),c===a[d].nshown&&b.push(a[d]);return SGAME.Utils.getRandomElement(b)},L=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,
success:O(a),more_los:r}},O=function(b){var c;m&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof g.behaviour_when_no_more_los?c=g.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&(c=a.game_settings.behaviour_when_no_more_los);return S(c,b)},S=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=P(b);return"undefined"!==typeof c&&
"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=P(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},P=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof g.events&&"undefined"!==typeof g.events[b]?g.events[b]:{}};SGAME.Debugger.init(!1);return{init:function(b){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(b);(g=b)&&"function"===typeof b.togglePause&&(c=b.togglePause);!1===m&&H(a);window.addEventListener("unload",
function(){!0===m&&!0===A&&(SGAME.Analytics.recordGameClosed(p),SGAME.Analytics.storeAnalytics())})},loadSettings:function(b){m=!0;H(b);SGAME.Debugger.log("SGAME settings loaded");SGAME.Debugger.log(a)},triggerLO:function(b,c){switch(a.sequencing.interruptions){case "no_restrictions":return B(b,c);case "n_times":return x>=a.sequencing.interruptions_n?F(b,c):B(b,c);case "1_per_timeperiod":return"undefined"!==typeof t&&(new Date-t)/1E3<=a.sequencing.interruptions_n?F(b,c):B(b,c)}},showLO:G,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,
function(b){G(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===r?!1:"undefined"===typeof a?r:0<J(I(a)).length},successWhenNoLOs:function(a){return O(a)},onConnectedToVLE:function(){"onstart"===a.game_settings.completion_status&&(p.progress_measure=1,p.completion_status="completed");"onstart"===a.game_settings.success_status&&(p.score=1,p.success_status="passed");if("onstart"===
a.game_settings.completion_status||"onstart"===a.game_settings.success_status)SGAME.Messenger.sendMessage({key:"tracking",value:p}),setTimeout(function(){!0===N()&&(D(),M(function(){D()}))},500)},getVLEData:function(){return s},setVLEData:function(a){s=a;if(!0===A)SGAME.Analytics.onVLEDataReceived(s)}}}();SGAME.Observer=function(g){var c=!0,q=g,a=g,m=g,s,p,l,u,v,b,n=function(){m=a=q=g;s=Date.now();p=!1;b=v=u=l=g},f=function(){!1===a.acts_as_asset&&"undefined"!==typeof m&&(m.addListener("cmi.success_status",function(a){l=a;"passed"===l&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),m.addListener("cmi.score.scaled",function(a){u=a;0.8<=u&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
m.addListener("cmi.completion_status",function(a){v=a}),m.addListener("cmi.progress_measure",function(a){b=a}))};return{start:function(b,l,k){if(!1===c||"undefined"!=typeof q)return null;c=!1;n();q=b;a=l;m=k;f();SGAME.TrafficLight.changeColor("red");if(!0===a.acts_as_asset){b:{b=a.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration)))break b;b=null}b=!b||0>=b?15:Math.min(0.5*
b,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===c||"undefined"==typeof q)return null;c=!0;SGAME.TrafficLight.stop();var f=Math.round((Date.now()-s)/1E3);p="green"===SGAME.TrafficLight.getCurrentColor();f={lo_metadata:a,time:f,success:p};"undefined"!=typeof l&&(f.scorm_success_status=l);"undefined"!=typeof u&&(f.scorm_scaled_score=u);"undefined"!=typeof v&&(f.scorm_completion_status=v);"undefined"!=typeof b&&(f.scorm_progress_measure=
b);n();return f},isStopped:function(){return c}}}();SGAME.Utils=function(){var g=void 0;return{init:function(c){},getRandomElement:function(c){if("number"==typeof c)return c;var g;g=c.length-1;if("number"!=typeof g)throw{name:"Invalid number format exception"};g=Math.round(0+Math.random()*(g-0));return c[g]},loadScript:function(c,g){if("string"===typeof c&&"function"===typeof g){var a=document.getElementsByTagName("head")[0];if(a){var m=document.createElement("script");m.setAttribute("src",c);m.setAttribute("type","text/javascript");m.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||g()};m.onload=g;a.appendChild(m)}}},getProtocol:function(){if("undefined"!==typeof g)return g;var c;try{c=document.location.protocol}catch(q){}"string"===typeof c&&(c=c.match(/[\w]+/),c=c instanceof Array&&"string"===typeof c[0]?c[0]:void 0);return g="string"===typeof c?c:"unknown"},checkUrlProtocol:function(c){if("string"===typeof c){var g=c.match(/^https?:\/\//);if(g instanceof Array&&1===g.length){var g=g[0].replace("://",""),a=
SGAME.Utils.getProtocol();if(g!==a)switch(a){case "https":c="https"+c.replace(g,"")}}}return c}}}();
