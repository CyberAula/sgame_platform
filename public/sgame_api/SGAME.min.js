iso8601Parser=function(e){return{getDuration:function(g){var b=[31104E3,2592E3,604800,86400,3600,60,1];try{var e;var m=g;g=[2,3,4,5,7,8,9];var u=[0,0,0,0,0,0,0],p;if(m=m.toUpperCase()){if("string"!==typeof m)throw Error("Invalid iso8601 period string '"+m+"'");if(p=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(m))for(m=0;m<g.length;m++){var q=g[m];u[m]=p[q]?+p[q].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+m+"' is not a valid ISO8601 period.");}e=u}catch(r){return null}for(q=
p=0;q<e.length;q++)p+=e[q]*b[q];return p}}}();function Local_API_1484_11(e){function g(l,b){f.diganostic="The "+l+" of "+b+" must be a proper vocabulary element.";f.errorCode=406;return"false"}function b(l){f.errorCode=402;f.diagnostic="The value for key "+l+" has not been created yet.";return"false"}function n(l,b){f.errorCode=201;f.diagnostic="The value for key "+l+" is not valid.";return"false"}function m(l,b,a){l=l.split(/\./);2>l.length?a[l[0]]=b:(a[l[0]]||(a[l[0]]={}),a=a[l.shift()],m(l.join("."),b,a))}function u(l,a){var c=l.split(/\./),
f;if(2>c.length)try{return a[c[0]]}catch(h){return b(l),"false"}else{f=c.shift();if(a[f])return String(u(c.join("."),a[f]));b(l);return"false"}}function p(l){var b,a=0;for(b in l)l.hasOwnProperty(b)&&(a+=1);return a}function q(l,a){if(f.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(l);break;case 2:console.warn(l);break;case 4:console.info(l);
break;case 3:console.log(l);break;default:return console.log(l),!1}return!0}3>a&&f.throw_alerts&&alert(l);return!1}function r(l,a){if("function"==typeof f.listeners[l]&&"undefined"!=typeof a)f.listeners[l](a)}function d(l,a){for(var b in a)a.hasOwnProperty(b)&&("object"==typeof l[b]?"object"==typeof a[b]&&(l[b]=d(l[b],a[b])):l[b]=a[b]);return l}function a(a,b){(function(){function a(b,l){l=l||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(b,l.bubbles,
l.cancelable,l.detail);return c}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}function s(a){return"object"!==type(a)||a.nodeType||isWindow(a)?!1:!(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))}var f=d({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},e),c={},h={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},t=this;"object"===typeof f.user&&("string"===typeof f.user.name&&(f.CMI.learner_name=f.user.name),"string"===typeof f.user.id&&(f.CMI.learner_id=f.user.id));this.isRunning=function(){return 1===f.initialized&&0===f.terminated};this.Initialize=function(){q(f.prefix+
":  Initializing...",3);f.cmi?(c=f.cmi,"suspend"===c.exit&&(c.entry="resume")):c=f.CMI;f.initialized=1;f.terminated=0;return"true"};this.GetValue=function(a){f.errorCode=0;var b="false";a=a.toString();var h=[];if(this.isRunning()){h=a.split(".");if(0<="|exit|session_time|".indexOf("|"+h[h.length-1]+"|"))return q(f.prefix+": This "+a+" is write only",4),f.errorCode=405,"false";h=a.toLowerCase().split(".");switch(h[0]){case "cmi":switch(b="false",a){case "cmi.exit":case "cmi.session_time":f.errorCode=
405;f.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;case "cmi.learner_name":b=f.CMI.learner_name;break;default:b=u(a.substr(4,a.length),c),"undefined"===b&&(f.errorCode=401,f.diagnostic="Sorry, there was a undefined response from "+a,b="false"),q(f.prefix+": GetValue "+a+" = "+b,4)}}return b}f.errorCode=123;return b};this.SetValue=function(a,b){q(f.prefix+": SetValue: "+a+" = "+b,4);f.errorCode=0;var h=[],k=a.toString(),e=b.toString(),d=0,t=0,d=[];if(this.isRunning()){d=
k.split(".");if("adl"===d[0]&&"id"===d[4]||"comments_from_lms"===d[1]||("comments_from_learner"===d[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+d[d.length-1]+"|")))return q(f.prefix+": This "+k+" is read only",4),f.errorCode=404,"false";h=k.split(".");switch(h[0]){case "cmi":switch(a){case "cmi.location":1E3<e.length&&q(f.prefix+": Some LMS's might truncate your bookmark as you've passed "+
e.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(a,e);d=Math.max(0,Math.min(1,d));r(a,d);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+e+"|"))return g(a,e);r(a,e);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return g(a,e);break;case "cmi.score.scaled":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(a,e);d=Math.max(0,
Math.min(1,d));r(a,d);break;case "cmi.score.min":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(a,e);f.CMI.score.min=d;break;case "cmi.score.max":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(a,e);f.CMI.score.max=d;break;case "cmi.score.raw":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(a,e);t=parseFloat(f.CMI.score.max);t="number"!=typeof t||isNaN(t)?100:t;h=parseFloat(f.CMI.score.min);h="number"!=typeof h||isNaN(h)?0:h;t-=h;0>=t&&(t=100);d=Math.max(0,Math.min(1,(d-
h)/t));r("cmi.score.scaled",d);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+e+"|"))return g(a,e);r(a,e);break;default:switch(h[1]){case "comments_from_lms":return f.errorCode="404",f.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===c.comments_from_learner._children.indexOf(h[3]))return g(a,e);m(k.substr(4,k.length),e,c);c.comments_from_learner._count=(p(c.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===c.interactions._children.indexOf(h[3]))return g(a,e);c.interactions._count=(p(c.interactions)-2).toString();if(isNaN(parseInt(h[2],10)))return"false";if(!s(c.interactions[h[2]])){if("id"===h[3])return c.interactions[h[2]]={},m(k.substr(4,k.length),e,c),c.interactions._count=(p(c.interactions)-2).toString(),s(c.interactions[h[2]].objectives)||(q(f.prefix+": Constructing objectives object for new interaction",4),c.interactions[h[2]].objectives={},c.interactions[h[2]].objectives._count=
"-1"),s(c.interactions[h[2]].correct_responses)||(q(f.prefix+": Constructing correct responses object for new interaction",4),c.interactions[h[2]].correct_responses={},c.interactions[h[2]].correct_responses._count="-1"),"true";q("Can't add interaction without ID first!",3);return"false"}if("objectives"===h[3]){if("id"===h[5])for(t=parseInt(c.interactions[h[2]].objectives._count,10),d=0;d<t;d+=1){if(c.interactions[h[2]].objectives[d].id===e)return k=a,f.errorCode="351",f.diagnostic="The "+k+" element must be unique.  The value '"+
e+"' has already been set in #"+d,"false"}else return g(a,e);m(k.substr(4,k.length),e,c);c.interactions[h[2]].objectives._count=(p(c.interactions[h[2]].objectives)-1).toString();return"true"}"correct_responses"===h[3]&&(m(k.substr(4,k.length),e,c),c.interactions[h[2]].correct_responses._count=(p(c.interactions[h[2]].correct_responses)-1).toString());m(k.substr(4,k.length),e,c);c.interactions._count=(p(c.interactions)-2).toString();return"true";case "objectives":if("id"===h[3])for(t=parseInt(c.objectives._count,
10),d=0;d<t;d+=1)if(c.objectives[d].id===e)return f.errorCode="351",f.diagnostic="The objectives.id element must be unique.  The value '"+e+"' has already been set in objective #"+d,"false";if("id"!==h[3]&&(d=parseInt(h[2],10),void 0===c.objectives[d]))return f.errorCode="408",f.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(h[2],10)))return"false";m(k.substr(4,k.length),e,c);c.objectives._count=(p(c.objectives)-2).toString();return"true"}}m(k.substr(4,
k.length),e,c)}return"true"}f.errorCode=f.terminated?133:132;return"false"};this.Commit=function(){q(f.prefix+": Commit CMI Object:",4);q(c);q(f.prefix+": Suspend Data Usage "+(Math.round(100*(c.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));a("StoreData",{runtimedata:c});return"true"};this.Terminate=function(){t.Commit();f.terminated=1;f.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==h[a])?h[a]:""};this.GetLastError=function(){return f.errorCode};
this.GetDiagnostic=function(){return f.diagnostic};this.setCMILMSValue=function(a,b){"string"==typeof a&&(f.CMI[a]=b)};this.addListener=function(a,b){"string"==typeof a&&"function"==typeof b&&(f.listeners[a]=b)}};function Local_API_SCORM_12(e){function g(b,c){a.diganostic="The "+b+" of "+c+" must be a proper vocabulary element.";a.errorCode=406;return"false"}function b(b){a.errorCode=402;a.diagnostic="The value for key "+b+" has not been created yet.";return"false"}function n(b,c){a.errorCode=201;a.diagnostic="The value for key "+b+" is not valid.";return"false"}function m(a,b,c){a=a.split(/\./);2>a.length?c[a[0]]=b:(c[a[0]]||(c[a[0]]={}),c=c[a.shift()],m(a.join("."),b,c))}function u(a,c){var d=a.split(/\./),
f;if(2>d.length)try{return c[d[0]]}catch(e){return b(a),"false"}else{f=d.shift();if(c[f])return String(u(d.join("."),c[f]));b(a);return"false"}}function p(b,c){if(a.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(c){case 1:console.error(b);break;case 2:console.warn(b);break;case 4:console.info(b);break;case 3:console.log(b);break;default:return console.log(b),
!1}return!0}3>c&&a.throw_alerts&&alert(b);return!1}function q(b,c){if("function"==typeof a.listeners[b]&&"undefined"!=typeof c)a.listeners[b](c)}function r(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof a[c]?"object"==typeof b[c]&&(a[c]=r(a[c],b[c])):a[c]=b[c]);return a}function d(a,b){(function(){function a(b,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=document.createEvent("CustomEvent");d.initCustomEvent(b,c.bubbles,c.cancelable,c.detail);return d}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}var a=r({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},e),s={},f={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},c=this;"object"===typeof a.user&&("string"===typeof a.user.name&&(a.CMI.core.student_name=a.user.name),"string"===typeof a.user.id&&(a.CMI.core.student_id=a.user.id));this.isRunning=function(){return 1===a.initialized&&0===a.terminated};this.LMSInitialize=function(){p(a.prefix+":  Initializing...",3);s=a.CMI;a.initialized=1;a.terminated=
0;return"true"};this.LMSGetValue=function(b){a.errorCode=0;var c="false";b=b.toString();var d=[];if(this.isRunning()){d=b.split(".");if(0<="|exit|session_time|".indexOf("|"+d[d.length-1]+"|"))return a.errorCode=405,"false";d=b.toLowerCase().split(".");switch(d[0]){case "cmi":c=b;b="false";switch(c){case "cmi.core.exit":case "cmi.core.session_time":a.errorCode=405;a.diagnostic="Sorry, this has been specified as a read-only value for "+c;break;default:c=c.replace("cmi.",""),b=u(c,s),"undefined"===b&&
(a.errorCode=401,a.diagnostic="Sorry, there was a undefined response from "+c,b="false")}c=b}return c}a.errorCode=123;return c};this.LMSSetValue=function(b,c){p(a.prefix+": SetValue: "+b+" = "+c,4);a.errorCode=0;var d=[],f=b.toString(),e=c.toString();if(this.isRunning()){var d=f.split("."),k=d[d.length-1],d="adl"===d[0]&&"id"===d[4]?!0:"comments_from_lms"===d[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
k+"|");if(d)return a.errorCode=404,"false";d=f.split(".");switch(d[0]){case "cmi":switch(b){case "cmi.core.lesson_location":1E3<e.length&&p(a.prefix+": Some LMS's might truncate your bookmark as you've passed "+e.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+e+"|"))return g(b,e);q(b,e);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return g(b,
e);break;case "cmi.core.score.min":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(b,e);a.CMI.core.score.min=d;break;case "cmi.core.score.max":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(b,e);a.CMI.core.score.max=d;break;case "cmi.core.score.raw":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(b,e);var r=parseFloat(a.CMI.core.score.max),r="number"!=typeof r||isNaN(r)?100:r,k=parseFloat(a.CMI.core.score.min),k="number"!=typeof k||isNaN(k)?0:k,r=r-k;0>=r&&(r=100);d=Math.max(0,
Math.min(1,(d-k)/r));q("cmi.score.scaled",d)}f=f.replace("cmi.","");m(f,e,s)}return"true"}a.errorCode=a.terminated?133:132;return"false"};this.LMSCommit=function(){d("StoreData",{runtimedata:s});return"true"};this.LMSTerminate=function(){c.LMSCommit();a.terminated=1;a.initialized=0;return"true"};this.LMSFinish=function(){c.LMSCommit();a.terminated=1;a.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==f[a])?f[a]:""};this.LMSGetLastError=function(){return a.errorCode};
this.LMSGetDiagnostic=function(){return a.diagnostic};this.setCMILMSValue=function(b,c){"string"==typeof b&&(a.CMI[b]=c)};this.addListener=function(b,c){"string"==typeof b&&"function"==typeof c&&(a.listeners[b]=c)}};SGAME=function(){return{init:function(e){return SGAME.CORE.init(e)},loadSettings:function(e){return SGAME.CORE.loadSettings(e)},triggerLO:function(e,g){return SGAME.CORE.triggerLO(e,g)},showLO:function(e,g){return SGAME.CORE.showLO(e,g)},showRandomLO:function(e){return SGAME.CORE.showRandomLO(e)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(e){return SGAME.CORE.losCanBeShown(e)},successWhenNoLOs:function(e){return SGAME.CORE.successWhenNoLOs(e)}}}();
SGAME.VERSION="0.6";SGAME.AUTHORS="Aldo Gordillo, Enrique Barra";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var e=!1;return{init:function(g){!0===g&&(e=g)},isDebugging:function(){return e},log:function(g){e&&window.console&&console.log(g)}}}();SGAME.Messenger=function(){function e(a,b){this.data=a||{};-1!==["PROTOCOL","APP"].indexOf(b)?this.type=b:this.type="APP";this.origin=n;this.destination=m}var g=["PROTOCOL","APP"],b=["SGAME_GATEWAY","SGAME_API"],n="SGAME_API",m="SGAME_GATEWAY",u=!1,p=!1,q=function(a){try{window.parent.parent.postMessage(a,"*")}catch(b){}},r=function(a){var b;b="object"!==typeof a||"string"!==typeof a.data?!1:d(a.data);if(b)switch(a=JSON.parse(a.data),a.type){case "PROTOCOL":if(a.data)switch(a.data.message){case "onIframeMessengerHello":"SGAME_GATEWAY"===
a.origin&&!0!==p&&(p=!0,a.destination=a.origin,a.origin=n,q(JSON.stringify(a)))}break;case "APP":if(a.data&&"string"===typeof a.data.key)switch(a.data.key){case "lms_data":if("object"===typeof a.data.value){b=a.data.value;a={};if("string"===typeof b.name||"number"===typeof b.name)a.name=""+b.name;if("string"===typeof b.id||"number"===typeof b.id)a.id=""+b.id;b=SGAME.CORE.getVLEData();b.user=a;SGAME.CORE.setVLEData(b)}}}},d=function(a){try{if(a=JSON.parse(a),-1===g.indexOf(a.type)||-1===b.indexOf(a.origin))return!1}catch(d){return!1}return!0};
return{init:function(b){if(!u){u=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",r,!1):window.attachEvent&&window.parent.attachEvent("message",r)}catch(d){}}},sendMessage:function(b){u&&p&&(b=JSON.stringify(new e(b,void 0)),d(b)&&q(b))}}}();SGAME.API=function(){var e=function(e,b){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText);b(e)}};n.open("GET",e,!0);n.send("")};return{init:function(){},requestLOMetadata:function(g,b,n){try{e("undefined"==typeof g?"/lo/random/metadata.json":"/lo/"+g+"/metadata.json",function(e){b(e)})}catch(m){n(m)}}}}();SGAME.CORE=function(){var e={},g=void 0,b={},n=!1,m={},u={completion_status:"incompleted",success_status:"unknown"},p=["repeat","repeat_unless_successfully_consumed","no_repeat"],q=["percentage_los","n_los_shown","n_times_shown","disabled"],r=["percentage_los","n_los_shown","n_times_shown","disabled"],d="no_more_los all_los_consumed all_los_succesfully_consumed completion_status success_status never".split(" "),a=["success","failure","success_unless_damage","failure_unless_blocking"],s=!1,f=0,c=0,
h=0,t=!1,l="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",v=function(c){b=c;"undefined"===typeof b.game_metadata&&(b.game_metadata={});"undefined"===typeof b.los&&(b.los={});"undefined"===typeof b.events&&(b.events={});"undefined"===typeof b.event_mapping&&(b.event_mapping={});"undefined"===typeof b.sequencing&&(b.sequencing={});-1===p.indexOf(b.sequencing.repeat_lo)&&(b.sequencing.repeat_lo="repeat");"undefined"===typeof b.game_settings&&
(b.game_settings={});-1===q.indexOf(b.game_settings.completion_status)&&(b.game_settings.completion_status="disabled");"disabled"!==b.game_settings.completion_status&&"number"===typeof b.game_settings.completion_status_n||delete b.game_settings.completion_status_n;-1===q.indexOf(b.game_settings.success_status)&&(b.game_settings.success_status="disabled");"disabled"!==b.game_settings.success_status&&"number"===typeof b.game_settings.success_status_n||delete b.game_settings.success_status_n;-1===r.indexOf(b.game_settings.success_status)&&
(b.game_settings.success_status="disabled");-1===d.indexOf(b.game_settings.completion_notification)&&(b.game_settings.completion_notification="never");-1===a.indexOf(b.game_settings.behaviour_when_no_more_los)&&(b.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof b.game_settings.completion_notification_text&&(l=b.game_settings.completion_notification_text);if("object"===typeof b.los){c=Object.keys(b.los);f=c.length;for(var e=0;e<f;e++)"undefined"!==typeof b.los[c[e]].url&&
(b.los[c[e]].url=SGAME.Utils.checkUrlProtocol(b.los[c[e]].url)),b.los[c[e]].can_be_shown=!0,b.los[c[e]].shown=!1,b.los[c[e]].nshown=0,b.los[c[e]].succesfully_consumed=!1,b.los[c[e]].nsuccess=0,b.los[c[e]].acts_as_asset="asset"===b.los[c[e]].scorm_type||"sco"===b.los[c[e]].scorm_type&&!1===b.los[c[e]].report_data,s=!0}},w=function(a){var c=[];a=b.event_mapping[a];if("undefined"!==typeof a){var d=a.length;if("number"===typeof d)for(var e=0;e<d;e++){if("*"===a[e]){c=[];a=Object.keys(b.los);for(d=0;d<
a.length;d++)"undefined"!==typeof b.los[a[d]]&&c.push(b.los[a[d]]);break}"undefined"!==typeof b.los[a[e]]&&c.push(b.los[a[e]])}}return c},k=function(b){for(var a=[],c=b.length,d=0;d<c;d++)!0===b[d].can_be_shown&&a.push(b[d]);return a},x=function(a,c){"object"!==typeof a||"string"!==typeof a.url?"function"===typeof c&&c(null,null):(y(),b.los[a.id].shown=!0,b.los[a.id].nshown+=1,SGAME.Fancybox.create({lo:a},function(d){b.los[a.id].succesfully_consumed=d.success;!0===d.success&&(b.los[a.id].nsuccess+=
1);switch(b.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":b.los[a.id].can_be_shown=!0!==b.los[a.id].succesfully_consumed;break;case "no_repeat":b.los[a.id].can_be_shown=!1}C();d.more_los=s;D(function(){"function"===typeof c&&c(d.success,d);y()})}))},y=function(){"function"===typeof g&&g()},C=function(){s=!1;for(var a=Object.keys(b.los),d=a.length,e=0;e<d;e++)!0===b.los[a[e]].shown&&(c+=1,h+=b.los[a[e]].nshown),!0===b.los[a[e]].can_be_shown&&(s=!0);a="incompleted";if("number"===
typeof b.game_settings.completion_status_n)switch(b.game_settings.completion_status){case "percentage_los":a=c/f>=b.game_settings.completion_status_n?"completed":"incompleted";break;case "n_los_shown":a=c>=b.game_settings.completion_status_n?"completed":"incompleted";break;case "n_times_shown":a=h>=b.game_settings.completion_status_n?"completed":"incompleted";break;default:a="incompleted"}d="unknown";if("number"===typeof b.game_settings.success_status_n)switch(b.game_settings.success_status){case "percentage_los":d=
c/f>=b.game_settings.success_status_n?"passed":"failed";break;case "n_los_shown":d=c>=b.game_settings.success_status_n?"passed":"failed";break;case "n_times_shown":d=h>=b.game_settings.success_status_n?"passed":"failed";break;default:d="unknown"}u={completion_status:a,success_status:d};SGAME.Messenger.sendMessage({key:"tracking",value:u})},D=function(a){!0!==E()?"function"===typeof a&&a(!1):F(a)},E=function(){if(!0===t)return!1;switch(b.game_settings.completion_notification){case "no_more_los":return!1===
s;case "all_los_consumed":for(var a=Object.keys(b.los),c=a.length,d=0;d<c;d++)if(!1===b.los[a[d]].shown)return!1;return!0;case "all_los_succesfully_consumed":a=Object.keys(b.los);c=a.length;for(d=0;d<c;d++)if(!1===b.los[a[d]].succesfully_consumed)return!1;return!0;case "never":return!1;default:return!1}},F=function(a){t=!0;SGAME.Fancybox.create({dialog:!0,msg:l},function(){"function"===typeof a&&a(!0)})},A=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,
scorm_completion_status:void 0,scorm_progress_measure:void 0,success:z(a),more_los:s}},z=function(a){var c;n&&"undefined"!==typeof b.game_settings.behaviour_when_no_more_los?c=b.game_settings.behaviour_when_no_more_los:"undefined"!==typeof e.behaviour_when_no_more_los?c=e.behaviour_when_no_more_los:"undefined"!==typeof b.game_settings.behaviour_when_no_more_los&&(c=b.game_settings.behaviour_when_no_more_los);return G(c,a)},G=function(a,b){switch(a){case "success":return!0;case "failure":return!1;
case "success_unless_damage":var c=B(b);return"undefined"!==typeof c&&"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=B(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},B=function(a){return"undefined"!==typeof b.events[a]?b.events[a]:"object"===typeof e.events&&"undefined"!==typeof e.events[a]?e.events[a]:{}};SGAME.Debugger.init(!0);!1===n&&v({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);
(e=a)&&"function"===typeof a.togglePause&&(g=a.togglePause)},loadSettings:function(a){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(a);n=!0;v(a)},triggerLO:function(a,b){var c=w(a);if(1>c.length){if("function"===typeof b){var d=A(a);b(d.success,d)}}else if(c=k(c),0<c.length){for(var e=[],f=0;f<c.length;f++)"undefined"===typeof d&&(d=c[f].nshown),c[f].nshown<d&&(d=c[f].nshown,e=[]),d===c[f].nshown&&e.push(c[f]);selectedLO=SGAME.Utils.getRandomElement(e);x(selectedLO,b)}else"function"===
typeof b&&(d=A(a),b(d.success,d))},showLO:x,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){x(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return b},losCanBeShown:function(a){return!1===s?!1:"undefined"===typeof a?s:0<k(w(a)).length},successWhenNoLOs:function(a){return z(a)},getVLEData:function(){return m},setVLEData:function(a){return m=a}}}();var API,API_1484_11;
SGAME.Fancybox=function(e){var g=e,b=e,n=e,m=function(){"undefined"!=typeof g&&(g.style.display="none",g.parentNode.removeChild(g),"lo"===b&&(API_1484_11=API=e),b=g=e)},u=function(){if("undefined"!=typeof g){var p=b;m();var q;q="lo"===p?SGAME.Observer.stop():!0;var r=n;n=e;setTimeout(function(){"function"===typeof r&&r(q)},50)}};return{init:function(){},create:function(p,q){m();n=q;var r="undefined"!==typeof p&&!0===p.dialog?"dialog":"lo",d=4/3,a,s,f=0.9*window.innerWidth,c=0.9*window.innerHeight;
c*d>f?(a=f,s=a/d):(s=c,a=s*d);if("lo"===r)var h={},t;else var l="";p&&(p.width&&(a=p.width),p.height&&(s=p.height),"lo"===r?p.lo&&(h=p.lo,"string"===typeof h.url&&(t=h.url)):"string"==typeof p.msg&&(l=p.msg));if("lo"===r){if("string"!=typeof t||"undefined"==typeof h.scorm_type)return;var v=e,d=API_1484_11=API=e,w=SGAME.CORE.getVLEData();"object"===typeof w.user&&(d=w.user);"sco"===h.scorm_type&&("1.2"===h.scorm_version?v=API=new Local_API_SCORM_12({user:d,debug:SGAME.Debugger.isDebugging()}):"2004"===
h.scorm_version&&(v=API_1484_11=new Local_API_1484_11({user:d,debug:SGAME.Debugger.isDebugging()})))}d=document.createElement("div");d.style.width=a+"px";d.style.height=s+"px";d.style.maxWidth=f+"px";d.style.maxHeight=c+"px";d.style.overflow="lo"===r?"hidden":"auto";d.style.background="white";d.style.position="absolute";d.style.top=0;d.style.zIndex=9999;d.style.borderRadius="1em";d.style.border="2px solid black";d.setAttribute("id","sgame_fancybox");d.style.marginLeft=(window.innerWidth-a)/2+"px";
d.style.marginTop=(window.innerHeight-s)/2+"px";c=document.createElement("img");c.src="/assets/sgame/close.png";f=Math.max(25,Math.floor(0.05*s));c.style.width=f+"px";c.style.height=f+"px";c.style.padding="5px";c.style.cursor="pointer";c.style.position="absolute";c.style.right=0;c.onclick=function(){u()};d.appendChild(c);if("lo"===r){var k=document.createElement("img");k.id="trafficLight";k.src="/assets/sgame/trafficLight/trafficLight_red.png";l=Math.max(40,Math.floor(0.085*s));c=Math.max(30,Math.floor(0.75*
l));k.style.height=l+"px";k.style.width=c+"px";k.style.padding="4px";k.style.position="absolute";k.style.left="0px";k.style.top="0px";k.style.background="#fff";k.style.borderRadius="0px 0px 20px 0px";k.style.borderRight="2px solid black";k.style.borderBottom="2px solid black";d.appendChild(k);k=document.createElement("iframe");k.src=t;t=Math.ceil(Math.max(f,l))+4;l=Math.floor(0.02*s);f=Math.floor(0.02*a);k.style.marginLeft=f+"px";k.style.marginTop=t+"px";k.style.width=Math.max(0,a-f-f)+"px";k.style.height=
Math.max(0,s-t-l)+"px";k.style.overflow="auto";k.scrolling="yes";k.style.frameBorder="0";k.style.borderStyle="none";k.setAttribute("allowfullscreen","false");d.appendChild(k)}else a=document.createElement("p"),a.id="dialog",a.innerHTML=l,a.style.padding="15px",a.style.marginTop="30px",a.style.marginBottom="20px",a.style.marginRight="20px",a.style.marginLeft="20px",a.style.textAlign="center",a.style.fontSize="24px",a.style.position="relative",a.style.cursor="default",a.style.color="#000",a.style.fontFamily=
"initial",d.appendChild(a);g=d;b=r;document.body.appendChild(d);"lo"===r&&SGAME.Observer.start(k,h,v)},closeCurrentFancybox:u}}();SGAME.Observer=function(e){var g=!0,b=e,n=e,m=e,u,p,q,r,d,a,s=function(){m=n=b=e;u=Date.now();p=!1;a=d=r=q=e},f=function(){!1===n.acts_as_asset&&"undefined"!==typeof m&&(m.addListener("cmi.success_status",function(a){q=a;"passed"===q&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),m.addListener("cmi.score.scaled",function(a){r=a;0.8<=r&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
m.addListener("cmi.completion_status",function(a){d=a}),m.addListener("cmi.progress_measure",function(b){a=b}))};return{start:function(a,d,e){if(!1===g||"undefined"!=typeof b)return null;g=!1;s();b=a;n=d;m=e;f();SGAME.TrafficLight.changeColor("red");if(!0===n.acts_as_asset){b:{a=n.lom_metadata;if(a.educational&&a.educational.typicalLearningTime&&a.educational.typicalLearningTime.duration&&(a=iso8601Parser.getDuration(a.educational.typicalLearningTime.duration)))break b;a=null}a=!a||0>=a?15:Math.min(0.5*
a,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*a-0.5,0.5*a);SGAME.TrafficLight.changeColor("green",a)}},stop:function(){if(!0===g||"undefined"==typeof b)return null;g=!0;SGAME.TrafficLight.stop();var c=Math.round((Date.now()-u)/1E3);p="green"===SGAME.TrafficLight.getCurrentColor();c={lo_metadata:n,time:c,success:p};"undefined"!=typeof q&&(c.scorm_success_status=q);"undefined"!=typeof r&&(c.scorm_scaled_score=r);"undefined"!=typeof d&&(c.scorm_completion_status=d);"undefined"!=typeof a&&(c.scorm_progress_measure=
a);s();return c},isStopped:function(){return g}}}();SGAME.TrafficLight=function(e){var g,b,n,m,u,p=function(b){var a=document.getElementById("trafficLight");a&&(g=b,a.src=q(b))},q=function(b){switch(b){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},r=function(b,a){var e=document.getElementById("trafficLight");if(e){var f=!1;m=
setInterval(function(){e&&(f?(e.src=q(null),f=!1):(e.src=q(b),f=!0))},500);u=setTimeout(function(){clearTimeout(m)},1E3*a)}};return{getCurrentColor:function(){return g},changeColor:function(d,a){a?b=setTimeout(function(){p(d)},1E3*a):p(d)},setUpBlink:function(b,a,e){e?n=setTimeout(function(){r(b,a)},1E3*e):r(b,a)},stop:function(){b&&clearTimeout(b);n&&clearTimeout(n);m&&clearTimeout(m);u&&clearTimeout(u)}}}();SGAME.Utils=function(){var e=void 0;return{init:function(e){},getRandomElement:function(e){if("number"==typeof e)return e;var b;b=e.length-1;if("number"!=typeof b)throw{name:"Invalid number format exception"};b=Math.round(0+Math.random()*(b-0));return e[b]},loadScript:function(e,b){if("string"===typeof e&&"function"===typeof b){var n=document.getElementsByTagName("head")[0];if(n){var m=document.createElement("script");m.setAttribute("src",e);m.setAttribute("type","text/javascript");m.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||b()};m.onload=b;n.appendChild(m)}}},getProtocol:function(){if("undefined"!==typeof e)return e;var g;try{g=document.location.protocol}catch(b){}"string"===typeof g&&(g=g.match(/[\w]+/),g=g instanceof Array&&"string"===typeof g[0]?g[0]:void 0);return e="string"===typeof g?g:"unknown"},checkUrlProtocol:function(e){if("string"===typeof e){var b=e.match(/^https?:\/\//);if(b instanceof Array&&1===b.length){var b=b[0].replace("://",""),n=
SGAME.Utils.getProtocol();if(b!==n)switch(n){case "https":e="https"+e.replace(b,"")}}}return e}}}();
