iso8601Parser=function(g){return{getDuration:function(f){var g=[31104E3,2592E3,604800,86400,3600,60,1];try{var a;var l=f;f=[2,3,4,5,7,8,9];var t=[0,0,0,0,0,0,0],n;if(l=l.toUpperCase()){if("string"!==typeof l)throw Error("Invalid iso8601 period string '"+l+"'");if(n=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(l))for(l=0;l<f.length;l++){var p=f[l];t[l]=n[p]?+n[p].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+l+"' is not a valid ISO8601 period.");}a=t}catch(r){return null}for(p=
n=0;p<a.length;p++)n+=a[p]*g[p];return n}}}();function Local_API_1484_11(g){function f(a,b){d.diganostic="The "+a+" of "+b+" must be a proper vocabulary element.";d.errorCode=406;return"false"}function q(a){d.errorCode=402;d.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function a(a,b){d.errorCode=201;d.diagnostic="The value for key "+a+" is not valid.";return"false"}function l(a,b,c){a=a.split(/\./);2>a.length?c[a[0]]=b:(c[a[0]]||(c[a[0]]={}),c=c[a.shift()],l(a.join("."),b,c))}function t(a,b){var c=a.split(/\./),
s;if(2>c.length)try{return b[c[0]]}catch(d){return q(a),"false"}else{s=c.shift();if(b[s])return String(t(c.join("."),b[s]));q(a);return"false"}}function n(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&(c+=1);return c}function p(a,b){if(d.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(b){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);
break;case 3:console.log(a);break;default:return console.log(a),!1}return!0}3>b&&d.throw_alerts&&alert(a);return!1}function r(a,b){if("function"==typeof d.listeners[a]&&"undefined"!=typeof b)d.listeners[a](b)}function e(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof a[c]?"object"==typeof b[c]&&(a[c]=e(a[c],b[c])):a[c]=b[c]);return a}function b(a,b){(function(){function a(b,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var v=document.createEvent("CustomEvent");v.initCustomEvent(b,c.bubbles,
c.cancelable,c.detail);return v}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}function u(a){return"object"!==type(a)||a.nodeType||isWindow(a)?!1:!(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))}var d=e({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},g),c={},s={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},m=this;"object"===typeof d.user&&("string"===typeof d.user.name&&(d.CMI.learner_name=d.user.name),"string"===typeof d.user.id&&(d.CMI.learner_id=d.user.id));this.isRunning=function(){return 1===d.initialized&&0===d.terminated};this.Initialize=function(){p(d.prefix+
":  Initializing...",3);d.cmi?(c=d.cmi,"suspend"===c.exit&&(c.entry="resume")):c=d.CMI;d.initialized=1;d.terminated=0;return"true"};this.GetValue=function(a){d.errorCode=0;var b="false";a=a.toString();var s=[];if(this.isRunning()){s=a.split(".");if(0<="|exit|session_time|".indexOf("|"+s[s.length-1]+"|"))return p(d.prefix+": This "+a+" is write only",4),d.errorCode=405,"false";s=a.toLowerCase().split(".");switch(s[0]){case "cmi":switch(b="false",a){case "cmi.exit":case "cmi.session_time":d.errorCode=
405;d.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;case "cmi.learner_name":b=d.CMI.learner_name;break;default:b=t(a.substr(4,a.length),c),"undefined"===b&&(d.errorCode=401,d.diagnostic="Sorry, there was a undefined response from "+a,b="false"),p(d.prefix+": GetValue "+a+" = "+b,4)}}return b}d.errorCode=123;return b};this.SetValue=function(b,s){p(d.prefix+": SetValue: "+b+" = "+s,4);d.errorCode=0;var k=[],h=b.toString(),m=s.toString(),e=0,g=0,e=[];if(this.isRunning()){e=
h.split(".");if("adl"===e[0]&&"id"===e[4]||"comments_from_lms"===e[1]||("comments_from_learner"===e[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+e[e.length-1]+"|")))return p(d.prefix+": This "+h+" is read only",4),d.errorCode=404,"false";k=h.split(".");switch(k[0]){case "cmi":switch(b){case "cmi.location":1E3<m.length&&p(d.prefix+": Some LMS's might truncate your bookmark as you've passed "+
m.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":e=parseFloat(m);if("number"!=typeof e||isNaN(e))return a(b,m);e=Math.max(0,Math.min(1,e));r(b,e);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+m+"|"))return f(b,m);r(b,m);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+m+"|"))return f(b,m);break;case "cmi.score.scaled":e=parseFloat(m);if("number"!=typeof e||isNaN(e))return a(b,m);e=Math.max(0,
Math.min(1,e));r(b,e);break;case "cmi.score.min":e=parseFloat(m);if("number"!=typeof e||isNaN(e))return a(b,m);d.CMI.score.min=e;break;case "cmi.score.max":e=parseFloat(m);if("number"!=typeof e||isNaN(e))return a(b,m);d.CMI.score.max=e;break;case "cmi.score.raw":e=parseFloat(m);if("number"!=typeof e||isNaN(e))return a(b,m);g=parseFloat(d.CMI.score.max);g="number"!=typeof g||isNaN(g)?100:g;k=parseFloat(d.CMI.score.min);k="number"!=typeof k||isNaN(k)?0:k;g-=k;0>=g&&(g=100);e=Math.max(0,Math.min(1,(e-
k)/g));r("cmi.score.scaled",e);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+m+"|"))return f(b,m);r(b,m);break;default:switch(k[1]){case "comments_from_lms":return d.errorCode="404",d.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===c.comments_from_learner._children.indexOf(k[3]))return f(b,m);l(h.substr(4,h.length),m,c);c.comments_from_learner._count=(n(c.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===c.interactions._children.indexOf(k[3]))return f(b,m);c.interactions._count=(n(c.interactions)-2).toString();if(isNaN(parseInt(k[2],10)))return"false";if(!u(c.interactions[k[2]])){if("id"===k[3])return c.interactions[k[2]]={},l(h.substr(4,h.length),m,c),c.interactions._count=(n(c.interactions)-2).toString(),u(c.interactions[k[2]].objectives)||(p(d.prefix+": Constructing objectives object for new interaction",4),c.interactions[k[2]].objectives={},c.interactions[k[2]].objectives._count=
"-1"),u(c.interactions[k[2]].correct_responses)||(p(d.prefix+": Constructing correct responses object for new interaction",4),c.interactions[k[2]].correct_responses={},c.interactions[k[2]].correct_responses._count="-1"),"true";p("Can't add interaction without ID first!",3);return"false"}if("objectives"===k[3]){if("id"===k[5])for(g=parseInt(c.interactions[k[2]].objectives._count,10),e=0;e<g;e+=1){if(c.interactions[k[2]].objectives[e].id===m)return h=b,d.errorCode="351",d.diagnostic="The "+h+" element must be unique.  The value '"+
m+"' has already been set in #"+e,"false"}else return f(b,m);l(h.substr(4,h.length),m,c);c.interactions[k[2]].objectives._count=(n(c.interactions[k[2]].objectives)-1).toString();return"true"}"correct_responses"===k[3]&&(l(h.substr(4,h.length),m,c),c.interactions[k[2]].correct_responses._count=(n(c.interactions[k[2]].correct_responses)-1).toString());l(h.substr(4,h.length),m,c);c.interactions._count=(n(c.interactions)-2).toString();return"true";case "objectives":if("id"===k[3])for(g=parseInt(c.objectives._count,
10),e=0;e<g;e+=1)if(c.objectives[e].id===m)return d.errorCode="351",d.diagnostic="The objectives.id element must be unique.  The value '"+m+"' has already been set in objective #"+e,"false";if("id"!==k[3]&&(e=parseInt(k[2],10),void 0===c.objectives[e]))return d.errorCode="408",d.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(k[2],10)))return"false";l(h.substr(4,h.length),m,c);c.objectives._count=(n(c.objectives)-2).toString();return"true"}}l(h.substr(4,
h.length),m,c)}return"true"}d.errorCode=d.terminated?133:132;return"false"};this.Commit=function(){p(d.prefix+": Commit CMI Object:",4);p(c);p(d.prefix+": Suspend Data Usage "+(Math.round(100*(c.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));b("StoreData",{runtimedata:c});return"true"};this.Terminate=function(){m.Commit();d.terminated=1;d.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==s[a])?s[a]:""};this.GetLastError=function(){return d.errorCode};
this.GetDiagnostic=function(){return d.diagnostic};this.setCMILMSValue=function(a,b){"string"==typeof a&&(d.CMI[a]=b)};this.addListener=function(a,b){"string"==typeof a&&"function"==typeof b&&(d.listeners[a]=b)}};function Local_API_SCORM_12(g){function f(a,c){b.diganostic="The "+a+" of "+c+" must be a proper vocabulary element.";b.errorCode=406;return"false"}function q(a){b.errorCode=402;b.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function a(a,c){b.errorCode=201;b.diagnostic="The value for key "+a+" is not valid.";return"false"}function l(a,b,c){a=a.split(/\./);2>a.length?c[a[0]]=b:(c[a[0]]||(c[a[0]]={}),c=c[a.shift()],l(a.join("."),b,c))}function t(a,b){var c=a.split(/\./),
e;if(2>c.length)try{return b[c[0]]}catch(d){return q(a),"false"}else{e=c.shift();if(b[e])return String(t(c.join("."),b[e]));q(a);return"false"}}function n(a,c){if(b.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(c){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>c&&b.throw_alerts&&alert(a);return!1}function p(a,c){if("function"==typeof b.listeners[a]&&"undefined"!=typeof c)b.listeners[a](c)}function r(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof a[c]?"object"==typeof b[c]&&(a[c]=r(a[c],b[c])):a[c]=b[c]);return a}function e(a,b){(function(){function a(b,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");e.initCustomEvent(b,c.bubbles,c.cancelable,c.detail);return e}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}var b=r({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},g),u={},d={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},c=this;"object"===typeof b.user&&("string"===typeof b.user.name&&(b.CMI.core.student_name=b.user.name),"string"===typeof b.user.id&&(b.CMI.core.student_id=b.user.id));this.isRunning=function(){return 1===b.initialized&&0===b.terminated};this.LMSInitialize=function(){n(b.prefix+":  Initializing...",3);u=b.CMI;b.initialized=1;b.terminated=
0;return"true"};this.LMSGetValue=function(a){b.errorCode=0;var c="false";a=a.toString();var e=[];if(this.isRunning()){e=a.split(".");if(0<="|exit|session_time|".indexOf("|"+e[e.length-1]+"|"))return b.errorCode=405,"false";e=a.toLowerCase().split(".");switch(e[0]){case "cmi":c=a;a="false";switch(c){case "cmi.core.exit":case "cmi.core.session_time":b.errorCode=405;b.diagnostic="Sorry, this has been specified as a read-only value for "+c;break;default:c=c.replace("cmi.",""),a=t(c,u),"undefined"===a&&
(b.errorCode=401,b.diagnostic="Sorry, there was a undefined response from "+c,a="false")}c=a}return c}b.errorCode=123;return c};this.LMSSetValue=function(c,e){n(b.prefix+": SetValue: "+c+" = "+e,4);b.errorCode=0;var d=[],g=c.toString(),k=e.toString();if(this.isRunning()){var d=g.split("."),h=d[d.length-1],d="adl"===d[0]&&"id"===d[4]?!0:"comments_from_lms"===d[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
h+"|");if(d)return b.errorCode=404,"false";d=g.split(".");switch(d[0]){case "cmi":switch(c){case "cmi.core.lesson_location":1E3<k.length&&n(b.prefix+": Some LMS's might truncate your bookmark as you've passed "+k.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+k+"|"))return f(c,k);p(c,k);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+k+"|"))return f(c,
k);break;case "cmi.core.score.min":d=parseFloat(k);if("number"!=typeof d||isNaN(d))return a(c,k);b.CMI.core.score.min=d;break;case "cmi.core.score.max":d=parseFloat(k);if("number"!=typeof d||isNaN(d))return a(c,k);b.CMI.core.score.max=d;break;case "cmi.core.score.raw":d=parseFloat(k);if("number"!=typeof d||isNaN(d))return a(c,k);var q=parseFloat(b.CMI.core.score.max),q="number"!=typeof q||isNaN(q)?100:q,h=parseFloat(b.CMI.core.score.min),h="number"!=typeof h||isNaN(h)?0:h,q=q-h;0>=q&&(q=100);d=Math.max(0,
Math.min(1,(d-h)/q));p("cmi.score.scaled",d)}g=g.replace("cmi.","");l(g,k,u)}return"true"}b.errorCode=b.terminated?133:132;return"false"};this.LMSCommit=function(){e("StoreData",{runtimedata:u});return"true"};this.LMSTerminate=function(){c.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSFinish=function(){c.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==d[a])?d[a]:""};this.LMSGetLastError=function(){return b.errorCode};
this.LMSGetDiagnostic=function(){return b.diagnostic};this.setCMILMSValue=function(a,c){"string"==typeof a&&(b.CMI[a]=c)};this.addListener=function(a,c){"string"==typeof a&&"function"==typeof c&&(b.listeners[a]=c)}};SGAME=function(){return{init:function(g){return SGAME.CORE.init(g)},loadSettings:function(g){return SGAME.CORE.loadSettings(g)},triggerLO:function(g,f){return SGAME.CORE.triggerLO(g,f)},showLO:function(g,f){return SGAME.CORE.showLO(g,f)},showRandomLO:function(g){return SGAME.CORE.showRandomLO(g)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(g){return SGAME.CORE.losCanBeShown(g)},successWhenNoLOs:function(g){return SGAME.CORE.successWhenNoLOs(g)}}}();
SGAME.VERSION="0.7";SGAME.AUTHORS="Aldo Gordillo, Enrique Barra";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var g=!1;return{init:function(f){!0===f&&(g=f)},isDebugging:function(){return g},log:function(f){g&&window.console&&console.log(f)}}}();SGAME.Messenger=function(){function g(b,e){this.data=b||{};-1!==["PROTOCOL","APP"].indexOf(e)?this.type=e:this.type="APP";this.origin=a;this.destination=l}var f=["PROTOCOL","APP"],q=["SGAME_GATEWAY","SGAME_API"],a="SGAME_API",l="SGAME_GATEWAY",t=!1,n=!1,p=function(a){try{window.parent.parent.postMessage(a,"*")}catch(e){}},r=function(b){var f;f="object"!==typeof b||"string"!==typeof b.data?!1:e(b.data);if(f)switch(b=JSON.parse(b.data),b.type){case "PROTOCOL":if(b.data)switch(b.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
b.origin&&!0!==n&&(n=!0,b.data.settings=SGAME.CORE.getSettings(),b.destination=b.origin,b.origin=a,p(JSON.stringify(b)))}break;case "APP":if(b.data&&"string"===typeof b.data.key)switch(b.data.key){case "lms_data":if("object"===typeof b.data.value){f=b.data.value;b={};if("string"===typeof f.name||"number"===typeof f.name)b.name=""+f.name;if("string"===typeof f.id||"number"===typeof f.id)b.id=""+f.id;f=SGAME.CORE.getVLEData();f.user=b;SGAME.CORE.setVLEData(f)}}}},e=function(a){try{if(a=JSON.parse(a),
-1===f.indexOf(a.type)||-1===q.indexOf(a.origin))return!1}catch(e){return!1}return!0};return{init:function(a){if(!t){t=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",r,!1):window.attachEvent&&window.parent.attachEvent("message",r)}catch(e){}}},sendMessage:function(a){t&&n&&(a=JSON.stringify(new g(a,void 0)),e(a)&&p(a))}}}();SGAME.API=function(){var g=function(f,g){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var f=JSON.parse(a.responseText);g(f)}};a.open("GET",f,!0);a.send("")};return{init:function(){},requestLOMetadata:function(f,q,a){try{g("undefined"==typeof f?"/lo/random/metadata.json":"/lo/"+f+"/metadata.json",function(a){q(a)})}catch(l){a(l)}}}}();SGAME.CORE=function(){var g={},f=void 0,q="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},l=!1,t={},n={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},p=["repeat","repeat_unless_successfully_consumed","no_repeat"],r=["no_restrictions","n_times","1_per_timeperiod"],e="all_los percentage_los n_los n_times disabled onstart".split(" "),b="all_los percentage_los n_los n_times disabled onstart".split(" "),
u="no_more_los all_los_consumed all_los_succesfully_consumed completion_status success_status never".split(" "),d=["success","failure","success_unless_damage","failure_unless_blocking"],c=!1,s=0,m=0,v=0,x=0,k=0,h=!1,y=void 0,C=function(w){a=w;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===
p.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===r.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||delete a.sequencing.interruptions_n;-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&
(a.game_settings={});-1===e.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);
-1===b.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===u.indexOf(a.game_settings.completion_notification)&&
(a.game_settings.completion_notification="never");-1===d.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&(q=a.game_settings.completion_notification_text);if("object"===typeof a.los){w=Object.keys(a.los);s=w.length;for(var f=0;f<s;f++)"undefined"!==typeof a.los[w[f]].url&&(a.los[w[f]].url=SGAME.Utils.checkUrlProtocol(a.los[w[f]].url)),a.los[w[f]].can_be_shown=!0,
a.los[w[f]].shown=!1,a.los[w[f]].nshown=0,a.los[w[f]].succesfully_consumed=!1,a.los[w[f]].nsuccess=0,a.los[w[f]].acts_as_asset="asset"===a.los[w[f]].scorm_type||"sco"===a.los[w[f]].scorm_type&&!1===a.los[w[f]].report_data,c=!0}},z=function(a,b){var c=D(a);if(1>c.length)return A(a,b);c=E(c);if(0<c.length){for(var e=[],d,f=0;f<c.length;f++)"undefined"===typeof d&&(d=c[f].nshown),c[f].nshown<d&&(d=c[f].nshown,e=[]),d===c[f].nshown&&e.push(c[f]);selectedLO=SGAME.Utils.getRandomElement(e);B(selectedLO,
b)}else"function"===typeof b&&(d=F(a),b(d.success,d))},A=function(a,c){if("function"===typeof c){var b=F(a);c(b.success,b)}},D=function(c){var b=[];c=a.event_mapping[c];if("undefined"!==typeof c){var e=c.length;if("number"===typeof e)for(var d=0;d<e;d++){if("*"===c[d]){b=[];c=Object.keys(a.los);for(e=0;e<c.length;e++)"undefined"!==typeof a.los[c[e]]&&b.push(a.los[c[e]]);break}"undefined"!==typeof a.los[c[d]]&&b.push(a.los[c[d]])}}return b},E=function(a){for(var c=[],b=a.length,e=0;e<b;e++)!0===a[e].can_be_shown&&
c.push(a[e]);return c},B=function(b,e){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof e&&e(null,null):(y=new Date,G(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(d){a.los[b.id].succesfully_consumed=d.success;!0===d.success&&(a.los[b.id].nsuccess+=1);switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].succesfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}J();d.more_los=
c;K(function(){"function"===typeof e&&e(d.success,d);G()})}))},G=function(){"function"===typeof f&&f()},J=function(){c=!1;for(var b=Object.keys(a.los),e=b.length,d=0;d<e;d++)!0===a.los[b[d]].shown&&(m+=1,v+=a.los[b[d]].nshown),!0===a.los[b[d]].succesfully_consumed&&(x+=1,k+=a.los[b[d]].nsuccess),!0===a.los[b[d]].can_be_shown&&(c=!0);b=0;e="incompleted";if("number"===typeof a.game_settings.completion_status_n){switch(a.game_settings.completion_status){case "percentage_los":a.game_settings.completion_status_n=
Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100;b=0>=a.game_settings.completion_status_n||0>=s?1:m/s/a.game_settings.completion_status_n;break;case "n_los":d=Math.min(a.game_settings.completion_status_n,s);b=0===d?1:m/d;break;case "n_times":b=0>=a.game_settings.completion_status_n?1:v/a.game_settings.completion_status_n}b=Math.max(Math.min(1,+b.toFixed(2)),0);e=1===b?"completed":"incompleted"}var d=0,f="unknown";if("number"===typeof a.game_settings.success_status_n){switch(a.game_settings.success_status){case "percentage_los":a.game_settings.success_status_n=
Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;d=0>=a.game_settings.success_status_n||0>=s?1:x/s/a.game_settings.success_status_n;break;case "n_los":d=Math.min(a.game_settings.success_status_n,s);d=0===d?1:m/d;break;case "n_times":d=0>=a.game_settings.success_status_n?1:k/a.game_settings.success_status_n}d=Math.max(Math.min(1,+d.toFixed(2)),0);f=1===d?"passed":"failed"}n={progress_measure:b,completion_status:e,score:d,success_status:f};SGAME.Messenger.sendMessage({key:"tracking",value:n})},
K=function(a){!0!==L()?"function"===typeof a&&a(!1):M(a)},L=function(){if(!0===h)return!1;switch(a.game_settings.completion_notification){case "no_more_los":return!1===c;case "all_los_consumed":for(var b=Object.keys(a.los),d=b.length,e=0;e<d;e++)if(!1===a.los[b[e]].shown)return!1;return!0;case "all_los_succesfully_consumed":b=Object.keys(a.los);d=b.length;for(e=0;e<d;e++)if(!1===a.los[b[e]].succesfully_consumed)return!1;return!0;case "never":return!1;default:return!1}},M=function(a){h=!0;SGAME.Fancybox.create({dialog:!0,
msg:q},function(){"function"===typeof a&&a(!0)})},F=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:H(a),more_los:c}},H=function(b){var c;l&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof g.behaviour_when_no_more_los?c=g.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&
(c=a.game_settings.behaviour_when_no_more_los);return N(c,b)},N=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=I(b);return"undefined"!==typeof c&&"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=I(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},I=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof g.events&&"undefined"!==typeof g.events[b]?g.events[b]:{}};SGAME.Debugger.init(!1);
!1===l&&C({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(g=a)&&"function"===typeof a.togglePause&&(f=a.togglePause)},loadSettings:function(a){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(a);l=!0;C(a)},triggerLO:function(b,c){switch(a.sequencing.interruptions){case "no_restrictions":return z(b,c);case "n_times":return v>=a.sequencing.interruptions_n?A(b,c):z(b,c);case "1_per_timeperiod":return"undefined"!==typeof y&&
(new Date-y)/1E3<=a.sequencing.interruptions_n?A(b,c):z(b,c)}},showLO:B,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){B(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===c?!1:"undefined"===typeof a?c:0<E(D(a)).length},successWhenNoLOs:function(a){return H(a)},getVLEData:function(){return t},setVLEData:function(a){return t=a}}}();var API,API_1484_11;
SGAME.Fancybox=function(g){var f=g,q=g,a=g,l=function(){"undefined"!=typeof f&&(f.style.display="none",f.parentNode.removeChild(f),"lo"===q&&(API_1484_11=API=g),q=f=g)},t=function(){if("undefined"!=typeof f){var n=q;l();var p;p="lo"===n?SGAME.Observer.stop():!0;var r=a;a=g;setTimeout(function(){"function"===typeof r&&r(p)},50)}};return{init:function(){},create:function(n,p){l();a=p;var r="undefined"!==typeof n&&!0===n.dialog?"dialog":"lo",e=4/3,b,u,d=0.9*window.innerWidth,c=0.9*window.innerHeight;
c*e>d?(b=d,u=b/e):(u=c,b=u*e);if("lo"===r)var s={},m;else var v="";n&&(n.width&&(b=n.width),n.height&&(u=n.height),"lo"===r?n.lo&&(s=n.lo,"string"===typeof s.url&&(m=s.url)):"string"==typeof n.msg&&(v=n.msg));if("lo"===r){if("string"!=typeof m||"undefined"==typeof s.scorm_type)return;var x=g,e=API_1484_11=API=g,k=SGAME.CORE.getVLEData();"object"===typeof k.user&&(e=k.user);"sco"===s.scorm_type&&("1.2"===s.scorm_version?x=API=new Local_API_SCORM_12({user:e,debug:SGAME.Debugger.isDebugging()}):"2004"===
s.scorm_version&&(x=API_1484_11=new Local_API_1484_11({user:e,debug:SGAME.Debugger.isDebugging()})))}e=document.createElement("div");e.style.width=b+"px";e.style.height=u+"px";e.style.maxWidth=d+"px";e.style.maxHeight=c+"px";e.style.overflow="lo"===r?"hidden":"auto";e.style.background="white";e.style.position="absolute";e.style.top=0;e.style.zIndex=9999;e.style.borderRadius="1em";e.style.border="2px solid black";e.setAttribute("id","sgame_fancybox");e.style.marginLeft=(window.innerWidth-b)/2+"px";
e.style.marginTop=(window.innerHeight-u)/2+"px";c=document.createElement("img");c.src="/assets/sgame/close.png";d=Math.max(25,Math.floor(0.05*u));c.style.width=d+"px";c.style.height=d+"px";c.style.padding="5px";c.style.cursor="pointer";c.style.position="absolute";c.style.right=0;c.onclick=function(){t()};e.appendChild(c);if("lo"===r){var h=document.createElement("img");h.id="trafficLight";h.src="/assets/sgame/trafficLight/trafficLight_red.png";v=Math.max(40,Math.floor(0.085*u));c=Math.max(30,Math.floor(0.75*
v));h.style.height=v+"px";h.style.width=c+"px";h.style.padding="4px";h.style.position="absolute";h.style.left="0px";h.style.top="0px";h.style.background="#fff";h.style.borderRadius="0px 0px 20px 0px";h.style.borderRight="2px solid black";h.style.borderBottom="2px solid black";e.appendChild(h);h=document.createElement("iframe");h.src=m;m=Math.ceil(Math.max(d,v))+4;v=Math.floor(0.02*u);d=Math.floor(0.02*b);h.style.marginLeft=d+"px";h.style.marginTop=m+"px";h.style.width=Math.max(0,b-d-d)+"px";h.style.height=
Math.max(0,u-m-v)+"px";h.style.overflow="auto";h.scrolling="yes";h.style.frameBorder="0";h.style.borderStyle="none";h.setAttribute("allowfullscreen","false");e.appendChild(h)}else b=document.createElement("p"),b.id="dialog",b.innerHTML=v,b.style.padding="15px",b.style.marginTop="30px",b.style.marginBottom="20px",b.style.marginRight="20px",b.style.marginLeft="20px",b.style.textAlign="center",b.style.fontSize="24px",b.style.position="relative",b.style.cursor="default",b.style.color="#000",b.style.fontFamily=
"initial",e.appendChild(b);f=e;q=r;document.body.appendChild(e);"lo"===r&&SGAME.Observer.start(h,s,x)},closeCurrentFancybox:t}}();SGAME.Observer=function(g){var f=!0,q=g,a=g,l=g,t,n,p,r,e,b,u=function(){l=a=q=g;t=Date.now();n=!1;b=e=r=p=g},d=function(){!1===a.acts_as_asset&&"undefined"!==typeof l&&(l.addListener("cmi.success_status",function(a){p=a;"passed"===p&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),l.addListener("cmi.score.scaled",function(a){r=a;0.8<=r&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
l.addListener("cmi.completion_status",function(a){e=a}),l.addListener("cmi.progress_measure",function(a){b=a}))};return{start:function(b,e,g){if(!1===f||"undefined"!=typeof q)return null;f=!1;u();q=b;a=e;l=g;d();SGAME.TrafficLight.changeColor("red");if(!0===a.acts_as_asset){b:{b=a.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration)))break b;b=null}b=!b||0>=b?15:Math.min(0.5*
b,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===f||"undefined"==typeof q)return null;f=!0;SGAME.TrafficLight.stop();var c=Math.round((Date.now()-t)/1E3);n="green"===SGAME.TrafficLight.getCurrentColor();c={lo_metadata:a,time:c,success:n};"undefined"!=typeof p&&(c.scorm_success_status=p);"undefined"!=typeof r&&(c.scorm_scaled_score=r);"undefined"!=typeof e&&(c.scorm_completion_status=e);"undefined"!=typeof b&&(c.scorm_progress_measure=
b);u();return c},isStopped:function(){return f}}}();SGAME.TrafficLight=function(g){var f,q,a,l,t,n=function(a){var b=document.getElementById("trafficLight");b&&(f=a,b.src=p(a))},p=function(a){switch(a){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},r=function(a,b){var f=document.getElementById("trafficLight");if(f){var d=!1;l=
setInterval(function(){f&&(d?(f.src=p(null),d=!1):(f.src=p(a),d=!0))},500);t=setTimeout(function(){clearTimeout(l)},1E3*b)}};return{getCurrentColor:function(){return f},changeColor:function(a,b){b?q=setTimeout(function(){n(a)},1E3*b):n(a)},setUpBlink:function(e,b,f){f?a=setTimeout(function(){r(e,b)},1E3*f):r(e,b)},stop:function(){q&&clearTimeout(q);a&&clearTimeout(a);l&&clearTimeout(l);t&&clearTimeout(t)}}}();SGAME.Utils=function(){var g=void 0;return{init:function(f){},getRandomElement:function(f){if("number"==typeof f)return f;var g;g=f.length-1;if("number"!=typeof g)throw{name:"Invalid number format exception"};g=Math.round(0+Math.random()*(g-0));return f[g]},loadScript:function(f,g){if("string"===typeof f&&"function"===typeof g){var a=document.getElementsByTagName("head")[0];if(a){var l=document.createElement("script");l.setAttribute("src",f);l.setAttribute("type","text/javascript");l.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||g()};l.onload=g;a.appendChild(l)}}},getProtocol:function(){if("undefined"!==typeof g)return g;var f;try{f=document.location.protocol}catch(q){}"string"===typeof f&&(f=f.match(/[\w]+/),f=f instanceof Array&&"string"===typeof f[0]?f[0]:void 0);return g="string"===typeof f?f:"unknown"},checkUrlProtocol:function(f){if("string"===typeof f){var g=f.match(/^https?:\/\//);if(g instanceof Array&&1===g.length){var g=g[0].replace("://",""),a=
SGAME.Utils.getProtocol();if(g!==a)switch(a){case "https":f="https"+f.replace(g,"")}}}return f}}}();
