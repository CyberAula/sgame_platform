iso8601Parser=function(h){return{getDuration:function(g){var a=[31104E3,2592E3,604800,86400,3600,60,1];try{var h;var m=g;g=[2,3,4,5,7,8,9];var u=[0,0,0,0,0,0,0],p;if(m=m.toUpperCase()){if("string"!==typeof m)throw Error("Invalid iso8601 period string '"+m+"'");if(p=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(m))for(m=0;m<g.length;m++){var n=g[m];u[m]=p[n]?+p[n].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+m+"' is not a valid ISO8601 period.");}h=u}catch(r){return null}for(n=
p=0;n<h.length;n++)p+=h[n]*a[n];return p}}}();function Local_API_1484_11(h){function g(b,a){f.diganostic="The "+b+" of "+a+" must be a proper vocabulary element.";f.errorCode=406;return"false"}function a(b){f.errorCode=402;f.diagnostic="The value for key "+b+" has not been created yet.";return"false"}function s(b,a){f.errorCode=201;f.diagnostic="The value for key "+b+" is not valid.";return"false"}function m(b,a,e){b=b.split(/\./);2>b.length?e[b[0]]=a:(e[b[0]]||(e[b[0]]={}),e=e[b.shift()],m(b.join("."),a,e))}function u(b,d){var e=b.split(/\./),
c;if(2>e.length)try{return d[e[0]]}catch(l){return a(b),"false"}else{c=e.shift();if(d[c])return String(u(e.join("."),d[c]));a(b);return"false"}}function p(b){var a,e=0;for(a in b)b.hasOwnProperty(a)&&(e+=1);return e}function n(b,a){if(f.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(b);break;case 2:console.warn(b);break;case 4:console.info(b);
break;case 3:console.log(b);break;default:return console.log(b),!1}return!0}3>a&&f.throw_alerts&&alert(b);return!1}function r(b,a){if("function"==typeof f.listeners[b]&&"undefined"!=typeof a)f.listeners[b](a)}function q(b,a){for(var e in a)a.hasOwnProperty(e)&&("object"==typeof b[e]?"object"==typeof a[e]&&(b[e]=q(b[e],a[e])):b[e]=a[e]);return b}function c(b,a){(function(){function b(a,l){l=l||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");e.initCustomEvent(a,l.bubbles,
l.cancelable,l.detail);return e}if("function"===typeof window.CustomEvent)return!1;b.prototype=window.Event.prototype;window.CustomEvent=b})();document.dispatchEvent(new CustomEvent(b,{detail:a}))}function t(b){return"object"!==type(b)||b.nodeType||isWindow(b)?!1:!(b.constructor&&!hasOwn.call(b.constructor.prototype,"isPrototypeOf"))}var f=q({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},h),d={},k={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},w=this;this.isRunning=function(){return 1===f.initialized&&0===f.terminated};this.Initialize=function(){n(f.prefix+":  Initializing...",3);f.cmi?(d=f.cmi,"suspend"===d.exit&&(d.entry="resume")):d=f.CMI;f.initialized=1;f.terminated=0;return"true"};this.GetValue=
function(b){f.errorCode=0;var a="false";b=b.toString();var e=[];if(this.isRunning()){e=b.split(".");if(0<="|exit|session_time|".indexOf("|"+e[e.length-1]+"|"))return n(f.prefix+": This "+b+" is write only",4),f.errorCode=405,"false";e=b.toLowerCase().split(".");switch(e[0]){case "cmi":switch(a="false",b){case "cmi.exit":case "cmi.session_time":f.errorCode=405;f.diagnostic="Sorry, this has been specified as a read-only value for "+b;break;case "cmi.learner_name":a=f.CMI.learner_name;break;default:a=
u(b.substr(4,b.length),d),"undefined"===a&&(f.errorCode=401,f.diagnostic="Sorry, there was a undefined response from "+b,a="false"),n(f.prefix+": GetValue "+b+" = "+a,4)}}return a}f.errorCode=123;return a};this.SetValue=function(b,a){n(f.prefix+": SetValue: "+b+" = "+a,4);f.errorCode=0;var e=[],c=b.toString(),l=a.toString(),k=0,v=0,k=[];if(this.isRunning()){k=c.split(".");if("adl"===k[0]&&"id"===k[4]||"comments_from_lms"===k[1]||("comments_from_learner"===k[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
k[k.length-1]+"|")))return n(f.prefix+": This "+c+" is read only",4),f.errorCode=404,"false";e=c.split(".");switch(e[0]){case "cmi":switch(b){case "cmi.location":1E3<l.length&&n(f.prefix+": Some LMS's might truncate your bookmark as you've passed "+l.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":k=parseFloat(l);if("number"!=typeof k||isNaN(k))return s(b,l);k=Math.max(0,Math.min(1,k));r(b,k);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+
l+"|"))return g(b,l);r(b,l);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+l+"|"))return g(b,l);break;case "cmi.score.scaled":k=parseFloat(l);if("number"!=typeof k||isNaN(k))return s(b,l);k=Math.max(0,Math.min(1,k));r(b,k);break;case "cmi.score.min":k=parseFloat(l);if("number"!=typeof k||isNaN(k))return s(b,l);f.CMI.score.min=k;break;case "cmi.score.max":k=parseFloat(l);if("number"!=typeof k||isNaN(k))return s(b,l);f.CMI.score.max=k;break;case "cmi.score.raw":k=parseFloat(l);
if("number"!=typeof k||isNaN(k))return s(b,l);v=parseFloat(f.CMI.score.max);v="number"!=typeof v||isNaN(v)?100:v;e=parseFloat(f.CMI.score.min);e="number"!=typeof e||isNaN(e)?0:e;v-=e;0>=v&&(v=100);k=Math.max(0,Math.min(1,(k-e)/v));r("cmi.score.scaled",k);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+l+"|"))return g(b,l);r(b,l);break;default:switch(e[1]){case "comments_from_lms":return f.errorCode="404",f.diagnostic="The cmi.comments_from_lms element is entirely read only.",
"false";case "comments_from_learner":if(-1===d.comments_from_learner._children.indexOf(e[3]))return g(b,l);m(c.substr(4,c.length),l,d);d.comments_from_learner._count=(p(d.comments_from_learner)-2).toString();return"true";case "interactions":if(-1===d.interactions._children.indexOf(e[3]))return g(b,l);d.interactions._count=(p(d.interactions)-2).toString();if(isNaN(parseInt(e[2],10)))return"false";if(!t(d.interactions[e[2]])){if("id"===e[3])return d.interactions[e[2]]={},m(c.substr(4,c.length),l,d),
d.interactions._count=(p(d.interactions)-2).toString(),t(d.interactions[e[2]].objectives)||(n(f.prefix+": Constructing objectives object for new interaction",4),d.interactions[e[2]].objectives={},d.interactions[e[2]].objectives._count="-1"),t(d.interactions[e[2]].correct_responses)||(n(f.prefix+": Constructing correct responses object for new interaction",4),d.interactions[e[2]].correct_responses={},d.interactions[e[2]].correct_responses._count="-1"),"true";n("Can't add interaction without ID first!",
3);return"false"}if("objectives"===e[3]){if("id"===e[5])for(v=parseInt(d.interactions[e[2]].objectives._count,10),k=0;k<v;k+=1){if(d.interactions[e[2]].objectives[k].id===l)return c=b,f.errorCode="351",f.diagnostic="The "+c+" element must be unique.  The value '"+l+"' has already been set in #"+k,"false"}else return g(b,l);m(c.substr(4,c.length),l,d);d.interactions[e[2]].objectives._count=(p(d.interactions[e[2]].objectives)-1).toString();return"true"}"correct_responses"===e[3]&&(m(c.substr(4,c.length),
l,d),d.interactions[e[2]].correct_responses._count=(p(d.interactions[e[2]].correct_responses)-1).toString());m(c.substr(4,c.length),l,d);d.interactions._count=(p(d.interactions)-2).toString();return"true";case "objectives":if("id"===e[3])for(v=parseInt(d.objectives._count,10),k=0;k<v;k+=1)if(d.objectives[k].id===l)return f.errorCode="351",f.diagnostic="The objectives.id element must be unique.  The value '"+l+"' has already been set in objective #"+k,"false";if("id"!==e[3]&&(k=parseInt(e[2],10),void 0===
d.objectives[k]))return f.errorCode="408",f.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(e[2],10)))return"false";m(c.substr(4,c.length),l,d);d.objectives._count=(p(d.objectives)-2).toString();return"true"}}m(c.substr(4,c.length),l,d)}return"true"}f.errorCode=f.terminated?133:132;return"false"};this.Commit=function(){n(f.prefix+": Commit CMI Object:",4);n(d);n(f.prefix+": Suspend Data Usage "+(Math.round(100*(d.suspend_data.length/64E3)*
Math.pow(10,2))/Math.pow(10,2)+"%"));c("StoreData",{runtimedata:d});return"true"};this.Terminate=function(){w.Commit();f.terminated=1;f.initialized=0;return"true"};this.GetErrorString=function(b){return""!==b&&(b=parseInt(b,10),void 0!==k[b])?k[b]:""};this.GetLastError=function(){return f.errorCode};this.GetDiagnostic=function(){return f.diagnostic};this.setCMILMSValue=function(b,a){"string"==typeof b&&(f.CMI[b]=a)};this.addListener=function(b,a){"string"==typeof b&&"function"==typeof a&&(f.listeners[b]=
a)}};function Local_API_SCORM_12(h){function g(a,d){c.diganostic="The "+a+" of "+d+" must be a proper vocabulary element.";c.errorCode=406;return"false"}function a(a){c.errorCode=402;c.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function s(a,d){c.errorCode=201;c.diagnostic="The value for key "+a+" is not valid.";return"false"}function m(a,c,b){a=a.split(/\./);2>a.length?b[a[0]]=c:(b[a[0]]||(b[a[0]]={}),b=b[a.shift()],m(a.join("."),c,b))}function u(k,c){var b=k.split(/\./),
d;if(2>b.length)try{return c[b[0]]}catch(e){return a(k),"false"}else{d=b.shift();if(c[d])return String(u(b.join("."),c[d]));a(k);return"false"}}function p(a,d){if(c.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(d){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>d&&c.throw_alerts&&alert(a);return!1}function n(a,d){if("function"==typeof c.listeners[a]&&"undefined"!=typeof d)c.listeners[a](d)}function r(a,c){for(var b in c)c.hasOwnProperty(b)&&("object"==typeof a[b]?"object"==typeof c[b]&&(a[b]=r(a[b],c[b])):a[b]=c[b]);return a}function q(a,c){(function(){function a(b,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=document.createEvent("CustomEvent");d.initCustomEvent(b,c.bubbles,c.cancelable,c.detail);return d}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:c}))}var c=r({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},h),t={},f={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},d=this;this.isRunning=function(){return 1===c.initialized&&0===c.terminated};this.LMSInitialize=function(){p(c.prefix+":  Initializing...",3);t=c.CMI;c.initialized=1;c.terminated=0;return"true"};this.LMSGetValue=function(a){c.errorCode=0;var d="false";a=a.toString();var b=[];if(this.isRunning()){b=a.split(".");if(0<="|exit|session_time|".indexOf("|"+
b[b.length-1]+"|"))return c.errorCode=405,"false";b=a.toLowerCase().split(".");switch(b[0]){case "cmi":d=a;a="false";switch(d){case "cmi.core.exit":case "cmi.core.session_time":c.errorCode=405;c.diagnostic="Sorry, this has been specified as a read-only value for "+d;break;default:d=d.replace("cmi.",""),a=u(d,t),"undefined"===a&&(c.errorCode=401,c.diagnostic="Sorry, there was a undefined response from "+d,a="false")}d=a}return d}c.errorCode=123;return d};this.LMSSetValue=function(a,d){p(c.prefix+": SetValue: "+
a+" = "+d,4);c.errorCode=0;var b=[],f=a.toString(),e=d.toString();if(this.isRunning()){var b=f.split("."),h=b[b.length-1],b="adl"===b[0]&&"id"===b[4]?!0:"comments_from_lms"===b[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+h+"|");if(b)return c.errorCode=404,"false";b=f.split(".");switch(b[0]){case "cmi":switch(a){case "cmi.core.lesson_location":1E3<
e.length&&p(c.prefix+": Some LMS's might truncate your bookmark as you've passed "+e.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+e+"|"))return g(a,e);n(a,e);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return g(a,e);break;case "cmi.core.score.min":b=parseFloat(e);if("number"!=typeof b||isNaN(b))return s(a,e);c.CMI.core.score.min=
b;break;case "cmi.core.score.max":b=parseFloat(e);if("number"!=typeof b||isNaN(b))return s(a,e);c.CMI.core.score.max=b;break;case "cmi.core.score.raw":b=parseFloat(e);if("number"!=typeof b||isNaN(b))return s(a,e);var l=parseFloat(c.CMI.core.score.max),l="number"!=typeof l||isNaN(l)?100:l,h=parseFloat(c.CMI.core.score.min),h="number"!=typeof h||isNaN(h)?0:h,l=l-h;0>=l&&(l=100);b=Math.max(0,Math.min(1,(b-h)/l));n("cmi.score.scaled",b)}f=f.replace("cmi.","");m(f,e,t)}return"true"}c.errorCode=c.terminated?
133:132;return"false"};this.LMSCommit=function(){q("StoreData",{runtimedata:t});return"true"};this.LMSTerminate=function(){d.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSFinish=function(){d.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==f[a])?f[a]:""};this.LMSGetLastError=function(){return c.errorCode};this.LMSGetDiagnostic=function(){return c.diagnostic};this.setCMILMSValue=function(a,d){"string"==
typeof a&&(c.CMI[a]=d)};this.addListener=function(a,d){"string"==typeof a&&"function"==typeof d&&(c.listeners[a]=d)}};SGAME=function(){return{init:function(h){return SGAME.CORE.init(h)},loadSettings:function(h){return SGAME.CORE.loadSettings(h)},triggerLO:function(h,g){return SGAME.CORE.triggerLO(h,g)},showLO:function(h,g){return SGAME.CORE.showLO(h,g)},showRandomLO:function(h){return SGAME.CORE.showRandomLO(h)},closeLO:function(){return SGAME.CORE.closeLO()},losCanBeShown:function(){return SGAME.CORE.losCanBeShown()}}}();SGAME.VERSION="0.5";SGAME.AUTHORS="Aldo Gordillo, Enrique Barra";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var h=!1;return{init:function(g){!0===g&&(h=g)},isDebugging:function(){return h},log:function(g){h&&window.console&&console.log(g)}}}();SGAME.API=function(){var h=function(g,a){var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==h.readyState&&200==h.status){var g=JSON.parse(h.responseText);a(g)}};h.open("GET",g,!0);h.send("")};return{init:function(){},requestLOMetadata:function(g,a,s){try{h("undefined"==typeof g?"/lo/random/metadata.json":"/lo/"+g+"/metadata.json",function(g){a(g)})}catch(m){s(m)}}}}();SGAME.CORE=function(){var h={},g=void 0,a={},s=!1,m=["repeat","repeat_unless_successfully_consumed","no_repeat"],u=["no_more_los","all_los_consumed","all_los_succesfully_consumed","never"],p=["success","failure","success_unless_damage","failure_unless_blocking"],n=!1,r=!1,q="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",c=function(b){a=b;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&
(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===m.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===u.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===p.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los=
"success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&(q=a.game_settings.completion_notification_text);if("object"===typeof a.los){b=Object.keys(a.los);for(var d=b.length,c=0;c<d;c++)"undefined"!==typeof a.los[b[c]].url&&(a.los[b[c]].url=SGAME.Utils.checkUrlProtocol(a.los[b[c]].url)),a.los[b[c]].can_be_shown=!0,a.los[b[c]].shown=!1,a.los[b[c]].nshown=0,a.los[b[c]].succesfully_consumed=!1,a.los[b[c]].acts_as_asset="asset"===a.los[b[c]].scorm_type||"sco"===a.los[b[c]].scorm_type&&
!1===a.los[b[c]].report_data,n=!0}},t=function(b,c){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof c&&c(null,null):(f(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(e){a.los[b.id].succesfully_consumed=e.success;switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].succesfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}d();e.more_los=n;k(function(){"function"===typeof c&&
c(e.success,e);f()})}))},f=function(){"function"===typeof g&&g()},d=function(){for(var b=Object.keys(a.los),c=b.length,d=0;d<c;d++)if(!0===a.los[b[d]].can_be_shown){n=!0;return}n=!1},k=function(a){!0!==w()?"function"===typeof a&&a(!1):b(a)},w=function(){if(!0===r)return!1;switch(a.game_settings.completion_notification){case "no_more_los":return!1===n;case "all_los_consumed":for(var b=Object.keys(a.los),c=b.length,d=0;d<c;d++)if(!1===a.los[b[d]].shown)return!1;return!0;case "all_los_succesfully_consumed":b=
Object.keys(a.los);c=b.length;for(d=0;d<c;d++)if(!1===a.los[b[d]].succesfully_consumed)return!1;return!0;case "never":return!1;default:return!1}},b=function(a){r=!0;SGAME.Fancybox.create({dialog:!0,msg:q},function(){"function"===typeof a&&a(!0)})},x=function(b){var c;s&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof h.behaviour_when_no_more_los?c=h.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&
(c=a.game_settings.behaviour_when_no_more_los);return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:e(c,b),more_los:n}},e=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=y(b);return"undefined"!==typeof c&&"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=y(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},
y=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof h.events&&"undefined"!==typeof h.events[b]?h.events[b]:{}};SGAME.Debugger.init(!0);!1===s&&c({});return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(h=a)&&"function"===typeof a.togglePause&&(g=a.togglePause)},loadSettings:function(a){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(a);s=!0;c(a)},triggerLO:function(b,c){var d=[],e=[],f=a.event_mapping[b];if("undefined"!==
typeof f){var g=f.length;if("number"===typeof g)for(var k=0;k<g;k++){if("*"===f[k]){d=[];f=Object.keys(a.los);for(g=0;g<f.length;g++)"undefined"!==typeof a.los[f[g]]&&d.push(a.los[f[g]]);break}"undefined"!==typeof a.los[f[k]]&&d.push(a.los[f[k]])}}f=d.length;if(1>f.length)"function"===typeof c&&(e=x(b),c(e.success,e));else{for(g=0;g<f;g++)!0===d[g].can_be_shown&&e.push(d[g]);if(e&&e instanceof Array&&0<e.length){for(var d=[],h,f=0;f<e.length;f++)"undefined"===typeof h&&(h=e[f].nshown),e[f].nshown<
h&&(h=e[f].nshown,d=[]),h===e[f].nshown&&d.push(e[f]);selectedLO=SGAME.Utils.getRandomElement(d);t(selectedLO,c)}else"function"===typeof c&&(e=x(b),c(e.success,e))}},showLO:t,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){t(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},losCanBeShown:function(){return n}}}();var API,API_1484_11;
SGAME.Fancybox=function(h){var g=h,a=h,s=h,m=function(){"undefined"!=typeof g&&(g.style.display="none",g.parentNode.removeChild(g),"lo"===a&&(API_1484_11=API=h),a=g=h)},u=function(){if("undefined"!=typeof g){var p=a;m();var n;n="lo"===p?SGAME.Observer.stop():!0;var r=s;s=h;setTimeout(function(){"function"===typeof r&&r(n)},50)}};return{init:function(){},create:function(p,n){m();s=n;var r="undefined"!==typeof p&&!0===p.dialog?"dialog":"lo",q=4/3,c,t,f=0.9*window.innerWidth,d=0.9*window.innerHeight;
d*q>f?(c=f,t=c/q):(t=d,c=t*q);if("lo"===r)var k={},w;else var b="";p&&(p.width&&(c=p.width),p.height&&(t=p.height),"lo"===r?p.lo&&(k=p.lo,"string"===typeof k.url&&(w=k.url)):"string"==typeof p.msg&&(b=p.msg));if("lo"===r){if("string"!=typeof w||"undefined"==typeof k.scorm_type)return;var x=h;API_1484_11=API=h;"sco"===k.scorm_type&&("1.2"===k.scorm_version?x=API=new Local_API_SCORM_12({debug:SGAME.Debugger.isDebugging()}):"2004"===k.scorm_version&&(x=API_1484_11=new Local_API_1484_11({debug:SGAME.Debugger.isDebugging()})))}q=
document.createElement("div");q.style.width=c+"px";q.style.height=t+"px";q.style.maxWidth=f+"px";q.style.maxHeight=d+"px";q.style.overflow="lo"===r?"hidden":"auto";q.style.background="white";q.style.position="absolute";q.style.top=0;q.style.zIndex=9999;q.style.borderRadius="1em";q.style.border="2px solid black";q.setAttribute("id","sgame_fancybox");q.style.marginLeft=(window.innerWidth-c)/2+"px";q.style.marginTop=(window.innerHeight-t)/2+"px";d=document.createElement("img");d.src="/assets/sgame/close.png";
f=Math.max(25,Math.floor(0.05*t));d.style.width=f+"px";d.style.height=f+"px";d.style.padding="5px";d.style.cursor="pointer";d.style.position="absolute";d.style.right=0;d.onclick=function(){u()};q.appendChild(d);if("lo"===r){var e=document.createElement("img");e.id="trafficLight";e.src="/assets/sgame/trafficLight/trafficLight_red.png";b=Math.max(40,Math.floor(0.085*t));d=Math.max(30,Math.floor(0.75*b));e.style.height=b+"px";e.style.width=d+"px";e.style.padding="4px";e.style.position="absolute";e.style.left=
"0px";e.style.top="0px";e.style.background="#fff";e.style.borderRadius="0px 0px 20px 0px";e.style.borderRight="2px solid black";e.style.borderBottom="2px solid black";q.appendChild(e);e=document.createElement("iframe");e.src=w;w=Math.ceil(Math.max(f,b))+4;b=Math.floor(0.02*t);f=Math.floor(0.02*c);e.style.marginLeft=f+"px";e.style.marginTop=w+"px";e.style.width=Math.max(0,c-f-f)+"px";e.style.height=Math.max(0,t-w-b)+"px";e.style.overflow="auto";e.scrolling="yes";e.style.frameBorder="0";e.style.borderStyle=
"none";e.setAttribute("allowfullscreen","false");q.appendChild(e)}else c=document.createElement("p"),c.id="dialog",c.innerHTML=b,c.style.padding="15px",c.style.marginTop="30px",c.style.marginBottom="20px",c.style.marginRight="20px",c.style.marginLeft="20px",c.style.textAlign="center",c.style.fontSize="24px",c.style.position="relative",c.style.cursor="default",c.style.color="#000",c.style.fontFamily="initial",q.appendChild(c);g=q;a=r;document.body.appendChild(q);"lo"===r&&SGAME.Observer.start(e,k,
x)},closeCurrentFancybox:u}}();SGAME.Observer=function(h){var g=!0,a=h,s=h,m=h,u,p,n,r,q,c,t=function(){m=s=a=h;u=Date.now();p=!1;c=q=r=n=h},f=function(){!1===s.acts_as_asset&&"undefined"!==typeof m&&(m.addListener("cmi.success_status",function(a){n=a;"passed"===n&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),m.addListener("cmi.score.scaled",function(a){r=a;0.8<=r&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
m.addListener("cmi.completion_status",function(a){q=a}),m.addListener("cmi.progress_measure",function(a){c=a}))};return{start:function(c,k,h){if(!1===g||"undefined"!=typeof a)return null;g=!1;t();a=c;s=k;m=h;f();SGAME.TrafficLight.changeColor("red");if(!0===s.acts_as_asset){b:{c=s.lom_metadata;if(c.educational&&c.educational.typicalLearningTime&&c.educational.typicalLearningTime.duration&&(c=iso8601Parser.getDuration(c.educational.typicalLearningTime.duration)))break b;c=null}c=!c||0>=c?15:Math.min(0.5*
c,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*c-0.5,0.5*c);SGAME.TrafficLight.changeColor("green",c)}},stop:function(){if(!0===g||"undefined"==typeof a)return null;g=!0;SGAME.TrafficLight.stop();var d=Math.round((Date.now()-u)/1E3);p="green"===SGAME.TrafficLight.getCurrentColor();d={lo_metadata:s,time:d,success:p};"undefined"!=typeof n&&(d.scorm_success_status=n);"undefined"!=typeof r&&(d.scorm_scaled_score=r);"undefined"!=typeof q&&(d.scorm_completion_status=q);"undefined"!=typeof c&&(d.scorm_progress_measure=
c);t();return d},isStopped:function(){return g}}}();SGAME.TrafficLight=function(h){var g,a,s,m,u,p=function(a){var c=document.getElementById("trafficLight");c&&(g=a,c.src=n(a))},n=function(a){switch(a){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},r=function(a,c){var g=document.getElementById("trafficLight");if(g){var f=!1;m=
setInterval(function(){g&&(f?(g.src=n(null),f=!1):(g.src=n(a),f=!0))},500);u=setTimeout(function(){clearTimeout(m)},1E3*c)}};return{getCurrentColor:function(){return g},changeColor:function(g,c){c?a=setTimeout(function(){p(g)},1E3*c):p(g)},setUpBlink:function(a,c,g){g?s=setTimeout(function(){r(a,c)},1E3*g):r(a,c)},stop:function(){a&&clearTimeout(a);s&&clearTimeout(s);m&&clearTimeout(m);u&&clearTimeout(u)}}}();SGAME.Utils=function(){var h=void 0;return{init:function(g){},getRandomElement:function(g){if("number"==typeof g)return g;var a;a=g.length-1;if("number"!=typeof a)throw{name:"Invalid number format exception"};a=Math.round(0+Math.random()*(a-0));return g[a]},loadScript:function(g,a){if("string"===typeof g&&"function"===typeof a){var h=document.getElementsByTagName("head")[0];if(h){var m=document.createElement("script");m.setAttribute("src",g);m.setAttribute("type","text/javascript");m.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||a()};m.onload=a;h.appendChild(m)}}},getProtocol:function(){if("undefined"!==typeof h)return h;var g;try{g=document.location.protocol}catch(a){}"string"===typeof g&&(g=g.match(/[\w]+/),g=g instanceof Array&&"string"===typeof g[0]?g[0]:void 0);return h="string"===typeof g?g:"unknown"},checkUrlProtocol:function(g){if("string"===typeof g){var a=g.match(/^https?:\/\//);if(a instanceof Array&&1===a.length){var a=a[0].replace("://",""),h=
SGAME.Utils.getProtocol();if(a!==h)switch(h){case "https":g="https"+g.replace(a,"")}}}return g}}}();
