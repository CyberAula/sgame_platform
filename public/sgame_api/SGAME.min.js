iso8601Parser=function(c){return{getDuration:function(h){var b=[31104E3,2592E3,604800,86400,3600,60,1];try{var c;var l=h;h=[2,3,4,5,7,8,9];var u=[0,0,0,0,0,0,0],q;if(l=l.toUpperCase()){if("string"!==typeof l)throw Error("Invalid iso8601 period string '"+l+"'");if(q=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(l))for(l=0;l<h.length;l++){var m=h[l];u[l]=q[m]?+q[m].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+l+"' is not a valid ISO8601 period.");}c=u}catch(r){return null}for(m=
q=0;m<c.length;m++)q+=c[m]*b[m];return q}}}();function Local_API_1484_11(c){function h(d,a){f.diganostic="The "+d+" of "+a+" must be a proper vocabulary element.";f.errorCode=406;return"false"}function b(d){f.errorCode=402;f.diagnostic="The value for key "+d+" has not been created yet.";return"false"}function p(d,a){f.errorCode=201;f.diagnostic="The value for key "+d+" is not valid.";return"false"}function l(d,a,e){d=d.split(/\./);2>d.length?e[d[0]]=a:(e[d[0]]||(e[d[0]]={}),e=e[d.shift()],l(d.join("."),a,e))}function u(d,a){var e=d.split(/\./),
g;if(2>e.length)try{return a[e[0]]}catch(n){return b(d),"false"}else{g=e.shift();if(a[g])return String(u(e.join("."),a[g]));b(d);return"false"}}function q(d){var a,e=0;for(a in d)d.hasOwnProperty(a)&&(e+=1);return e}function m(d,a){if(f.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(d);break;case 2:console.warn(d);break;case 4:console.info(d);
break;case 3:console.log(d);break;default:return console.log(d),!1}return!0}3>a&&f.throw_alerts&&alert(d);return!1}function r(d,a){if("function"==typeof f.listeners[d]&&"undefined"!=typeof a)f.listeners[d](a)}function k(d,a){for(var e in a)a.hasOwnProperty(e)&&("object"==typeof d[e]?"object"==typeof a[e]&&(d[e]=k(d[e],a[e])):d[e]=a[e]);return d}function a(d,a){(function(){function d(a,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(a,e.bubbles,
e.cancelable,e.detail);return b}if("function"===typeof window.CustomEvent)return!1;d.prototype=window.Event.prototype;window.CustomEvent=d})();document.dispatchEvent(new CustomEvent(d,{detail:a}))}function s(d){return"object"!==type(d)||d.nodeType||isWindow(d)?!1:!(d.constructor&&!hasOwn.call(d.constructor.prototype,"isPrototypeOf"))}var f=k({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},c),g={},n={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},t=this;this.isRunning=function(){return 1===f.initialized&&0===f.terminated};this.Initialize=function(){m(f.prefix+":  Initializing...",3);f.cmi?(g=f.cmi,"suspend"===g.exit&&(g.entry="resume")):g=f.CMI;f.initialized=1;f.terminated=0;return"true"};this.GetValue=
function(d){f.errorCode=0;var a="false";d=d.toString();var e=[];if(this.isRunning()){e=d.split(".");if(0<="|exit|session_time|".indexOf("|"+e[e.length-1]+"|"))return m(f.prefix+": This "+d+" is write only",4),f.errorCode=405,"false";e=d.toLowerCase().split(".");switch(e[0]){case "cmi":switch(a="false",d){case "cmi.exit":case "cmi.session_time":f.errorCode=405;f.diagnostic="Sorry, this has been specified as a read-only value for "+d;break;case "cmi.learner_name":a=f.CMI.learner_name;break;default:a=
u(d.substr(4,d.length),g),"undefined"===a&&(f.errorCode=401,f.diagnostic="Sorry, there was a undefined response from "+d,a="false"),m(f.prefix+": GetValue "+d+" = "+a,4)}}return a}f.errorCode=123;return a};this.SetValue=function(d,a){m(f.prefix+": SetValue: "+d+" = "+a,4);f.errorCode=0;var e=[],b=d.toString(),n=a.toString(),c=0,t=0,c=[];if(this.isRunning()){c=b.split(".");if("adl"===c[0]&&"id"===c[4]||"comments_from_lms"===c[1]||("comments_from_learner"===c[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
c[c.length-1]+"|")))return m(f.prefix+": This "+b+" is read only",4),f.errorCode=404,"false";e=b.split(".");switch(e[0]){case "cmi":switch(d){case "cmi.location":1E3<n.length&&m(f.prefix+": Some LMS's might truncate your bookmark as you've passed "+n.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":c=parseFloat(n);if("number"!=typeof c||isNaN(c))return p(d,n);c=Math.max(0,Math.min(1,c));r(d,c);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+
n+"|"))return h(d,n);r(d,n);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+n+"|"))return h(d,n);break;case "cmi.score.scaled":c=parseFloat(n);if("number"!=typeof c||isNaN(c))return p(d,n);c=Math.max(0,Math.min(1,c));r(d,c);break;case "cmi.score.min":c=parseFloat(n);if("number"!=typeof c||isNaN(c))return p(d,n);f.CMI.score.min=c;break;case "cmi.score.max":c=parseFloat(n);if("number"!=typeof c||isNaN(c))return p(d,n);f.CMI.score.max=c;break;case "cmi.score.raw":c=parseFloat(n);
if("number"!=typeof c||isNaN(c))return p(d,n);t=parseFloat(f.CMI.score.max);t="number"!=typeof t||isNaN(t)?100:t;e=parseFloat(f.CMI.score.min);e="number"!=typeof e||isNaN(e)?0:e;t-=e;0>=t&&(t=100);c=Math.max(0,Math.min(1,(c-e)/t));r("cmi.score.scaled",c);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+n+"|"))return h(d,n);r(d,n);break;default:switch(e[1]){case "comments_from_lms":return f.errorCode="404",f.diagnostic="The cmi.comments_from_lms element is entirely read only.",
"false";case "comments_from_learner":if(-1===g.comments_from_learner._children.indexOf(e[3]))return h(d,n);l(b.substr(4,b.length),n,g);g.comments_from_learner._count=(q(g.comments_from_learner)-2).toString();return"true";case "interactions":if(-1===g.interactions._children.indexOf(e[3]))return h(d,n);g.interactions._count=(q(g.interactions)-2).toString();if(isNaN(parseInt(e[2],10)))return"false";if(!s(g.interactions[e[2]])){if("id"===e[3])return g.interactions[e[2]]={},l(b.substr(4,b.length),n,g),
g.interactions._count=(q(g.interactions)-2).toString(),s(g.interactions[e[2]].objectives)||(m(f.prefix+": Constructing objectives object for new interaction",4),g.interactions[e[2]].objectives={},g.interactions[e[2]].objectives._count="-1"),s(g.interactions[e[2]].correct_responses)||(m(f.prefix+": Constructing correct responses object for new interaction",4),g.interactions[e[2]].correct_responses={},g.interactions[e[2]].correct_responses._count="-1"),"true";m("Can't add interaction without ID first!",
3);return"false"}if("objectives"===e[3]){if("id"===e[5])for(t=parseInt(g.interactions[e[2]].objectives._count,10),c=0;c<t;c+=1){if(g.interactions[e[2]].objectives[c].id===n)return b=d,f.errorCode="351",f.diagnostic="The "+b+" element must be unique.  The value '"+n+"' has already been set in #"+c,"false"}else return h(d,n);l(b.substr(4,b.length),n,g);g.interactions[e[2]].objectives._count=(q(g.interactions[e[2]].objectives)-1).toString();return"true"}"correct_responses"===e[3]&&(l(b.substr(4,b.length),
n,g),g.interactions[e[2]].correct_responses._count=(q(g.interactions[e[2]].correct_responses)-1).toString());l(b.substr(4,b.length),n,g);g.interactions._count=(q(g.interactions)-2).toString();return"true";case "objectives":if("id"===e[3])for(t=parseInt(g.objectives._count,10),c=0;c<t;c+=1)if(g.objectives[c].id===n)return f.errorCode="351",f.diagnostic="The objectives.id element must be unique.  The value '"+n+"' has already been set in objective #"+c,"false";if("id"!==e[3]&&(c=parseInt(e[2],10),void 0===
g.objectives[c]))return f.errorCode="408",f.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(e[2],10)))return"false";l(b.substr(4,b.length),n,g);g.objectives._count=(q(g.objectives)-2).toString();return"true"}}l(b.substr(4,b.length),n,g)}return"true"}f.errorCode=f.terminated?133:132;return"false"};this.Commit=function(){m(f.prefix+": Commit CMI Object:",4);m(g);m(f.prefix+": Suspend Data Usage "+(Math.round(100*(g.suspend_data.length/64E3)*
Math.pow(10,2))/Math.pow(10,2)+"%"));a("StoreData",{runtimedata:g});return"true"};this.Terminate=function(){t.Commit();f.terminated=1;f.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==n[a])?n[a]:""};this.GetLastError=function(){return f.errorCode};this.GetDiagnostic=function(){return f.diagnostic};this.setCMILMSValue=function(a,b){"string"==typeof a&&(f.CMI[a]=b)};this.addListener=function(a,b){"string"==typeof a&&"function"==typeof b&&(f.listeners[a]=
b)}};function Local_API_SCORM_12(c){function h(b,c){a.diganostic="The "+b+" of "+c+" must be a proper vocabulary element.";a.errorCode=406;return"false"}function b(b){a.errorCode=402;a.diagnostic="The value for key "+b+" has not been created yet.";return"false"}function p(b,c){a.errorCode=201;a.diagnostic="The value for key "+b+" is not valid.";return"false"}function l(a,b,d){a=a.split(/\./);2>a.length?d[a[0]]=b:(d[a[0]]||(d[a[0]]={}),d=d[a.shift()],l(a.join("."),b,d))}function u(a,c){var d=a.split(/\./),
g;if(2>d.length)try{return c[d[0]]}catch(e){return b(a),"false"}else{g=d.shift();if(c[g])return String(u(d.join("."),c[g]));b(a);return"false"}}function q(b,c){if(a.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(c){case 1:console.error(b);break;case 2:console.warn(b);break;case 4:console.info(b);break;case 3:console.log(b);break;default:return console.log(b),
!1}return!0}3>c&&a.throw_alerts&&alert(b);return!1}function m(b,c){if("function"==typeof a.listeners[b]&&"undefined"!=typeof c)a.listeners[b](c)}function r(a,b){for(var d in b)b.hasOwnProperty(d)&&("object"==typeof a[d]?"object"==typeof b[d]&&(a[d]=r(a[d],b[d])):a[d]=b[d]);return a}function k(a,b){(function(){function a(b,d){d=d||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(b,d.bubbles,d.cancelable,d.detail);return c}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}var a=r({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},c),s={},f={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},g=this;this.isRunning=function(){return 1===a.initialized&&0===a.terminated};this.LMSInitialize=function(){q(a.prefix+":  Initializing...",3);s=a.CMI;a.initialized=1;a.terminated=0;return"true"};this.LMSGetValue=function(b){a.errorCode=0;var c="false";b=b.toString();var d=[];if(this.isRunning()){d=b.split(".");if(0<="|exit|session_time|".indexOf("|"+
d[d.length-1]+"|"))return a.errorCode=405,"false";d=b.toLowerCase().split(".");switch(d[0]){case "cmi":c=b;b="false";switch(c){case "cmi.core.exit":case "cmi.core.session_time":a.errorCode=405;a.diagnostic="Sorry, this has been specified as a read-only value for "+c;break;default:c=c.replace("cmi.",""),b=u(c,s),"undefined"===b&&(a.errorCode=401,a.diagnostic="Sorry, there was a undefined response from "+c,b="false")}c=b}return c}a.errorCode=123;return c};this.LMSSetValue=function(b,c){q(a.prefix+": SetValue: "+
b+" = "+c,4);a.errorCode=0;var d=[],g=b.toString(),e=c.toString();if(this.isRunning()){var d=g.split("."),f=d[d.length-1],d="adl"===d[0]&&"id"===d[4]?!0:"comments_from_lms"===d[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+f+"|");if(d)return a.errorCode=404,"false";d=g.split(".");switch(d[0]){case "cmi":switch(b){case "cmi.core.lesson_location":1E3<
e.length&&q(a.prefix+": Some LMS's might truncate your bookmark as you've passed "+e.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+e+"|"))return h(b,e);m(b,e);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return h(b,e);break;case "cmi.core.score.min":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return p(b,e);a.CMI.core.score.min=
d;break;case "cmi.core.score.max":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return p(b,e);a.CMI.core.score.max=d;break;case "cmi.core.score.raw":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return p(b,e);var k=parseFloat(a.CMI.core.score.max),k="number"!=typeof k||isNaN(k)?100:k,f=parseFloat(a.CMI.core.score.min),f="number"!=typeof f||isNaN(f)?0:f,k=k-f;0>=k&&(k=100);d=Math.max(0,Math.min(1,(d-f)/k));m("cmi.score.scaled",d)}g=g.replace("cmi.","");l(g,e,s)}return"true"}a.errorCode=a.terminated?
133:132;return"false"};this.LMSCommit=function(){k("StoreData",{runtimedata:s});return"true"};this.LMSTerminate=function(){g.LMSCommit();a.terminated=1;a.initialized=0;return"true"};this.LMSFinish=function(){g.LMSCommit();a.terminated=1;a.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==f[a])?f[a]:""};this.LMSGetLastError=function(){return a.errorCode};this.LMSGetDiagnostic=function(){return a.diagnostic};this.setCMILMSValue=function(b,c){"string"==
typeof b&&(a.CMI[b]=c)};this.addListener=function(b,c){"string"==typeof b&&"function"==typeof c&&(a.listeners[b]=c)}};SGAME=function(){return{init:function(c){return SGAME.CORE.init(c)},loadSettings:function(c){return SGAME.CORE.loadSettings(c)},triggerLO:function(c,h){return SGAME.CORE.triggerLO(c,h)},showLO:function(c,h){return SGAME.CORE.showLO(c,h)},showRandomLO:function(c){return SGAME.CORE.showRandomLO(c)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(c){return SGAME.CORE.losCanBeShown(c)},successWhenNoLOs:function(c){return SGAME.CORE.successWhenNoLOs(c)}}}();
SGAME.VERSION="0.6";SGAME.AUTHORS="Aldo Gordillo, Enrique Barra";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var c=!1;return{init:function(h){!0===h&&(c=h)},isDebugging:function(){return c},log:function(h){c&&window.console&&console.log(h)}}}();SGAME.Messenger=function(){function c(a,b){this.data=a||{};-1!==["PROTOCOL","APP"].indexOf(b)?this.type=b:this.type="APP";this.origin=p;this.destination=l}var h=["PROTOCOL","APP"],b=["SGAME_GATEWAY","SGAME_API"],p="SGAME_API",l="SGAME_GATEWAY",u=!1,q=!1,m=function(a){try{window.parent.parent.postMessage(a,"*")}catch(b){}},r=function(a){var b;b="object"!==typeof a||"string"!==typeof a.data?!1:k(a.data);if(b)switch(a=JSON.parse(a.data),a.type){case "PROTOCOL":if(a.data)switch(a.data.message){case "onIframeMessengerHello":"SGAME_GATEWAY"===
a.origin&&!0!==q&&(q=!0,a.destination=a.origin,a.origin=p,m(JSON.stringify(a)))}break;case "APP":a.data&&(console.log("SGAME API: APP Message received with data:"),console.log(a.data))}},k=function(a){try{if(a=JSON.parse(a),-1===h.indexOf(a.type)||-1===b.indexOf(a.origin))return!1}catch(c){return!1}return!0};return{init:function(a){if(!u){u=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",r,!1):window.attachEvent&&window.parent.attachEvent("message",r)}catch(b){}}},createMessage:function(b,
h){return JSON.stringify(new c(b,h))},validateMessage:k,sendMessage:function(b){u&&q&&k(b)&&m(b)}}}();SGAME.API=function(){var c=function(c,b){var p=new XMLHttpRequest;p.onreadystatechange=function(){if(4==p.readyState&&200==p.status){var c=JSON.parse(p.responseText);b(c)}};p.open("GET",c,!0);p.send("")};return{init:function(){},requestLOMetadata:function(h,b,p){try{c("undefined"==typeof h?"/lo/random/metadata.json":"/lo/"+h+"/metadata.json",function(c){b(c)})}catch(l){p(l)}}}}();SGAME.CORE=function(){var c={},h=void 0,b={},p=!1,l=["repeat","repeat_unless_successfully_consumed","no_repeat"],u=["no_more_los","all_los_consumed","all_los_succesfully_consumed","never"],q=["success","failure","success_unless_damage","failure_unless_blocking"],m=!1,r=!1,k="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a=function(a){b=a;"undefined"===typeof b.game_metadata&&(b.game_metadata={});"undefined"===typeof b.los&&
(b.los={});"undefined"===typeof b.events&&(b.events={});"undefined"===typeof b.event_mapping&&(b.event_mapping={});"undefined"===typeof b.sequencing&&(b.sequencing={});-1===l.indexOf(b.sequencing.repeat_lo)&&(b.sequencing.repeat_lo="repeat");"undefined"===typeof b.game_settings&&(b.game_settings={});-1===u.indexOf(b.game_settings.completion_notification)&&(b.game_settings.completion_notification="never");-1===q.indexOf(b.game_settings.behaviour_when_no_more_los)&&(b.game_settings.behaviour_when_no_more_los=
"success_unless_damage");"string"===typeof b.game_settings.completion_notification_text&&(k=b.game_settings.completion_notification_text);if("object"===typeof b.los){a=Object.keys(b.los);for(var d=a.length,c=0;c<d;c++)"undefined"!==typeof b.los[a[c]].url&&(b.los[a[c]].url=SGAME.Utils.checkUrlProtocol(b.los[a[c]].url)),b.los[a[c]].can_be_shown=!0,b.los[a[c]].shown=!1,b.los[a[c]].nshown=0,b.los[a[c]].succesfully_consumed=!1,b.los[a[c]].acts_as_asset="asset"===b.los[a[c]].scorm_type||"sco"===b.los[a[c]].scorm_type&&
!1===b.los[a[c]].report_data,m=!0}},s=function(a){var c=[];a=b.event_mapping[a];if("undefined"!==typeof a){var d=a.length;if("number"===typeof d)for(var e=0;e<d;e++){if("*"===a[e]){c=[];a=Object.keys(b.los);for(d=0;d<a.length;d++)"undefined"!==typeof b.los[a[d]]&&c.push(b.los[a[d]]);break}"undefined"!==typeof b.los[a[e]]&&c.push(b.los[a[e]])}}return c},f=function(a){for(var b=[],c=a.length,d=0;d<c;d++)!0===a[d].can_be_shown&&b.push(a[d]);return b},g=function(a,c){"object"!==typeof a||"string"!==typeof a.url?
"function"===typeof c&&c(null,null):(n(),b.los[a.id].shown=!0,b.los[a.id].nshown+=1,SGAME.Fancybox.create({lo:a},function(e){b.los[a.id].succesfully_consumed=e.success;switch(b.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":b.los[a.id].can_be_shown=!0!==b.los[a.id].succesfully_consumed;break;case "no_repeat":b.los[a.id].can_be_shown=!1}t();e.more_los=m;d(function(){"function"===typeof c&&c(e.success,e);n()})}))},n=function(){"function"===typeof h&&h()},t=function(){for(var a=Object.keys(b.los),
c=a.length,d=0;d<c;d++)if(!0===b.los[a[d]].can_be_shown){m=!0;return}m=!1},d=function(a){!0!==v()?"function"===typeof a&&a(!1):e(a)},v=function(){if(!0===r)return!1;switch(b.game_settings.completion_notification){case "no_more_los":return!1===m;case "all_los_consumed":for(var a=Object.keys(b.los),c=a.length,d=0;d<c;d++)if(!1===b.los[a[d]].shown)return!1;return!0;case "all_los_succesfully_consumed":a=Object.keys(b.los);c=a.length;for(d=0;d<c;d++)if(!1===b.los[a[d]].succesfully_consumed)return!1;return!0;
case "never":return!1;default:return!1}},e=function(a){r=!0;SGAME.Fancybox.create({dialog:!0,msg:k},function(){"function"===typeof a&&a(!0)})},w=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:x(a),more_los:m}},x=function(a){var d;p&&"undefined"!==typeof b.game_settings.behaviour_when_no_more_los?d=b.game_settings.behaviour_when_no_more_los:"undefined"!==typeof c.behaviour_when_no_more_los?
d=c.behaviour_when_no_more_los:"undefined"!==typeof b.game_settings.behaviour_when_no_more_los&&(d=b.game_settings.behaviour_when_no_more_los);return z(d,a)},z=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var d=y(b);return"undefined"!==typeof d&&"damage"===d.type?!1:!0;case "failure_unless_blocking":return d=y(b),"undefined"===typeof d||"blocking"!==d.type?!1:!0;default:return!1}},y=function(a){return"undefined"!==typeof b.events[a]?b.events[a]:
"object"===typeof c.events&&"undefined"!==typeof c.events[a]?c.events[a]:{}};SGAME.Debugger.init(!0);!1===p&&a({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(c=a)&&"function"===typeof a.togglePause&&(h=a.togglePause)},loadSettings:function(b){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(b);p=!0;a(b)},triggerLO:function(a,b){var d=s(a);if(1>d.length){if("function"===typeof b){var c=w(a);b(c.success,c)}}else if(d=
f(d),0<d.length){for(var e=[],h=0;h<d.length;h++)"undefined"===typeof c&&(c=d[h].nshown),d[h].nshown<c&&(c=d[h].nshown,e=[]),c===d[h].nshown&&e.push(d[h]);selectedLO=SGAME.Utils.getRandomElement(e);g(selectedLO,b)}else"function"===typeof b&&(c=w(a),b(c.success,c))},showLO:g,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){g(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return b},losCanBeShown:function(a){return!1===
m?!1:"undefined"===typeof a?m:0<f(s(a)).length},successWhenNoLOs:function(a){return x(a)}}}();var API,API_1484_11;
SGAME.Fancybox=function(c){var h=c,b=c,p=c,l=function(){"undefined"!=typeof h&&(h.style.display="none",h.parentNode.removeChild(h),"lo"===b&&(API_1484_11=API=c),b=h=c)},u=function(){if("undefined"!=typeof h){var q=b;l();var m;m="lo"===q?SGAME.Observer.stop():!0;var r=p;p=c;setTimeout(function(){"function"===typeof r&&r(m)},50)}};return{init:function(){},create:function(q,m){l();p=m;var r="undefined"!==typeof q&&!0===q.dialog?"dialog":"lo",k=4/3,a,s,f=0.9*window.innerWidth,g=0.9*window.innerHeight;
g*k>f?(a=f,s=a/k):(s=g,a=s*k);if("lo"===r)var n={},t;else var d="";q&&(q.width&&(a=q.width),q.height&&(s=q.height),"lo"===r?q.lo&&(n=q.lo,"string"===typeof n.url&&(t=n.url)):"string"==typeof q.msg&&(d=q.msg));if("lo"===r){if("string"!=typeof t||"undefined"==typeof n.scorm_type)return;var v=c;API_1484_11=API=c;"sco"===n.scorm_type&&("1.2"===n.scorm_version?v=API=new Local_API_SCORM_12({debug:SGAME.Debugger.isDebugging()}):"2004"===n.scorm_version&&(v=API_1484_11=new Local_API_1484_11({debug:SGAME.Debugger.isDebugging()})))}k=
document.createElement("div");k.style.width=a+"px";k.style.height=s+"px";k.style.maxWidth=f+"px";k.style.maxHeight=g+"px";k.style.overflow="lo"===r?"hidden":"auto";k.style.background="white";k.style.position="absolute";k.style.top=0;k.style.zIndex=9999;k.style.borderRadius="1em";k.style.border="2px solid black";k.setAttribute("id","sgame_fancybox");k.style.marginLeft=(window.innerWidth-a)/2+"px";k.style.marginTop=(window.innerHeight-s)/2+"px";g=document.createElement("img");g.src="/assets/sgame/close.png";
f=Math.max(25,Math.floor(0.05*s));g.style.width=f+"px";g.style.height=f+"px";g.style.padding="5px";g.style.cursor="pointer";g.style.position="absolute";g.style.right=0;g.onclick=function(){u()};k.appendChild(g);if("lo"===r){var e=document.createElement("img");e.id="trafficLight";e.src="/assets/sgame/trafficLight/trafficLight_red.png";d=Math.max(40,Math.floor(0.085*s));g=Math.max(30,Math.floor(0.75*d));e.style.height=d+"px";e.style.width=g+"px";e.style.padding="4px";e.style.position="absolute";e.style.left=
"0px";e.style.top="0px";e.style.background="#fff";e.style.borderRadius="0px 0px 20px 0px";e.style.borderRight="2px solid black";e.style.borderBottom="2px solid black";k.appendChild(e);e=document.createElement("iframe");e.src=t;t=Math.ceil(Math.max(f,d))+4;d=Math.floor(0.02*s);f=Math.floor(0.02*a);e.style.marginLeft=f+"px";e.style.marginTop=t+"px";e.style.width=Math.max(0,a-f-f)+"px";e.style.height=Math.max(0,s-t-d)+"px";e.style.overflow="auto";e.scrolling="yes";e.style.frameBorder="0";e.style.borderStyle=
"none";e.setAttribute("allowfullscreen","false");k.appendChild(e)}else a=document.createElement("p"),a.id="dialog",a.innerHTML=d,a.style.padding="15px",a.style.marginTop="30px",a.style.marginBottom="20px",a.style.marginRight="20px",a.style.marginLeft="20px",a.style.textAlign="center",a.style.fontSize="24px",a.style.position="relative",a.style.cursor="default",a.style.color="#000",a.style.fontFamily="initial",k.appendChild(a);h=k;b=r;document.body.appendChild(k);"lo"===r&&SGAME.Observer.start(e,n,
v)},closeCurrentFancybox:u}}();SGAME.Observer=function(c){var h=!0,b=c,p=c,l=c,u,q,m,r,k,a,s=function(){l=p=b=c;u=Date.now();q=!1;a=k=r=m=c},f=function(){!1===p.acts_as_asset&&"undefined"!==typeof l&&(l.addListener("cmi.success_status",function(a){m=a;"passed"===m&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),l.addListener("cmi.score.scaled",function(a){r=a;0.8<=r&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
l.addListener("cmi.completion_status",function(a){k=a}),l.addListener("cmi.progress_measure",function(b){a=b}))};return{start:function(a,c,k){if(!1===h||"undefined"!=typeof b)return null;h=!1;s();b=a;p=c;l=k;f();SGAME.TrafficLight.changeColor("red");if(!0===p.acts_as_asset){b:{a=p.lom_metadata;if(a.educational&&a.educational.typicalLearningTime&&a.educational.typicalLearningTime.duration&&(a=iso8601Parser.getDuration(a.educational.typicalLearningTime.duration)))break b;a=null}a=!a||0>=a?15:Math.min(0.5*
a,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*a-0.5,0.5*a);SGAME.TrafficLight.changeColor("green",a)}},stop:function(){if(!0===h||"undefined"==typeof b)return null;h=!0;SGAME.TrafficLight.stop();var c=Math.round((Date.now()-u)/1E3);q="green"===SGAME.TrafficLight.getCurrentColor();c={lo_metadata:p,time:c,success:q};"undefined"!=typeof m&&(c.scorm_success_status=m);"undefined"!=typeof r&&(c.scorm_scaled_score=r);"undefined"!=typeof k&&(c.scorm_completion_status=k);"undefined"!=typeof a&&(c.scorm_progress_measure=
a);s();return c},isStopped:function(){return h}}}();SGAME.TrafficLight=function(c){var h,b,p,l,u,q=function(b){var a=document.getElementById("trafficLight");a&&(h=b,a.src=m(b))},m=function(b){switch(b){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},r=function(b,a){var c=document.getElementById("trafficLight");if(c){var f=!1;l=
setInterval(function(){c&&(f?(c.src=m(null),f=!1):(c.src=m(b),f=!0))},500);u=setTimeout(function(){clearTimeout(l)},1E3*a)}};return{getCurrentColor:function(){return h},changeColor:function(c,a){a?b=setTimeout(function(){q(c)},1E3*a):q(c)},setUpBlink:function(b,a,c){c?p=setTimeout(function(){r(b,a)},1E3*c):r(b,a)},stop:function(){b&&clearTimeout(b);p&&clearTimeout(p);l&&clearTimeout(l);u&&clearTimeout(u)}}}();SGAME.Utils=function(){var c=void 0;return{init:function(c){},getRandomElement:function(c){if("number"==typeof c)return c;var b;b=c.length-1;if("number"!=typeof b)throw{name:"Invalid number format exception"};b=Math.round(0+Math.random()*(b-0));return c[b]},loadScript:function(c,b){if("string"===typeof c&&"function"===typeof b){var p=document.getElementsByTagName("head")[0];if(p){var l=document.createElement("script");l.setAttribute("src",c);l.setAttribute("type","text/javascript");l.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||b()};l.onload=b;p.appendChild(l)}}},getProtocol:function(){if("undefined"!==typeof c)return c;var h;try{h=document.location.protocol}catch(b){}"string"===typeof h&&(h=h.match(/[\w]+/),h=h instanceof Array&&"string"===typeof h[0]?h[0]:void 0);return c="string"===typeof h?h:"unknown"},checkUrlProtocol:function(c){if("string"===typeof c){var b=c.match(/^https?:\/\//);if(b instanceof Array&&1===b.length){var b=b[0].replace("://",""),p=
SGAME.Utils.getProtocol();if(b!==p)switch(p){case "https":c="https"+c.replace(b,"")}}}return c}}}();
