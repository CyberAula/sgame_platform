iso8601Parser=function(c){return{getDuration:function(f){var c=[31104E3,2592E3,604800,86400,3600,60,1];try{var l;var a=f;f=[2,3,4,5,7,8,9];var t=[0,0,0,0,0,0,0],r;if(a=a.toUpperCase()){if("string"!==typeof a)throw Error("Invalid iso8601 period string '"+a+"'");if(r=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(a))for(a=0;a<f.length;a++){var m=f[a];t[a]=r[m]?+r[m].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+a+"' is not a valid ISO8601 period.");}l=t}catch(s){return null}for(m=
r=0;m<l.length;m++)r+=l[m]*c[m];return r}}}();function Local_API_1484_11(c){function f(a,b){d.diganostic="The "+a+" of "+b+" must be a proper vocabulary element.";d.errorCode=406;return"false"}function g(a){d.errorCode=402;d.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function l(a,b){d.errorCode=201;d.diagnostic="The value for key "+a+" is not valid.";return"false"}function a(b,n,d){b=b.split(/\./);2>b.length?d[b[0]]=n:(d[b[0]]||(d[b[0]]={}),d=d[b.shift()],a(b.join("."),n,d))}function t(a,b){var d=a.split(/\./),
n;if(2>d.length)try{return b[d[0]]}catch(h){return g(a),"false"}else{n=d.shift();if(b[n])return String(t(d.join("."),b[n]));g(a);return"false"}}function r(a){var b,d=0;for(b in a)a.hasOwnProperty(b)&&(d+=1);return d}function m(a,b){if(d.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(b){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);
break;case 3:console.log(a);break;default:return console.log(a),!1}return!0}3>b&&d.throw_alerts&&alert(a);return!1}function s(a,b){if("function"==typeof d.listeners[a]&&"undefined"!=typeof b)d.listeners[a](b)}function e(a,b){for(var d in b)b.hasOwnProperty(d)&&("object"==typeof a[d]?"object"==typeof b[d]&&(a[d]=e(a[d],b[d])):a[d]=b[d]);return a}function b(a,b){(function(){function a(b,d){d=d||{bubbles:!1,cancelable:!1,detail:void 0};var v=document.createEvent("CustomEvent");v.initCustomEvent(b,d.bubbles,
d.cancelable,d.detail);return v}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}function k(a){return"object"!==type(a)||a.nodeType||isWindow(a)?!1:!(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))}var d=e({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},c),h={},n={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},q=this;"object"===typeof d.user&&("string"===typeof d.user.name&&(d.CMI.learner_name=d.user.name),"string"===typeof d.user.id&&(d.CMI.learner_id=d.user.id));this.isRunning=function(){return 1===d.initialized&&0===d.terminated};this.Initialize=function(){m(d.prefix+
":  Initializing...",3);d.cmi?(h=d.cmi,"suspend"===h.exit&&(h.entry="resume")):h=d.CMI;d.initialized=1;d.terminated=0;return"true"};this.GetValue=function(a){d.errorCode=0;var b="false";a=a.toString();var n=[];if(this.isRunning()){n=a.split(".");if(0<="|exit|session_time|".indexOf("|"+n[n.length-1]+"|"))return m(d.prefix+": This "+a+" is write only",4),d.errorCode=405,"false";n=a.toLowerCase().split(".");switch(n[0]){case "cmi":switch(b="false",a){case "cmi.exit":case "cmi.session_time":d.errorCode=
405;d.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;case "cmi.learner_name":b=d.CMI.learner_name;break;default:b=t(a.substr(4,a.length),h),"undefined"===b&&(d.errorCode=401,d.diagnostic="Sorry, there was a undefined response from "+a,b="false"),m(d.prefix+": GetValue "+a+" = "+b,4)}}return b}d.errorCode=123;return b};this.SetValue=function(b,n){m(d.prefix+": SetValue: "+b+" = "+n,4);d.errorCode=0;var e=[],q=b.toString(),c=n.toString(),p=0,g=0,p=[];if(this.isRunning()){p=
q.split(".");if("adl"===p[0]&&"id"===p[4]||"comments_from_lms"===p[1]||("comments_from_learner"===p[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+p[p.length-1]+"|")))return m(d.prefix+": This "+q+" is read only",4),d.errorCode=404,"false";e=q.split(".");switch(e[0]){case "cmi":switch(b){case "cmi.location":1E3<c.length&&m(d.prefix+": Some LMS's might truncate your bookmark as you've passed "+
c.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":p=parseFloat(c);if("number"!=typeof p||isNaN(p))return l(b,c);p=Math.max(0,Math.min(1,p));s(b,p);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+c+"|"))return f(b,c);s(b,c);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+c+"|"))return f(b,c);break;case "cmi.score.scaled":p=parseFloat(c);if("number"!=typeof p||isNaN(p))return l(b,c);p=Math.max(0,
Math.min(1,p));s(b,p);break;case "cmi.score.min":p=parseFloat(c);if("number"!=typeof p||isNaN(p))return l(b,c);d.CMI.score.min=p;break;case "cmi.score.max":p=parseFloat(c);if("number"!=typeof p||isNaN(p))return l(b,c);d.CMI.score.max=p;break;case "cmi.score.raw":p=parseFloat(c);if("number"!=typeof p||isNaN(p))return l(b,c);g=parseFloat(d.CMI.score.max);g="number"!=typeof g||isNaN(g)?100:g;e=parseFloat(d.CMI.score.min);e="number"!=typeof e||isNaN(e)?0:e;g-=e;0>=g&&(g=100);p=Math.max(0,Math.min(1,(p-
e)/g));s("cmi.score.scaled",p);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+c+"|"))return f(b,c);s(b,c);break;default:switch(e[1]){case "comments_from_lms":return d.errorCode="404",d.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===h.comments_from_learner._children.indexOf(e[3]))return f(b,c);a(q.substr(4,q.length),c,h);h.comments_from_learner._count=(r(h.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===h.interactions._children.indexOf(e[3]))return f(b,c);h.interactions._count=(r(h.interactions)-2).toString();if(isNaN(parseInt(e[2],10)))return"false";if(!k(h.interactions[e[2]])){if("id"===e[3])return h.interactions[e[2]]={},a(q.substr(4,q.length),c,h),h.interactions._count=(r(h.interactions)-2).toString(),k(h.interactions[e[2]].objectives)||(m(d.prefix+": Constructing objectives object for new interaction",4),h.interactions[e[2]].objectives={},h.interactions[e[2]].objectives._count=
"-1"),k(h.interactions[e[2]].correct_responses)||(m(d.prefix+": Constructing correct responses object for new interaction",4),h.interactions[e[2]].correct_responses={},h.interactions[e[2]].correct_responses._count="-1"),"true";m("Can't add interaction without ID first!",3);return"false"}if("objectives"===e[3]){if("id"===e[5])for(g=parseInt(h.interactions[e[2]].objectives._count,10),p=0;p<g;p+=1){if(h.interactions[e[2]].objectives[p].id===c)return q=b,d.errorCode="351",d.diagnostic="The "+q+" element must be unique.  The value '"+
c+"' has already been set in #"+p,"false"}else return f(b,c);a(q.substr(4,q.length),c,h);h.interactions[e[2]].objectives._count=(r(h.interactions[e[2]].objectives)-1).toString();return"true"}"correct_responses"===e[3]&&(a(q.substr(4,q.length),c,h),h.interactions[e[2]].correct_responses._count=(r(h.interactions[e[2]].correct_responses)-1).toString());a(q.substr(4,q.length),c,h);h.interactions._count=(r(h.interactions)-2).toString();return"true";case "objectives":if("id"===e[3])for(g=parseInt(h.objectives._count,
10),p=0;p<g;p+=1)if(h.objectives[p].id===c)return d.errorCode="351",d.diagnostic="The objectives.id element must be unique.  The value '"+c+"' has already been set in objective #"+p,"false";if("id"!==e[3]&&(p=parseInt(e[2],10),void 0===h.objectives[p]))return d.errorCode="408",d.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(e[2],10)))return"false";a(q.substr(4,q.length),c,h);h.objectives._count=(r(h.objectives)-2).toString();return"true"}}a(q.substr(4,
q.length),c,h)}return"true"}d.errorCode=d.terminated?133:132;return"false"};this.Commit=function(){m(d.prefix+": Commit CMI Object:",4);m(h);m(d.prefix+": Suspend Data Usage "+(Math.round(100*(h.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));b("StoreData",{runtimedata:h});return"true"};this.Terminate=function(){q.Commit();d.terminated=1;d.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==n[a])?n[a]:""};this.GetLastError=function(){return d.errorCode};
this.GetDiagnostic=function(){return d.diagnostic};this.setCMILMSValue=function(a,b){"string"==typeof a&&(d.CMI[a]=b)};this.addListener=function(a,b){"string"==typeof a&&"function"==typeof b&&(d.listeners[a]=b)}};function Local_API_SCORM_12(c){function f(a,d){b.diganostic="The "+a+" of "+d+" must be a proper vocabulary element.";b.errorCode=406;return"false"}function g(a){b.errorCode=402;b.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function l(a,d){b.errorCode=201;b.diagnostic="The value for key "+a+" is not valid.";return"false"}function a(b,d,e){b=b.split(/\./);2>b.length?e[b[0]]=d:(e[b[0]]||(e[b[0]]={}),e=e[b.shift()],a(b.join("."),d,e))}function t(a,b){var d=a.split(/\./),
e;if(2>d.length)try{return b[d[0]]}catch(h){return g(a),"false"}else{e=d.shift();if(b[e])return String(t(d.join("."),b[e]));g(a);return"false"}}function r(a,d){if(b.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(d){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>d&&b.throw_alerts&&alert(a);return!1}function m(a,d){if("function"==typeof b.listeners[a]&&"undefined"!=typeof d)b.listeners[a](d)}function s(a,b){for(var d in b)b.hasOwnProperty(d)&&("object"==typeof a[d]?"object"==typeof b[d]&&(a[d]=s(a[d],b[d])):a[d]=b[d]);return a}function e(a,b){(function(){function a(b,d){d=d||{bubbles:!1,cancelable:!1,detail:void 0};var e=document.createEvent("CustomEvent");e.initCustomEvent(b,d.bubbles,d.cancelable,d.detail);return e}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:b}))}var b=s({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},c),k={},d={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},h=this;"object"===typeof b.user&&("string"===typeof b.user.name&&(b.CMI.core.student_name=b.user.name),"string"===typeof b.user.id&&(b.CMI.core.student_id=b.user.id));this.isRunning=function(){return 1===b.initialized&&0===b.terminated};this.LMSInitialize=function(){r(b.prefix+":  Initializing...",3);k=b.CMI;b.initialized=1;b.terminated=
0;return"true"};this.LMSGetValue=function(a){b.errorCode=0;var d="false";a=a.toString();var e=[];if(this.isRunning()){e=a.split(".");if(0<="|exit|session_time|".indexOf("|"+e[e.length-1]+"|"))return b.errorCode=405,"false";e=a.toLowerCase().split(".");switch(e[0]){case "cmi":d=a;a="false";switch(d){case "cmi.core.exit":case "cmi.core.session_time":b.errorCode=405;b.diagnostic="Sorry, this has been specified as a read-only value for "+d;break;default:d=d.replace("cmi.",""),a=t(d,k),"undefined"===a&&
(b.errorCode=401,b.diagnostic="Sorry, there was a undefined response from "+d,a="false")}d=a}return d}b.errorCode=123;return d};this.LMSSetValue=function(d,e){r(b.prefix+": SetValue: "+d+" = "+e,4);b.errorCode=0;var h=[],c=d.toString(),g=e.toString();if(this.isRunning()){var h=c.split("."),s=h[h.length-1],h="adl"===h[0]&&"id"===h[4]?!0:"comments_from_lms"===h[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
s+"|");if(h)return b.errorCode=404,"false";h=c.split(".");switch(h[0]){case "cmi":switch(d){case "cmi.core.lesson_location":1E3<g.length&&r(b.prefix+": Some LMS's might truncate your bookmark as you've passed "+g.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+g+"|"))return f(d,g);m(d,g);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+g+"|"))return f(d,
g);break;case "cmi.core.score.min":h=parseFloat(g);if("number"!=typeof h||isNaN(h))return l(d,g);b.CMI.core.score.min=h;break;case "cmi.core.score.max":h=parseFloat(g);if("number"!=typeof h||isNaN(h))return l(d,g);b.CMI.core.score.max=h;break;case "cmi.core.score.raw":h=parseFloat(g);if("number"!=typeof h||isNaN(h))return l(d,g);var t=parseFloat(b.CMI.core.score.max),t="number"!=typeof t||isNaN(t)?100:t,s=parseFloat(b.CMI.core.score.min),s="number"!=typeof s||isNaN(s)?0:s,t=t-s;0>=t&&(t=100);h=Math.max(0,
Math.min(1,(h-s)/t));m("cmi.score.scaled",h)}c=c.replace("cmi.","");a(c,g,k)}return"true"}b.errorCode=b.terminated?133:132;return"false"};this.LMSCommit=function(){e("StoreData",{runtimedata:k});return"true"};this.LMSTerminate=function(){h.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSFinish=function(){h.LMSCommit();b.terminated=1;b.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==d[a])?d[a]:""};this.LMSGetLastError=function(){return b.errorCode};
this.LMSGetDiagnostic=function(){return b.diagnostic};this.setCMILMSValue=function(a,d){"string"==typeof a&&(b.CMI[a]=d)};this.addListener=function(a,d){"string"==typeof a&&"function"==typeof d&&(b.listeners[a]=d)}};SGAME=function(){return{init:function(c){return SGAME.CORE.init(c)},loadSettings:function(c){return SGAME.CORE.loadSettings(c)},triggerLO:function(c,f){return SGAME.CORE.triggerLO(c,f)},showLO:function(c,f){return SGAME.CORE.showLO(c,f)},showRandomLO:function(c){return SGAME.CORE.showRandomLO(c)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(c){return SGAME.CORE.losCanBeShown(c)},successWhenNoLOs:function(c){return SGAME.CORE.successWhenNoLOs(c)}}}();
SGAME.VERSION="1.0.0";SGAME.AUTHORS="Aldo Gordillo";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var c=!1;return{init:function(f){!0===f&&(c=f)},isDebugging:function(){return c},log:function(f){c&&window.console&&console.log(f)}}}();SGAME.Messenger=function(){function c(b,e){this.data=b||{};-1!==["PROTOCOL","APP"].indexOf(e)?this.type=e:this.type="APP";this.origin=l;this.destination=a}var f=["PROTOCOL","APP"],g=["SGAME_GATEWAY","SGAME_API"],l="SGAME_API",a="SGAME_GATEWAY",t=!1,r=!1,m=function(a){try{window.parent.parent.postMessage(a,"*")}catch(e){}},s=function(a){var c;c="object"!==typeof a||"string"!==typeof a.data?!1:e(a.data);if(c)switch(a=JSON.parse(a.data),a.type){case "PROTOCOL":if(a.data)switch(a.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
a.origin&&!0!==r&&(r=!0,a.data.settings=SGAME.CORE.getSettings(),a.destination=a.origin,a.origin=l,m(JSON.stringify(a)),SGAME.CORE.onConnectedToVLE())}break;case "APP":if(a.data&&"string"===typeof a.data.key)switch(a.data.key){case "lms_data":if("object"===typeof a.data.value){c=a.data.value;a={};if("string"===typeof c.name||"number"===typeof c.name)a.name=""+c.name;if("string"===typeof c.id||"number"===typeof c.id)a.id=""+c.id;c=SGAME.CORE.getVLEData();c.user=a;SGAME.CORE.setVLEData(c)}}}},e=function(a){try{if(a=
JSON.parse(a),-1===f.indexOf(a.type)||-1===g.indexOf(a.origin))return!1}catch(e){return!1}return!0};return{init:function(a){if(!t){t=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",s,!1):window.attachEvent&&window.parent.attachEvent("message",s)}catch(e){}}},isConnected:function(){return r},sendMessage:function(a){t&&r&&(a=JSON.stringify(new c(a,void 0)),e(a)&&m(a))}}}();SGAME.Sequencing=function(){var c,f=["completion","success"],g=function(a){for(var c=Object.keys(a),f=c.length,e=0;e<f;e++){var b=l(a[c[e]],c);!1!==b?a[c[e]]=b:delete a[c[e]]}return Object.keys(a).length===f?a:g(a)},l=function(a,c){if("undefined"===typeof a.conditions)return a;if("object"!==typeof a.conditions)return!1;if(0===a.conditions.length)return delete a.conditions,a;for(var g=[],e=0;e<a.conditions.length;e++){var b=a.conditions[e];-1!==c.indexOf(b.group+"")&&-1!==f.indexOf(b.requirement)&&
g.push(b)}a.conditions=g;return 0===a.conditions.length?!1:a},a=function(a,g){for(var f=Object.keys(g),e=0,b=0;b<f.length;b++){var k=g[f[b]];if(!1===k.can_be_shown&&k.id!=a.id&&"undefined"!==typeof k.conditions)for(var d=0;d<k.conditions.length;d++)if(k.conditions[d].group==a.id){if(!1===k.conditions[d].met)return!1;e+=1}}if(0<e)return!0;switch(c){case "linear_completion":return a.shown;case "linear_success":return a.succesfully_consumed;default:return a.shown&&a.succesfully_consumed}},t=function(a,
c,g){for(var e=0;e<a.los.length;e++)c[a.los[e]].can_be_shown=g;return c};return{init:function(a){c=a.approach},validateSequence:function(a,c){if("object"!==typeof a||"object"!==typeof c)return!1;for(var f=Object.keys(a),e=Object.keys(c),b=0;b<f.length;b++){var k;k=a[f[b]];for(var d=e,h=[],n=0;n<k.los.length;n++){var q=k.los[n];-1!==d.indexOf(q)&&h.push(q)}k.los=h;k=1>k.los.length?!1:k;!1!==k?a[f[b]]=k:delete a[f[b]]}a=g(a);f=Object.keys(a);e=[];for(b=0;b<f.length;b++)for(k=a[f[b]],d=0;d<k.los.length;d++)-1===
e.indexOf(k.los[d])&&e.push(k.los[d]);return 2>typeof f.length||2>e.length?!1:a},updateGroupsTracking:function(c,f,g){for(var e=0;e<c.groups.length;e++){var b=f,k=c.groups[e]+"",d;d=f[c.groups[e]+""];if(!0!==(d.shown&&d.succesfully_consumed)){for(var h=!0,n=!0,q=0;q<d.los.length;q++)var l=g[d.los[q]],h=h&&!0===l.shown,n=n&&!0===l.succesfully_consumed;d.shown=h;d.succesfully_consumed=n}b[k]=d}e=0;b=Object.keys(f);for(k=0;k<b.length;k++)if(n=f[b[k]],!1===n.can_be_shown&&(e+=1,!1===n.shown&&!1===n.succesfully_consumed)){d=
f;h=b[k];q=f;if("undefined"!==typeof n.conditions){for(var l=!0,w=0;w<n.conditions.length;w++)if(!1===n.conditions[w].met){switch(n.conditions[w].requirement){case "completion":n.conditions[w].met=!0===q[n.conditions[w].group+""].shown;break;case "success":n.conditions[w].met=!0===q[n.conditions[w].group+""].succesfully_consumed}l=l&&n.conditions[w].met;if(!1===l)break}n.can_be_shown=l}d[h]=n;!0===f[b[k]].can_be_shown&&(g=t(f[b[k]],g,!0),e-=1)}for(k=0;k<c.groups.length;k++)n=f[c.groups[k]+""],!0===
n.can_be_shown&&(d=f,h=c.groups[k]+"",q=a(n,f),n.can_be_shown=!1===q,d[h]=n,!1===f[c.groups[k]+""].can_be_shown&&(g=t(f[c.groups[k]+""],g,!1),e+=1));if(c=e===b.length)for(e=Object.keys(g),b=0;b<e.length;b++)if("undefined"===typeof g[e[b]].groups||0===g[e[b]].groups.length)g[e[b]].can_be_shown=!0;return{groups:f,los:g,finished:c}}}}();SGAME.API=function(){var c=function(c,g){var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){var a=JSON.parse(l.responseText);g(a)}};l.open("GET",c,!0);l.send("")};return{init:function(){},requestLOMetadata:function(f,g,l){try{c("undefined"==typeof f?"/lo/random/metadata.json":"/lo/"+f+"/metadata.json",function(a){g(a)})}catch(a){l(a)}}}}();SGAME.CORE=function(){var c={},f=void 0,g=!1,l="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},t=!1,r={},m={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},s=["repeat","repeat_unless_successfully_consumed","no_repeat"],e=["no_restrictions","n_times","1_per_timeperiod"],b=["random","linear_completion","linear_success","custom"],k="all_los percentage_los n_los n_times disabled onstart".split(" "),
d="all_los percentage_los n_los n_times disabled onstart oncompletion".split(" "),h="no_more_los all_los_consumed all_los_succesfully_consumed completion_status success_status never".split(" "),n=["success","failure","success_unless_damage","failure_unless_blocking"],q=!1,v=0,w=0,x=0,u=0,y=0,p=!1,A=void 0,E=function(c){a=c;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&
(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===s.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===e.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1===b.indexOf(a.sequencing.approach)&&(a.sequencing.approach="random",delete a.sequencing.sequence);-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||delete a.sequencing.interruptions_n;-1!==
["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===k.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;
-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);-1===d.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;-1!==
["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===h.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===n.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&
(l=a.game_settings.completion_notification_text);if("object"===typeof a.los){c=Object.keys(a.los);v=c.length;for(var f=0;f<v;f++)"undefined"!==typeof a.los[c[f]].url&&(a.los[c[f]].url=SGAME.Utils.checkUrlProtocol(a.los[c[f]].url)),a.los[c[f]].can_be_shown=!0,a.los[c[f]].shown=!1,a.los[c[f]].nshown=0,a.los[c[f]].succesfully_consumed=!1,a.los[c[f]].nsuccess=0,a.los[c[f]].acts_as_asset="asset"===a.los[c[f]].scorm_type||"sco"===a.los[c[f]].scorm_type&&!1===a.los[c[f]].report_data,q=!0}"random"!==a.sequencing.approach&&
(c=SGAME.Sequencing.validateSequence(a.sequencing.sequence,a.los),!1===c?(a.sequencing.approach="random",delete a.sequencing.sequence):a.sequencing.sequence=c);if("object"===typeof a.sequencing.sequence){c=Object.keys(a.los);v=c.length;for(f=0;f<v;f++)a.los[c[f]].can_be_shown=!1,a.los[c[f]].groups=[];q=!1;c=Object.keys(a.sequencing.sequence);_nGroups=c.length;for(f=0;f<_nGroups;f++){var g=a.sequencing.sequence[c[f]];g.can_be_shown="undefined"===typeof g.conditions||0===g.conditions.length;g.shown=
!1;g.succesfully_consumed=!1;if("undefined"!==typeof g.conditions)for(var m=0;m<g.conditions.length;m++)g.conditions[m].met=!1;a.sequencing.sequence[c[f]]=g;for(m=0;m<g.los.length;m++)a.los[g.los[m]].groups.push(g.id),a.los[g.los[m]].can_be_shown=!0===g.can_be_shown,!0===a.los[g.los[m]].can_be_shown&&(q=!0)}}SGAME.Sequencing.init(a.sequencing)},D=function(b,d){var c=F(b);if(1>c.length)return B(b,d);var e=G(c);if(0<e.length){c=void 0;switch(a.sequencing.approach){case "linear_completion":case "linear_success":case "custom":if(!1===
g){for(var c=[],h=[],f=[],k=0;k<e.length;k++)f.push(e[k].id);for(var e=Object.keys(a.sequencing.sequence),m=0;m<e.length;m++){var l=a.sequencing.sequence[e[m]];if(!0===l.can_be_shown)for(k=0;k<l.los.length;k++)-1!==f.indexOf(l.los[k])&&-1===h.indexOf(l.los[k])&&(h.push(l.los[k]),c.push(a.los[l.los[k]]))}}else c=e;c=H(c);break;default:c=H(e)}selectedLO=c;C(selectedLO,d)}else"function"===typeof d&&(c=I(b),d(c.success,c))},B=function(a,b){if("function"===typeof b){var d=I(a);b(d.success,d)}},F=function(b){var d=
[];b=a.event_mapping[b];if("undefined"!==typeof b){var c=b.length;if("number"===typeof c)for(var e=0;e<c;e++){if("*"===b[e]){d=[];b=Object.keys(a.los);for(c=0;c<b.length;c++)"undefined"!==typeof a.los[b[c]]&&d.push(a.los[b[c]]);break}"undefined"!==typeof a.los[b[e]]&&d.push(a.los[b[e]])}}return d},G=function(a){for(var b=[],d=a.length,c=0;c<d;c++)!0===a[c].can_be_shown&&b.push(a[c]);return b},C=function(b,d){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof d&&d(null,null):(A=new Date,
z(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(c){!0!==a.los[b.id].succesfully_consumed&&(a.los[b.id].succesfully_consumed=c.success);!0===c.success&&(a.los[b.id].nsuccess+=1);if("random"!==a.sequencing.approach&&!1===g){var e=SGAME.Sequencing.updateGroupsTracking(a.los[b.id],a.sequencing.sequence,a.los);a.sequencing.sequence=e.groups;a.los=e.los;e.finished&&(g=!0)}switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=
!0!==a.los[b.id].succesfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}N();c.more_los=q;J(function(){"function"===typeof d&&d(c.success,c);z()})}))},z=function(){"function"===typeof f&&f()},N=function(){var b=Object.keys(a.los),d=b.length;y=u=x=w=0;q=!1;for(var c=0;c<d;c++)!0===a.los[b[c]].shown&&(w+=1,x+=a.los[b[c]].nshown),!0===a.los[b[c]].succesfully_consumed&&(u+=1,y+=a.los[b[c]].nsuccess),!0===a.los[b[c]].can_be_shown&&(q=!0);b=0;d="incompleted";switch(a.game_settings.completion_status){case "all_los":a.game_settings.completion_status_n=
100;case "percentage_los":c=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100;b=0>=c||0>=v?1:w/v/c;break;case "n_los":c=Math.min(a.game_settings.completion_status_n,v);b=0===c?1:w/c;break;case "n_times":b=0>=a.game_settings.completion_status_n?1:x/a.game_settings.completion_status_n;break;case "onstart":b=1}b=Math.max(Math.min(1,+b.toFixed(2)),0);d=1===b?"completed":"incompleted";c=0;switch(a.game_settings.success_status){case "all_los":a.game_settings.success_status_n=100;case "percentage_los":c=
Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;c=0>=c||0>=v?1:u/v/c;break;case "n_los":c=Math.min(a.game_settings.success_status_n,v);c=0===c?1:w/c;break;case "n_times":c=0>=a.game_settings.success_status_n?1:y/a.game_settings.success_status_n;break;case "oncompletion":c=b;break;case "onstart":c=1}c=Math.max(Math.min(1,+c.toFixed(2)),0);m={progress_measure:b,completion_status:d,score:c,success_status:1===c?"passed":"failed"};SGAME.Messenger.sendMessage({key:"tracking",value:m})},J=
function(a){!0!==K()?"function"===typeof a&&a(!1):O(a)},K=function(){if(!0===p)return!1;switch(a.game_settings.completion_notification){case "no_more_los":return!1===q;case "all_los_consumed":return w>=v;case "all_los_succesfully_consumed":return u>=v;case "completion_status":return"completed"===m.completion_status;case "success_status":return"passed"===m.success_status;case "never":return!1;default:return!1}},O=function(a){p=!0;SGAME.Fancybox.create({dialog:!0,msg:l},function(){"function"===typeof a&&
a(!0)})},H=function(a){for(var b=[],c,d=0;d<a.length;d++)"undefined"===typeof c&&(c=a[d].nshown),a[d].nshown<c&&(c=a[d].nshown,b=[]),c===a[d].nshown&&b.push(a[d]);return SGAME.Utils.getRandomElement(b)},I=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:L(a),more_los:q}},L=function(b){var d;t&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?d=a.game_settings.behaviour_when_no_more_los:
"undefined"!==typeof c.behaviour_when_no_more_los?d=c.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&(d=a.game_settings.behaviour_when_no_more_los);return P(d,b)},P=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var d=M(b);return"undefined"!==typeof d&&"damage"===d.type?!1:!0;case "failure_unless_blocking":return d=M(b),"undefined"===typeof d||"blocking"!==d.type?!1:!0;default:return!1}},M=function(b){return"undefined"!==
typeof a.events[b]?a.events[b]:"object"===typeof c.events&&"undefined"!==typeof c.events[b]?c.events[b]:{}};SGAME.Debugger.init(!1);!1===t&&E({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(c=a)&&"function"===typeof a.togglePause&&(f=a.togglePause)},loadSettings:function(a){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(a);t=!0;E(a)},triggerLO:function(b,d){switch(a.sequencing.interruptions){case "no_restrictions":return D(b,
d);case "n_times":return x>=a.sequencing.interruptions_n?B(b,d):D(b,d);case "1_per_timeperiod":return"undefined"!==typeof A&&(new Date-A)/1E3<=a.sequencing.interruptions_n?B(b,d):D(b,d)}},showLO:C,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){C(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===q?!1:"undefined"===typeof a?q:0<G(F(a)).length},
successWhenNoLOs:function(a){return L(a)},onConnectedToVLE:function(){"onstart"===a.game_settings.completion_status&&(m.progress_measure=1,m.completion_status="completed");"onstart"===a.game_settings.success_status&&(m.score=1,m.success_status="passed");if("onstart"===a.game_settings.completion_status||"onstart"===a.game_settings.success_status)SGAME.Messenger.sendMessage({key:"tracking",value:m}),setTimeout(function(){!0===K()&&(z(),J(function(){z()}))},500)},getVLEData:function(){return r},setVLEData:function(a){return r=
a}}}();var API,API_1484_11;
SGAME.Fancybox=function(c){var f=c,g=c,l=c,a=function(){"undefined"!=typeof f&&(f.style.display="none",f.parentNode.removeChild(f),"lo"===g&&(API_1484_11=API=c),g=f=c)},t=function(){if("undefined"!=typeof f){var r=g;a();var m;m="lo"===r?SGAME.Observer.stop():!0;var s=l;l=c;setTimeout(function(){"function"===typeof s&&s(m)},50)}};return{init:function(){},create:function(r,m){a();l=m;var s="undefined"!==typeof r&&!0===r.dialog?"dialog":"lo",e=4/3,b,k,d=0.9*window.innerWidth,h=0.9*window.innerHeight;
h*e>d?(b=d,k=b/e):(k=h,b=k*e);if("lo"===s)var n={},q;else var v="";r&&(r.width&&(b=r.width),r.height&&(k=r.height),"lo"===s?r.lo&&(n=r.lo,"string"===typeof n.url&&(q=n.url)):"string"==typeof r.msg&&(v=r.msg));if("lo"===s){if("string"!=typeof q||"undefined"==typeof n.scorm_type)return;var w=c,e=API_1484_11=API=c,x=SGAME.CORE.getVLEData();"object"===typeof x.user&&(e=x.user);"sco"===n.scorm_type&&("1.2"===n.scorm_version?w=API=new Local_API_SCORM_12({user:e,debug:SGAME.Debugger.isDebugging()}):"2004"===
n.scorm_version&&(w=API_1484_11=new Local_API_1484_11({user:e,debug:SGAME.Debugger.isDebugging()})))}e=document.createElement("div");e.style.width=b+"px";e.style.height=k+"px";e.style.maxWidth=d+"px";e.style.maxHeight=h+"px";e.style.overflow="lo"===s?"hidden":"auto";e.style.background="white";e.style.position="absolute";e.style.top=0;e.style.zIndex=9999;e.style.borderRadius="1em";e.style.border="2px solid black";e.setAttribute("id","sgame_fancybox");e.style.marginLeft=(window.innerWidth-b)/2+"px";
e.style.marginTop=(window.innerHeight-k)/2+"px";h=document.createElement("img");h.src="/assets/sgame/close.png";d=Math.max(25,Math.floor(0.05*k));h.style.width=d+"px";h.style.height=d+"px";h.style.padding="5px";h.style.cursor="pointer";h.style.position="absolute";h.style.right=0;h.onclick=function(){t()};e.appendChild(h);if("lo"===s){var u=document.createElement("img");u.id="trafficLight";u.src="/assets/sgame/trafficLight/trafficLight_red.png";v=Math.max(40,Math.floor(0.085*k));h=Math.max(30,Math.floor(0.75*
v));u.style.height=v+"px";u.style.width=h+"px";u.style.padding="4px";u.style.position="absolute";u.style.left="0px";u.style.top="0px";u.style.background="#fff";u.style.borderRadius="0px 0px 20px 0px";u.style.borderRight="2px solid black";u.style.borderBottom="2px solid black";e.appendChild(u);u=document.createElement("iframe");u.src=q;q=Math.ceil(Math.max(d,v))+4;v=Math.floor(0.02*k);d=Math.floor(0.02*b);u.style.marginLeft=d+"px";u.style.marginTop=q+"px";u.style.width=Math.max(0,b-d-d)+"px";u.style.height=
Math.max(0,k-q-v)+"px";u.style.overflow="auto";u.scrolling="yes";u.style.frameBorder="0";u.style.borderStyle="none";u.setAttribute("allowfullscreen","false");e.appendChild(u)}else b=document.createElement("p"),b.id="dialog",b.innerHTML=v,b.style.padding="15px",b.style.marginTop="30px",b.style.marginBottom="20px",b.style.marginRight="20px",b.style.marginLeft="20px",b.style.textAlign="center",b.style.fontSize="24px",b.style.position="relative",b.style.cursor="default",b.style.color="#000",b.style.fontFamily=
"initial",e.appendChild(b);f=e;g=s;document.body.appendChild(e);"lo"===s&&SGAME.Observer.start(u,n,w)},closeCurrentFancybox:t}}();SGAME.Observer=function(c){var f=!0,g=c,l=c,a=c,t,r,m,s,e,b,k=function(){a=l=g=c;t=Date.now();r=!1;b=e=s=m=c},d=function(){!1===l.acts_as_asset&&"undefined"!==typeof a&&(a.addListener("cmi.success_status",function(a){m=a;"passed"===m&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),a.addListener("cmi.score.scaled",function(a){s=a;0.8<=s&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
a.addListener("cmi.completion_status",function(a){e=a}),a.addListener("cmi.progress_measure",function(a){b=a}))};return{start:function(b,c,e){if(!1===f||"undefined"!=typeof g)return null;f=!1;k();g=b;l=c;a=e;d();SGAME.TrafficLight.changeColor("red");if(!0===l.acts_as_asset){b:{b=l.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration)))break b;b=null}b=!b||0>=b?15:Math.min(0.5*
b,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===f||"undefined"==typeof g)return null;f=!0;SGAME.TrafficLight.stop();var a=Math.round((Date.now()-t)/1E3);r="green"===SGAME.TrafficLight.getCurrentColor();a={lo_metadata:l,time:a,success:r};"undefined"!=typeof m&&(a.scorm_success_status=m);"undefined"!=typeof s&&(a.scorm_scaled_score=s);"undefined"!=typeof e&&(a.scorm_completion_status=e);"undefined"!=typeof b&&(a.scorm_progress_measure=
b);k();return a},isStopped:function(){return f}}}();SGAME.TrafficLight=function(c){var f,g,l,a,t,r=function(a){var b=document.getElementById("trafficLight");b&&(f=a,b.src=m(a))},m=function(a){switch(a){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},s=function(c,b){var f=document.getElementById("trafficLight");if(f){var d=!1;a=
setInterval(function(){f&&(d?(f.src=m(null),d=!1):(f.src=m(c),d=!0))},500);t=setTimeout(function(){clearTimeout(a)},1E3*b)}};return{getCurrentColor:function(){return f},changeColor:function(a,b){b?g=setTimeout(function(){r(a)},1E3*b):r(a)},setUpBlink:function(a,b,c){c?l=setTimeout(function(){s(a,b)},1E3*c):s(a,b)},stop:function(){g&&clearTimeout(g);l&&clearTimeout(l);a&&clearTimeout(a);t&&clearTimeout(t)}}}();SGAME.Utils=function(){var c=void 0;return{init:function(c){},getRandomElement:function(c){if("number"==typeof c)return c;var g;g=c.length-1;if("number"!=typeof g)throw{name:"Invalid number format exception"};g=Math.round(0+Math.random()*(g-0));return c[g]},loadScript:function(c,g){if("string"===typeof c&&"function"===typeof g){var l=document.getElementsByTagName("head")[0];if(l){var a=document.createElement("script");a.setAttribute("src",c);a.setAttribute("type","text/javascript");a.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||g()};a.onload=g;l.appendChild(a)}}},getProtocol:function(){if("undefined"!==typeof c)return c;var f;try{f=document.location.protocol}catch(g){}"string"===typeof f&&(f=f.match(/[\w]+/),f=f instanceof Array&&"string"===typeof f[0]?f[0]:void 0);return c="string"===typeof f?f:"unknown"},checkUrlProtocol:function(c){if("string"===typeof c){var g=c.match(/^https?:\/\//);if(g instanceof Array&&1===g.length){var g=g[0].replace("://",""),l=
SGAME.Utils.getProtocol();if(g!==l)switch(l){case "https":c="https"+c.replace(g,"")}}}return c}}}();
