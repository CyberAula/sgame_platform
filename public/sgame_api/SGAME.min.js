iso8601Parser=function(b){return{getDuration:function(e){var b=[31104E3,2592E3,604800,86400,3600,60,1];try{var p;var a=e;e=[2,3,4,5,7,8,9];var t=[0,0,0,0,0,0,0],r;if(a=a.toUpperCase()){if("string"!==typeof a)throw Error("Invalid iso8601 period string '"+a+"'");if(r=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(a))for(a=0;a<e.length;a++){var q=e[a];t[a]=r[q]?+r[q].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+a+"' is not a valid ISO8601 period.");}p=t}catch(s){return null}for(q=
r=0;q<p.length;q++)r+=p[q]*b[q];return r}}}();function Local_API_1484_11(b){function e(a,c){d.diganostic="The "+a+" of "+c+" must be a proper vocabulary element.";d.errorCode=406;return"false"}function f(a){d.errorCode=402;d.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function p(a,c){d.errorCode=201;d.diagnostic="The value for key "+a+" is not valid.";return"false"}function a(c,l,d){c=c.split(/\./);2>c.length?d[c[0]]=l:(d[c[0]]||(d[c[0]]={}),d=d[c.shift()],a(c.join("."),l,d))}function t(a,c){var l=a.split(/\./),
d;if(2>l.length)try{return c[l[0]]}catch(g){return f(a),"false"}else{d=l.shift();if(c[d])return String(t(l.join("."),c[d]));f(a);return"false"}}function r(a){var c,l=0;for(c in a)a.hasOwnProperty(c)&&(l+=1);return l}function q(a,c){if(d.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(c){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);
break;case 3:console.log(a);break;default:return console.log(a),!1}return!0}3>c&&d.throw_alerts&&alert(a);return!1}function s(a,c){if("function"==typeof d.listeners[a]&&"undefined"!=typeof c)d.listeners[a](c)}function h(a,c){for(var l in c)c.hasOwnProperty(l)&&("object"==typeof a[l]?"object"==typeof c[l]&&(a[l]=h(a[l],c[l])):a[l]=c[l]);return a}function c(a,c){(function(){function a(c,l){l=l||{bubbles:!1,cancelable:!1,detail:void 0};var v=document.createEvent("CustomEvent");v.initCustomEvent(c,l.bubbles,
l.cancelable,l.detail);return v}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:c}))}function m(a){return"object"!==type(a)||a.nodeType||isWindow(a)?!1:!(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))}var d=h({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},b),g={},l={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},n=this;"object"===typeof d.user&&("string"===typeof d.user.name&&(d.CMI.learner_name=d.user.name),"string"===typeof d.user.id&&(d.CMI.learner_id=d.user.id));this.isRunning=function(){return 1===d.initialized&&0===d.terminated};this.Initialize=function(){q(d.prefix+
":  Initializing...",3);d.cmi?(g=d.cmi,"suspend"===g.exit&&(g.entry="resume")):g=d.CMI;d.initialized=1;d.terminated=0;return"true"};this.GetValue=function(a){d.errorCode=0;var c="false";a=a.toString();var l=[];if(this.isRunning()){l=a.split(".");if(0<="|exit|session_time|".indexOf("|"+l[l.length-1]+"|"))return q(d.prefix+": This "+a+" is write only",4),d.errorCode=405,"false";l=a.toLowerCase().split(".");switch(l[0]){case "cmi":switch(c="false",a){case "cmi.exit":case "cmi.session_time":d.errorCode=
405;d.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;case "cmi.learner_name":c=d.CMI.learner_name;break;default:c=t(a.substr(4,a.length),g),"undefined"===c&&(d.errorCode=401,d.diagnostic="Sorry, there was a undefined response from "+a,c="false"),q(d.prefix+": GetValue "+a+" = "+c,4)}}return c}d.errorCode=123;return c};this.SetValue=function(c,l){q(d.prefix+": SetValue: "+c+" = "+l,4);d.errorCode=0;var n=[],h=c.toString(),k=l.toString(),b=0,f=0,b=[];if(this.isRunning()){b=
h.split(".");if("adl"===b[0]&&"id"===b[4]||"comments_from_lms"===b[1]||("comments_from_learner"===b[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+b[b.length-1]+"|")))return q(d.prefix+": This "+h+" is read only",4),d.errorCode=404,"false";n=h.split(".");switch(n[0]){case "cmi":switch(c){case "cmi.location":1E3<k.length&&q(d.prefix+": Some LMS's might truncate your bookmark as you've passed "+
k.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":b=parseFloat(k);if("number"!=typeof b||isNaN(b))return p(c,k);b=Math.max(0,Math.min(1,b));s(c,b);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+k+"|"))return e(c,k);s(c,k);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+k+"|"))return e(c,k);break;case "cmi.score.scaled":b=parseFloat(k);if("number"!=typeof b||isNaN(b))return p(c,k);b=Math.max(0,
Math.min(1,b));s(c,b);break;case "cmi.score.min":b=parseFloat(k);if("number"!=typeof b||isNaN(b))return p(c,k);d.CMI.score.min=b;break;case "cmi.score.max":b=parseFloat(k);if("number"!=typeof b||isNaN(b))return p(c,k);d.CMI.score.max=b;break;case "cmi.score.raw":b=parseFloat(k);if("number"!=typeof b||isNaN(b))return p(c,k);f=parseFloat(d.CMI.score.max);f="number"!=typeof f||isNaN(f)?100:f;n=parseFloat(d.CMI.score.min);n="number"!=typeof n||isNaN(n)?0:n;f-=n;0>=f&&(f=100);b=Math.max(0,Math.min(1,(b-
n)/f));s("cmi.score.scaled",b);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+k+"|"))return e(c,k);s(c,k);break;default:switch(n[1]){case "comments_from_lms":return d.errorCode="404",d.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===g.comments_from_learner._children.indexOf(n[3]))return e(c,k);a(h.substr(4,h.length),k,g);g.comments_from_learner._count=(r(g.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===g.interactions._children.indexOf(n[3]))return e(c,k);g.interactions._count=(r(g.interactions)-2).toString();if(isNaN(parseInt(n[2],10)))return"false";if(!m(g.interactions[n[2]])){if("id"===n[3])return g.interactions[n[2]]={},a(h.substr(4,h.length),k,g),g.interactions._count=(r(g.interactions)-2).toString(),m(g.interactions[n[2]].objectives)||(q(d.prefix+": Constructing objectives object for new interaction",4),g.interactions[n[2]].objectives={},g.interactions[n[2]].objectives._count=
"-1"),m(g.interactions[n[2]].correct_responses)||(q(d.prefix+": Constructing correct responses object for new interaction",4),g.interactions[n[2]].correct_responses={},g.interactions[n[2]].correct_responses._count="-1"),"true";q("Can't add interaction without ID first!",3);return"false"}if("objectives"===n[3]){if("id"===n[5])for(f=parseInt(g.interactions[n[2]].objectives._count,10),b=0;b<f;b+=1){if(g.interactions[n[2]].objectives[b].id===k)return h=c,d.errorCode="351",d.diagnostic="The "+h+" element must be unique.  The value '"+
k+"' has already been set in #"+b,"false"}else return e(c,k);a(h.substr(4,h.length),k,g);g.interactions[n[2]].objectives._count=(r(g.interactions[n[2]].objectives)-1).toString();return"true"}"correct_responses"===n[3]&&(a(h.substr(4,h.length),k,g),g.interactions[n[2]].correct_responses._count=(r(g.interactions[n[2]].correct_responses)-1).toString());a(h.substr(4,h.length),k,g);g.interactions._count=(r(g.interactions)-2).toString();return"true";case "objectives":if("id"===n[3])for(f=parseInt(g.objectives._count,
10),b=0;b<f;b+=1)if(g.objectives[b].id===k)return d.errorCode="351",d.diagnostic="The objectives.id element must be unique.  The value '"+k+"' has already been set in objective #"+b,"false";if("id"!==n[3]&&(b=parseInt(n[2],10),void 0===g.objectives[b]))return d.errorCode="408",d.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(n[2],10)))return"false";a(h.substr(4,h.length),k,g);g.objectives._count=(r(g.objectives)-2).toString();return"true"}}a(h.substr(4,
h.length),k,g)}return"true"}d.errorCode=d.terminated?133:132;return"false"};this.Commit=function(){q(d.prefix+": Commit CMI Object:",4);q(g);q(d.prefix+": Suspend Data Usage "+(Math.round(100*(g.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));c("StoreData",{runtimedata:g});return"true"};this.Terminate=function(){n.Commit();d.terminated=1;d.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==l[a])?l[a]:""};this.GetLastError=function(){return d.errorCode};
this.GetDiagnostic=function(){return d.diagnostic};this.setCMILMSValue=function(a,c){"string"==typeof a&&(d.CMI[a]=c)};this.addListener=function(a,c){"string"==typeof a&&"function"==typeof c&&(d.listeners[a]=c)}};function Local_API_SCORM_12(b){function e(a,d){c.diganostic="The "+a+" of "+d+" must be a proper vocabulary element.";c.errorCode=406;return"false"}function f(a){c.errorCode=402;c.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function p(a,d){c.errorCode=201;c.diagnostic="The value for key "+a+" is not valid.";return"false"}function a(c,d,g){c=c.split(/\./);2>c.length?g[c[0]]=d:(g[c[0]]||(g[c[0]]={}),g=g[c.shift()],a(c.join("."),d,g))}function t(a,c){var d=a.split(/\./),
g;if(2>d.length)try{return c[d[0]]}catch(b){return f(a),"false"}else{g=d.shift();if(c[g])return String(t(d.join("."),c[g]));f(a);return"false"}}function r(a,d){if(c.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(d){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>d&&c.throw_alerts&&alert(a);return!1}function q(a,d){if("function"==typeof c.listeners[a]&&"undefined"!=typeof d)c.listeners[a](d)}function s(a,c){for(var d in c)c.hasOwnProperty(d)&&("object"==typeof a[d]?"object"==typeof c[d]&&(a[d]=s(a[d],c[d])):a[d]=c[d]);return a}function h(a,c){(function(){function a(c,d){d=d||{bubbles:!1,cancelable:!1,detail:void 0};var g=document.createEvent("CustomEvent");g.initCustomEvent(c,d.bubbles,d.cancelable,d.detail);return g}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:c}))}var c=s({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},b),m={},d={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},g=this;"object"===typeof c.user&&("string"===typeof c.user.name&&(c.CMI.core.student_name=c.user.name),"string"===typeof c.user.id&&(c.CMI.core.student_id=c.user.id));this.isRunning=function(){return 1===c.initialized&&0===c.terminated};this.LMSInitialize=function(){r(c.prefix+":  Initializing...",3);m=c.CMI;c.initialized=1;c.terminated=
0;return"true"};this.LMSGetValue=function(a){c.errorCode=0;var d="false";a=a.toString();var g=[];if(this.isRunning()){g=a.split(".");if(0<="|exit|session_time|".indexOf("|"+g[g.length-1]+"|"))return c.errorCode=405,"false";g=a.toLowerCase().split(".");switch(g[0]){case "cmi":d=a;a="false";switch(d){case "cmi.core.exit":case "cmi.core.session_time":c.errorCode=405;c.diagnostic="Sorry, this has been specified as a read-only value for "+d;break;default:d=d.replace("cmi.",""),a=t(d,m),"undefined"===a&&
(c.errorCode=401,c.diagnostic="Sorry, there was a undefined response from "+d,a="false")}d=a}return d}c.errorCode=123;return d};this.LMSSetValue=function(d,g){r(c.prefix+": SetValue: "+d+" = "+g,4);c.errorCode=0;var b=[],h=d.toString(),f=g.toString();if(this.isRunning()){var b=h.split("."),s=b[b.length-1],b="adl"===b[0]&&"id"===b[4]?!0:"comments_from_lms"===b[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
s+"|");if(b)return c.errorCode=404,"false";b=h.split(".");switch(b[0]){case "cmi":switch(d){case "cmi.core.lesson_location":1E3<f.length&&r(c.prefix+": Some LMS's might truncate your bookmark as you've passed "+f.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+f+"|"))return e(d,f);q(d,f);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+f+"|"))return e(d,
f);break;case "cmi.core.score.min":b=parseFloat(f);if("number"!=typeof b||isNaN(b))return p(d,f);c.CMI.core.score.min=b;break;case "cmi.core.score.max":b=parseFloat(f);if("number"!=typeof b||isNaN(b))return p(d,f);c.CMI.core.score.max=b;break;case "cmi.core.score.raw":b=parseFloat(f);if("number"!=typeof b||isNaN(b))return p(d,f);var k=parseFloat(c.CMI.core.score.max),k="number"!=typeof k||isNaN(k)?100:k,s=parseFloat(c.CMI.core.score.min),s="number"!=typeof s||isNaN(s)?0:s,k=k-s;0>=k&&(k=100);b=Math.max(0,
Math.min(1,(b-s)/k));q("cmi.score.scaled",b)}h=h.replace("cmi.","");a(h,f,m)}return"true"}c.errorCode=c.terminated?133:132;return"false"};this.LMSCommit=function(){h("StoreData",{runtimedata:m});return"true"};this.LMSTerminate=function(){g.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSFinish=function(){g.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==d[a])?d[a]:""};this.LMSGetLastError=function(){return c.errorCode};
this.LMSGetDiagnostic=function(){return c.diagnostic};this.setCMILMSValue=function(a,d){"string"==typeof a&&(c.CMI[a]=d)};this.addListener=function(a,d){"string"==typeof a&&"function"==typeof d&&(c.listeners[a]=d)}};SGAME=function(){return{init:function(b){return SGAME.CORE.init(b)},loadSettings:function(b){return SGAME.CORE.loadSettings(b)},triggerLO:function(b,e){return SGAME.CORE.triggerLO(b,e)},showLO:function(b,e){return SGAME.CORE.showLO(b,e)},showRandomLO:function(b){return SGAME.CORE.showRandomLO(b)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(b){return SGAME.CORE.losCanBeShown(b)},successWhenNoLOs:function(b){return SGAME.CORE.successWhenNoLOs(b)}}}();
SGAME.VERSION="1.0.0";SGAME.AUTHORS="Aldo Gordillo";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var b=!1;return{init:function(e){!0===e&&(b=e)},isDebugging:function(){return b},log:function(e){b&&window.console&&console.log(e)}}}();SGAME.Messenger=function(){function b(c,b){this.data=c||{};-1!==["PROTOCOL","APP"].indexOf(b)?this.type=b:this.type="APP";this.origin=p;this.destination=a}var e=["PROTOCOL","APP"],f=["SGAME_GATEWAY","SGAME_API"],p="SGAME_API",a="SGAME_GATEWAY",t=!1,r=!1,q=function(a){try{window.parent.parent.postMessage(a,"*")}catch(b){}},s=function(a){var b;b="object"!==typeof a||"string"!==typeof a.data?!1:h(a.data);if(b)switch(a=JSON.parse(a.data),a.type){case "PROTOCOL":if(a.data)switch(a.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
a.origin&&!0!==r&&(r=!0,a.data.settings=SGAME.CORE.getSettings(),a.destination=a.origin,a.origin=p,q(JSON.stringify(a)),SGAME.CORE.onConnectedToVLE())}break;case "APP":if(a.data&&"string"===typeof a.data.key)switch(a.data.key){case "lms_data":if("object"===typeof a.data.value){b=a.data.value;a={};if("string"===typeof b.name||"number"===typeof b.name)a.name=""+b.name;if("string"===typeof b.id||"number"===typeof b.id)a.id=""+b.id;b=SGAME.CORE.getVLEData();b.user=a;SGAME.CORE.setVLEData(b)}}}},h=function(a){try{if(a=
JSON.parse(a),-1===e.indexOf(a.type)||-1===f.indexOf(a.origin))return!1}catch(b){return!1}return!0};return{init:function(a){if(!t){t=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",s,!1):window.attachEvent&&window.parent.attachEvent("message",s)}catch(b){}}},isConnected:function(){return r},sendMessage:function(a){t&&r&&(a=JSON.stringify(new b(a,void 0)),h(a)&&q(a))}}}();var API,API_1484_11;
SGAME.Fancybox=function(b){var e=b,f=b,p=b,a,t=function(){"undefined"!=typeof e&&(e.style.display="none",e.parentNode.removeChild(e),"lo"===f&&(API_1484_11=API=b),f=e=b)},r=function(){if("undefined"!=typeof e){var a=f;t();var r;r="lo"===a?SGAME.Observer.stop():!0;var h=p;p=b;setTimeout(function(){"function"===typeof h&&h(r)},50)}};return{init:function(b){"string"===typeof b&&(a=b)},create:function(q,s){t();p=s;var h="undefined"!==typeof q&&!0===q.dialog?"dialog":"lo",c=4/3,m,d,g=0.9*window.innerWidth,
l=0.9*window.innerHeight;l*c>g?(m=g,d=m/c):(d=l,m=d*c);if("lo"===h)var n={},v;else var u="";q&&(q.width&&(m=q.width),q.height&&(d=q.height),"lo"===h?q.lo&&(n=q.lo,"string"===typeof n.url&&(v=n.url)):"string"==typeof q.msg&&(u=q.msg));if("lo"===h){if("string"!=typeof v||"undefined"==typeof n.scorm_type)return;var w=b,c=API_1484_11=API=b,x=SGAME.CORE.getVLEData();"object"===typeof x.user&&(c=x.user);"sco"===n.scorm_type&&("1.2"===n.scorm_version?w=API=new Local_API_SCORM_12({user:c,debug:SGAME.Debugger.isDebugging()}):
"2004"===n.scorm_version&&(w=API_1484_11=new Local_API_1484_11({user:c,debug:SGAME.Debugger.isDebugging()})))}c=document.createElement("div");c.style.width=m+"px";c.style.height=d+"px";c.style.maxWidth=g+"px";c.style.maxHeight=l+"px";c.style.overflow="lo"===h?"hidden":"auto";c.style.background="white";c.style.position="absolute";c.style.top=0;c.style.zIndex=9999;c.style.borderRadius="1em";c.style.border="2px solid black";c.setAttribute("id","sgame_fancybox");c.style.marginLeft=(window.innerWidth-
m)/2+"px";c.style.marginTop=(window.innerHeight-d)/2+"px";l=document.createElement("img");l.src=a+"close.png";g=Math.max(25,Math.floor(0.05*d));l.style.width=g+"px";l.style.height=g+"px";l.style.padding="5px";l.style.cursor="pointer";l.style.position="absolute";l.style.right=0;l.onclick=function(){r()};c.appendChild(l);if("lo"===h){var k=document.createElement("img");k.id="trafficLight";k.src=a+"trafficLight/trafficLight_red.png";u=Math.max(40,Math.floor(0.085*d));l=Math.max(30,Math.floor(0.75*u));
k.style.height=u+"px";k.style.width=l+"px";k.style.padding="4px";k.style.position="absolute";k.style.left="0px";k.style.top="0px";k.style.background="#fff";k.style.borderRadius="0px 0px 20px 0px";k.style.borderRight="2px solid black";k.style.borderBottom="2px solid black";c.appendChild(k);k=document.createElement("iframe");k.src=v;v=Math.ceil(Math.max(g,u))+4;u=Math.floor(0.02*d);g=Math.floor(0.02*m);k.style.marginLeft=g+"px";k.style.marginTop=v+"px";k.style.width=Math.max(0,m-g-g)+"px";k.style.height=
Math.max(0,d-v-u)+"px";k.style.overflow="auto";k.scrolling="yes";k.style.frameBorder="0";k.style.borderStyle="none";k.setAttribute("allowfullscreen","false");c.appendChild(k)}else m=document.createElement("p"),m.id="dialog",m.innerHTML=u,m.style.padding="15px",m.style.marginTop="30px",m.style.marginBottom="20px",m.style.marginRight="20px",m.style.marginLeft="20px",m.style.textAlign="center",m.style.fontSize="24px",m.style.position="relative",m.style.cursor="default",m.style.color="#000",m.style.fontFamily=
"initial",c.appendChild(m);e=c;f=h;document.body.appendChild(c);"lo"===h&&SGAME.Observer.start(k,n,w)},closeCurrentFancybox:r}}();SGAME.TrafficLight=function(b){var e,f,p,a,t,r,q=function(a){var b=document.getElementById("trafficLight");b&&(e=a,b.src=s(a))},s=function(a){switch(a){case "green":return r+"trafficLight/trafficLight_green.png";case "yellow":return r+"trafficLight/trafficLight_yellow.png";case "red":return r+"trafficLight/trafficLight_red.png";default:return r+"trafficLight/trafficLight.png"}},h=function(c,b){var d=document.getElementById("trafficLight");if(d){var g=!1;a=setInterval(function(){d&&(g?(d.src=s(null),
g=!1):(d.src=s(c),g=!0))},500);t=setTimeout(function(){clearTimeout(a)},1E3*b)}};return{init:function(a){"string"===typeof a&&(r=a)},getCurrentColor:function(){return e},changeColor:function(a,b){b?f=setTimeout(function(){q(a)},1E3*b):q(a)},setUpBlink:function(a,b,d){d?p=setTimeout(function(){h(a,b)},1E3*d):h(a,b)},stop:function(){f&&clearTimeout(f);p&&clearTimeout(p);a&&clearTimeout(a);t&&clearTimeout(t)}}}();SGAME.Sequencing=function(){var b,e=["completion","success"],f=function(a){for(var b=Object.keys(a),e=b.length,h=0;h<e;h++){var c=p(a[b[h]],b);!1!==c?a[b[h]]=c:delete a[b[h]]}return Object.keys(a).length===e?a:f(a)},p=function(a,b){if("undefined"===typeof a.conditions)return a;if("object"!==typeof a.conditions)return!1;if(0===a.conditions.length)return delete a.conditions,a;for(var f=[],h=0;h<a.conditions.length;h++){var c=a.conditions[h];-1!==b.indexOf(c.group+"")&&-1!==e.indexOf(c.requirement)&&
f.push(c)}a.conditions=f;return 0===a.conditions.length?!1:a},a=function(a,f){for(var e=Object.keys(f),h=0,c=0;c<e.length;c++){var m=f[e[c]];if(!1===m.can_be_shown&&m.id!=a.id&&"undefined"!==typeof m.conditions)for(var d=0;d<m.conditions.length;d++)if(m.conditions[d].group==a.id){if(!1===m.conditions[d].met)return!1;h+=1}}if(0<h)return!0;switch(b){case "linear_completion":return a.shown;case "linear_success":return a.succesfully_consumed;default:return a.shown&&a.succesfully_consumed}},t=function(a,
b,f){for(var h=0;h<a.los.length;h++)b[a.los[h]].can_be_shown=f;return b};return{init:function(a){b=a.approach},validateSequence:function(a,b){if("object"!==typeof a||"object"!==typeof b)return!1;for(var e=Object.keys(a),h=Object.keys(b),c=0;c<e.length;c++){var m;m=a[e[c]];for(var d=h,g=[],l=0;l<m.los.length;l++){var n=m.los[l];-1!==d.indexOf(n)&&g.push(n)}m.los=g;m=1>m.los.length?!1:m;!1!==m?a[e[c]]=m:delete a[e[c]]}a=f(a);e=Object.keys(a);h=[];for(c=0;c<e.length;c++)for(m=a[e[c]],d=0;d<m.los.length;d++)-1===
h.indexOf(m.los[d])&&h.push(m.los[d]);return 2>typeof e.length||2>h.length?!1:a},updateGroupsTracking:function(b,e,f){for(var h=0;h<b.groups.length;h++){var c=e,m=b.groups[h]+"",d;d=e[b.groups[h]+""];if(!0!==(d.shown&&d.succesfully_consumed)){for(var g=!0,l=!0,n=0;n<d.los.length;n++)var p=f[d.los[n]],g=g&&!0===p.shown,l=l&&!0===p.succesfully_consumed;d.shown=g;d.succesfully_consumed=l}c[m]=d}h=0;c=Object.keys(e);for(m=0;m<c.length;m++)if(l=e[c[m]],!1===l.can_be_shown&&(h+=1,!1===l.shown&&!1===l.succesfully_consumed)){d=
e;g=c[m];n=e;if("undefined"!==typeof l.conditions){for(var p=!0,u=0;u<l.conditions.length;u++)if(!1===l.conditions[u].met){switch(l.conditions[u].requirement){case "completion":l.conditions[u].met=!0===n[l.conditions[u].group+""].shown;break;case "success":l.conditions[u].met=!0===n[l.conditions[u].group+""].succesfully_consumed}p=p&&l.conditions[u].met;if(!1===p)break}l.can_be_shown=p}d[g]=l;!0===e[c[m]].can_be_shown&&(f=t(e[c[m]],f,!0),h-=1)}for(m=0;m<b.groups.length;m++)l=e[b.groups[m]+""],!0===
l.can_be_shown&&(d=e,g=b.groups[m]+"",n=a(l,e),l.can_be_shown=!1===n,d[g]=l,!1===e[b.groups[m]+""].can_be_shown&&(f=t(e[b.groups[m]+""],f,!1),h+=1));if(b=h===c.length)for(h=Object.keys(f),c=0;c<h.length;c++)if("undefined"===typeof f[h[c]].groups||0===f[h[c]].groups.length)f[h[c]].can_be_shown=!0;return{groups:e,los:f,finished:b}}}}();SGAME.API=function(){var b=function(b,f){var p=new XMLHttpRequest;p.onreadystatechange=function(){if(4==p.readyState&&200==p.status){var a=JSON.parse(p.responseText);f(a)}};p.open("GET",b,!0);p.send("")};return{init:function(){},requestLOMetadata:function(e,f,p){try{b("undefined"==typeof e?"/lo/random/metadata.json":"/lo/"+e+"/metadata.json",function(a){f(a)})}catch(a){p(a)}}}}();SGAME.CORE=function(){var b={},e=void 0,f=!1,p="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},t=!1,r={},q={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},s=["repeat","repeat_unless_successfully_consumed","no_repeat"],h=["no_restrictions","n_times","1_per_timeperiod"],c=["random","linear_completion","linear_success","custom"],m="all_los percentage_los n_los n_times disabled onstart".split(" "),
d="all_los percentage_los n_los n_times disabled onstart oncompletion".split(" "),g="no_more_los all_los_consumed all_los_succesfully_consumed completion_status success_status never".split(" "),l=["success","failure","success_unless_damage","failure_unless_blocking"],n=!1,v=0,u=0,w=0,x=0,k=0,D=!1,z=void 0,E=function(b){a=b;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&
(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===s.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===h.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1===c.indexOf(a.sequencing.approach)&&(a.sequencing.approach="random");-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||delete a.sequencing.interruptions_n;-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&
"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===m.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&
"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);-1===d.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==
typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===g.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===l.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&(p=a.game_settings.completion_notification_text);if("object"===typeof a.los){b=
Object.keys(a.los);v=b.length;for(var e=0;e<v;e++)"undefined"!==typeof a.los[b[e]].url&&(a.los[b[e]].url=SGAME.Utils.checkUrlProtocol(a.los[b[e]].url)),a.los[b[e]].can_be_shown=!0,a.los[b[e]].shown=!1,a.los[b[e]].nshown=0,a.los[b[e]].succesfully_consumed=!1,a.los[b[e]].nsuccess=0,a.los[b[e]].acts_as_asset="asset"===a.los[b[e]].scorm_type||"sco"===a.los[b[e]].scorm_type&&!1===a.los[b[e]].report_data,n=!0}"random"!==a.sequencing.approach&&(b=SGAME.Sequencing.validateSequence(a.sequencing.sequence,a.los),
!1===b?a.sequencing.approach="random":a.sequencing.sequence=b);"random"===a.sequencing.approach&&delete a.sequencing.sequence;if("object"===typeof a.sequencing.sequence){b=Object.keys(a.los);v=b.length;for(e=0;e<v;e++)a.los[b[e]].can_be_shown=!1,a.los[b[e]].groups=[];n=!1;b=Object.keys(a.sequencing.sequence);_nGroups=b.length;for(e=0;e<_nGroups;e++){var f=a.sequencing.sequence[b[e]];f.can_be_shown="undefined"===typeof f.conditions||0===f.conditions.length;f.shown=!1;f.succesfully_consumed=!1;if("undefined"!==
typeof f.conditions)for(var k=0;k<f.conditions.length;k++)f.conditions[k].met=!1;a.sequencing.sequence[b[e]]=f;for(k=0;k<f.los.length;k++)a.los[f.los[k]].groups.push(f.id),a.los[f.los[k]].can_be_shown=!0===f.can_be_shown,!0===a.los[f.los[k]].can_be_shown&&(n=!0)}}"string"!==typeof a.assets_path&&(a.assets_path="/assets/sgame/");SGAME.Fancybox.init(a.assets_path);SGAME.TrafficLight.init(a.assets_path);SGAME.Sequencing.init(a.sequencing)},C=function(b,c){var d=F(b);if(1>d.length)return A(b,c);var e=
G(d);if(0<e.length){d=void 0;switch(a.sequencing.approach){case "linear_completion":case "linear_success":case "custom":if(!1===f){for(var d=[],g=[],h=[],k=0;k<e.length;k++)h.push(e[k].id);for(var e=Object.keys(a.sequencing.sequence),l=0;l<e.length;l++){var m=a.sequencing.sequence[e[l]];if(!0===m.can_be_shown)for(k=0;k<m.los.length;k++)-1!==h.indexOf(m.los[k])&&-1===g.indexOf(m.los[k])&&(g.push(m.los[k]),d.push(a.los[m.los[k]]))}}else d=e;d=H(d);break;default:d=H(e)}selectedLO=d;B(selectedLO,c)}else"function"===
typeof c&&(d=I(b),c(d.success,d))},A=function(a,b){if("function"===typeof b){var c=I(a);b(c.success,c)}},F=function(b){var c=[];b=a.event_mapping[b];if("undefined"!==typeof b){var d=b.length;if("number"===typeof d)for(var e=0;e<d;e++){if("*"===b[e]){c=[];b=Object.keys(a.los);for(d=0;d<b.length;d++)"undefined"!==typeof a.los[b[d]]&&c.push(a.los[b[d]]);break}"undefined"!==typeof a.los[b[e]]&&c.push(a.los[b[e]])}}return c},G=function(a){for(var b=[],c=a.length,d=0;d<c;d++)!0===a[d].can_be_shown&&b.push(a[d]);
return b},B=function(b,c){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof c&&c(null,null):(z=new Date,y(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(d){!0!==a.los[b.id].succesfully_consumed&&(a.los[b.id].succesfully_consumed=d.success);!0===d.success&&(a.los[b.id].nsuccess+=1);if("random"!==a.sequencing.approach&&!1===f){var e=SGAME.Sequencing.updateGroupsTracking(a.los[b.id],a.sequencing.sequence,a.los);a.sequencing.sequence=e.groups;a.los=e.los;
e.finished&&(f=!0)}switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].succesfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}N();d.more_los=n;J(function(){"function"===typeof c&&c(d.success,d);y()})}))},y=function(){"function"===typeof e&&e()},N=function(){var b=Object.keys(a.los),c=b.length;k=x=w=u=0;n=!1;for(var d=0;d<c;d++)!0===a.los[b[d]].shown&&(u+=1,w+=a.los[b[d]].nshown),!0===a.los[b[d]].succesfully_consumed&&
(x+=1,k+=a.los[b[d]].nsuccess),!0===a.los[b[d]].can_be_shown&&(n=!0);b=0;c="incompleted";switch(a.game_settings.completion_status){case "all_los":a.game_settings.completion_status_n=100;case "percentage_los":d=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100;b=0>=d||0>=v?1:u/v/d;break;case "n_los":d=Math.min(a.game_settings.completion_status_n,v);b=0===d?1:u/d;break;case "n_times":b=0>=a.game_settings.completion_status_n?1:w/a.game_settings.completion_status_n;break;case "onstart":b=
1}b=Math.max(Math.min(1,+b.toFixed(2)),0);c=1===b?"completed":"incompleted";d=0;switch(a.game_settings.success_status){case "all_los":a.game_settings.success_status_n=100;case "percentage_los":d=Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;d=0>=d||0>=v?1:x/v/d;break;case "n_los":d=Math.min(a.game_settings.success_status_n,v);d=0===d?1:u/d;break;case "n_times":d=0>=a.game_settings.success_status_n?1:k/a.game_settings.success_status_n;break;case "oncompletion":d=b;break;case "onstart":d=
1}d=Math.max(Math.min(1,+d.toFixed(2)),0);q={progress_measure:b,completion_status:c,score:d,success_status:1===d?"passed":"failed"};SGAME.Messenger.sendMessage({key:"tracking",value:q})},J=function(a){!0!==K()?"function"===typeof a&&a(!1):O(a)},K=function(){if(!0===D)return!1;switch(a.game_settings.completion_notification){case "no_more_los":return!1===n;case "all_los_consumed":return u>=v;case "all_los_succesfully_consumed":return x>=v;case "completion_status":return"completed"===q.completion_status;
case "success_status":return"passed"===q.success_status;case "never":return!1;default:return!1}},O=function(a){D=!0;SGAME.Fancybox.create({dialog:!0,msg:p},function(){"function"===typeof a&&a(!0)})},H=function(a){for(var b=[],d,c=0;c<a.length;c++)"undefined"===typeof d&&(d=a[c].nshown),a[c].nshown<d&&(d=a[c].nshown,b=[]),d===a[c].nshown&&b.push(a[c]);return SGAME.Utils.getRandomElement(b)},I=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,
scorm_progress_measure:void 0,success:L(a),more_los:n}},L=function(d){var c;t&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof b.behaviour_when_no_more_los?c=b.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&(c=a.game_settings.behaviour_when_no_more_los);return P(c,d)},P=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=
M(b);return"undefined"!==typeof c&&"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=M(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},M=function(c){return"undefined"!==typeof a.events[c]?a.events[c]:"object"===typeof b.events&&"undefined"!==typeof b.events[c]?b.events[c]:{}};SGAME.Debugger.init(!1);!1===t&&E({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(b=a)&&"function"===typeof a.togglePause&&
(e=a.togglePause)},loadSettings:function(a){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(a);t=!0;E(a)},triggerLO:function(b,c){switch(a.sequencing.interruptions){case "no_restrictions":return C(b,c);case "n_times":return w>=a.sequencing.interruptions_n?A(b,c):C(b,c);case "1_per_timeperiod":return"undefined"!==typeof z&&(new Date-z)/1E3<=a.sequencing.interruptions_n?A(b,c):C(b,c)}},showLO:B,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){B(b,a)},function(){"function"===
typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===n?!1:"undefined"===typeof a?n:0<G(F(a)).length},successWhenNoLOs:function(a){return L(a)},onConnectedToVLE:function(){"onstart"===a.game_settings.completion_status&&(q.progress_measure=1,q.completion_status="completed");"onstart"===a.game_settings.success_status&&(q.score=1,q.success_status="passed");if("onstart"===a.game_settings.completion_status||
"onstart"===a.game_settings.success_status)SGAME.Messenger.sendMessage({key:"tracking",value:q}),setTimeout(function(){!0===K()&&(y(),J(function(){y()}))},500)},getVLEData:function(){return r},setVLEData:function(a){return r=a}}}();SGAME.Observer=function(b){var e=!0,f=b,p=b,a=b,t,r,q,s,h,c,m=function(){a=p=f=b;t=Date.now();r=!1;c=h=s=q=b},d=function(){!1===p.acts_as_asset&&"undefined"!==typeof a&&(a.addListener("cmi.success_status",function(a){q=a;"passed"===q&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),a.addListener("cmi.score.scaled",function(a){s=a;0.8<=s&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
a.addListener("cmi.completion_status",function(a){h=a}),a.addListener("cmi.progress_measure",function(a){c=a}))};return{start:function(b,c,h){if(!1===e||"undefined"!=typeof f)return null;e=!1;m();f=b;p=c;a=h;d();SGAME.TrafficLight.changeColor("red");if(!0===p.acts_as_asset){b:{b=p.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration)))break b;b=null}b=!b||0>=b?15:Math.min(0.5*
b,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===e||"undefined"==typeof f)return null;e=!0;SGAME.TrafficLight.stop();var a=Math.round((Date.now()-t)/1E3);r="green"===SGAME.TrafficLight.getCurrentColor();a={lo_metadata:p,time:a,success:r};"undefined"!=typeof q&&(a.scorm_success_status=q);"undefined"!=typeof s&&(a.scorm_scaled_score=s);"undefined"!=typeof h&&(a.scorm_completion_status=h);"undefined"!=typeof c&&(a.scorm_progress_measure=
c);m();return a},isStopped:function(){return e}}}();SGAME.Utils=function(){var b=void 0;return{init:function(b){},getRandomElement:function(b){if("number"==typeof b)return b;var f;f=b.length-1;if("number"!=typeof f)throw{name:"Invalid number format exception"};f=Math.round(0+Math.random()*(f-0));return b[f]},loadScript:function(b,f){if("string"===typeof b&&"function"===typeof f){var p=document.getElementsByTagName("head")[0];if(p){var a=document.createElement("script");a.setAttribute("src",b);a.setAttribute("type","text/javascript");a.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||f()};a.onload=f;p.appendChild(a)}}},getProtocol:function(){if("undefined"!==typeof b)return b;var e;try{e=document.location.protocol}catch(f){}"string"===typeof e&&(e=e.match(/[\w]+/),e=e instanceof Array&&"string"===typeof e[0]?e[0]:void 0);return b="string"===typeof e?e:"unknown"},checkUrlProtocol:function(b){if("string"===typeof b){var f=b.match(/^https?:\/\//);if(f instanceof Array&&1===f.length){var f=f[0].replace("://",""),p=
SGAME.Utils.getProtocol();if(f!==p)switch(p){case "https":b="https"+b.replace(f,"")}}}return b}}}();
