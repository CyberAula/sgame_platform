iso8601Parser=function(e){return{getDuration:function(a){var p=[31104E3,2592E3,604800,86400,3600,60,1];try{var n;var l=a;a=[2,3,4,5,7,8,9];var e=[0,0,0,0,0,0,0],s;if(l=l.toUpperCase()){if("string"!==typeof l)throw Error("Invalid iso8601 period string '"+l+"'");if(s=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(l))for(l=0;l<a.length;l++){var f=a[l];e[l]=s[f]?+s[f].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+l+"' is not a valid ISO8601 period.");}n=e}catch(t){return null}for(f=
s=0;f<n.length;f++)s+=n[f]*p[f];return s}}}();function Local_API_1484_11(e){function a(d,a){g.diganostic="The "+d+" of "+a+" must be a proper vocabulary element.";g.errorCode=406;return"false"}function p(d){g.errorCode=402;g.diagnostic="The value for key "+d+" has not been created yet.";return"false"}function n(d,a){g.errorCode=201;g.diagnostic="The value for key "+d+" is not valid.";return"false"}function l(d,a,h){d=d.split(/\./);2>d.length?h[d[0]]=a:(h[d[0]]||(h[d[0]]={}),h=h[d.shift()],l(d.join("."),a,h))}function r(d,a){var h=d.split(/\./),
b;if(2>h.length)try{return a[h[0]]}catch(c){return p(d),"false"}else{b=h.shift();if(a[b])return String(r(h.join("."),a[b]));p(d);return"false"}}function s(d){var a,h=0;for(a in d)d.hasOwnProperty(a)&&(h+=1);return h}function f(d,a){if(g.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(d);break;case 2:console.warn(d);break;case 4:console.info(d);
break;case 3:console.log(d);break;default:return console.log(d),!1}return!0}3>a&&g.throw_alerts&&alert(d);return!1}function t(d,a){if("function"==typeof g.listeners[d]&&"undefined"!=typeof a)g.listeners[d](a)}function k(d,a){for(var h in a)a.hasOwnProperty(h)&&("object"==typeof d[h]?"object"==typeof a[h]&&(d[h]=k(d[h],a[h])):d[h]=a[h]);return d}function c(d,a){(function(){function d(a,h){h=h||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(a,h.bubbles,
h.cancelable,h.detail);return b}if("function"===typeof window.CustomEvent)return!1;d.prototype=window.Event.prototype;window.CustomEvent=d})();document.dispatchEvent(new CustomEvent(d,{detail:a}))}function u(d){return"object"!==type(d)||d.nodeType||isWindow(d)?!1:!(d.constructor&&!hasOwn.call(d.constructor.prototype,"isPrototypeOf"))}var g=k({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},e),b={},h={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},q=this;this.isRunning=function(){return 1===g.initialized&&0===g.terminated};this.Initialize=function(){f(g.prefix+":  Initializing...",3);g.cmi?(b=g.cmi,"suspend"===b.exit&&(b.entry="resume")):b=g.CMI;g.initialized=1;g.terminated=0;return"true"};this.GetValue=
function(d){g.errorCode=0;var a="false";d=d.toString();var h=[];if(this.isRunning()){h=d.split(".");if(0<="|exit|session_time|".indexOf("|"+h[h.length-1]+"|"))return f(g.prefix+": This "+d+" is write only",4),g.errorCode=405,"false";h=d.toLowerCase().split(".");switch(h[0]){case "cmi":switch(a="false",d){case "cmi.exit":case "cmi.session_time":g.errorCode=405;g.diagnostic="Sorry, this has been specified as a read-only value for "+d;break;case "cmi.learner_name":a=g.CMI.learner_name;break;default:a=
r(d.substr(4,d.length),b),"undefined"===a&&(g.errorCode=401,g.diagnostic="Sorry, there was a undefined response from "+d,a="false"),f(g.prefix+": GetValue "+d+" = "+a,4)}}return a}g.errorCode=123;return a};this.SetValue=function(d,h){f(g.prefix+": SetValue: "+d+" = "+h,4);g.errorCode=0;var c=[],k=d.toString(),q=h.toString(),m=0,e=0,m=[];if(this.isRunning()){m=k.split(".");if("adl"===m[0]&&"id"===m[4]||"comments_from_lms"===m[1]||("comments_from_learner"===m[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
m[m.length-1]+"|")))return f(g.prefix+": This "+k+" is read only",4),g.errorCode=404,"false";c=k.split(".");switch(c[0]){case "cmi":switch(d){case "cmi.location":1E3<q.length&&f(g.prefix+": Some LMS's might truncate your bookmark as you've passed "+q.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":m=parseFloat(q);if("number"!=typeof m||isNaN(m))return n(d,q);m=Math.max(0,Math.min(1,m));t(d,m);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+
q+"|"))return a(d,q);t(d,q);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+q+"|"))return a(d,q);break;case "cmi.score.scaled":m=parseFloat(q);if("number"!=typeof m||isNaN(m))return n(d,q);m=Math.max(0,Math.min(1,m));t(d,m);break;case "cmi.score.min":m=parseFloat(q);if("number"!=typeof m||isNaN(m))return n(d,q);g.CMI.score.min=m;break;case "cmi.score.max":m=parseFloat(q);if("number"!=typeof m||isNaN(m))return n(d,q);g.CMI.score.max=m;break;case "cmi.score.raw":m=parseFloat(q);
if("number"!=typeof m||isNaN(m))return n(d,q);e=parseFloat(g.CMI.score.max);e="number"!=typeof e||isNaN(e)?100:e;c=parseFloat(g.CMI.score.min);c="number"!=typeof c||isNaN(c)?0:c;e-=c;0>=e&&(e=100);m=Math.max(0,Math.min(1,(m-c)/e));t("cmi.score.scaled",m);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+q+"|"))return a(d,q);t(d,q);break;default:switch(c[1]){case "comments_from_lms":return g.errorCode="404",g.diagnostic="The cmi.comments_from_lms element is entirely read only.",
"false";case "comments_from_learner":if(-1===b.comments_from_learner._children.indexOf(c[3]))return a(d,q);l(k.substr(4,k.length),q,b);b.comments_from_learner._count=(s(b.comments_from_learner)-2).toString();return"true";case "interactions":if(-1===b.interactions._children.indexOf(c[3]))return a(d,q);b.interactions._count=(s(b.interactions)-2).toString();if(isNaN(parseInt(c[2],10)))return"false";if(!u(b.interactions[c[2]])){if("id"===c[3])return b.interactions[c[2]]={},l(k.substr(4,k.length),q,b),
b.interactions._count=(s(b.interactions)-2).toString(),u(b.interactions[c[2]].objectives)||(f(g.prefix+": Constructing objectives object for new interaction",4),b.interactions[c[2]].objectives={},b.interactions[c[2]].objectives._count="-1"),u(b.interactions[c[2]].correct_responses)||(f(g.prefix+": Constructing correct responses object for new interaction",4),b.interactions[c[2]].correct_responses={},b.interactions[c[2]].correct_responses._count="-1"),"true";f("Can't add interaction without ID first!",
3);return"false"}if("objectives"===c[3]){if("id"===c[5])for(e=parseInt(b.interactions[c[2]].objectives._count,10),m=0;m<e;m+=1){if(b.interactions[c[2]].objectives[m].id===q)return k=d,g.errorCode="351",g.diagnostic="The "+k+" element must be unique.  The value '"+q+"' has already been set in #"+m,"false"}else return a(d,q);l(k.substr(4,k.length),q,b);b.interactions[c[2]].objectives._count=(s(b.interactions[c[2]].objectives)-1).toString();return"true"}"correct_responses"===c[3]&&(l(k.substr(4,k.length),
q,b),b.interactions[c[2]].correct_responses._count=(s(b.interactions[c[2]].correct_responses)-1).toString());l(k.substr(4,k.length),q,b);b.interactions._count=(s(b.interactions)-2).toString();return"true";case "objectives":if("id"===c[3])for(e=parseInt(b.objectives._count,10),m=0;m<e;m+=1)if(b.objectives[m].id===q)return g.errorCode="351",g.diagnostic="The objectives.id element must be unique.  The value '"+q+"' has already been set in objective #"+m,"false";if("id"!==c[3]&&(m=parseInt(c[2],10),void 0===
b.objectives[m]))return g.errorCode="408",g.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(c[2],10)))return"false";l(k.substr(4,k.length),q,b);b.objectives._count=(s(b.objectives)-2).toString();return"true"}}l(k.substr(4,k.length),q,b)}return"true"}g.errorCode=g.terminated?133:132;return"false"};this.Commit=function(){f(g.prefix+": Commit CMI Object:",4);f(b);f(g.prefix+": Suspend Data Usage "+(Math.round(100*(b.suspend_data.length/64E3)*
Math.pow(10,2))/Math.pow(10,2)+"%"));c("StoreData",{runtimedata:b});return"true"};this.Terminate=function(){q.Commit();g.terminated=1;g.initialized=0;return"true"};this.GetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==h[a])?h[a]:""};this.GetLastError=function(){return g.errorCode};this.GetDiagnostic=function(){return g.diagnostic};this.setCMILMSValue=function(a,h){"string"==typeof a&&(g.CMI[a]=h)};this.addListener=function(a,h){"string"==typeof a&&"function"==typeof h&&(g.listeners[a]=
h)}};function Local_API_SCORM_12(e){function a(a,b){c.diganostic="The "+a+" of "+b+" must be a proper vocabulary element.";c.errorCode=406;return"false"}function p(a){c.errorCode=402;c.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function n(a,b){c.errorCode=201;c.diagnostic="The value for key "+a+" is not valid.";return"false"}function l(a,c,d){a=a.split(/\./);2>a.length?d[a[0]]=c:(d[a[0]]||(d[a[0]]={}),d=d[a.shift()],l(a.join("."),c,d))}function r(a,c){var d=a.split(/\./),
b;if(2>d.length)try{return c[d[0]]}catch(k){return p(a),"false"}else{b=d.shift();if(c[b])return String(r(d.join("."),c[b]));p(a);return"false"}}function s(a,b){if(c.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(b){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>b&&c.throw_alerts&&alert(a);return!1}function f(a,b){if("function"==typeof c.listeners[a]&&"undefined"!=typeof b)c.listeners[a](b)}function t(a,c){for(var d in c)c.hasOwnProperty(d)&&("object"==typeof a[d]?"object"==typeof c[d]&&(a[d]=t(a[d],c[d])):a[d]=c[d]);return a}function k(a,c){(function(){function a(d,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var b=document.createEvent("CustomEvent");b.initCustomEvent(d,c.bubbles,c.cancelable,c.detail);return b}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:c}))}var c=t({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},e),u={},g={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},b=this;this.isRunning=function(){return 1===c.initialized&&0===c.terminated};this.LMSInitialize=function(){s(c.prefix+":  Initializing...",3);u=c.CMI;c.initialized=1;c.terminated=0;return"true"};this.LMSGetValue=function(a){c.errorCode=0;var b="false";a=a.toString();var d=[];if(this.isRunning()){d=a.split(".");if(0<="|exit|session_time|".indexOf("|"+
d[d.length-1]+"|"))return c.errorCode=405,"false";d=a.toLowerCase().split(".");switch(d[0]){case "cmi":b=a;a="false";switch(b){case "cmi.core.exit":case "cmi.core.session_time":c.errorCode=405;c.diagnostic="Sorry, this has been specified as a read-only value for "+b;break;default:b=b.replace("cmi.",""),a=r(b,u),"undefined"===a&&(c.errorCode=401,c.diagnostic="Sorry, there was a undefined response from "+b,a="false")}b=a}return b}c.errorCode=123;return b};this.LMSSetValue=function(b,k){s(c.prefix+": SetValue: "+
b+" = "+k,4);c.errorCode=0;var d=[],g=b.toString(),e=k.toString();if(this.isRunning()){var d=g.split("."),p=d[d.length-1],d="adl"===d[0]&&"id"===d[4]?!0:"comments_from_lms"===d[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+p+"|");if(d)return c.errorCode=404,"false";d=g.split(".");switch(d[0]){case "cmi":switch(b){case "cmi.core.lesson_location":1E3<
e.length&&s(c.prefix+": Some LMS's might truncate your bookmark as you've passed "+e.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+e+"|"))return a(b,e);f(b,e);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+e+"|"))return a(b,e);break;case "cmi.core.score.min":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(b,e);c.CMI.core.score.min=
d;break;case "cmi.core.score.max":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(b,e);c.CMI.core.score.max=d;break;case "cmi.core.score.raw":d=parseFloat(e);if("number"!=typeof d||isNaN(d))return n(b,e);var r=parseFloat(c.CMI.core.score.max),r="number"!=typeof r||isNaN(r)?100:r,p=parseFloat(c.CMI.core.score.min),p="number"!=typeof p||isNaN(p)?0:p,r=r-p;0>=r&&(r=100);d=Math.max(0,Math.min(1,(d-p)/r));f("cmi.score.scaled",d)}g=g.replace("cmi.","");l(g,e,u)}return"true"}c.errorCode=c.terminated?
133:132;return"false"};this.LMSCommit=function(){k("StoreData",{runtimedata:u});return"true"};this.LMSTerminate=function(){b.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSFinish=function(){b.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==g[a])?g[a]:""};this.LMSGetLastError=function(){return c.errorCode};this.LMSGetDiagnostic=function(){return c.diagnostic};this.setCMILMSValue=function(a,b){"string"==
typeof a&&(c.CMI[a]=b)};this.addListener=function(a,b){"string"==typeof a&&"function"==typeof b&&(c.listeners[a]=b)}};SGAME=function(){return{init:function(e){SGAME.CORE.init(e)},loadSettings:function(e){SGAME.CORE.loadSettings(e)},triggerLO:function(e,a){SGAME.CORE.triggerLO(e,a)},showLO:function(e,a){SGAME.CORE.showLO(e,a)},showRandomLO:function(e){SGAME.CORE.showRandomLO(e)},closeLO:function(){SGAME.CORE.closeLO()}}}();SGAME.VERSION="0.5";SGAME.AUTHORS="Aldo Gordillo, Enrique Barra";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var e=!1;return{init:function(a){!0===a&&(e=a)},isDebugging:function(){return e},log:function(a){e&&window.console&&console.log(a)}}}();SGAME.API=function(){var e=function(a,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var a=JSON.parse(n.responseText);e(a)}};n.open("GET",a,!0);n.send("")};return{init:function(){},requestLOMetadata:function(a,p,n){try{e("undefined"==typeof a?"/lo/random/metadata.json":"/lo/"+a+"/metadata.json",function(a){p(a)})}catch(l){n(l)}}}}();SGAME.CORE=function(){var e=void 0,a={},p=["repeat","repeat_unless_successfully_consumed","no_repeat"],n=["no_more_los","all_los_consumed","all_los_succesfully_consumed","never"],l=!1;SGAME.Debugger.init(!0);var r=function(k,c){"object"!==typeof k||"string"!==typeof k.url?"function"==typeof c&&c(null,null):(a.los[k.id].shown=!0,a.los[k.id].nshown+=1,s(),SGAME.Fancybox.create({lo:k},function(e){a.los[k.id].succesfully_consumed=e.success;switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[k.id].can_be_shown=
!0!==a.los[k.id].succesfully_consumed;break;case "no_repeat":a.los[k.id].can_be_shown=!1}f(function(){"function"==typeof c&&c(e.success,e);s()})}))},s=function(){"function"===typeof e&&e()},f=function(a){!0!==t()?"function"===typeof a&&a(!1):(l=!0,alert("Final screen"),"function"===typeof a&&a(!0))},t=function(){if(!0===l)return!1;switch(a.game_settings.completion_notification){case "no_more_los":for(var k=Object.keys(a.los),c=k.length,e=0;e<c;e++)if(!0===a.los[k[e]].can_be_shown)return!1;return!0;
case "all_los_consumed":k=Object.keys(a.los);c=k.length;for(e=0;e<c;e++)if(!1===a.los[k[e]].shown)return!1;return!0;case "all_los_succesfully_consumed":k=Object.keys(a.los);c=k.length;for(e=0;e<c;e++)if(!1===a.los[k[e]].succesfully_consumed)return!1;return!0;case "never":return!1;default:return!1}};return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);a&&"function"===typeof a.togglePause&&(e=a.togglePause)},loadSettings:function(e){SGAME.Debugger.log("SGAME load settings ");
SGAME.Debugger.log(e);a=e;void 0===typeof a.game_metadata&&(a.game_metadata={});void 0===typeof a.los&&(a.los={});void 0===typeof a.events&&(a.events={});void 0===typeof a.event_mapping&&(a.event_mapping={});void 0===typeof a.sequencing&&(a.sequencing={},-1!==p.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat"));void 0===typeof a.game_settings&&(a.game_settings={},-1!==n.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never"));if("object"===
typeof a.los){e=Object.keys(a.los);for(var c=e.length,f=0;f<c;f++)"undefined"!==typeof a.los[e[f]].url&&(a.los[e[f]].url=SGAME.Utils.checkUrlProtocol(a.los[e[f]].url)),a.los[e[f]].can_be_shown=!0,a.los[e[f]].shown=!1,a.los[e[f]].nshown=0,a.los[e[f]].succesfully_consumed=!1}},triggerLO:function(e,c){var f=[],g=[],b=a.event_mapping[e],h=b.length;if("undefined"!==typeof b&&"number"===typeof h)for(var p=0;p<h;p++){if("*"===b[p]){f=[];b=Object.keys(a.los);for(h=0;h<b.length;h++)"undefined"!==typeof a.los[b[h]]&&
f.push(a.los[b[h]]);break}"undefined"!==typeof a.los[b[p]]&&f.push(a.los[b[p]])}b=f.length;if(1>b.length)"function"==typeof c&&c(null,null);else{for(h=0;h<b;h++)!0===f[h].can_be_shown&&g.push(f[h]);if(g&&g instanceof Array&&0<g.length){for(var f=[],d,b=0;b<g.length;b++)"undefined"===typeof d&&(d=g[b].nshown),g[b].nshown<d&&(d=g[b].nshown,f=[]),d===g[b].nshown&&f.push(g[b]);selectedLO=SGAME.Utils.getRandomElement(f);r(selectedLO,c)}else"function"==typeof c&&c(null,null)}},showLO:r,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,
function(c){r(c,a)},function(){"function"==typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()}}}();var API,API_1484_11;
SGAME.Fancybox=function(e){var a=e,p=e,n=function(){"undefined"!=typeof a&&(a.style.display="none",a.parentNode.removeChild(a),API_1484_11=API=a=e)},l=function(){n();var a=SGAME.Observer.stop();setTimeout(function(){"function"===typeof p&&p(a);p=e},50)};return{init:function(){},create:function(r,s){n();p=s;var f=850,t=650,k={},c;r&&(r.width&&(f=r.width),r.height&&(t=r.height),r.lo&&(k=r.lo),"string"==typeof k.url&&(c=k.url));var u=window.innerHeight-8,g=window.innerWidth-8,t=Math.min(t,u),f=Math.min(f,
g);if("string"==typeof c&&"undefined"!=typeof k.scorm_type){var b=e;API_1484_11=API=e;"sco"===k.scorm_type&&("1.2"===k.scorm_version?b=API=new Local_API_SCORM_12({debug:SGAME.Debugger.isDebugging()}):"2004"===k.scorm_version&&(b=API_1484_11=new Local_API_1484_11({debug:SGAME.Debugger.isDebugging()})));var h=document.createElement("div");h.style.width=f+"px";h.style.height=t+"px";h.style.maxWidth=g+"px";h.style.maxHeight=u+"px";h.style.overflow="hidden";h.style.background="white";h.style.position=
"absolute";h.style.top=0;h.style.zIndex=9999;h.style.borderRadius="1em";h.style.border="2px solid black";h.setAttribute("id","sgame_fancybox");h.style.marginLeft=(window.innerWidth-f)/2+"px";h.style.marginTop=(window.innerHeight-t)/2+"px";f=document.createElement("img");f.src="/assets/sgame/close.png";f.style.width="25px";f.style.height="25px";f.style.padding="5px";f.style.cursor="pointer";f.style.position="absolute";f.style.right=0;f.onclick=function(){l()};h.appendChild(f);f=document.createElement("img");
f.id="trafficLight";f.src="/assets/sgame/trafficLight/trafficLight_red.png";f.style.width="45px";f.style.height="40px";f.style.padding="5px";f.style.position="absolute";f.style.left="0px";f.style.top="0px";h.appendChild(f);f=document.createElement("iframe");f.src=c;f.style.width="94%";f.style.height="94%";f.style.marginLeft="3%";f.style.marginTop="3%";f.style.overflow="hidden";f.style.overflowY="auto";f.scrolling="yes";f.style.frameBorder="0";f.style.borderStyle="none";f.setAttribute("allowfullscreen",
"false");h.appendChild(f);a=h;document.body.appendChild(h);SGAME.Observer.start(f,k,b)}},closeCurrentFancybox:l}}();SGAME.Observer=function(e){var a=!0,p=e,n=e,l=e,r,s,f,t,k,c,u=function(){l=n=p=e;r=Date.now();s=!1;c=k=t=f=e},g=function(){"sco"==n.scorm_type&&"undefined"!=typeof l&&(l.addListener("cmi.success_status",function(a){f=a;"passed"===f&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),l.addListener("cmi.score.scaled",function(a){t=a;0.8<=t&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
l.addListener("cmi.completion_status",function(a){k=a}),l.addListener("cmi.progress_measure",function(a){c=a}))};return{start:function(b,c,e){if(!1===a||"undefined"!=typeof p)return null;a=!1;u();p=b;n=c;l=e;g();SGAME.TrafficLight.changeColor("red");if("asset"==n.scorm_type){b:{b=n.lom_metadata;if(b.educational&&b.educational.typicalLearningTime&&b.educational.typicalLearningTime.duration&&b.educational.typicalLearningTime.duration.langstrings&&b.educational.typicalLearningTime.duration.langstrings["x-none"]&&
(b=iso8601Parser.getDuration(b.educational.typicalLearningTime.duration.langstrings["x-none"])))break b;b=null}b=b?Math.min(0.5*b,60):15;SGAME.TrafficLight.setUpBlink("yellow",0.5*b-0.5,0.5*b);SGAME.TrafficLight.changeColor("green",b)}},stop:function(){if(!0===a||"undefined"==typeof p)return null;a=!0;SGAME.TrafficLight.stop();var b=Math.round((Date.now()-r)/1E3);s="green"===SGAME.TrafficLight.getCurrentColor();b={lo_metadata:n,time:b,success:s};"undefined"!=typeof f&&(b.scorm_success_status=f);"undefined"!=
typeof t&&(b.scorm_scaled_score=t);"undefined"!=typeof k&&(b.scorm_completion_status=k);"undefined"!=typeof c&&(b.scorm_progress_measure=c);u();return b},isStopped:function(){return a}}}();SGAME.TrafficLight=function(e){var a,p,n,l,r,s=function(e){var c=document.getElementById("trafficLight");c&&(a=e,c.src=f(e))},f=function(a){switch(a){case "green":return"/assets/sgame/trafficLight/trafficLight_green.png";case "yellow":return"/assets/sgame/trafficLight/trafficLight_yellow.png";case "red":return"/assets/sgame/trafficLight/trafficLight_red.png";default:return"/assets/sgame/trafficLight/trafficLight.png"}},t=function(a,c){var e=document.getElementById("trafficLight");if(e){var g=!1;l=
setInterval(function(){e&&(g?(e.src=f(null),g=!1):(e.src=f(a),g=!0))},500);r=setTimeout(function(){clearTimeout(l)},1E3*c)}};return{getCurrentColor:function(){return a},changeColor:function(a,c){c?p=setTimeout(function(){s(a)},1E3*c):s(a)},setUpBlink:function(a,c,e){e?n=setTimeout(function(){t(a,c)},1E3*e):t(a,c)},stop:function(){p&&clearTimeout(p);n&&clearTimeout(n);l&&clearTimeout(l);r&&clearTimeout(r)}}}();SGAME.Utils=function(){var e=void 0;return{init:function(a){},getRandomElement:function(a){if("number"==typeof a)return a;var e;e=a.length-1;if("number"!=typeof e)throw{name:"Invalid number format exception"};e=Math.round(0+Math.random()*(e-0));return a[e]},loadScript:function(a,e){if("string"===typeof a&&"function"===typeof e){var n=document.getElementsByTagName("head")[0];if(n){var l=document.createElement("script");l.setAttribute("src",a);l.setAttribute("type","text/javascript");l.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||e()};l.onload=e;n.appendChild(l)}}},getProtocol:function(){if("undefined"!==typeof e)return e;var a;try{a=document.location.protocol}catch(p){}"string"===typeof a&&(a=a.match(/[\w]+/),a=a instanceof Array&&"string"===typeof a[0]?a[0]:void 0);return e="string"===typeof a?a:"unknown"},checkUrlProtocol:function(a){if("string"===typeof a){var e=a.match(/^https?:\/\//);if(e instanceof Array&&1===e.length){var e=e[0].replace("://",""),n=
SGAME.Utils.getProtocol();if(e!==n)switch(n){case "https":a="https"+a.replace(e,"")}}}return a}}}();
