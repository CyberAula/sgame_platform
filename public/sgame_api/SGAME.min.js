iso8601Parser=function(h){return{getDuration:function(e){var h=[31104E3,2592E3,604800,86400,3600,60,1];try{var a;var l=e;e=[2,3,4,5,7,8,9];var v=[0,0,0,0,0,0,0],r;if(l=l.toUpperCase()){if("string"!==typeof l)throw Error("Invalid iso8601 period string '"+l+"'");if(r=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(l))for(l=0;l<e.length;l++){var s=e[l];v[l]=r[s]?+r[s].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+l+"' is not a valid ISO8601 period.");}a=v}catch(t){return null}for(s=
r=0;s<a.length;s++)r+=a[s]*h[s];return r}}}();function Local_API_1484_11(h){function e(b,a){g.diganostic="The "+b+" of "+a+" must be a proper vocabulary element.";g.errorCode=406;return"false"}function p(b){g.errorCode=402;g.diagnostic="The value for key "+b+" has not been created yet.";return"false"}function a(b,a){g.errorCode=201;g.diagnostic="The value for key "+b+" is not valid.";return"false"}function l(b,a,k){b=b.split(/\./);2>b.length?k[b[0]]=a:(k[b[0]]||(k[b[0]]={}),k=k[b.shift()],l(b.join("."),a,k))}function v(b,a){var k=b.split(/\./),
c;if(2>k.length)try{return a[k[0]]}catch(d){return p(b),"false"}else{c=k.shift();if(a[c])return String(v(k.join("."),a[c]));p(b);return"false"}}function r(b){var a,k=0;for(a in b)b.hasOwnProperty(a)&&(k+=1);return k}function s(b,a){if(g.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(b);break;case 2:console.warn(b);break;case 4:console.info(b);
break;case 3:console.log(b);break;default:return console.log(b),!1}return!0}3>a&&g.throw_alerts&&alert(b);return!1}function t(b,a){if("function"==typeof g.listeners[b]&&"undefined"!=typeof a)g.listeners[b](a)}function u(b,a){for(var k in a)a.hasOwnProperty(k)&&("object"==typeof b[k]?"object"==typeof a[k]&&(b[k]=u(b[k],a[k])):b[k]=a[k]);return b}function c(b,a){(function(){function b(a,k){k=k||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,k.bubbles,
k.cancelable,k.detail);return c}if("function"===typeof window.CustomEvent)return!1;b.prototype=window.Event.prototype;window.CustomEvent=b})();document.dispatchEvent(new CustomEvent(b,{detail:a}))}function m(b){return"object"!==type(b)||b.nodeType||isWindow(b)?!1:!(b.constructor&&!hasOwn.call(b.constructor.prototype,"isPrototypeOf"))}var g=u({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},h),f={},q={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},k=this;"object"===typeof g.user&&("string"===typeof g.user.name&&(g.CMI.learner_name=g.user.name),"string"===typeof g.user.id&&(g.CMI.learner_id=g.user.id));this.isRunning=function(){return 1===g.initialized&&0===g.terminated};this.Initialize=function(){s(g.prefix+
":  Initializing...",3);g.cmi?(f=g.cmi,"suspend"===f.exit&&(f.entry="resume")):f=g.CMI;g.initialized=1;g.terminated=0;return"true"};this.GetValue=function(b){g.errorCode=0;var a="false";b=b.toString();var k=[];if(this.isRunning()){k=b.split(".");if(0<="|exit|session_time|".indexOf("|"+k[k.length-1]+"|"))return s(g.prefix+": This "+b+" is write only",4),g.errorCode=405,"false";k=b.toLowerCase().split(".");switch(k[0]){case "cmi":switch(a="false",b){case "cmi.exit":case "cmi.session_time":g.errorCode=
405;g.diagnostic="Sorry, this has been specified as a read-only value for "+b;break;case "cmi.learner_name":a=g.CMI.learner_name;break;default:a=v(b.substr(4,b.length),f),"undefined"===a&&(g.errorCode=401,g.diagnostic="Sorry, there was a undefined response from "+b,a="false"),s(g.prefix+": GetValue "+b+" = "+a,4)}}return a}g.errorCode=123;return a};this.SetValue=function(b,k){s(g.prefix+": SetValue: "+b+" = "+k,4);g.errorCode=0;var c=[],q=b.toString(),d=k.toString(),n=0,h=0,n=[];if(this.isRunning()){n=
q.split(".");if("adl"===n[0]&&"id"===n[4]||"comments_from_lms"===n[1]||("comments_from_learner"===n[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+n[n.length-1]+"|")))return s(g.prefix+": This "+q+" is read only",4),g.errorCode=404,"false";c=q.split(".");switch(c[0]){case "cmi":switch(b){case "cmi.location":1E3<d.length&&s(g.prefix+": Some LMS's might truncate your bookmark as you've passed "+
d.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":n=parseFloat(d);if("number"!=typeof n||isNaN(n))return a(b,d);n=Math.max(0,Math.min(1,n));t(b,n);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+d+"|"))return e(b,d);t(b,d);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+d+"|"))return e(b,d);break;case "cmi.score.scaled":n=parseFloat(d);if("number"!=typeof n||isNaN(n))return a(b,d);n=Math.max(0,
Math.min(1,n));t(b,n);break;case "cmi.score.min":n=parseFloat(d);if("number"!=typeof n||isNaN(n))return a(b,d);g.CMI.score.min=n;break;case "cmi.score.max":n=parseFloat(d);if("number"!=typeof n||isNaN(n))return a(b,d);g.CMI.score.max=n;break;case "cmi.score.raw":n=parseFloat(d);if("number"!=typeof n||isNaN(n))return a(b,d);h=parseFloat(g.CMI.score.max);h="number"!=typeof h||isNaN(h)?100:h;c=parseFloat(g.CMI.score.min);c="number"!=typeof c||isNaN(c)?0:c;h-=c;0>=h&&(h=100);n=Math.max(0,Math.min(1,(n-
c)/h));t("cmi.score.scaled",n);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+d+"|"))return e(b,d);t(b,d);break;default:switch(c[1]){case "comments_from_lms":return g.errorCode="404",g.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===f.comments_from_learner._children.indexOf(c[3]))return e(b,d);l(q.substr(4,q.length),d,f);f.comments_from_learner._count=(r(f.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===f.interactions._children.indexOf(c[3]))return e(b,d);f.interactions._count=(r(f.interactions)-2).toString();if(isNaN(parseInt(c[2],10)))return"false";if(!m(f.interactions[c[2]])){if("id"===c[3])return f.interactions[c[2]]={},l(q.substr(4,q.length),d,f),f.interactions._count=(r(f.interactions)-2).toString(),m(f.interactions[c[2]].objectives)||(s(g.prefix+": Constructing objectives object for new interaction",4),f.interactions[c[2]].objectives={},f.interactions[c[2]].objectives._count=
"-1"),m(f.interactions[c[2]].correct_responses)||(s(g.prefix+": Constructing correct responses object for new interaction",4),f.interactions[c[2]].correct_responses={},f.interactions[c[2]].correct_responses._count="-1"),"true";s("Can't add interaction without ID first!",3);return"false"}if("objectives"===c[3]){if("id"===c[5])for(h=parseInt(f.interactions[c[2]].objectives._count,10),n=0;n<h;n+=1){if(f.interactions[c[2]].objectives[n].id===d)return q=b,g.errorCode="351",g.diagnostic="The "+q+" element must be unique.  The value '"+
d+"' has already been set in #"+n,"false"}else return e(b,d);l(q.substr(4,q.length),d,f);f.interactions[c[2]].objectives._count=(r(f.interactions[c[2]].objectives)-1).toString();return"true"}"correct_responses"===c[3]&&(l(q.substr(4,q.length),d,f),f.interactions[c[2]].correct_responses._count=(r(f.interactions[c[2]].correct_responses)-1).toString());l(q.substr(4,q.length),d,f);f.interactions._count=(r(f.interactions)-2).toString();return"true";case "objectives":if("id"===c[3])for(h=parseInt(f.objectives._count,
10),n=0;n<h;n+=1)if(f.objectives[n].id===d)return g.errorCode="351",g.diagnostic="The objectives.id element must be unique.  The value '"+d+"' has already been set in objective #"+n,"false";if("id"!==c[3]&&(n=parseInt(c[2],10),void 0===f.objectives[n]))return g.errorCode="408",g.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(c[2],10)))return"false";l(q.substr(4,q.length),d,f);f.objectives._count=(r(f.objectives)-2).toString();return"true"}}l(q.substr(4,
q.length),d,f)}return"true"}g.errorCode=g.terminated?133:132;return"false"};this.Commit=function(){s(g.prefix+": Commit CMI Object:",4);s(f);s(g.prefix+": Suspend Data Usage "+(Math.round(100*(f.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));c("StoreData",{runtimedata:f});return"true"};this.Terminate=function(){k.Commit();g.terminated=1;g.initialized=0;return"true"};this.GetErrorString=function(b){return""!==b&&(b=parseInt(b,10),void 0!==q[b])?q[b]:""};this.GetLastError=function(){return g.errorCode};
this.GetDiagnostic=function(){return g.diagnostic};this.setCMILMSValue=function(b,a){"string"==typeof b&&(g.CMI[b]=a)};this.addListener=function(b,a){"string"==typeof b&&"function"==typeof a&&(g.listeners[b]=a)}};function Local_API_SCORM_12(h){function e(a,k){c.diganostic="The "+a+" of "+k+" must be a proper vocabulary element.";c.errorCode=406;return"false"}function p(a){c.errorCode=402;c.diagnostic="The value for key "+a+" has not been created yet.";return"false"}function a(a,k){c.errorCode=201;c.diagnostic="The value for key "+a+" is not valid.";return"false"}function l(a,k,b){a=a.split(/\./);2>a.length?b[a[0]]=k:(b[a[0]]||(b[a[0]]={}),b=b[a.shift()],l(a.join("."),k,b))}function v(a,k){var b=a.split(/\./),
c;if(2>b.length)try{return k[b[0]]}catch(w){return p(a),"false"}else{c=b.shift();if(k[c])return String(v(b.join("."),k[c]));p(a);return"false"}}function r(a,k){if(c.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(k){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);break;case 3:console.log(a);break;default:return console.log(a),
!1}return!0}3>k&&c.throw_alerts&&alert(a);return!1}function s(a,k){if("function"==typeof c.listeners[a]&&"undefined"!=typeof k)c.listeners[a](k)}function t(a,k){for(var b in k)k.hasOwnProperty(b)&&("object"==typeof a[b]?"object"==typeof k[b]&&(a[b]=t(a[b],k[b])):a[b]=k[b]);return a}function u(a,k){(function(){function a(b,k){k=k||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(b,k.bubbles,k.cancelable,k.detail);return c}if("function"===typeof window.CustomEvent)return!1;
a.prototype=window.Event.prototype;window.CustomEvent=a})();document.dispatchEvent(new CustomEvent(a,{detail:k}))}var c=t({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},h),m={},g={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},f=this;"object"===typeof c.user&&("string"===typeof c.user.name&&(c.CMI.core.student_name=c.user.name),"string"===typeof c.user.id&&(c.CMI.core.student_id=c.user.id));this.isRunning=function(){return 1===c.initialized&&0===c.terminated};this.LMSInitialize=function(){r(c.prefix+":  Initializing...",3);m=c.CMI;c.initialized=1;c.terminated=
0;return"true"};this.LMSGetValue=function(a){c.errorCode=0;var k="false";a=a.toString();var b=[];if(this.isRunning()){b=a.split(".");if(0<="|exit|session_time|".indexOf("|"+b[b.length-1]+"|"))return c.errorCode=405,"false";b=a.toLowerCase().split(".");switch(b[0]){case "cmi":k=a;a="false";switch(k){case "cmi.core.exit":case "cmi.core.session_time":c.errorCode=405;c.diagnostic="Sorry, this has been specified as a read-only value for "+k;break;default:k=k.replace("cmi.",""),a=v(k,m),"undefined"===a&&
(c.errorCode=401,c.diagnostic="Sorry, there was a undefined response from "+k,a="false")}k=a}return k}c.errorCode=123;return k};this.LMSSetValue=function(f,k){r(c.prefix+": SetValue: "+f+" = "+k,4);c.errorCode=0;var b=[],x=f.toString(),w=k.toString();if(this.isRunning()){var b=x.split("."),g=b[b.length-1],b="adl"===b[0]&&"id"===b[4]?!0:"comments_from_lms"===b[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
g+"|");if(b)return c.errorCode=404,"false";b=x.split(".");switch(b[0]){case "cmi":switch(f){case "cmi.core.lesson_location":1E3<w.length&&r(c.prefix+": Some LMS's might truncate your bookmark as you've passed "+w.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+w+"|"))return e(f,w);s(f,w);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+w+"|"))return e(f,
w);break;case "cmi.core.score.min":b=parseFloat(w);if("number"!=typeof b||isNaN(b))return a(f,w);c.CMI.core.score.min=b;break;case "cmi.core.score.max":b=parseFloat(w);if("number"!=typeof b||isNaN(b))return a(f,w);c.CMI.core.score.max=b;break;case "cmi.core.score.raw":b=parseFloat(w);if("number"!=typeof b||isNaN(b))return a(f,w);var d=parseFloat(c.CMI.core.score.max),d="number"!=typeof d||isNaN(d)?100:d,g=parseFloat(c.CMI.core.score.min),g="number"!=typeof g||isNaN(g)?0:g,d=d-g;0>=d&&(d=100);b=Math.max(0,
Math.min(1,(b-g)/d));s("cmi.score.scaled",b)}x=x.replace("cmi.","");l(x,w,m)}return"true"}c.errorCode=c.terminated?133:132;return"false"};this.LMSCommit=function(){u("StoreData",{runtimedata:m});return"true"};this.LMSTerminate=function(){f.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSFinish=function(){f.LMSCommit();c.terminated=1;c.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==g[a])?g[a]:""};this.LMSGetLastError=function(){return c.errorCode};
this.LMSGetDiagnostic=function(){return c.diagnostic};this.setCMILMSValue=function(a,k){"string"==typeof a&&(c.CMI[a]=k)};this.addListener=function(a,k){"string"==typeof a&&"function"==typeof k&&(c.listeners[a]=k)}};SGAME=function(){return{init:function(h){return SGAME.CORE.init(h)},loadSettings:function(h){return SGAME.CORE.loadSettings(h)},triggerLO:function(h,e){return SGAME.CORE.triggerLO(h,e)},showLO:function(h,e){return SGAME.CORE.showLO(h,e)},showRandomLO:function(h){return SGAME.CORE.showRandomLO(h)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(h){return SGAME.CORE.losCanBeShown(h)},successWhenNoLOs:function(h){return SGAME.CORE.successWhenNoLOs(h)}}}();
SGAME.VERSION="1.0.1";SGAME.AUTHORS="Aldo Gordillo";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var h=!1;return{init:function(e){!0===e&&(h=e)},isDebugging:function(){return h},log:function(e){h&&window.console&&console.log(e)}}}();SGAME.Messenger=function(){function h(c,e){this.data=c||{};-1!==["PROTOCOL","APP"].indexOf(e)?this.type=e:this.type="APP";this.origin=a;this.destination=l}var e=["PROTOCOL","APP"],p=["SGAME_GATEWAY","SGAME_API"],a="SGAME_API",l="SGAME_GATEWAY",v=!1,r=!1,s=function(a){try{window.parent.parent.postMessage(a,"*")}catch(e){}},t=function(c){var e;e="object"!==typeof c||"string"!==typeof c.data?!1:u(c.data);if(e)switch(c=JSON.parse(c.data),c.type){case "PROTOCOL":if(c.data)switch(c.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
c.origin&&!0!==r&&(r=!0,c.data.settings=SGAME.CORE.getSettings(),c.destination=c.origin,c.origin=a,s(JSON.stringify(c)),SGAME.CORE.onConnectedToVLE())}break;case "APP":if(c.data&&"string"===typeof c.data.key)switch(c.data.key){case "lms_data":if("object"===typeof c.data.value){e=c.data.value;c={};if("string"===typeof e.name||"number"===typeof e.name)c.name=""+e.name;if("string"===typeof e.id||"number"===typeof e.id)c.id=""+e.id;e=SGAME.CORE.getVLEData();e.user=c;SGAME.CORE.setVLEData(e)}}}},u=function(a){try{if(a=
JSON.parse(a),-1===e.indexOf(a.type)||-1===p.indexOf(a.origin))return!1}catch(h){return!1}return!0};return{init:function(a){if(!v){v=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",t,!1):window.attachEvent&&window.parent.attachEvent("message",t)}catch(e){}}},isConnected:function(){return r},sendMessage:function(a){v&&r&&(a=JSON.stringify(new h(a,void 0)),u(a)&&s(a))}}}();var API,API_1484_11;
SGAME.Fancybox=function(h){var e=h,p=h,a=h,l,v=function(){"undefined"!=typeof e&&(e.style.display="none",e.parentNode.removeChild(e),"lo"===p&&(API_1484_11=API=h),p=e=h)},r=function(){if("undefined"!=typeof e){var l=p;v();var r;r="lo"===l?SGAME.Observer.stop():!0;var u=a;a=h;setTimeout(function(){"function"===typeof u&&u(r)},50)}};return{init:function(a){"string"===typeof a&&(l=a)},create:function(s,t){v();a=t;var u="undefined"!==typeof s&&!0===s.dialog?"dialog":"lo",c=4/3,m,g,f=0.9*window.innerWidth,
q=0.9*window.innerHeight;q*c>f?(m=f,g=m/c):(g=q,m=g*c);if("lo"===u)var k={},b;else var x="";s&&(s.width&&(m=s.width),s.height&&(g=s.height),"lo"===u?s.lo&&(k=s.lo,"string"===typeof k.url&&(b=k.url)):"string"==typeof s.msg&&(x=s.msg));if("lo"===u){if("string"!=typeof b||"undefined"==typeof k.scorm_type)return;var w=h,c=API_1484_11=API=h,y=SGAME.CORE.getVLEData();"object"===typeof y.user&&(c=y.user);"sco"===k.scorm_type&&("1.2"===k.scorm_version?w=API=new Local_API_SCORM_12({user:c,debug:SGAME.Debugger.isDebugging()}):
"2004"===k.scorm_version&&(w=API_1484_11=new Local_API_1484_11({user:c,debug:SGAME.Debugger.isDebugging()})))}c=document.createElement("div");c.style.width=m+"px";c.style.height=g+"px";c.style.maxWidth=f+"px";c.style.maxHeight=q+"px";c.style.overflow="lo"===u?"hidden":"auto";c.style.background="white";c.style.position="absolute";c.style.top=0;c.style.zIndex=9999;c.style.borderRadius="1em";c.style.border="2px solid black";c.setAttribute("id","sgame_fancybox");c.style.marginLeft=(window.innerWidth-
m)/2+"px";c.style.marginTop=(window.innerHeight-g)/2+"px";q=document.createElement("img");q.src=l+"close.png";f=Math.max(25,Math.floor(0.05*g));q.style.width=f+"px";q.style.height=f+"px";q.style.padding="5px";q.style.cursor="pointer";q.style.position="absolute";q.style.right=0;q.onclick=function(){r()};c.appendChild(q);if("lo"===u){var d=document.createElement("img");d.id="trafficLight";d.src=l+"trafficLight/trafficLight_red.png";x=Math.max(40,Math.floor(0.085*g));q=Math.max(30,Math.floor(0.75*x));
d.style.height=x+"px";d.style.width=q+"px";d.style.padding="4px";d.style.position="absolute";d.style.left="0px";d.style.top="0px";d.style.background="#fff";d.style.borderRadius="0px 0px 20px 0px";d.style.borderRight="2px solid black";d.style.borderBottom="2px solid black";c.appendChild(d);d=document.createElement("iframe");d.src=b;b=Math.ceil(Math.max(f,x))+4;x=Math.floor(0.02*g);f=Math.floor(0.02*m);d.style.marginLeft=f+"px";d.style.marginTop=b+"px";d.style.width=Math.max(0,m-f-f)+"px";d.style.height=
Math.max(0,g-b-x)+"px";d.style.overflow="auto";d.scrolling="yes";d.style.frameBorder="0";d.style.borderStyle="none";d.setAttribute("allowfullscreen","false");c.appendChild(d)}else m=document.createElement("p"),m.id="dialog",m.innerHTML=x,m.style.padding="15px",m.style.marginTop="30px",m.style.marginBottom="20px",m.style.marginRight="20px",m.style.marginLeft="20px",m.style.textAlign="center",m.style.fontSize="24px",m.style.position="relative",m.style.cursor="default",m.style.color="#000",m.style.fontFamily=
"initial",c.appendChild(m);e=c;p=u;document.body.appendChild(c);"lo"===u&&SGAME.Observer.start(d,k,w)},closeCurrentFancybox:r}}();SGAME.TrafficLight=function(h){var e,p,a,l,v,r,s=function(a){var h=document.getElementById("trafficLight");h&&(e=a,h.src=t(a))},t=function(a){switch(a){case "green":return r+"trafficLight/trafficLight_green.png";case "yellow":return r+"trafficLight/trafficLight_yellow.png";case "red":return r+"trafficLight/trafficLight_red.png";default:return r+"trafficLight/trafficLight.png"}},u=function(a,e){var g=document.getElementById("trafficLight");if(g){var f=!1;l=setInterval(function(){g&&(f?(g.src=t(null),
f=!1):(g.src=t(a),f=!0))},500);v=setTimeout(function(){clearTimeout(l)},1E3*e)}};return{init:function(a){"string"===typeof a&&(r=a)},getCurrentColor:function(){return e},changeColor:function(a,e){e?p=setTimeout(function(){s(a)},1E3*e):s(a)},setUpBlink:function(c,e,g){g?a=setTimeout(function(){u(c,e)},1E3*g):u(c,e)},stop:function(){p&&clearTimeout(p);a&&clearTimeout(a);l&&clearTimeout(l);v&&clearTimeout(v)}}}();SGAME.Sequencing=function(){var h,e="completion completion_higher_inmediate success fail score_higher score_higher_inmediate score_lower".split(" "),p=function(a){if("object"!==typeof a)return a;a.met=!1;if("multiple"===a.type&&Array.isArray(a.conditions))for(var b=0;b<a.conditions.length;b++)a.conditions[b]=p(a.conditions[b]);return a},a=function(k){for(var b=Object.keys(k),c=b.length,f=0;f<c;f++)"undefined"!==typeof k[b[f]].condition&&(k[b[f]].condition=l(k[b[f]].condition,b),!1===k[b[f]].condition&&
delete k[b[f]]);return Object.keys(k).length===c?k:a(k)},l=function(a,b){if("object"!==typeof a||"undefined"===typeof a.id)return!1;a.id+="";switch(a.type){case "single":return v(a,b);case "multiple":var c;a:if(-1===["AND","OR"].indexOf(a.operator)||!1===Array.isArray(a.conditions)||1>a.conditions.length)c=!1;else{for(c=0;c<a.conditions.length;c++)if(a.conditions[c]=l(a.conditions[c],b),!1===a.conditions[c]){c=!1;break a}c=a}return c;default:return!1}},v=function(a,b){if("undefined"===typeof a.group)return!1;
a.group+="";if(-1===b.indexOf(a.group)||-1===e.indexOf(a.requirement))return!1;if(-1!==["completion_higher_inmediate","score_higher","score_higher_inmediate","score_lower"].indexOf(a.requirement)){if("string"===typeof a.threshold){if(!0===isNaN(a.threshold))return!1;a.threshold=parseInt(a.threshold)/100}if("number"!==typeof a.threshold||0>a.threshold||1<a.threshold||"score_lower"===a.requirement&&0===a.threshold)return!1}return a},r=function(a,b){if("undefined"===typeof a||!0===a.met)return a;switch(a.type){case "single":var c=
a,f=b[c.group],e=!0===f.shown,d=!1;switch(c.requirement){case "completion":d=e;break;case "completion_higher_inmediate":d=f.nshown/f.los.length>=c.threshold;break;case "success":d=e&&1===f.score;break;case "fail":d=e&&1>f.score;break;case "score_higher":d=e&&f.score>=c.threshold;break;case "score_higher_inmediate":d=f.score>=c.threshold;break;case "score_lower":d=e&&f.score<c.threshold}c.met=d;a=c;break;case "multiple":a:{c=a;for(f=0;f<c.conditions.length;f++)if(c.conditions[f]=r(c.conditions[f],
b),"OR"===c.operator&&!0===c.conditions[f].met){c.met=!0;a=c;break a}else if("AND"===c.operator&&!1===c.conditions[f].met){c.met=!1;a=c;break a}"OR"===c.operator?c.met=!1:"AND"===c.operator&&(c.met=!0);a=c}}return a},s=function(a,b){for(var c=Object.keys(b),f=!1,e=0;e<c.length;e++){var d=b[c[e]];if(d.id!=a.id&&"undefined"!==typeof d.condition)for(var g=t(d.condition,a),l=0;l<g.length;l++){if(!0===g[l].met)return!0;!1===d.unlocked&&(f=!0)}}if(!0===f)return!1;switch(h){case "linear_success":return 1===
a.score;default:return!0===a.shown}},t=function(a,b){switch(a.type){case "single":if(a.group===b.id)return[a];break;case "multiple":for(var c=[],f=0;f<a.conditions.length;f++)c=c.concat(t(a.conditions[f],b));return c}return[]},u=function(a,b,c){for(var f=0;f<a.los.length;f++)b[a.los[f]].can_be_shown=c;return b},c=void 0,m=void 0,g=function(a,b){if("undefined"===typeof m){if("undefined"!==typeof b){for(var e=[],g=Object.keys(b),l=0;l<g.length;l++)"undefined"!==typeof b[g[l]].groups&&0!==b[g[l]].groups.length||
e.push(g[l]);m=e.length}m=0}switch(h){case "linear_success":case "linear_completion":if("undefined"!==typeof c)return c;for(var e=0,g=Object.keys(a),l=g.length,d=0;d<l;d++)e+=a[g[d]].los.length;break;case "custom":e=f(a);break;default:e=0}return c=e+m},f=function(a){a=JSON.parse(JSON.stringify(a));for(var b=Object.keys(a),c=b.length,e=[],g=0;g<c;g++){var d=a[b[g]];if(!1===d.unlocked&&"undefined"!==typeof d.condition&&!1===d.locked)for(var n=0;n<c;n++){var h=a[b[n]];if(!0===h.unlocked&&!1===h.locked&&
h.id!==d.id){var l=t(d.condition,h);if(0<l.length&&!1===l[0].met){var r=l[0],s={conditionsToMet:[],groupsToLock:[],groupsToUnlock:[]};s.conditionsToMet.push({id:r.id,group:d.id});s.groupsToLock.push(h.id);"multiple"===d.condition.type&&"OR"===d.condition.operator||"single"===d.condition.type?s.groupsToUnlock.push(d.id):"multiple"===d.condition.type&&"AND"===d.condition.operator&&!0===q(r.id,JSON.parse(JSON.stringify(d.condition))).met&&s.groupsToUnlock.push(d.id);for(r=0;r<c;r++){var p=a[b[r]];if(!1===
p.unlocked&&!1===p.locked&&p.id!==d.id&&p.id!==h.id&&"undefined"!==typeof p.condition){var m=t(p.condition,h);if(0<m.length&&!1===m[0].met){var u=!1;switch(l[0].requirement){case "completion":case "completion_higher_inmediate":u=!0;break;case "success":u=-1===["fail","score_lower"].indexOf(m[0].requirement);break;case "fail":u=-1!==["score_higher","score_higher_inmediate","score_lower"].indexOf(m[0].requirement)?100!==m[0].threshold:-1===["success"].indexOf(m[0].requirement);break;case "score_higher":case "score_higher_inmediate":u=
-1!==["success"].indexOf(m[0].requirement)?100===l[0].threshold:-1!==["fail"].indexOf(m[0].requirement)?100>l[0].threshold:-1!==["score_lower"].indexOf(m[0].requirement)?m[0].threshold>l[0].threshold:!0;break;case "score_lower":u=-1!==["score_higher","score_higher_inmediate"].indexOf(m[0].requirement)?l[0].threshold>m[0].threshold:-1===["success"].indexOf(m[0].requirement)}u&&(s.conditionsToMet.push({id:m[0].id,group:p.id}),"multiple"===p.condition.type&&"OR"===p.condition.operator||"single"===p.condition.type?
s.groupsToUnlock.push(p.id):"multiple"===p.condition.type&&"AND"===p.condition.operator&&!0===q(m[0].id,JSON.parse(JSON.stringify(p.condition))).met&&s.groupsToUnlock.push(p.id))}}}e.push(s)}}}}b=e.length;if(0===b){e=0;b=Object.keys(a);c=b.length;for(g=0;g<c;g++)d=a[b[g]],!0===d.unlocked&&Array.isArray(d.los)&&(e+=d.los.length);return e}for(g=c=0;g<b;g++){d=JSON.parse(JSON.stringify(a));for(n=0;n<e[g].groupsToLock.length;n++)d[e[g].groupsToLock[n]].locked=!0;for(n=0;n<e[g].groupsToUnlock.length;n++)d[e[g].groupsToUnlock[n]].unlocked=
!0;for(n=0;n<e[g].conditionsToMet.length;n++)d[e[g].conditionsToMet[n].group].condition=q(e[g].conditionsToMet[n].id,d[e[g].conditionsToMet[n].group].condition);d=f(d);d>c&&(c=d)}return c},q=function(a,b){if(b.id===a)b.met=!0;else if("multiple"===b.type){b.met="AND"===b.operator;for(var c=0;c<b.conditions.length;c++)if(b.conditions[c]=q(a,b.conditions[c]),!0!==b.conditions[c].met&&"AND"===b.operator)b.met=!1;else if(!0===b.conditions[c].met&&"OR"===b.operator){b.met=!0;break}}return b};return{init:function(a){h=
a.approach},initGroupSequence:function(a){a.can_be_shown="undefined"===typeof a.condition||0===Object.keys(a.condition).length;a.locked=!1;a.unlocked=a.can_be_shown;a.shown=!1;a.nshown=0;a.score=!1;a.performance=0;a.condition=p(a.condition);return a},validateSequence:function(c,b){if("object"!==typeof c||"object"!==typeof b)return!1;for(var f=Object.keys(c),e=Object.keys(b),g=0;g<f.length;g++){var d;d=c[f[g]];var h=e;if("undefined"===typeof d.id)d=!1;else{d.id+="";for(var l=[],p=0;p<d.los.length;p++){var r=
d.los[p];-1!==h.indexOf(r)&&l.push(r)}d.los=l;d=1>d.los.length?!1:d}!1!==d?c[f[g]]=d:delete c[f[g]]}c=a(c);f=Object.keys(c);e=[];for(g=0;g<f.length;g++)for(d=c[f[g]],h=0;h<d.los.length;h++)-1===e.indexOf(d.los[h])&&e.push(d.los[h]);return 2>typeof f.length||2>e.length?!1:c},getNLOsForTracking:g,updateGroupsTracking:function(a,b,f){for(var e=a.groups.length,h=0;h<e;h++){var d=b[a.groups[h]];if(!0===d.can_be_shown){for(var l=b,p=a.groups[h],m=d.los.length,q=0,t=0,v=0;v<m;v++){var A=f[d.los[v]];!0===
A.shown&&(q+=1);!0===A.successfully_consumed&&(t+=1)}d.shown=q===m;d.nshown=q;d.score=0<m?t/m:0;d.performance=0<q?t/q:0;l[p]=d}}h=!1;p=Object.keys(b);l=p.length;for(m=0;m<l;m++)d=b[p[m]],!1===d.unlocked&&!1===d.locked&&(q=b,t=p[m],!0!==d.locked&&!0!==d.unlocked&&("undefined"!==typeof d.condition?(d.condition=r(d.condition,b),!0===d.condition.met&&(d.unlocked=!0,d.can_be_shown=!0)):(d.unlocked=!0,d.can_be_shown=!0)),q[t]=d,!0===b[p[m]].unlocked&&(f=u(b[p[m]],f,!0),h=!0));for(m=0;m<e;m++)d=b[a.groups[m]],
!0===d.unlocked&&!1===d.locked&&(q=b,t=a.groups[m],!0!==d.locked&&!1!==d.unlocked&&(v=s(d,b),d.locked=v,d.can_be_shown=!1===d.locked),q[t]=d,!0===b[a.groups[m]].locked&&(f=u(b[a.groups[m]],f,!1),h=!0));a=!0;for(e=0;e<l;e++)if(d=b[p[e]],!0===d.unlocked&&!1===d.locked){a=!1;break}if(a)for(e=Object.keys(f),p=0;p<e.length;p++)if("undefined"===typeof f[e[p]].groups||0===f[e[p]].groups.length)f[e[p]].can_be_shown=!0;!0===h&&25>=l&&(c=g(b,f));return{groups:b,los:f,nLOsForTracking:c,finished:a}}}}();SGAME.API=function(){var h=function(e,h){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(a.responseText);h(e)}};a.open("GET",e,!0);a.send("")};return{init:function(){},requestLOMetadata:function(e,p,a){try{h("undefined"==typeof e?"/lo/random/metadata.json":"/lo/"+e+"/metadata.json",function(a){p(a)})}catch(l){a(l)}}}}();SGAME.CORE=function(){var h={},e=void 0,p="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},l=!1,v={},r={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},s=["repeat","repeat_unless_successfully_consumed","no_repeat"],t=["no_restrictions","n_times","1_per_timeperiod"],u=["random","linear_completion","linear_success","custom"],c="all_los percentage_los n_los n_times disabled onstart".split(" "),
m="all_los percentage_los n_los n_times disabled onstart oncompletion".split(" "),g="no_more_los all_los_consumed all_los_successfully_consumed completion_status success_status never".split(" "),f=["success","failure","success_unless_damage","failure_unless_blocking"],q=!1,k=0,b=0,x=0,w=0,y=0,d=!1,n=void 0,z=!1,B=!1,D=0,G=function(b){a=b;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&
(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===s.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===t.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1===u.indexOf(a.sequencing.approach)&&(a.sequencing.approach="random");-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||delete a.sequencing.interruptions_n;-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&
"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===c.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&
"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);-1===m.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==
typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===g.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===f.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&(p=a.game_settings.completion_notification_text);if("object"===typeof a.los){b=
Object.keys(a.los);k=b.length;for(var d=0;d<k;d++)"undefined"!==typeof a.los[b[d]].url&&(a.los[b[d]].url=SGAME.Utils.checkUrlProtocol(a.los[b[d]].url)),a.los[b[d]].can_be_shown=!0,a.los[b[d]].shown=!1,a.los[b[d]].nshown=0,a.los[b[d]].successfully_consumed=!1,a.los[b[d]].nsuccess=0,a.los[b[d]].unsuccessfully_consumed=!1,a.los[b[d]].acts_as_asset="asset"===a.los[b[d]].scorm_type||"sco"===a.los[b[d]].scorm_type&&!1===a.los[b[d]].report_data,q=!0}"random"!==a.sequencing.approach&&(b=SGAME.Sequencing.validateSequence(a.sequencing.sequence,
a.los),!1===b?a.sequencing.approach="random":(a.sequencing.sequence=b,z=!0));"random"===a.sequencing.approach&&delete a.sequencing.sequence;if(!0===z){b=Object.keys(a.los);k=b.length;for(d=0;d<k;d++)a.los[b[d]].can_be_shown=!1,a.los[b[d]].groups=[];q=!1;d=Object.keys(a.sequencing.sequence);_nGroups=d.length;for(var e=0;e<_nGroups;e++){a.sequencing.sequence[d[e]]=SGAME.Sequencing.initGroupSequence(a.sequencing.sequence[d[e]]);for(var h=a.sequencing.sequence[d[e]],l=0;l<h.los.length;l++)a.los[h.los[l]].groups.push(h.id),
a.los[h.los[l]].can_be_shown=!0===h.can_be_shown,!0===a.los[h.los[l]].can_be_shown&&(q=!0)}for(d=0;d<k;d++)"undefined"!==typeof a.los[b[d]].groups&&0!==a.los[b[d]].groups.length||delete a.los[b[d]];k=Object.keys(a.los).length}"string"!==typeof a.assets_path&&(a.assets_path="/assets/sgame/");SGAME.Fancybox.init(a.assets_path);SGAME.TrafficLight.init(a.assets_path);SGAME.Sequencing.init(a.sequencing);!0===z&&(D=SGAME.Sequencing.getNLOsForTracking(a.sequencing.sequence,a.los))},E=function(b,c){var d=
H(b);if(1>d.length)return A(b,c);var f=I(d);if(0<f.length){d=void 0;switch(a.sequencing.approach){case "linear_completion":case "linear_success":case "custom":if(!0===z&&!1===B){for(var d=[],e=[],g=[],k=0;k<f.length;k++)g.push(f[k].id);f=Object.keys(a.sequencing.sequence);for(k=0;k<f.length;k++){var h=a.sequencing.sequence[f[k]];if(!0===h.can_be_shown)for(var l=0;l<h.los.length;l++)-1!==g.indexOf(h.los[l])&&-1===e.indexOf(h.los[l])&&(e.push(h.los[l]),d.push(a.los[h.los[l]]))}}else d=f;d=J(d);break;
default:d=J(f)}selectedLO=d;F(selectedLO,c)}else"function"===typeof c&&(d=K(b),c(d.success,d))},A=function(a,b){if("function"===typeof b){var c=K(a);b(c.success,c)}},H=function(b){var c=[];b=a.event_mapping[b];if("undefined"!==typeof b){var d=b.length;if("number"===typeof d)for(var f=0;f<d;f++){if("*"===b[f]){c=[];b=Object.keys(a.los);for(d=0;d<b.length;d++)"undefined"!==typeof a.los[b[d]]&&c.push(a.los[b[d]]);break}"undefined"!==typeof a.los[b[f]]&&c.push(a.los[b[f]])}}return c},I=function(a){for(var b=
[],c=a.length,d=0;d<c;d++)!0===a[d].can_be_shown&&b.push(a[d]);return b},F=function(b,c){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof c&&c(null,null):(n=new Date,C(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(d){!0!==a.los[b.id].successfully_consumed&&(a.los[b.id].successfully_consumed=d.success);!0===d.success?a.los[b.id].nsuccess+=1:a.los[b.id].unsuccessfully_consumed=!0;if(!0===z&&!1===B){var f=SGAME.Sequencing.updateGroupsTracking(a.los[b.id],
a.sequencing.sequence,a.los);a.sequencing.sequence=f.groups;a.los=f.los;D=f.nLOsForTracking;f.finished&&(B=!0)}switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].successfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}P();d.more_los=q;L(function(){"function"===typeof c&&c(d.success,d);C()})}))},C=function(){"function"===typeof e&&e()},P=function(){var c=Object.keys(a.los);k=c.length;y=w=x=b=0;q=!1;for(var d=0;d<k;d++)!0===
a.los[c[d]].shown&&(b+=1,x+=a.los[c[d]].nshown),!0===a.los[c[d]].successfully_consumed&&(w+=1,y+=a.los[c[d]].nsuccess),!0===a.los[c[d]].can_be_shown&&(q=!0);c=k;!0===z&&(c=!0===B?b:D);var d=0,f="incompleted";switch(a.game_settings.completion_status){case "all_los":a.game_settings.completion_status_n=100;case "percentage_los":var e=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100,d=0>=e||0>=c?1:b/c/e;break;case "n_los":e=Math.min(a.game_settings.completion_status_n,c);d=0===e?1:b/
e;break;case "n_times":d=0>=a.game_settings.completion_status_n?1:x/a.game_settings.completion_status_n;break;case "onstart":d=1}d=Math.max(Math.min(1,+d.toFixed(2)),0);f=1===d?"completed":"incompleted";e=0;switch(a.game_settings.success_status){case "all_los":a.game_settings.success_status_n=100;case "percentage_los":e=Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;e=0>=e||0>=c?1:w/c/e;break;case "n_los":e=Math.min(a.game_settings.success_status_n,c);e=0===e?1:b/e;break;case "n_times":e=
0>=a.game_settings.success_status_n?1:y/a.game_settings.success_status_n;break;case "oncompletion":e=d;break;case "onstart":e=1}e=Math.max(Math.min(1,+e.toFixed(2)),0);r={progress_measure:d,completion_status:f,score:e,success_status:1===e?"passed":"failed"};SGAME.Debugger.log("Tracking");SGAME.Debugger.log(r);SGAME.Messenger.sendMessage({key:"tracking",value:r})},L=function(a){!0!==M()?"function"===typeof a&&a(!1):Q(a)},M=function(){if(!0===d)return!1;var c=k;!0===z&&!0===B&&(c=b);switch(a.game_settings.completion_notification){case "no_more_los":return!1===
q;case "all_los_consumed":return b>=c;case "all_los_successfully_consumed":return w>=c;case "completion_status":return"completed"===r.completion_status;case "success_status":return"passed"===r.success_status;case "never":return!1;default:return!1}},Q=function(a){d=!0;SGAME.Fancybox.create({dialog:!0,msg:p},function(){"function"===typeof a&&a(!0)})},J=function(a){for(var b=[],c,d=0;d<a.length;d++)"undefined"===typeof c&&(c=a[d].nshown),a[d].nshown<c&&(c=a[d].nshown,b=[]),c===a[d].nshown&&b.push(a[d]);
return SGAME.Utils.getRandomElement(b)},K=function(a){return{lo_metadata:void 0,time:void 0,scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:N(a),more_los:q}},N=function(b){var c;l&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?c=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof h.behaviour_when_no_more_los?c=h.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&
(c=a.game_settings.behaviour_when_no_more_los);return R(c,b)},R=function(a,b){switch(a){case "success":return!0;case "failure":return!1;case "success_unless_damage":var c=O(b);return"undefined"!==typeof c&&"damage"===c.type?!1:!0;case "failure_unless_blocking":return c=O(b),"undefined"===typeof c||"blocking"!==c.type?!1:!0;default:return!1}},O=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof h.events&&"undefined"!==typeof h.events[b]?h.events[b]:{}};SGAME.Debugger.init(!1);
!1===l&&G({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");SGAME.Debugger.log(a);(h=a)&&"function"===typeof a.togglePause&&(e=a.togglePause)},loadSettings:function(b){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(b);l=!0;G(b);SGAME.Debugger.log("SGAME settings loaded");SGAME.Debugger.log(a)},triggerLO:function(b,c){switch(a.sequencing.interruptions){case "no_restrictions":return E(b,c);case "n_times":return x>=a.sequencing.interruptions_n?
A(b,c):E(b,c);case "1_per_timeperiod":return"undefined"!==typeof n&&(new Date-n)/1E3<=a.sequencing.interruptions_n?A(b,c):E(b,c)}},showLO:F,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){F(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===q?!1:"undefined"===typeof a?q:0<I(H(a)).length},successWhenNoLOs:function(a){return N(a)},onConnectedToVLE:function(){"onstart"===
a.game_settings.completion_status&&(r.progress_measure=1,r.completion_status="completed");"onstart"===a.game_settings.success_status&&(r.score=1,r.success_status="passed");if("onstart"===a.game_settings.completion_status||"onstart"===a.game_settings.success_status)SGAME.Messenger.sendMessage({key:"tracking",value:r}),setTimeout(function(){!0===M()&&(C(),L(function(){C()}))},500)},getVLEData:function(){return v},setVLEData:function(a){return v=a}}}();SGAME.Observer=function(h){var e=!0,p=h,a=h,l=h,v,r,s,t,u,c,m=function(){l=a=p=h;v=Date.now();r=!1;c=u=t=s=h},g=function(){!1===a.acts_as_asset&&"undefined"!==typeof l&&(l.addListener("cmi.success_status",function(a){s=a;"passed"===s&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),l.addListener("cmi.score.scaled",function(a){t=a;0.8<=t&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
l.addListener("cmi.completion_status",function(a){u=a}),l.addListener("cmi.progress_measure",function(a){c=a}))};return{start:function(c,h,k){if(!1===e||"undefined"!=typeof p)return null;e=!1;m();p=c;a=h;l=k;g();SGAME.TrafficLight.changeColor("red");if(!0===a.acts_as_asset){b:{c=a.lom_metadata;if(c.educational&&c.educational.typicalLearningTime&&c.educational.typicalLearningTime.duration&&(c=iso8601Parser.getDuration(c.educational.typicalLearningTime.duration)))break b;c=null}c=!c||0>=c?15:Math.min(0.5*
c,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*c-0.5,0.5*c);SGAME.TrafficLight.changeColor("green",c)}},stop:function(){if(!0===e||"undefined"==typeof p)return null;e=!0;SGAME.TrafficLight.stop();var f=Math.round((Date.now()-v)/1E3);r="green"===SGAME.TrafficLight.getCurrentColor();f={lo_metadata:a,time:f,success:r};"undefined"!=typeof s&&(f.scorm_success_status=s);"undefined"!=typeof t&&(f.scorm_scaled_score=t);"undefined"!=typeof u&&(f.scorm_completion_status=u);"undefined"!=typeof c&&(f.scorm_progress_measure=
c);m();return f},isStopped:function(){return e}}}();SGAME.Utils=function(){var h=void 0;return{init:function(e){},getRandomElement:function(e){if("number"==typeof e)return e;var h;h=e.length-1;if("number"!=typeof h)throw{name:"Invalid number format exception"};h=Math.round(0+Math.random()*(h-0));return e[h]},loadScript:function(e,h){if("string"===typeof e&&"function"===typeof h){var a=document.getElementsByTagName("head")[0];if(a){var l=document.createElement("script");l.setAttribute("src",e);l.setAttribute("type","text/javascript");l.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||h()};l.onload=h;a.appendChild(l)}}},getProtocol:function(){if("undefined"!==typeof h)return h;var e;try{e=document.location.protocol}catch(p){}"string"===typeof e&&(e=e.match(/[\w]+/),e=e instanceof Array&&"string"===typeof e[0]?e[0]:void 0);return h="string"===typeof e?e:"unknown"},checkUrlProtocol:function(e){if("string"===typeof e){var h=e.match(/^https?:\/\//);if(h instanceof Array&&1===h.length){var h=h[0].replace("://",""),a=
SGAME.Utils.getProtocol();if(h!==a)switch(a){case "https":e="https"+e.replace(h,"")}}}return e}}}();
