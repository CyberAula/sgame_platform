iso8601Parser=function(c){return{getDuration:function(f){var c=[31104E3,2592E3,604800,86400,3600,60,1];try{var a;var k=f;f=[2,3,4,5,7,8,9];var x=[0,0,0,0,0,0,0],r;if(k=k.toUpperCase()){if("string"!==typeof k)throw Error("Invalid iso8601 period string '"+k+"'");if(r=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(k))for(k=0;k<f.length;k++){var s=f[k];x[k]=r[s]?+r[s].replace(/[A-Za-z]+/g,""):0}else throw Error("String '"+k+"' is not a valid ISO8601 period.");}a=x}catch(w){return null}for(s=
r=0;s<a.length;s++)r+=a[s]*c[s];return r}}}();function Local_API_1484_11(c){function f(n,a){b.diganostic="The "+n+" of "+a+" must be a proper vocabulary element.";b.errorCode=406;return"false"}function q(n){b.errorCode=402;b.diagnostic="The value for key "+n+" has not been created yet.";return"false"}function a(n,a){b.errorCode=201;b.diagnostic="The value for key "+n+" is not valid.";return"false"}function k(b,a,e){b=b.split(/\./);2>b.length?e[b[0]]=a:(e[b[0]]||(e[b[0]]={}),e=e[b.shift()],k(b.join("."),a,e))}function x(b,a){var e=b.split(/\./),
d;if(2>e.length)try{return a[e[0]]}catch(g){return q(b),"false"}else{d=e.shift();if(a[d])return String(x(e.join("."),a[d]));q(b);return"false"}}function r(b){var a,e=0;for(a in b)b.hasOwnProperty(a)&&(e+=1);return e}function s(a,e){if(b.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(e){case 1:console.error(a);break;case 2:console.warn(a);break;case 4:console.info(a);
break;case 3:console.log(a);break;default:return console.log(a),!1}return!0}3>e&&b.throw_alerts&&alert(a);return!1}function w(a,e){if("function"==typeof b.listeners[a]&&"undefined"!=typeof e)b.listeners[a](e)}function v(b,a){for(var e in a)a.hasOwnProperty(e)&&("object"==typeof b[e]?"object"==typeof a[e]&&(b[e]=v(b[e],a[e])):b[e]=a[e]);return b}function g(b,a){(function(){function b(a,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");n.initCustomEvent(a,e.bubbles,
e.cancelable,e.detail);return n}if("function"===typeof window.CustomEvent)return!1;b.prototype=window.Event.prototype;window.CustomEvent=b})();document.dispatchEvent(new CustomEvent(b,{detail:a}))}function t(b){return"object"!==type(b)||b.nodeType||isWindow(b)?!1:!(b.constructor&&!hasOwn.call(b.constructor.prototype,"isPrototypeOf"))}var b=v({version:"2.4",prefix:"Local_API_1484_11",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"1.0",comments_from_learner:{_children:"comment,location,timestamp",
_count:"0"},comments_from_lms:{_children:"comment,location,timestamp",_count:"0"},completion_status:"unknown",completion_threshold:"0.7",credit:"credit",entry:"ab-initio",exit:"",interactions:{_children:"id,type,objectives,timestamp,correct_responses,weighting,learner_response,result,latency,description",_count:"0"},launch_data:"",learner_id:"100",learner_name:"Simulated User",learner_preference:{_children:"audio_level,language,delivery_speed,audio_captioning",audio_level:"1",language:"",delivery_speed:"1",
audio_captioning:"0"},location:"",max_time_allowed:"",mode:"normal",objectives:{_children:"id,score,success_status,completion_status,description",_count:"0"},progress_measure:"",scaled_passing_score:"0.5",score:{_children:"scaled,raw,min,max",scaled:"",raw:"",min:"",max:""},session_time:"PT0H0M0S",success_status:"unknown",suspend_data:"",time_limit_action:"",total_time:"PT0H0M0S"}},c),d={},e={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",
111:"General Termination Failure",112:"Termination Before Initialization",113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",
403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},l=this;"object"===typeof b.user&&("string"===typeof b.user.name&&(b.CMI.learner_name=b.user.name),"string"===typeof b.user.id&&(b.CMI.learner_id=b.user.id));this.isRunning=function(){return 1===b.initialized&&0===b.terminated};this.Initialize=function(){s(b.prefix+
":  Initializing...",3);b.cmi?(d=b.cmi,"suspend"===d.exit&&(d.entry="resume")):d=b.CMI;b.initialized=1;b.terminated=0;return"true"};this.GetValue=function(a){b.errorCode=0;var e="false";a=a.toString();var g=[];if(this.isRunning()){g=a.split(".");if(0<="|exit|session_time|".indexOf("|"+g[g.length-1]+"|"))return s(b.prefix+": This "+a+" is write only",4),b.errorCode=405,"false";g=a.toLowerCase().split(".");switch(g[0]){case "cmi":switch(e="false",a){case "cmi.exit":case "cmi.session_time":b.errorCode=
405;b.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;case "cmi.learner_name":e=b.CMI.learner_name;break;default:e=x(a.substr(4,a.length),d),"undefined"===e&&(b.errorCode=401,b.diagnostic="Sorry, there was a undefined response from "+a,e="false"),s(b.prefix+": GetValue "+a+" = "+e,4)}}return e}b.errorCode=123;return e};this.SetValue=function(e,g){s(b.prefix+": SetValue: "+e+" = "+g,4);b.errorCode=0;var l=[],m=e.toString(),h=g.toString(),p=0,c=0,p=[];if(this.isRunning()){p=
m.split(".");if("adl"===p[0]&&"id"===p[4]||"comments_from_lms"===p[1]||("comments_from_learner"===p[1]?0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+p[p.length-1]+"|")))return s(b.prefix+": This "+m+" is read only",4),b.errorCode=404,"false";l=m.split(".");switch(l[0]){case "cmi":switch(e){case "cmi.location":1E3<h.length&&s(b.prefix+": Some LMS's might truncate your bookmark as you've passed "+
h.length+" characters of bookmarking data",2);break;case "cmi.progress_measure":p=parseFloat(h);if("number"!=typeof p||isNaN(p))return a(e,h);p=Math.max(0,Math.min(1,p));w(e,p);break;case "cmi.completion_status":if(-1==="|completed|incomplete|not attempted|unknown|".indexOf("|"+h+"|"))return f(e,h);w(e,h);break;case "cmi.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+h+"|"))return f(e,h);break;case "cmi.score.scaled":p=parseFloat(h);if("number"!=typeof p||isNaN(p))return a(e,h);p=Math.max(0,
Math.min(1,p));w(e,p);break;case "cmi.score.min":p=parseFloat(h);if("number"!=typeof p||isNaN(p))return a(e,h);b.CMI.score.min=p;break;case "cmi.score.max":p=parseFloat(h);if("number"!=typeof p||isNaN(p))return a(e,h);b.CMI.score.max=p;break;case "cmi.score.raw":p=parseFloat(h);if("number"!=typeof p||isNaN(p))return a(e,h);c=parseFloat(b.CMI.score.max);c="number"!=typeof c||isNaN(c)?100:c;l=parseFloat(b.CMI.score.min);l="number"!=typeof l||isNaN(l)?0:l;c-=l;0>=c&&(c=100);p=Math.max(0,Math.min(1,(p-
l)/c));w("cmi.score.scaled",p);break;case "cmi.success_status":if(-1==="|passed|failed|unknown|".indexOf("|"+h+"|"))return f(e,h);w(e,h);break;default:switch(l[1]){case "comments_from_lms":return b.errorCode="404",b.diagnostic="The cmi.comments_from_lms element is entirely read only.","false";case "comments_from_learner":if(-1===d.comments_from_learner._children.indexOf(l[3]))return f(e,h);k(m.substr(4,m.length),h,d);d.comments_from_learner._count=(r(d.comments_from_learner)-2).toString();return"true";
case "interactions":if(-1===d.interactions._children.indexOf(l[3]))return f(e,h);d.interactions._count=(r(d.interactions)-2).toString();if(isNaN(parseInt(l[2],10)))return"false";if(!t(d.interactions[l[2]])){if("id"===l[3])return d.interactions[l[2]]={},k(m.substr(4,m.length),h,d),d.interactions._count=(r(d.interactions)-2).toString(),t(d.interactions[l[2]].objectives)||(s(b.prefix+": Constructing objectives object for new interaction",4),d.interactions[l[2]].objectives={},d.interactions[l[2]].objectives._count=
"-1"),t(d.interactions[l[2]].correct_responses)||(s(b.prefix+": Constructing correct responses object for new interaction",4),d.interactions[l[2]].correct_responses={},d.interactions[l[2]].correct_responses._count="-1"),"true";s("Can't add interaction without ID first!",3);return"false"}if("objectives"===l[3]){if("id"===l[5])for(c=parseInt(d.interactions[l[2]].objectives._count,10),p=0;p<c;p+=1){if(d.interactions[l[2]].objectives[p].id===h)return m=e,b.errorCode="351",b.diagnostic="The "+m+" element must be unique.  The value '"+
h+"' has already been set in #"+p,"false"}else return f(e,h);k(m.substr(4,m.length),h,d);d.interactions[l[2]].objectives._count=(r(d.interactions[l[2]].objectives)-1).toString();return"true"}"correct_responses"===l[3]&&(k(m.substr(4,m.length),h,d),d.interactions[l[2]].correct_responses._count=(r(d.interactions[l[2]].correct_responses)-1).toString());k(m.substr(4,m.length),h,d);d.interactions._count=(r(d.interactions)-2).toString();return"true";case "objectives":if("id"===l[3])for(c=parseInt(d.objectives._count,
10),p=0;p<c;p+=1)if(d.objectives[p].id===h)return b.errorCode="351",b.diagnostic="The objectives.id element must be unique.  The value '"+h+"' has already been set in objective #"+p,"false";if("id"!==l[3]&&(p=parseInt(l[2],10),void 0===d.objectives[p]))return b.errorCode="408",b.diagnostic="The objectives.id element must be set before other elements can be set","false";if(isNaN(parseInt(l[2],10)))return"false";k(m.substr(4,m.length),h,d);d.objectives._count=(r(d.objectives)-2).toString();return"true"}}k(m.substr(4,
m.length),h,d)}return"true"}b.errorCode=b.terminated?133:132;return"false"};this.Commit=function(){s(b.prefix+": Commit CMI Object:",4);s(d);s(b.prefix+": Suspend Data Usage "+(Math.round(100*(d.suspend_data.length/64E3)*Math.pow(10,2))/Math.pow(10,2)+"%"));g("StoreData",{runtimedata:d});return"true"};this.Terminate=function(){l.Commit();b.terminated=1;b.initialized=0;return"true"};this.GetErrorString=function(b){return""!==b&&(b=parseInt(b,10),void 0!==e[b])?e[b]:""};this.GetLastError=function(){return b.errorCode};
this.GetDiagnostic=function(){return b.diagnostic};this.setCMILMSValue=function(e,a){"string"==typeof e&&(b.CMI[e]=a)};this.addListener=function(e,a){"string"==typeof e&&"function"==typeof a&&(b.listeners[e]=a)}};function Local_API_SCORM_12(c){function f(b,a){g.diganostic="The "+b+" of "+a+" must be a proper vocabulary element.";g.errorCode=406;return"false"}function q(b){g.errorCode=402;g.diagnostic="The value for key "+b+" has not been created yet.";return"false"}function a(b,a){g.errorCode=201;g.diagnostic="The value for key "+b+" is not valid.";return"false"}function k(b,a,d){b=b.split(/\./);2>b.length?d[b[0]]=a:(d[b[0]]||(d[b[0]]={}),d=d[b.shift()],k(b.join("."),a,d))}function x(b,a){var d=b.split(/\./),
g;if(2>d.length)try{return a[d[0]]}catch(f){return q(b),"false"}else{g=d.shift();if(a[g])return String(x(d.join("."),a[g]));q(b);return"false"}}function r(b,a){if(g.debug){window.console||(window.console={},window.console.info=noconsole,window.console.log=noconsole,window.console.warn=noconsole,window.console.error=noconsole,window.console.trace=noconsole);switch(a){case 1:console.error(b);break;case 2:console.warn(b);break;case 4:console.info(b);break;case 3:console.log(b);break;default:return console.log(b),
!1}return!0}3>a&&g.throw_alerts&&alert(b);return!1}function s(b,a){if("function"==typeof g.listeners[b]&&"undefined"!=typeof a)g.listeners[b](a)}function w(b,a){for(var d in a)a.hasOwnProperty(d)&&("object"==typeof b[d]?"object"==typeof a[d]&&(b[d]=w(b[d],a[d])):b[d]=a[d]);return b}function v(b,a){(function(){function b(a,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var d=document.createEvent("CustomEvent");d.initCustomEvent(a,e.bubbles,e.cancelable,e.detail);return d}if("function"===typeof window.CustomEvent)return!1;
b.prototype=window.Event.prototype;window.CustomEvent=b})();document.dispatchEvent(new CustomEvent(b,{detail:a}))}var g=w({version:"1.1",prefix:"Local_API_SCORM_12",errorCode:0,diagnostic:"",initialized:0,terminated:0,user:void 0,debug:!0,listeners:{},CMI:{_version:"3.4",comments:"",comments_from_lms:"",launch_data:"",suspend_data:"",core:{entry:"ab-initio",credit:"credit",lesson_status:"not attempted",lesson_mode:"normal",lesson_location:"",student_id:"100",student_name:"Simulated User",student_preference:{_children:"audio,language,speed,text",
audio:"0",language:"",speed:"0",text:"0"},score:{_children:"raw,min,max",raw:"",max:"",min:""},total_time:"0000:00:00.00",session_time:"",exit:""},student_data:{_children:"mastery_score,time_limit_action,max_time_allowed",mastery_score:"50",max_time_allowed:"",time_limit_action:"continue,no message"}}},c),t={},b={0:"No error",101:"General exception",102:"General Initialization Failure",103:"Already Initialized",104:"Content Instance Terminated",111:"General Termination Failure",112:"Termination Before Initialization",
113:"Termination After Termination",122:"Retrieve Data Before Initialization",123:"Retrieve Data After Termination",132:"Store Data Before Initialization",133:"Store Data After Termination",142:"Commit Before Initialization",143:"Commit After Termination",201:"General Argument Error",301:"General Get Failure",351:"General Set Failure",391:"General Commit Failure",401:"Undefined Data Model",402:"Unimplemented Data Model Element",403:"Data Model Element Value Not Initialized",404:"Data Model Element Is Read Only",
405:"Data Model Element Is Write Only",406:"Data Model Element Type Mismatch",407:"Data Model Element Value Out Of Range",408:"Data Model Dependency Not Established"},d=this;"object"===typeof g.user&&("string"===typeof g.user.name&&(g.CMI.core.student_name=g.user.name),"string"===typeof g.user.id&&(g.CMI.core.student_id=g.user.id));this.isRunning=function(){return 1===g.initialized&&0===g.terminated};this.LMSInitialize=function(){r(g.prefix+":  Initializing...",3);t=g.CMI;g.initialized=1;g.terminated=
0;return"true"};this.LMSGetValue=function(b){g.errorCode=0;var a="false";b=b.toString();var d=[];if(this.isRunning()){d=b.split(".");if(0<="|exit|session_time|".indexOf("|"+d[d.length-1]+"|"))return g.errorCode=405,"false";d=b.toLowerCase().split(".");switch(d[0]){case "cmi":a=b;b="false";switch(a){case "cmi.core.exit":case "cmi.core.session_time":g.errorCode=405;g.diagnostic="Sorry, this has been specified as a read-only value for "+a;break;default:a=a.replace("cmi.",""),b=x(a,t),"undefined"===b&&
(g.errorCode=401,g.diagnostic="Sorry, there was a undefined response from "+a,b="false")}a=b}return a}g.errorCode=123;return a};this.LMSSetValue=function(b,d){r(g.prefix+": SetValue: "+b+" = "+d,4);g.errorCode=0;var n=[],u=b.toString(),c=d.toString();if(this.isRunning()){var n=u.split("."),m=n[n.length-1],n="adl"===n[0]&&"id"===n[4]?!0:"comments_from_lms"===n[1]?!0:0<="|_version|completion_threshold|credit|entry|launch_data|learner_id|learner_name|_children|_count|mode|maximum_time_allowed|scaled_passing_score|time_limit_action|total_time|comment|".indexOf("|"+
m+"|");if(n)return g.errorCode=404,"false";n=u.split(".");switch(n[0]){case "cmi":switch(b){case "cmi.core.lesson_location":1E3<c.length&&r(g.prefix+": Some LMS's might truncate your bookmark as you've passed "+c.length+" characters of bookmarking data",2);break;case "cmi.core.lesson_status":if(-1==="|passed|completed|failed|incomplete|browsed|not attempted|unknown|".indexOf("|"+c+"|"))return f(b,c);s(b,c);break;case "cmi.core.exit":if(-1==="|time-out|suspend|logout|normal||".indexOf("|"+c+"|"))return f(b,
c);break;case "cmi.core.score.min":n=parseFloat(c);if("number"!=typeof n||isNaN(n))return a(b,c);g.CMI.core.score.min=n;break;case "cmi.core.score.max":n=parseFloat(c);if("number"!=typeof n||isNaN(n))return a(b,c);g.CMI.core.score.max=n;break;case "cmi.core.score.raw":n=parseFloat(c);if("number"!=typeof n||isNaN(n))return a(b,c);var h=parseFloat(g.CMI.core.score.max),h="number"!=typeof h||isNaN(h)?100:h,m=parseFloat(g.CMI.core.score.min),m="number"!=typeof m||isNaN(m)?0:m,h=h-m;0>=h&&(h=100);n=Math.max(0,
Math.min(1,(n-m)/h));s("cmi.score.scaled",n)}u=u.replace("cmi.","");k(u,c,t)}return"true"}g.errorCode=g.terminated?133:132;return"false"};this.LMSCommit=function(){v("StoreData",{runtimedata:t});return"true"};this.LMSTerminate=function(){d.LMSCommit();g.terminated=1;g.initialized=0;return"true"};this.LMSFinish=function(){d.LMSCommit();g.terminated=1;g.initialized=0;return"true"};this.LMSGetErrorString=function(a){return""!==a&&(a=parseInt(a,10),void 0!==b[a])?b[a]:""};this.LMSGetLastError=function(){return g.errorCode};
this.LMSGetDiagnostic=function(){return g.diagnostic};this.setCMILMSValue=function(b,a){"string"==typeof b&&(g.CMI[b]=a)};this.addListener=function(b,a){"string"==typeof b&&"function"==typeof a&&(g.listeners[b]=a)}};SGAME=function(){return{init:function(c){return SGAME.CORE.init(c)},loadSettings:function(c){return SGAME.CORE.loadSettings(c)},triggerLO:function(c,f){return SGAME.CORE.triggerLO(c,f)},showLO:function(c,f){return SGAME.CORE.showLO(c,f)},showRandomLO:function(c){return SGAME.CORE.showRandomLO(c)},closeLO:function(){return SGAME.CORE.closeLO()},getSettings:function(){return SGAME.CORE.getSettings()},losCanBeShown:function(c){return SGAME.CORE.losCanBeShown(c)},successWhenNoLOs:function(c){return SGAME.CORE.successWhenNoLOs(c)}}}();
SGAME.VERSION="1.0.1";SGAME.AUTHORS="Aldo Gordillo";SGAME.URL="https://github.com/ging/sgame_platform";SGAME.Debugger=function(){var c=!1;return{init:function(f){!0===f&&(c=f)},isDebugging:function(){return c},log:function(f){c&&window.console&&console.log(f)}}}();SGAME.Messenger=function(){function c(g,c){this.data=g||{};-1!==["PROTOCOL","APP"].indexOf(c)?this.type=c:this.type="APP";this.origin=a;this.destination=k}var f=["PROTOCOL","APP"],q=["SGAME_GATEWAY","SGAME_API"],a="SGAME_API",k="SGAME_GATEWAY",x=!1,r=!1,s=function(a){try{window.parent.parent.postMessage(a,"*")}catch(c){}},w=function(g){var c;c="object"!==typeof g||"string"!==typeof g.data?!1:v(g.data);if(c)switch(g=JSON.parse(g.data),g.type){case "PROTOCOL":if(g.data)switch(g.data.key){case "onIframeMessengerHello":"SGAME_GATEWAY"===
g.origin&&!0!==r&&(r=!0,g.data.settings=SGAME.CORE.getSettings(),g.destination=g.origin,g.origin=a,s(JSON.stringify(g)),SGAME.CORE.onConnectedToVLE())}break;case "APP":if(g.data&&"string"===typeof g.data.key)switch(g.data.key){case "lms_data":if("object"===typeof g.data.value){c=g.data.value;g={};if("string"===typeof c.name||"number"===typeof c.name)g.name=""+c.name;if("string"===typeof c.id||"number"===typeof c.id)g.id=""+c.id;c=SGAME.CORE.getVLEData();c.user=g;SGAME.CORE.setVLEData(c)}}}},v=function(a){try{if(a=
JSON.parse(a),-1===f.indexOf(a.type)||-1===q.indexOf(a.origin))return!1}catch(c){return!1}return!0};return{init:function(a){if(!x){x=!0;try{window.parent.addEventListener?window.parent.addEventListener("message",w,!1):window.attachEvent&&window.parent.attachEvent("message",w)}catch(c){}}},isConnected:function(){return r},sendMessage:function(a){x&&r&&(a=JSON.stringify(new c(a,void 0)),v(a)&&s(a))}}}();var API,API_1484_11;
SGAME.Fancybox=function(c){var f=c,q=c,a=c,k,x=function(){"undefined"!=typeof f&&(f.style.display="none",f.parentNode.removeChild(f),"lo"===q&&(API_1484_11=API=c),q=f=c)},r=function(){if("undefined"!=typeof f){var k=q;x();var r;r="lo"===k?SGAME.Observer.stop():!0;var v=a;a=c;setTimeout(function(){"function"===typeof v&&v(r)},50)}};return{init:function(a){"string"===typeof a&&(k=a)},create:function(s,w){x();a=w;var v="undefined"!==typeof s&&!0===s.dialog?"dialog":"lo",g=4/3,t,b,d=0.9*window.innerWidth,
e=0.9*window.innerHeight;e*g>d?(t=d,b=t/g):(b=e,t=b*g);if("lo"===v)var l={},n;else var u="";s&&(s.width&&(t=s.width),s.height&&(b=s.height),"lo"===v?s.lo&&(l=s.lo,"string"===typeof l.url&&(n=l.url)):"string"==typeof s.msg&&(u=s.msg));if("lo"===v){if("string"!=typeof n||"undefined"==typeof l.scorm_type)return;var y=c,g=API_1484_11=API=c,m=SGAME.CORE.getVLEData();"object"===typeof m.user&&(g=m.user);"sco"===l.scorm_type&&("1.2"===l.scorm_version?y=API=new Local_API_SCORM_12({user:g,debug:SGAME.Debugger.isDebugging()}):
"2004"===l.scorm_version&&(y=API_1484_11=new Local_API_1484_11({user:g,debug:SGAME.Debugger.isDebugging()})))}g=document.createElement("div");g.style.width=t+"px";g.style.height=b+"px";g.style.maxWidth=d+"px";g.style.maxHeight=e+"px";g.style.overflow="lo"===v?"hidden":"auto";g.style.background="white";g.style.position="absolute";g.style.top=0;g.style.zIndex=9999;g.style.borderRadius="1em";g.style.border="2px solid black";g.setAttribute("id","sgame_fancybox");g.style.marginLeft=(window.innerWidth-
t)/2+"px";g.style.marginTop=(window.innerHeight-b)/2+"px";e=document.createElement("img");e.src=k+"close.png";d=Math.max(25,Math.floor(0.05*b));e.style.width=d+"px";e.style.height=d+"px";e.style.padding="5px";e.style.cursor="pointer";e.style.position="absolute";e.style.right=0;e.onclick=function(){r()};g.appendChild(e);if("lo"===v){var h=document.createElement("img");h.id="trafficLight";h.src=k+"trafficLight/trafficLight_red.png";u=Math.max(40,Math.floor(0.085*b));e=Math.max(30,Math.floor(0.75*u));
h.style.height=u+"px";h.style.width=e+"px";h.style.padding="4px";h.style.position="absolute";h.style.left="0px";h.style.top="0px";h.style.background="#fff";h.style.borderRadius="0px 0px 20px 0px";h.style.borderRight="2px solid black";h.style.borderBottom="2px solid black";g.appendChild(h);h=document.createElement("iframe");h.src=n;n=Math.ceil(Math.max(d,u))+4;u=Math.floor(0.02*b);d=Math.floor(0.02*t);h.style.marginLeft=d+"px";h.style.marginTop=n+"px";h.style.width=Math.max(0,t-d-d)+"px";h.style.height=
Math.max(0,b-n-u)+"px";h.style.overflow="auto";h.scrolling="yes";h.style.frameBorder="0";h.style.borderStyle="none";h.setAttribute("allowfullscreen","false");g.appendChild(h)}else t=document.createElement("p"),t.id="dialog",t.innerHTML=u,t.style.padding="15px",t.style.marginTop="30px",t.style.marginBottom="20px",t.style.marginRight="20px",t.style.marginLeft="20px",t.style.textAlign="center",t.style.fontSize="24px",t.style.position="relative",t.style.cursor="default",t.style.color="#000",t.style.fontFamily=
"initial",g.appendChild(t);f=g;q=v;document.body.appendChild(g);"lo"===v&&SGAME.Observer.start(h,l,y)},closeCurrentFancybox:r}}();SGAME.TrafficLight=function(c){var f,q,a,k,x,r,s=function(a){var c=document.getElementById("trafficLight");c&&(f=a,c.src=w(a))},w=function(a){switch(a){case "green":return r+"trafficLight/trafficLight_green.png";case "yellow":return r+"trafficLight/trafficLight_yellow.png";case "red":return r+"trafficLight/trafficLight_red.png";default:return r+"trafficLight/trafficLight.png"}},v=function(a,c){var b=document.getElementById("trafficLight");if(b){var d=!1;k=setInterval(function(){b&&(d?(b.src=w(null),
d=!1):(b.src=w(a),d=!0))},500);x=setTimeout(function(){clearTimeout(k)},1E3*c)}};return{init:function(a){"string"===typeof a&&(r=a)},getCurrentColor:function(){return f},changeColor:function(a,c){c?q=setTimeout(function(){s(a)},1E3*c):s(a)},setUpBlink:function(g,c,b){b?a=setTimeout(function(){v(g,c)},1E3*b):v(g,c)},stop:function(){q&&clearTimeout(q);a&&clearTimeout(a);k&&clearTimeout(k);x&&clearTimeout(x)}}}();SGAME.Sequencing=function(){var c,f="completion completion_higher_inmediate success fail score_higher score_higher_inmediate score_lower".split(" "),q=function(b){if("object"!==typeof b)return b;b.met=!1;if("multiple"===b.type&&Array.isArray(b.conditions))for(var a=0;a<b.conditions.length;a++)b.conditions[a]=q(b.conditions[a]);return b},a=function(b){for(var d=Object.keys(b),e=d.length,l=0;l<e;l++){if("undefined"===typeof b[d[l]].condition&&"undefined"!==typeof b[d[l]].conditions){for(var g=b,c=d[l],
f=b[d[l]],m={id:1,type:"multiple",operator:"AND",conditions:f.conditions},h=0;h<m.conditions.length;h++)m.conditions[h].id=h+2,m.conditions[h].type="single";f.condition=m;delete f.conditions;g[c]=f}"undefined"!==typeof b[d[l]].condition&&(b[d[l]].condition=k(b[d[l]].condition,d),!1===b[d[l]].condition&&delete b[d[l]])}return Object.keys(b).length===e?b:a(b)},k=function(a,d){if("object"!==typeof a||"undefined"===typeof a.id)return!1;a.id+="";switch(a.type){case "single":return x(a,d);case "multiple":var e;
a:if(-1===["AND","OR"].indexOf(a.operator)||!1===Array.isArray(a.conditions)||1>a.conditions.length)e=!1;else{for(e=0;e<a.conditions.length;e++)if(a.conditions[e]=k(a.conditions[e],d),!1===a.conditions[e]){e=!1;break a}e=a}return e;default:return!1}},x=function(a,d){if("undefined"===typeof a.group)return!1;a.group+="";if(-1===d.indexOf(a.group)||-1===f.indexOf(a.requirement))return!1;if(-1!==["completion_higher_inmediate","score_higher","score_higher_inmediate","score_lower"].indexOf(a.requirement)){if("string"===
typeof a.threshold){if(!0===isNaN(a.threshold))return!1;a.threshold=parseInt(a.threshold)/100}if("number"!==typeof a.threshold||0>a.threshold||1<a.threshold||"score_lower"===a.requirement&&0===a.threshold)return!1}return a},r=function(a,d){if("undefined"===typeof a||!0===a.met)return a;switch(a.type){case "single":var e=a,l=d[e.group],g=!0===l.shown,c=!1;switch(e.requirement){case "completion":c=g;break;case "completion_higher_inmediate":c=l.nshown/l.los.length>=e.threshold;break;case "success":c=
g&&1===l.score;break;case "fail":c=g&&1>l.score;break;case "score_higher":c=g&&l.score>=e.threshold;break;case "score_higher_inmediate":c=l.score>=e.threshold;break;case "score_lower":c=g&&l.score<e.threshold}e.met=c;a=e;break;case "multiple":a:{e=a;for(l=0;l<e.conditions.length;l++)if(e.conditions[l]=r(e.conditions[l],d),"OR"===e.operator&&!0===e.conditions[l].met){e.met=!0;a=e;break a}else if("AND"===e.operator&&!1===e.conditions[l].met){e.met=!1;a=e;break a}"OR"===e.operator?e.met=!1:"AND"===e.operator&&
(e.met=!0);a=e}}return a},s=function(a,d){for(var e=Object.keys(d),g=!1,n=0;n<e.length;n++){var u=d[e[n]];if(u.id!=a.id&&"undefined"!==typeof u.condition)for(var f=w(u.condition,a),m=0;m<f.length;m++){if(!0===f[m].met)return!0;!1===u.unlocked&&(g=!0)}}if(!0===g)return!1;switch(c){case "linear_success":return 1===a.score;default:return!0===a.shown}},w=function(a,d){switch(a.type){case "single":if(a.group===d.id)return[a];break;case "multiple":for(var e=[],g=0;g<a.conditions.length;g++)e=e.concat(w(a.conditions[g],
d));return e}return[]},v=function(a,d,e){for(var g=0;g<a.los.length;g++)d[a.los[g]].can_be_shown=e;return d},g=function(a){a=JSON.parse(JSON.stringify(a));for(var d=Object.keys(a),e=d.length,c=[],n=0;n<e;n++){var u=a[d[n]];if(!1===u.unlocked&&"undefined"!==typeof u.condition)for(var f=0;f<e;f++){var m=a[d[f]];if(!0===m.unlocked&&!1===m.locked&&m.id!==u.id){var h=w(u.condition,m);0<h.length&&(h=h[0],m={conditionId:h.id,conditionGroup:u.id,lockGroupId:m.id},"multiple"===u.condition.type&&"OR"===u.condition.operator||
"single"===u.condition.type?m.unlockGroupId=u.id:"multiple"===u.condition.type&&"AND"===u.condition.operator&&!0===t(h.id,u.condition).met&&(m.unlockGroupId=u.id),c.push(m))}}}d=c.length;if(0===d){c=0;m=Object.keys(a);d=m.length;for(e=0;e<d;e++)n=a[m[e]],!0===n.unlocked&&Array.isArray(n.los)&&(c+=n.los.length);return c}for(n=e=0;n<d;n++)m=JSON.parse(JSON.stringify(a)),m[c[n].lockGroupId].locked=!0,"undefined"!==typeof c[n].unlockGroupId?m[c[n].unlockGroupId].unlocked=!0:m[c[n].conditionGroup].condition=
t(c[n].conditionId,m[c[n].conditionGroup].condition),m=g(m),m>e&&(e=m);return e},t=function(a,d){if(d.id===a)d.met=!0;else if("multiple"===d.type){d.met=!0;for(var e=0;e<d.conditions.length;e++)d.conditions[e]=t(a,d.conditions[e]),!0!==d.conditions[e].met&&(d.met=!1)}return d};return{init:function(a){c=a.approach},initGroupSequence:function(a){a.can_be_shown="undefined"===typeof a.condition||0===Object.keys(a.condition).length;a.locked=!1;a.unlocked=a.can_be_shown;a.shown=!1;a.nshown=0;a.score=!1;
a.performance=0;a.condition=q(a.condition);return a},validateSequence:function(b,d){if("object"!==typeof b||"object"!==typeof d)return!1;for(var e=Object.keys(b),g=Object.keys(d),c=0;c<e.length;c++){var f;f=b[e[c]];var k=g;if("undefined"===typeof f.id)f=!1;else{f.id+="";for(var m=[],h=0;h<f.los.length;h++){var p=f.los[h];-1!==k.indexOf(p)&&m.push(p)}f.los=m;f=1>f.los.length?!1:f}!1!==f?b[e[c]]=f:delete b[e[c]]}b=a(b);e=Object.keys(b);g=[];for(c=0;c<e.length;c++)for(f=b[e[c]],k=0;k<f.los.length;k++)-1===
g.indexOf(f.los[k])&&g.push(f.los[k]);return 2>typeof e.length||2>g.length?!1:b},getNLOsForTracking:g,updateGroupsTracking:function(a,d,e){for(var g=0;g<a.groups.length;g++){var c=d[a.groups[g]];if(!0===c.can_be_shown){for(var f=d,k=a.groups[g],m=c.los.length,h=0,p=0,q=0;q<m;q++){var t=e[c.los[q]];!0===t.shown&&(h+=1);!0===t.successfully_consumed&&(p+=1)}c.shown=h===m;c.nshown=h;c.score=0<m?p/m:0;c.performance=0<h?p/h:0;f[k]=c}}g=Object.keys(d);for(k=0;k<g.length;k++)f=d[g[k]],!1===f.unlocked&&!1===
f.locked&&(c=d,m=g[k],!0!==f.locked&&!0!==f.unlocked&&("undefined"!==typeof f.condition?(f.condition=r(f.condition,d),!0===f.condition.met&&(f.unlocked=!0,f.can_be_shown=!0)):(f.unlocked=!0,f.can_be_shown=!0)),c[m]=f,!0===d[g[k]].unlocked&&(e=v(d[g[k]],e,!0)));for(k=0;k<a.groups.length;k++)f=d[a.groups[k]],!0===f.unlocked&&!1===f.locked&&(c=d,m=a.groups[k],!0!==f.locked&&!1!==f.unlocked&&(h=s(f,d),f.locked=h,f.can_be_shown=!1===f.locked),c[m]=f,!0===d[a.groups[k]].locked&&(e=v(d[a.groups[k]],e,!1)));
a=!0;for(k=0;k<g.length;k++)if(f=d[g[k]],!0===f.unlocked&&!1===f.locked){a=!1;break}if(a)for(g=Object.keys(e),f=0;f<g.length;f++)if("undefined"===typeof e[g[f]].groups||0===e[g[f]].groups.length)e[g[f]].can_be_shown=!0;return{groups:d,los:e,finished:a}}}}();SGAME.API=function(){var c=function(c,q){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var c=JSON.parse(a.responseText);q(c)}};a.open("GET",c,!0);a.send("")};return{init:function(){},requestLOMetadata:function(f,q,a){try{c("undefined"==typeof f?"/lo/random/metadata.json":"/lo/"+f+"/metadata.json",function(a){q(a)})}catch(k){a(k)}}}}();SGAME.CORE=function(){var c={},f=void 0,q="Congratulations. You have achieved the objectives of this educational game. You may close this window or continue playing.",a={},k=!1,x={},r={progress_measure:0,completion_status:"incompleted",score:0,success_status:"unknown"},s=["repeat","repeat_unless_successfully_consumed","no_repeat"],w=["no_restrictions","n_times","1_per_timeperiod"],v=["random","linear_completion","linear_success","custom"],g="all_los percentage_los n_los n_times disabled onstart".split(" "),
t="all_los percentage_los n_los n_times disabled onstart oncompletion".split(" "),b="no_more_los all_los_consumed all_los_successfully_consumed completion_status success_status never".split(" "),d=["success","failure","success_unless_damage","failure_unless_blocking"],e=!1,l=0,n=0,u=0,y=0,m=0,h=!1,p=void 0,z=!1,A=!1,F=0,G=function(c){a=c;"undefined"===typeof a.game_metadata&&(a.game_metadata={});"undefined"===typeof a.los&&(a.los={});"undefined"===typeof a.events&&(a.events={});"undefined"===typeof a.event_mapping&&
(a.event_mapping={});"undefined"===typeof a.sequencing&&(a.sequencing={});-1===s.indexOf(a.sequencing.repeat_lo)&&(a.sequencing.repeat_lo="repeat");-1===w.indexOf(a.sequencing.interruptions)&&(a.sequencing.interruptions="no_restrictions");-1===v.indexOf(a.sequencing.approach)&&(a.sequencing.approach="random");-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&"number"===typeof a.sequencing.interruptions_n||delete a.sequencing.interruptions_n;-1!==["n_times","1_per_timeperiod"].indexOf(a.sequencing.interruptions)&&
"number"!==typeof a.sequencing.interruptions_n&&(a.sequencing.interruptions="no_restrictions");"undefined"===typeof a.game_settings&&(a.game_settings={});-1===g.indexOf(a.game_settings.completion_status)&&(a.game_settings.completion_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&"number"===typeof a.game_settings.completion_status_n||delete a.game_settings.completion_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.completion_status)&&
"number"!==typeof a.game_settings.completion_status_n&&(a.game_settings.completion_status="disabled",delete a.game_settings.completion_status_n);-1===t.indexOf(a.game_settings.success_status)&&(a.game_settings.success_status="disabled");-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"===typeof a.game_settings.success_status_n||delete a.game_settings.success_status_n;-1!==["percentage_los","n_los","n_times"].indexOf(a.game_settings.success_status)&&"number"!==
typeof a.game_settings.success_status_n&&(a.game_settings.success_status="disabled",delete a.game_settings.success_status_n);-1===b.indexOf(a.game_settings.completion_notification)&&(a.game_settings.completion_notification="never");-1===d.indexOf(a.game_settings.behaviour_when_no_more_los)&&(a.game_settings.behaviour_when_no_more_los="success_unless_damage");"string"===typeof a.game_settings.completion_notification_text&&(q=a.game_settings.completion_notification_text);if("object"===typeof a.los){c=
Object.keys(a.los);l=c.length;for(var f=0;f<l;f++)"undefined"!==typeof a.los[c[f]].url&&(a.los[c[f]].url=SGAME.Utils.checkUrlProtocol(a.los[c[f]].url)),a.los[c[f]].can_be_shown=!0,a.los[c[f]].shown=!1,a.los[c[f]].nshown=0,a.los[c[f]].successfully_consumed=!1,a.los[c[f]].nsuccess=0,a.los[c[f]].unsuccessfully_consumed=!1,a.los[c[f]].acts_as_asset="asset"===a.los[c[f]].scorm_type||"sco"===a.los[c[f]].scorm_type&&!1===a.los[c[f]].report_data,e=!0}"random"!==a.sequencing.approach&&(c=SGAME.Sequencing.validateSequence(a.sequencing.sequence,
a.los),!1===c?a.sequencing.approach="random":(a.sequencing.sequence=c,z=!0));"random"===a.sequencing.approach&&delete a.sequencing.sequence;if(!0===z){c=Object.keys(a.los);l=c.length;for(f=0;f<l;f++)a.los[c[f]].can_be_shown=!1,a.los[c[f]].groups=[];e=!1;f=Object.keys(a.sequencing.sequence);_nGroups=f.length;for(var h=0;h<_nGroups;h++){a.sequencing.sequence[f[h]]=SGAME.Sequencing.initGroupSequence(a.sequencing.sequence[f[h]]);for(var k=a.sequencing.sequence[f[h]],m=0;m<k.los.length;m++)a.los[k.los[m]].groups.push(k.id),
a.los[k.los[m]].can_be_shown=!0===k.can_be_shown,!0===a.los[k.los[m]].can_be_shown&&(e=!0)}for(f=0;f<l;f++)"undefined"!==typeof a.los[c[f]].groups&&0!==a.los[c[f]].groups.length||delete a.los[c[f]];l=Object.keys(a.los).length;F=SGAME.Sequencing.getNLOsForTracking(a.sequencing.sequence)}"string"!==typeof a.assets_path&&(a.assets_path="/assets/sgame/");SGAME.Fancybox.init(a.assets_path);SGAME.TrafficLight.init(a.assets_path);SGAME.Sequencing.init(a.sequencing)},E=function(b,d){var c=H(b);if(1>c.length)return C(b,
d);var e=I(c);if(0<e.length){c=void 0;switch(a.sequencing.approach){case "linear_completion":case "linear_success":case "custom":if(!0===z&&!1===A){for(var c=[],f=[],g=[],h=0;h<e.length;h++)g.push(e[h].id);e=Object.keys(a.sequencing.sequence);for(h=0;h<e.length;h++){var k=a.sequencing.sequence[e[h]];if(!0===k.can_be_shown)for(var l=0;l<k.los.length;l++)-1!==g.indexOf(k.los[l])&&-1===f.indexOf(k.los[l])&&(f.push(k.los[l]),c.push(a.los[k.los[l]]))}}else c=e;c=J(c);break;default:c=J(e)}selectedLO=c;
D(selectedLO,d)}else"function"===typeof d&&(c=K(b),d(c.success,c))},C=function(a,b){if("function"===typeof b){var c=K(a);b(c.success,c)}},H=function(b){var c=[];b=a.event_mapping[b];if("undefined"!==typeof b){var d=b.length;if("number"===typeof d)for(var e=0;e<d;e++){if("*"===b[e]){c=[];b=Object.keys(a.los);for(d=0;d<b.length;d++)"undefined"!==typeof a.los[b[d]]&&c.push(a.los[b[d]]);break}"undefined"!==typeof a.los[b[e]]&&c.push(a.los[b[e]])}}return c},I=function(a){for(var b=[],c=a.length,d=0;d<
c;d++)!0===a[d].can_be_shown&&b.push(a[d]);return b},D=function(b,c){"object"!==typeof b||"string"!==typeof b.url?"function"===typeof c&&c(null,null):(p=new Date,B(),a.los[b.id].shown=!0,a.los[b.id].nshown+=1,SGAME.Fancybox.create({lo:b},function(d){!0!==a.los[b.id].successfully_consumed&&(a.los[b.id].successfully_consumed=d.success);!0===d.success?a.los[b.id].nsuccess+=1:a.los[b.id].unsuccessfully_consumed=!0;if(!0===z&&!1===A){var f=SGAME.Sequencing.updateGroupsTracking(a.los[b.id],a.sequencing.sequence,
a.los);a.sequencing.sequence=f.groups;a.los=f.los;f.finished&&(A=!0)}switch(a.sequencing.repeat_lo){case "repeat_unless_successfully_consumed":a.los[b.id].can_be_shown=!0!==a.los[b.id].successfully_consumed;break;case "no_repeat":a.los[b.id].can_be_shown=!1}P();d.more_los=e;L(function(){"function"===typeof c&&c(d.success,d);B()})}))},B=function(){"function"===typeof f&&f()},P=function(){var b=Object.keys(a.los);l=b.length;m=y=u=n=0;e=!1;for(var d=0;d<l;d++)!0===a.los[b[d]].shown&&(n+=1,u+=a.los[b[d]].nshown),
!0===a.los[b[d]].successfully_consumed&&(y+=1,m+=a.los[b[d]].nsuccess),!0===a.los[b[d]].can_be_shown&&(e=!0);b=l;!0===z&&(b=!0===A?n:F);var d=0,c="incompleted";switch(a.game_settings.completion_status){case "all_los":a.game_settings.completion_status_n=100;case "percentage_los":var f=Math.min(100,Math.max(0,a.game_settings.completion_status_n))/100,d=0>=f||0>=b?1:n/b/f;break;case "n_los":f=Math.min(a.game_settings.completion_status_n,b);d=0===f?1:n/f;break;case "n_times":d=0>=a.game_settings.completion_status_n?
1:u/a.game_settings.completion_status_n;break;case "onstart":d=1}d=Math.max(Math.min(1,+d.toFixed(2)),0);c=1===d?"completed":"incompleted";f=0;switch(a.game_settings.success_status){case "all_los":a.game_settings.success_status_n=100;case "percentage_los":f=Math.min(100,Math.max(0,a.game_settings.success_status_n))/100;f=0>=f||0>=b?1:y/b/f;break;case "n_los":f=Math.min(a.game_settings.success_status_n,b);f=0===f?1:n/f;break;case "n_times":f=0>=a.game_settings.success_status_n?1:m/a.game_settings.success_status_n;
break;case "oncompletion":f=d;break;case "onstart":f=1}f=Math.max(Math.min(1,+f.toFixed(2)),0);r={progress_measure:d,completion_status:c,score:f,success_status:1===f?"passed":"failed"};SGAME.Messenger.sendMessage({key:"tracking",value:r})},L=function(a){!0!==M()?"function"===typeof a&&a(!1):Q(a)},M=function(){if(!0===h)return!1;var b=l;!0===z&&!0===A&&(b=n);switch(a.game_settings.completion_notification){case "no_more_los":return!1===e;case "all_los_consumed":return n>=b;case "all_los_successfully_consumed":return y>=
b;case "completion_status":return"completed"===r.completion_status;case "success_status":return"passed"===r.success_status;case "never":return!1;default:return!1}},Q=function(a){h=!0;SGAME.Fancybox.create({dialog:!0,msg:q},function(){"function"===typeof a&&a(!0)})},J=function(a){for(var b=[],d,c=0;c<a.length;c++)"undefined"===typeof d&&(d=a[c].nshown),a[c].nshown<d&&(d=a[c].nshown,b=[]),d===a[c].nshown&&b.push(a[c]);return SGAME.Utils.getRandomElement(b)},K=function(a){return{lo_metadata:void 0,time:void 0,
scorm_success_status:void 0,scorm_scaled_score:void 0,scorm_completion_status:void 0,scorm_progress_measure:void 0,success:N(a),more_los:e}},N=function(b){var d;k&&"undefined"!==typeof a.game_settings.behaviour_when_no_more_los?d=a.game_settings.behaviour_when_no_more_los:"undefined"!==typeof c.behaviour_when_no_more_los?d=c.behaviour_when_no_more_los:"undefined"!==typeof a.game_settings.behaviour_when_no_more_los&&(d=a.game_settings.behaviour_when_no_more_los);return R(d,b)},R=function(a,b){switch(a){case "success":return!0;
case "failure":return!1;case "success_unless_damage":var d=O(b);return"undefined"!==typeof d&&"damage"===d.type?!1:!0;case "failure_unless_blocking":return d=O(b),"undefined"===typeof d||"blocking"!==d.type?!1:!0;default:return!1}},O=function(b){return"undefined"!==typeof a.events[b]?a.events[b]:"object"===typeof c.events&&"undefined"!==typeof c.events[b]?c.events[b]:{}};SGAME.Debugger.init(!1);!1===k&&G({});SGAME.Messenger.init();return{init:function(a){SGAME.Debugger.log("SGAME init with options ");
SGAME.Debugger.log(a);(c=a)&&"function"===typeof a.togglePause&&(f=a.togglePause)},loadSettings:function(b){SGAME.Debugger.log("SGAME load settings ");SGAME.Debugger.log(b);k=!0;G(b);SGAME.Debugger.log("SGAME settings loaded");SGAME.Debugger.log(a)},triggerLO:function(b,d){switch(a.sequencing.interruptions){case "no_restrictions":return E(b,d);case "n_times":return u>=a.sequencing.interruptions_n?C(b,d):E(b,d);case "1_per_timeperiod":return"undefined"!==typeof p&&(new Date-p)/1E3<=a.sequencing.interruptions_n?
C(b,d):E(b,d)}},showLO:D,showRandomLO:function(a){SGAME.API.requestLOMetadata(void 0,function(b){D(b,a)},function(){"function"===typeof a&&a(null,null)})},closeLO:function(){SGAME.Fancybox.closeCurrentFancybox()},getSettings:function(){return a},losCanBeShown:function(a){return!1===e?!1:"undefined"===typeof a?e:0<I(H(a)).length},successWhenNoLOs:function(a){return N(a)},onConnectedToVLE:function(){"onstart"===a.game_settings.completion_status&&(r.progress_measure=1,r.completion_status="completed");
"onstart"===a.game_settings.success_status&&(r.score=1,r.success_status="passed");if("onstart"===a.game_settings.completion_status||"onstart"===a.game_settings.success_status)SGAME.Messenger.sendMessage({key:"tracking",value:r}),setTimeout(function(){!0===M()&&(B(),L(function(){B()}))},500)},getVLEData:function(){return x},setVLEData:function(a){return x=a}}}();SGAME.Observer=function(c){var f=!0,q=c,a=c,k=c,x,r,s,w,v,g,t=function(){k=a=q=c;x=Date.now();r=!1;g=v=w=s=c},b=function(){!1===a.acts_as_asset&&"undefined"!==typeof k&&(k.addListener("cmi.success_status",function(a){s=a;"passed"===s&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),k.addListener("cmi.score.scaled",function(a){w=a;0.8<=w&&"green"!=SGAME.TrafficLight.getCurrentColor()&&(SGAME.TrafficLight.stop(),SGAME.TrafficLight.changeColor("green"))}),
k.addListener("cmi.completion_status",function(a){v=a}),k.addListener("cmi.progress_measure",function(a){g=a}))};return{start:function(d,c,g){if(!1===f||"undefined"!=typeof q)return null;f=!1;t();q=d;a=c;k=g;b();SGAME.TrafficLight.changeColor("red");if(!0===a.acts_as_asset){b:{d=a.lom_metadata;if(d.educational&&d.educational.typicalLearningTime&&d.educational.typicalLearningTime.duration&&(d=iso8601Parser.getDuration(d.educational.typicalLearningTime.duration)))break b;d=null}d=!d||0>=d?15:Math.min(0.5*
d,120);SGAME.TrafficLight.setUpBlink("yellow",0.5*d-0.5,0.5*d);SGAME.TrafficLight.changeColor("green",d)}},stop:function(){if(!0===f||"undefined"==typeof q)return null;f=!0;SGAME.TrafficLight.stop();var b=Math.round((Date.now()-x)/1E3);r="green"===SGAME.TrafficLight.getCurrentColor();b={lo_metadata:a,time:b,success:r};"undefined"!=typeof s&&(b.scorm_success_status=s);"undefined"!=typeof w&&(b.scorm_scaled_score=w);"undefined"!=typeof v&&(b.scorm_completion_status=v);"undefined"!=typeof g&&(b.scorm_progress_measure=
g);t();return b},isStopped:function(){return f}}}();SGAME.Utils=function(){var c=void 0;return{init:function(c){},getRandomElement:function(c){if("number"==typeof c)return c;var q;q=c.length-1;if("number"!=typeof q)throw{name:"Invalid number format exception"};q=Math.round(0+Math.random()*(q-0));return c[q]},loadScript:function(c,q){if("string"===typeof c&&"function"===typeof q){var a=document.getElementsByTagName("head")[0];if(a){var k=document.createElement("script");k.setAttribute("src",c);k.setAttribute("type","text/javascript");k.onreadystatechange=
function(){"complete"!=this.readyState&&"loaded"!=this.readyState||q()};k.onload=q;a.appendChild(k)}}},getProtocol:function(){if("undefined"!==typeof c)return c;var f;try{f=document.location.protocol}catch(q){}"string"===typeof f&&(f=f.match(/[\w]+/),f=f instanceof Array&&"string"===typeof f[0]?f[0]:void 0);return c="string"===typeof f?f:"unknown"},checkUrlProtocol:function(c){if("string"===typeof c){var q=c.match(/^https?:\/\//);if(q instanceof Array&&1===q.length){var q=q[0].replace("://",""),a=
SGAME.Utils.getProtocol();if(q!==a)switch(a){case "https":c="https"+c.replace(q,"")}}}return c}}}();
