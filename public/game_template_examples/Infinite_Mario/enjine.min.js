var Enjine={GameCanvas:function(){this.BackBufferContext2D=this.BackBuffer=this.Context2D=this.Canvas=null}};Enjine.GameCanvas.prototype={Initialize:function(t,e,i){this.Canvas=document.getElementById(t),this.Context2D=this.Canvas.getContext("2d"),this.BackBuffer=document.createElement("canvas"),this.BackBuffer.width=e,this.BackBuffer.height=i,this.BackBufferContext2D=this.BackBuffer.getContext("2d")},BeginDraw:function(){this.BackBufferContext2D.clearRect(0,0,this.BackBuffer.width,this.BackBuffer.height),this.Context2D.clearRect(0,0,this.Canvas.width,this.Canvas.height)},EndDraw:function(){this.Context2D.drawImage(this.BackBuffer,0,0,this.BackBuffer.width,this.BackBuffer.height,0,0,this.Canvas.width,this.Canvas.height)}},Enjine.Keys={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:80,Left:37,Up:38,Right:39,Down:40},Enjine.KeyboardInput={Pressed:[],Initialize:function(){var t=this;document.addEventListener("keydown",e=>{t.KeyDownEvent(e)}),document.addEventListener("keyup",e=>{t.KeyUpEvent(e)})},IsKeyDown:function(t){return this.Pressed[t]},KeyDownEvent:function(t){this.Pressed[t.keyCode]=!0,this.PreventScrolling(t)},KeyUpEvent:function(t){this.Pressed[t.keyCode]=!1,this.PreventScrolling(t)},PreventScrolling:function(t){t.keyCode>=37&&t.keyCode<=40&&t.preventDefault()},ReleaseKeys:function(t){this.Pressed=[]}},Enjine.Resources={Images:{},Sounds:{},Destroy:function(){return delete this.Images,delete this.Sounds,this},AddImage:function(t,e){var i=new Image;return this.Images[t]=i,i.src=e,this},AddImages:function(t){for(var e=0;e<t.length;e++){var i=new Image;this.Images[t[e].name]=i,i.src=t[e].src}return this},ClearImages:function(){return delete this.Images,this.Images={},this},RemoveImage:function(t){return delete this.Images[t],this},AddSound:function(t,e,i){this.Sounds[t]=[],this.Sounds[t].index=0,i||(i=3);for(var n=0;n<i;n++)this.Sounds[t][n]=new Audio(e);return this},ClearSounds:function(){return delete this.Sounds,this.Sounds={},this},RemoveSound:function(t){return delete this.Sounds[t],this},PlaySound:function(t,e){return this.Sounds[t].index>=this.Sounds[t].length&&(this.Sounds[t].index=0),e&&this.Sounds[t][this.Sounds[t].index].addEventListener("ended",this.LoopCallback,!1),this.Sounds[t][this.Sounds[t].index++].play(),this.Sounds[t].index},PauseChannel:function(t,e){return this.Sounds[t][e].paused||this.Sounds[t][e].pause(),this},PauseSound:function(t){for(var e=0;e<this.Sounds[t].length;e++)this.Sounds[t][e].paused||this.Sounds[t][e].pause();return this},ResetChannel:function(t,e){return this.Sounds[t][e].currentTime=0,this.StopLoop(t,e),this},ResetSound:function(t){for(var e=0;e<this.Sounds[t].length;e++)this.Sounds[t].currentTime=0,this.StopLoop(t,e);return this},StopLoop:function(t,e){this.Sounds[t][e].removeEventListener("ended",this.LoopCallback,!1)},LoopCallback:function(){this.currentTime=-1,this.play()}},Enjine.Drawable=function(){this.ZOrder=0},Enjine.Drawable.prototype={Draw:function(){}},Enjine.GameStateContext=function(t){this.State=null,null!=t&&(this.State=t,this.State.Enter())},Enjine.GameStateContext.prototype={ChangeState:function(t){null!=this.State&&this.State.Exit(),this.State=t,this.State.Enter()},Update:function(t){this.State.CheckForChange(this),this.State.Update(t)},Draw:function(t){this.State.Draw(t)}},Enjine.GameState=function(){},Enjine.GameState.prototype={Enter:function(){},Exit:function(){},Update:function(){},Draw:function(){},CheckForChange:function(){}},Enjine.GameTimer=function(){this.FramesPerSecond=1e3/30,this.LastTime=0,this.UpdateObject=this.IntervalFunc=null},Enjine.GameTimer.prototype={Start:function(){this.LastTime=(new Date).getTime();var t=this;this.IntervalFunc=setInterval(function(){t.Tick()},this.FramesPerSecond)},Tick:function(){if(null!=this.UpdateObject){var t=(new Date).getTime(),e=(t-this.LastTime)/1e3;this.LastTime=t,this.UpdateObject.Update(e)}},Stop:function(){clearInterval(this.IntervalFunc)}},Enjine.Camera=function(){this.Y=this.X=0},Enjine.DrawableManager=function(){this.Unsorted=!0,this.Objects=[]},Enjine.DrawableManager.prototype={Add:function(t){this.Objects.push(t),this.Unsorted=!0},AddRange:function(t){this.Objects=this.Objects.concat(t),this.Unsorted=!0},Clear:function(){this.Objects.splice(0,this.Objects.length)},Contains:function(t){for(var e=this.Objects.length;e--;)if(this.Objects[e]===t)return!0;return!1},Remove:function(t){this.Objects.splice(this.Objects.indexOf(t),1)},RemoveAt:function(t){this.Objects.splice(t,1)},RemoveRange:function(t,e){this.Objects.splice(t,e)},RemoveList:function(t){var e=0,i=0;for(i=0;i<t.length;)for(e=0;e<this.Objects.length;e++)if(this.Objects[e]===t[i]){this.Objects.splice(e,1),t.splice(i,1),i--;break}},Update:function(t){var e=0;for(e=0;e<this.Objects.length;e++)this.Objects[e].Update&&this.Objects[e].Update(t)},Draw:function(t,e){this.Unsorted&&(this.Unsorted=!1,this.Objects.sort(function(t,e){return t.ZOrder-e.ZOrder}));var i=0;for(i=0;i<this.Objects.length;i++)this.Objects[i].Draw&&this.Objects[i].Draw(t,e)}},Enjine.Sprite=function(){this.Y=this.X=0,this.Image=null},Enjine.Sprite.prototype=new Enjine.Drawable,Enjine.Sprite.prototype.Draw=function(t,e){t.drawImage(this.Image,this.X-e.X,this.Y-e.Y)},Enjine.SpriteFont=function(t,e,i,n,s){this.Image=e,this.Letters=s,this.LetterWidth=i,this.LetterHeight=n,this.Strings=t},Enjine.SpriteFont.prototype=new Enjine.Drawable,Enjine.SpriteFont.prototype.Draw=function(t){for(var e=0;e<this.Strings.length;e++)for(var i=this.Strings[e],n=0;n<i.String.length;n++){var s=i.String.charCodeAt(n);t.drawImage(this.Image,this.Letters[s].X,this.Letters[s].Y,this.LetterWidth,this.LetterHeight,i.X+this.LetterWidth*(n+1),i.Y,this.LetterWidth,this.LetterHeight)}},Enjine.FrameSprite=function(){this.FrameHeight=this.FrameWidth=this.FrameY=this.FrameX=0},Enjine.FrameSprite.prototype=new Enjine.Sprite,Enjine.FrameSprite.prototype.Draw=function(t,e){t.drawImage(this.Image,this.FrameX,this.FrameY,this.FrameWidth,this.FrameHeight,this.X-e.X,this.Y-e.Y,this.FrameWidth,this.FrameHeight)},Enjine.AnimationSequence=function(t,e,i,n){this.StartRow=t,this.StartColumn=e,this.EndRow=i,this.EndColumn=n,this.SingleFrame=!1,this.StartRow==this.EndRow&&this.StartColumn==this.EndColumn&&(this.SingleFrame=!0)},Enjine.AnimatedSprite=function(){this.LastElapsed=0,this.FramesPerSecond=.05,this.CurrentSequence=null,this.Looping=this.Playing=!1,this.Columns=this.Rows=0,this.Sequences={}},Enjine.AnimatedSprite.prototype=new Enjine.FrameSprite,Enjine.AnimatedSprite.prototype.Update=function(t){this.CurrentSequence.SingleFrame||!this.Playing||(this.LastElapsed-=t,this.LastElapsed>0)||(this.LastElapsed=this.FramesPerSecond,this.FrameX+=this.FrameWidth,this.FrameX>this.Image.width-this.FrameWidth&&(this.FrameX=0,this.FrameY+=this.FrameHeight,this.FrameY>this.Image.height-this.FrameHeight)&&(this.FrameY=0),t=!1,this.FrameX>this.CurrentSequence.EndColumn*this.FrameWidth&&this.FrameY==this.CurrentSequence.EndRow*this.FrameHeight?t=!0:0==this.FrameX&&this.FrameY>this.CurrentSequence.EndRow*this.FrameHeight&&(t=!0),t&&(this.Looping?(this.FrameX=this.CurrentSequence.StartColumn*this.FrameWidth,this.FrameY=this.CurrentSequence.StartRow*this.FrameHeight):this.Playing=!1))},Enjine.AnimatedSprite.prototype.PlaySequence=function(t,e){this.Playing=!0,this.Looping=e,this.CurrentSequence=this.Sequences["seq_"+t],this.FrameX=this.CurrentSequence.StartColumn*this.FrameWidth,this.FrameY=this.CurrentSequence.StartRow*this.FrameHeight},Enjine.AnimatedSprite.prototype.StopLooping=function(){this.Looping=!1},Enjine.AnimatedSprite.prototype.StopPlaying=function(){this.Playing=!1},Enjine.AnimatedSprite.prototype.SetFrameWidth=function(t){this.FrameWidth=t,this.Rows=this.Image.width/this.FrameWidth},Enjine.AnimatedSprite.prototype.SetFrameHeight=function(t){this.FrameHeight=t,this.Columns=this.Image.height/this.FrameHeight},Enjine.AnimatedSprite.prototype.SetColumnCount=function(t){this.FrameWidth=this.Image.width/t,this.Columns=t},Enjine.AnimatedSprite.prototype.SetRowCount=function(t){this.FrameHeight=this.Image.height/t,this.Rows=t},Enjine.AnimatedSprite.prototype.AddExistingSequence=function(t,e){this.Sequences["seq_"+t]=e},Enjine.AnimatedSprite.prototype.AddNewSequence=function(t,e,i,n,s){this.Sequences["seq_"+t]=new Enjine.AnimationSequence(e,i,n,s)},Enjine.AnimatedSprite.prototype.DeleteSequence=function(t){null!=this.Sequences["seq_"+t]&&delete this.Sequences["seq_"+t]},Enjine.AnimatedSprite.prototype.ClearSequences=function(){delete this.Sequences,this.Sequences={}},Enjine.Collideable=function(t,e,i,n){this.Base=t,this.X=t.X,this.Y=t.Y,this.Width=e,this.Height=i,this.CollisionEvent=null!=n?n:function(){}},Enjine.Collideable.prototype={Update:function(){this.X=this.Base.X,this.Y=this.Base.Y},CheckCollision:function(t){!(this.Y+this.Height<t.Y)&&!(this.Y>t.Y+t.Height)&&!(this.X+this.Width<t.X)&&!(this.X>t.X+t.Width)&&(this.CollisionEvent(t),t.CollisionEvent(this))}},Enjine.Application=function(){this.stateContext=this.timer=this.canvas=null},Enjine.Application.prototype={Update:function(t){this.stateContext.Update(t),this.canvas.BeginDraw(),this.stateContext.Draw(this.canvas.BackBufferContext2D),this.canvas.EndDraw()},Initialize:function(t,e,i){this.canvas=new Enjine.GameCanvas,this.timer=new Enjine.GameTimer,Enjine.KeyboardInput.Initialize(),this.canvas.Initialize("canvas",e,i),this.timer.UpdateObject=this,this.stateContext=new Enjine.GameStateContext(t),this.timer.Start()}};