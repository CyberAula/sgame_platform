!function(root,factory){if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.Phaser=factory()}}(this,function(){var PIXI=PIXI||{};var Phaser=Phaser||{VERSION:"1.1.3",DEV_VERSION:"1.1.3",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,SPRITE:0,BUTTON:1,BULLET:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4};PIXI.InteractionManager=function(dummy){};Phaser.Utils={shuffle:function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array},pad:function(str,len,pad,dir){if(typeof len=="undefined"){var len=0}if(typeof pad=="undefined"){var pad=" "}if(typeof dir=="undefined"){var dir=3}var padlen=0;if(len+1>=str.length){switch(dir){case 1:str=Array(len+1-str.length).join(pad)+str;break;case 3:var right=Math.ceil((padlen=len-str.length)/2);var left=padlen-right;str=Array(left+1).join(pad)+str+Array(right+1).join(pad);break;default:str=str+Array(len+1-str.length).join(pad);break}}return str},isPlainObject:function(obj){if(typeof obj!=="object"||obj.nodeType||obj===obj.window){return false}try{if(obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},extend:function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(Phaser.Utils.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&Phaser.Utils.isPlainObject(src)?src:{}}target[name]=Phaser.Utils.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target}};(function(){var consoleDisabled=false;if(consoleDisabled){window.console=undefined}if(window.console===undefined){window.console={debug:function(){return true},info:function(){return false},warn:function(){return false},log:function(){return false}}}debug=function(args){window.console.debug(args)};info=function(args){window.console.info(args)};warn=function(args){window.console.warn(args)};log=function(args){window.console.log(args)}})();function HEXtoRGB(hex){return[(hex>>16&255)/255,(hex>>8&255)/255,(hex&255)/255]}if(typeof Function.prototype.bind!="function"){Function.prototype.bind=function(){var slice=Array.prototype.slice;return function(thisArg){var target=this,boundArgs=slice.call(arguments,1);if(typeof target!="function"){throw new TypeError}function bound(){var args=boundArgs.concat(slice.call(arguments));target.apply(this instanceof bound?this:thisArg,args)}bound.prototype=function F(proto){proto&&(F.prototype=proto);if(!(this instanceof F)){return new F}}(target.prototype);return bound}}()}function determineMatrixArrayType(){PIXI.Matrix=typeof Float32Array!=="undefined"?Float32Array:Array;return PIXI.Matrix}determineMatrixArrayType();PIXI.mat3={};PIXI.mat3.create=function(){var matrix=new PIXI.Matrix(9);matrix[0]=1;matrix[1]=0;matrix[2]=0;matrix[3]=0;matrix[4]=1;matrix[5]=0;matrix[6]=0;matrix[7]=0;matrix[8]=1;return matrix};PIXI.mat3.identity=function(matrix){matrix[0]=1;matrix[1]=0;matrix[2]=0;matrix[3]=0;matrix[4]=1;matrix[5]=0;matrix[6]=0;matrix[7]=0;matrix[8]=1;return matrix};PIXI.mat4={};PIXI.mat4.create=function(){var matrix=new PIXI.Matrix(16);matrix[0]=1;matrix[1]=0;matrix[2]=0;matrix[3]=0;matrix[4]=0;matrix[5]=1;matrix[6]=0;matrix[7]=0;matrix[8]=0;matrix[9]=0;matrix[10]=1;matrix[11]=0;matrix[12]=0;matrix[13]=0;matrix[14]=0;matrix[15]=1;return matrix};PIXI.mat3.multiply=function(mat,mat2,dest){if(!dest){dest=mat}var a00=mat[0],a01=mat[1],a02=mat[2],a10=mat[3],a11=mat[4],a12=mat[5],a20=mat[6],a21=mat[7],a22=mat[8],b00=mat2[0],b01=mat2[1],b02=mat2[2],b10=mat2[3],b11=mat2[4],b12=mat2[5],b20=mat2[6],b21=mat2[7],b22=mat2[8];dest[0]=b00*a00+b01*a10+b02*a20;dest[1]=b00*a01+b01*a11+b02*a21;dest[2]=b00*a02+b01*a12+b02*a22;dest[3]=b10*a00+b11*a10+b12*a20;dest[4]=b10*a01+b11*a11+b12*a21;dest[5]=b10*a02+b11*a12+b12*a22;dest[6]=b20*a00+b21*a10+b22*a20;dest[7]=b20*a01+b21*a11+b22*a21;dest[8]=b20*a02+b21*a12+b22*a22;return dest};PIXI.mat3.clone=function(mat){var matrix=new PIXI.Matrix(9);matrix[0]=mat[0];matrix[1]=mat[1];matrix[2]=mat[2];matrix[3]=mat[3];matrix[4]=mat[4];matrix[5]=mat[5];matrix[6]=mat[6];matrix[7]=mat[7];matrix[8]=mat[8];return matrix};PIXI.mat3.transpose=function(mat,dest){if(!dest||mat===dest){var a01=mat[1],a02=mat[2],a12=mat[5];mat[1]=mat[3];mat[2]=mat[6];mat[3]=a01;mat[5]=mat[7];mat[6]=a02;mat[7]=a12;return mat}dest[0]=mat[0];dest[1]=mat[3];dest[2]=mat[6];dest[3]=mat[1];dest[4]=mat[4];dest[5]=mat[7];dest[6]=mat[2];dest[7]=mat[5];dest[8]=mat[8];return dest};PIXI.mat3.toMat4=function(mat,dest){if(!dest){dest=PIXI.mat4.create()}dest[15]=1;dest[14]=0;dest[13]=0;dest[12]=0;dest[11]=0;dest[10]=mat[8];dest[9]=mat[7];dest[8]=mat[6];dest[7]=0;dest[6]=mat[5];dest[5]=mat[4];dest[4]=mat[3];dest[3]=0;dest[2]=mat[2];dest[1]=mat[1];dest[0]=mat[0];return dest};PIXI.mat4.create=function(){var matrix=new PIXI.Matrix(16);matrix[0]=1;matrix[1]=0;matrix[2]=0;matrix[3]=0;matrix[4]=0;matrix[5]=1;matrix[6]=0;matrix[7]=0;matrix[8]=0;matrix[9]=0;matrix[10]=1;matrix[11]=0;matrix[12]=0;matrix[13]=0;matrix[14]=0;matrix[15]=1;return matrix};PIXI.mat4.transpose=function(mat,dest){if(!dest||mat===dest){var a01=mat[1],a02=mat[2],a03=mat[3],a12=mat[6],a13=mat[7],a23=mat[11];mat[1]=mat[4];mat[2]=mat[8];mat[3]=mat[12];mat[4]=a01;mat[6]=mat[9];mat[7]=mat[13];mat[8]=a02;mat[9]=a12;mat[11]=mat[14];mat[12]=a03;mat[13]=a13;mat[14]=a23;return mat}dest[0]=mat[0];dest[1]=mat[4];dest[2]=mat[8];dest[3]=mat[12];dest[4]=mat[1];dest[5]=mat[5];dest[6]=mat[9];dest[7]=mat[13];dest[8]=mat[2];dest[9]=mat[6];dest[10]=mat[10];dest[11]=mat[14];dest[12]=mat[3];dest[13]=mat[7];dest[14]=mat[11];dest[15]=mat[15];return dest};PIXI.mat4.multiply=function(mat,mat2,dest){if(!dest){dest=mat}var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];var a30=mat[12],a31=mat[13],a32=mat[14],a33=mat[15];var b0=mat2[0],b1=mat2[1],b2=mat2[2],b3=mat2[3];dest[0]=b0*a00+b1*a10+b2*a20+b3*a30;dest[1]=b0*a01+b1*a11+b2*a21+b3*a31;dest[2]=b0*a02+b1*a12+b2*a22+b3*a32;dest[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=mat2[4];b1=mat2[5];b2=mat2[6];b3=mat2[7];dest[4]=b0*a00+b1*a10+b2*a20+b3*a30;dest[5]=b0*a01+b1*a11+b2*a21+b3*a31;dest[6]=b0*a02+b1*a12+b2*a22+b3*a32;dest[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=mat2[8];b1=mat2[9];b2=mat2[10];b3=mat2[11];dest[8]=b0*a00+b1*a10+b2*a20+b3*a30;dest[9]=b0*a01+b1*a11+b2*a21+b3*a31;dest[10]=b0*a02+b1*a12+b2*a22+b3*a32;dest[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=mat2[12];b1=mat2[13];b2=mat2[14];b3=mat2[15];dest[12]=b0*a00+b1*a10+b2*a20+b3*a30;dest[13]=b0*a01+b1*a11+b2*a21+b3*a31;dest[14]=b0*a02+b1*a12+b2*a22+b3*a32;dest[15]=b0*a03+b1*a13+b2*a23+b3*a33;return dest};PIXI.Point=function(x,y){this.x=x||0;this.y=y||0};PIXI.Point.prototype.clone=function(){return new PIXI.Point(this.x,this.y)};PIXI.Point.prototype.constructor=PIXI.Point;PIXI.Rectangle=function(x,y,width,height){this.x=x||0;this.y=y||0;this.width=width||0;this.height=height||0};PIXI.Rectangle.prototype.clone=function(){return new PIXI.Rectangle(this.x,this.y,this.width,this.height)};PIXI.Rectangle.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return false;var x1=this.x;if(x>=x1&&x<=x1+this.width){var y1=this.y;if(y>=y1&&y<=y1+this.height){return true}}return false};PIXI.Rectangle.prototype.constructor=PIXI.Rectangle;PIXI.Polygon=function(points){if(!(points instanceof Array))points=Array.prototype.slice.call(arguments);if(typeof points[0]==="number"){var p=[];for(var i=0,il=points.length;i<il;i+=2){p.push(new PIXI.Point(points[i],points[i+1]))}points=p}this.points=points};PIXI.Polygon.prototype.clone=function(){var points=[];for(var i=0;i<this.points.length;i++){points.push(this.points[i].clone())}return new PIXI.Polygon(points)};PIXI.Polygon.prototype.contains=function(x,y){var inside=false;for(var i=0,j=this.points.length-1;i<this.points.length;j=i++){var xi=this.points[i].x,yi=this.points[i].y,xj=this.points[j].x,yj=this.points[j].y,intersect=yi>y!=yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi;if(intersect)inside=!inside}return inside};PIXI.Polygon.prototype.constructor=PIXI.Polygon;PIXI.DisplayObject=function(){this.last=this;this.first=this;this.position=new PIXI.Point;this.scale=new PIXI.Point(1,1);this.pivot=new PIXI.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.buttonMode=false;this.renderable=false;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=false;this.worldTransform=PIXI.mat3.create();this.localTransform=PIXI.mat3.create();this.color=[];this.dynamic=true;this._sr=0;this._cr=1;this.filterArea=new PIXI.Rectangle(0,0,1,1)};PIXI.DisplayObject.prototype.constructor=PIXI.DisplayObject;PIXI.DisplayObject.prototype.setInteractive=function(interactive){this.interactive=interactive};Object.defineProperty(PIXI.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(value){this._interactive=value;if(this.stage)this.stage.dirty=true}});Object.defineProperty(PIXI.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(value){if(value){if(this._mask){value.start=this._mask.start;value.end=this._mask.end}else{this.addFilter(value);value.renderable=false}}else{this.removeFilter(this._mask);this._mask.renderable=true}this._mask=value}});Object.defineProperty(PIXI.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(value){if(value){if(this._filters)this.removeFilter(this._filters);this.addFilter(value);var passes=[];for(var i=0;i<value.length;i++){var filterPasses=value[i].passes;for(var j=0;j<filterPasses.length;j++){passes.push(filterPasses[j])}}value.start.filterPasses=passes}else{if(this._filters)this.removeFilter(this._filters)}this._filters=value}});PIXI.DisplayObject.prototype.addFilter=function(data){var start=new PIXI.FilterBlock;var end=new PIXI.FilterBlock;data.start=start;data.end=end;start.data=data;end.data=data;start.first=start.last=this;end.first=end.last=this;start.open=true;start.target=this;var childFirst=start;var childLast=start;var nextObject;var previousObject;previousObject=this.first._iPrev;if(previousObject){nextObject=previousObject._iNext;childFirst._iPrev=previousObject;previousObject._iNext=childFirst}else{nextObject=this}if(nextObject){nextObject._iPrev=childLast;childLast._iNext=nextObject}var childFirst=end;var childLast=end;var nextObject=null;var previousObject=null;previousObject=this.last;nextObject=previousObject._iNext;if(nextObject){nextObject._iPrev=childLast;childLast._iNext=nextObject}childFirst._iPrev=previousObject;previousObject._iNext=childFirst;var updateLast=this;var prevLast=this.last;while(updateLast){if(updateLast.last==prevLast){updateLast.last=end}updateLast=updateLast.parent}this.first=start;if(this.__renderGroup){this.__renderGroup.addFilterBlocks(start,end)}};PIXI.DisplayObject.prototype.removeFilter=function(data){console.log("YUOIO");var startBlock=data.start;var nextObject=startBlock._iNext;var previousObject=startBlock._iPrev;if(nextObject)nextObject._iPrev=previousObject;if(previousObject)previousObject._iNext=nextObject;this.first=startBlock._iNext;var lastBlock=data.end;var nextObject=lastBlock._iNext;var previousObject=lastBlock._iPrev;if(nextObject)nextObject._iPrev=previousObject;previousObject._iNext=nextObject;var tempLast=lastBlock._iPrev;var updateLast=this;while(updateLast.last==lastBlock){updateLast.last=tempLast;updateLast=updateLast.parent;if(!updateLast)break}if(this.__renderGroup){this.__renderGroup.removeFilterBlocks(startBlock,lastBlock)}};PIXI.DisplayObject.prototype.updateTransform=function(){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}var localTransform=this.localTransform;var parentTransform=this.parent.worldTransform;var worldTransform=this.worldTransform;localTransform[0]=this._cr*this.scale.x;localTransform[1]=-this._sr*this.scale.y;localTransform[3]=this._sr*this.scale.x;localTransform[4]=this._cr*this.scale.y;var px=this.pivot.x;var py=this.pivot.y;var a00=localTransform[0],a01=localTransform[1],a02=this.position.x-localTransform[0]*px-py*localTransform[1],a10=localTransform[3],a11=localTransform[4],a12=this.position.y-localTransform[4]*py-px*localTransform[3],b00=parentTransform[0],b01=parentTransform[1],b02=parentTransform[2],b10=parentTransform[3],b11=parentTransform[4],b12=parentTransform[5];localTransform[2]=a02;localTransform[5]=a12;worldTransform[0]=b00*a00+b01*a10;worldTransform[1]=b00*a01+b01*a11;worldTransform[2]=b00*a02+b01*a12+b02;worldTransform[3]=b10*a00+b11*a10;worldTransform[4]=b10*a01+b11*a11;worldTransform[5]=b10*a02+b11*a12+b12;this.worldAlpha=this.alpha*this.parent.worldAlpha;this.vcount=PIXI.visibleCount};PIXI.visibleCount=0;PIXI.DisplayObjectContainer=function(){PIXI.DisplayObject.call(this);this.children=[]};PIXI.DisplayObjectContainer.prototype=Object.create(PIXI.DisplayObject.prototype);PIXI.DisplayObjectContainer.prototype.constructor=PIXI.DisplayObjectContainer;PIXI.DisplayObjectContainer.prototype.addChild=function(child){if(child.parent!=undefined){child.parent.removeChild(child)}child.parent=this;this.children.push(child);if(this.stage){var tmpChild=child;do{if(tmpChild.interactive)this.stage.dirty=true;tmpChild.stage=this.stage;tmpChild=tmpChild._iNext}while(tmpChild)}var childFirst=child.first;var childLast=child.last;var nextObject;var previousObject;if(this._filters||this._mask){previousObject=this.last._iPrev}else{previousObject=this.last}nextObject=previousObject._iNext;var updateLast=this;var prevLast=previousObject;while(updateLast){if(updateLast.last==prevLast){updateLast.last=child.last}updateLast=updateLast.parent}if(nextObject){nextObject._iPrev=childLast;childLast._iNext=nextObject}childFirst._iPrev=previousObject;previousObject._iNext=childFirst;if(this.__renderGroup){if(child.__renderGroup)child.__renderGroup.removeDisplayObjectAndChildren(child);this.__renderGroup.addDisplayObjectAndChildren(child)}};PIXI.DisplayObjectContainer.prototype.addChildAt=function(child,index){if(index>=0&&index<=this.children.length){if(child.parent!=undefined){child.parent.removeChild(child)}child.parent=this;if(this.stage){var tmpChild=child;do{if(tmpChild.interactive)this.stage.dirty=true;tmpChild.stage=this.stage;tmpChild=tmpChild._iNext}while(tmpChild)}var childFirst=child.first;var childLast=child.last;var nextObject;var previousObject;if(index==this.children.length){previousObject=this.last;var updateLast=this;var prevLast=this.last;while(updateLast){if(updateLast.last==prevLast){updateLast.last=child.last}updateLast=updateLast.parent}}else if(index===0){previousObject=this}else{previousObject=this.children[index-1].last}nextObject=previousObject._iNext;if(nextObject){nextObject._iPrev=childLast;childLast._iNext=nextObject}childFirst._iPrev=previousObject;previousObject._iNext=childFirst;this.children.splice(index,0,child);if(this.__renderGroup){if(child.__renderGroup)child.__renderGroup.removeDisplayObjectAndChildren(child);this.__renderGroup.addDisplayObjectAndChildren(child)}}else{throw new Error(child+" The index "+index+" supplied is out of bounds "+this.children.length)}};PIXI.DisplayObjectContainer.prototype.swapChildren=function(child,child2){return};PIXI.DisplayObjectContainer.prototype.getChildAt=function(index){if(index>=0&&index<this.children.length){return this.children[index]}else{throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)}};PIXI.DisplayObjectContainer.prototype.removeChild=function(child){var index=this.children.indexOf(child);if(index!==-1){var childFirst=child.first;var childLast=child.last;var nextObject=childLast._iNext;var previousObject=childFirst._iPrev;if(nextObject)nextObject._iPrev=previousObject;previousObject._iNext=nextObject;if(this.last==childLast){var tempLast=childFirst._iPrev;var updateLast=this;while(updateLast.last==childLast.last){updateLast.last=tempLast;updateLast=updateLast.parent;if(!updateLast)break}}childLast._iNext=null;childFirst._iPrev=null;if(this.stage){var tmpChild=child;do{if(tmpChild.interactive)this.stage.dirty=true;tmpChild.stage=null;tmpChild=tmpChild._iNext}while(tmpChild)}if(child.__renderGroup){child.__renderGroup.removeDisplayObjectAndChildren(child)}child.parent=undefined;this.children.splice(index,1)}else{throw new Error(child+" The supplied DisplayObject must be a child of the caller "+this)}};PIXI.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible)return;PIXI.DisplayObject.prototype.updateTransform.call(this);for(var i=0,j=this.children.length;i<j;i++){this.children[i].updateTransform()}};PIXI.blendModes={};PIXI.blendModes.NORMAL=0;PIXI.blendModes.SCREEN=1;PIXI.Sprite=function(texture){PIXI.DisplayObjectContainer.call(this);this.anchor=new PIXI.Point;this.texture=texture;this.blendMode=PIXI.blendModes.NORMAL;this._width=0;this._height=0;if(texture.baseTexture.hasLoaded){this.updateFrame=true}else{this.onTextureUpdateBind=this.onTextureUpdate.bind(this);this.texture.addEventListener("update",this.onTextureUpdateBind)}this.renderable=true};PIXI.Sprite.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Sprite.prototype.constructor=PIXI.Sprite;Object.defineProperty(PIXI.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(value){this.scale.x=value/this.texture.frame.width;this._width=value}});Object.defineProperty(PIXI.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(value){this.scale.y=value/this.texture.frame.height;this._height=value}});PIXI.Sprite.prototype.setTexture=function(texture){if(this.texture.baseTexture!=texture.baseTexture){this.textureChange=true;this.texture=texture;if(this.__renderGroup){this.__renderGroup.updateTexture(this)}}else{this.texture=texture}this.updateFrame=true};PIXI.Sprite.prototype.onTextureUpdate=function(event){if(this._width)this.scale.x=this._width/this.texture.frame.width;if(this._height)this.scale.y=this._height/this.texture.frame.height;this.updateFrame=true};PIXI.Sprite.fromFrame=function(frameId){var texture=PIXI.TextureCache[frameId];if(!texture)throw new Error("The frameId '"+frameId+"' does not exist in the texture cache"+this);return new PIXI.Sprite(texture)};PIXI.Sprite.fromImage=function(imageId){var texture=PIXI.Texture.fromImage(imageId);return new PIXI.Sprite(texture)};PIXI.Stage=function(backgroundColor){PIXI.DisplayObjectContainer.call(this);this.worldTransform=PIXI.mat3.create();this.interactive=true;this.interactionManager=new PIXI.InteractionManager(this);this.dirty=true;this.__childrenAdded=[];this.__childrenRemoved=[];this.stage=this;this.stage.hitArea=new PIXI.Rectangle(0,0,1e5,1e5);this.setBackgroundColor(backgroundColor);this.worldVisible=true};PIXI.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Stage.prototype.constructor=PIXI.Stage;PIXI.Stage.prototype.setInteractionDelegate=function(domElement){this.interactionManager.setTargetDomElement(domElement)};PIXI.Stage.prototype.updateTransform=function(){this.worldAlpha=1;this.vcount=PIXI.visibleCount;for(var i=0,j=this.children.length;i<j;i++){this.children[i].updateTransform()}if(this.dirty){this.dirty=false;this.interactionManager.dirty=true}if(this.interactive)this.interactionManager.update()};PIXI.Stage.prototype.setBackgroundColor=function(backgroundColor){this.backgroundColor=backgroundColor||0;this.backgroundColorSplit=HEXtoRGB(this.backgroundColor);var hex=this.backgroundColor.toString(16);hex="000000".substr(0,6-hex.length)+hex;this.backgroundColorString="#"+hex};PIXI.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};PIXI.CustomRenderable=function(){PIXI.DisplayObject.call(this);this.renderable=true};PIXI.CustomRenderable.prototype=Object.create(PIXI.DisplayObject.prototype);PIXI.CustomRenderable.prototype.constructor=PIXI.CustomRenderable;PIXI.CustomRenderable.prototype.renderCanvas=function(renderer){};PIXI.CustomRenderable.prototype.initWebGL=function(renderer){};PIXI.CustomRenderable.prototype.renderWebGL=function(renderGroup,projectionMatrix){};PIXI.Strip=function(texture,width,height){PIXI.DisplayObjectContainer.call(this);this.texture=texture;this.blendMode=PIXI.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]);this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]);this.colors=new Float32Array([1,1,1,1]);this.indices=new Uint16Array([0,1,2,3])}catch(error){this.uvs=[0,1,1,1,1,0,0,1];this.verticies=[0,0,0,0,0,0,0,0,0];this.colors=[1,1,1,1];this.indices=[0,1,2,3]}this.width=width;this.height=height;if(texture.baseTexture.hasLoaded){this.width=this.texture.frame.width;this.height=this.texture.frame.height;this.updateFrame=true}else{this.onTextureUpdateBind=this.onTextureUpdate.bind(this);this.texture.addEventListener("update",this.onTextureUpdateBind)}this.renderable=true};PIXI.Strip.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Strip.prototype.constructor=PIXI.Strip;PIXI.Strip.prototype.setTexture=function(texture){this.texture=texture;this.width=texture.frame.width;this.height=texture.frame.height;this.updateFrame=true};PIXI.Strip.prototype.onTextureUpdate=function(event){this.updateFrame=true};PIXI.Rope=function(texture,points){PIXI.Strip.call(this,texture);this.points=points;try{this.verticies=new Float32Array(points.length*4);this.uvs=new Float32Array(points.length*4);this.colors=new Float32Array(points.length*2);this.indices=new Uint16Array(points.length*2)}catch(error){this.verticies=verticies;this.uvs=uvs;this.colors=colors;this.indices=indices}this.refresh()};PIXI.Rope.prototype=Object.create(PIXI.Strip.prototype);PIXI.Rope.prototype.constructor=PIXI.Rope;PIXI.Rope.prototype.refresh=function(){var points=this.points;if(points.length<1)return;var uvs=this.uvs;var indices=this.indices;var colors=this.colors;var lastPoint=points[0];var nextPoint;var perp={x:0,y:0};var point=points[0];this.count-=.2;uvs[0]=0;uvs[1]=1;uvs[2]=0;uvs[3]=1;colors[0]=1;colors[1]=1;indices[0]=0;indices[1]=1;var total=points.length;for(var i=1;i<total;i++){var point=points[i];var index=i*4;var amount=i/(total-1);if(i%2){uvs[index]=amount;uvs[index+1]=0;uvs[index+2]=amount;uvs[index+3]=1}else{uvs[index]=amount;uvs[index+1]=0;uvs[index+2]=amount;uvs[index+3]=1}index=i*2;colors[index]=1;colors[index+1]=1;index=i*2;indices[index]=index;indices[index+1]=index+1;lastPoint=point}};PIXI.Rope.prototype.updateTransform=function(){var points=this.points;if(points.length<1)return;var verticies=this.verticies;var lastPoint=points[0];var nextPoint;var perp={x:0,y:0};var point=points[0];this.count-=.2;verticies[0]=point.x+perp.x;verticies[1]=point.y+perp.y;verticies[2]=point.x-perp.x;verticies[3]=point.y-perp.y;var total=points.length;for(var i=1;i<total;i++){var point=points[i];var index=i*4;if(i<points.length-1){nextPoint=points[i+1]}else{nextPoint=point}perp.y=-(nextPoint.x-lastPoint.x);perp.x=nextPoint.y-lastPoint.y;var ratio=(1-i/(total-1))*10;if(ratio>1)ratio=1;var perpLength=Math.sqrt(perp.x*perp.x+perp.y*perp.y);var num=this.texture.height/2;perp.x/=perpLength;perp.y/=perpLength;perp.x*=num;perp.y*=num;verticies[index]=point.x+perp.x;verticies[index+1]=point.y+perp.y;verticies[index+2]=point.x-perp.x;verticies[index+3]=point.y-perp.y;lastPoint=point}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};PIXI.Rope.prototype.setTexture=function(texture){this.texture=texture;this.updateFrame=true};PIXI.TilingSprite=function(texture,width,height){PIXI.DisplayObjectContainer.call(this);this.texture=texture;this.width=width;this.height=height;this.tileScale=new PIXI.Point(1,1);this.tilePosition=new PIXI.Point(0,0);this.renderable=true;this.blendMode=PIXI.blendModes.NORMAL};PIXI.TilingSprite.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.TilingSprite.prototype.constructor=PIXI.TilingSprite;PIXI.TilingSprite.prototype.setTexture=function(texture){this.texture=texture;this.updateFrame=true};PIXI.TilingSprite.prototype.onTextureUpdate=function(event){this.updateFrame=true};PIXI.AbstractFilter=function(fragmentSrc,uniforms){this.passes=[this];this.dirty=true;this.padding=0;this.uniforms=uniforms||{};this.fragmentSrc=fragmentSrc||[]};PIXI.FilterBlock=function(){this.visible=true;this.renderable=true};PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.currentPath={points:[]}};PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Graphics.prototype.constructor=PIXI.Graphics;PIXI.Graphics.prototype.lineStyle=function(lineWidth,color,alpha){if(this.currentPath.points.length===0)this.graphicsData.pop();this.lineWidth=lineWidth||0;this.lineColor=color||0;this.lineAlpha=alpha==undefined?1:alpha;this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:PIXI.Graphics.POLY};this.graphicsData.push(this.currentPath)};PIXI.Graphics.prototype.moveTo=function(x,y){if(this.currentPath.points.length===0)this.graphicsData.pop();this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:PIXI.Graphics.POLY};this.currentPath.points.push(x,y);this.graphicsData.push(this.currentPath)};PIXI.Graphics.prototype.lineTo=function(x,y){this.currentPath.points.push(x,y);this.dirty=true};PIXI.Graphics.prototype.beginFill=function(color,alpha){this.filling=true;this.fillColor=color||0;this.fillAlpha=alpha==undefined?1:alpha};PIXI.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1};PIXI.Graphics.prototype.drawRect=function(x,y,width,height){if(this.currentPath.points.length===0)this.graphicsData.pop();this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[x,y,width,height],type:PIXI.Graphics.RECT};this.graphicsData.push(this.currentPath);this.dirty=true};PIXI.Graphics.prototype.drawCircle=function(x,y,radius){if(this.currentPath.points.length===0)this.graphicsData.pop();this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[x,y,radius,radius],type:PIXI.Graphics.CIRC};this.graphicsData.push(this.currentPath);this.dirty=true};PIXI.Graphics.prototype.drawElipse=function(x,y,width,height){if(this.currentPath.points.length===0)this.graphicsData.pop();this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[x,y,width,height],type:PIXI.Graphics.ELIP};this.graphicsData.push(this.currentPath);this.dirty=true};PIXI.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this.clearDirty=true;this.graphicsData=[];this.bounds=null};PIXI.Graphics.prototype.updateFilterBounds=function(){if(!this.bounds){var minX=Infinity;var maxX=-Infinity;var minY=Infinity;var maxY=-Infinity;var points,x,y;for(var i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i];var type=data.type;var lineWidth=data.lineWidth;points=data.points;if(type===PIXI.Graphics.RECT){x=points.x-lineWidth/2;y=points.y-lineWidth/2;var width=points.width+lineWidth;var height=points.height+lineWidth;minX=x<minX?x:minX;maxX=x+width>maxX?x+width:maxX;minY=y<minY?x:minY;maxY=y+height>maxY?y+height:maxY}else if(type===PIXI.Graphics.CIRC||type===PIXI.Graphics.ELIP){x=points.x;y=points.y;var radius=points.radius+lineWidth/2;minX=x-radius<minX?x-radius:minX;maxX=x+radius>maxX?x+radius:maxX;minY=y-radius<minY?y-radius:minY;maxY=y+radius>maxY?y+radius:maxY}else{for(var j=0;j<points.length;j+=2){x=points[j];y=points[j+1];minX=x-lineWidth<minX?x-lineWidth:minX;maxX=x+lineWidth>maxX?x+lineWidth:maxX;minY=y-lineWidth<minY?y-lineWidth:minY;maxY=y+lineWidth>maxY?y+lineWidth:maxY}}}this.bounds=new PIXI.Rectangle(minX,minY,maxX-minX,maxY-minY)}};PIXI.Graphics.POLY=0;PIXI.Graphics.RECT=1;PIXI.Graphics.CIRC=2;PIXI.Graphics.ELIP=3;PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=function(graphics,context){var worldAlpha=graphics.worldAlpha;for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];var points=data.points;context.strokeStyle=color="#"+("00000"+(data.lineColor|0).toString(16)).substr(-6);context.lineWidth=data.lineWidth;if(data.type==PIXI.Graphics.POLY){context.beginPath();context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++){context.lineTo(points[j*2],points[j*2+1])}if(points[0]==points[points.length-2]&&points[1]==points[points.length-1]){context.closePath()}if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle=color="#"+("00000"+(data.fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.stroke()}}else if(data.type==PIXI.Graphics.RECT){if(data.fillColor||data.fillColor===0){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle=color="#"+("00000"+(data.fillColor|0).toString(16)).substr(-6);context.fillRect(points[0],points[1],points[2],points[3])}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeRect(points[0],points[1],points[2],points[3])}}else if(data.type==PIXI.Graphics.CIRC){context.beginPath();context.arc(points[0],points[1],points[2],0,2*Math.PI);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle=color="#"+("00000"+(data.fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.stroke()}}else if(data.type==PIXI.Graphics.ELIP){var elipseData=data.points;var w=elipseData[2]*2;var h=elipseData[3]*2;var x=elipseData[0]-w/2;var y=elipseData[1]-h/2;context.beginPath();var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle=color="#"+("00000"+(data.fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.stroke()}}}};PIXI.CanvasGraphics.renderGraphicsMask=function(graphics,context){var worldAlpha=graphics.worldAlpha;var len=graphics.graphicsData.length;if(len===0)return;if(len>1){len=1;console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")}for(var i=0;i<1;i++){var data=graphics.graphicsData[i];var points=data.points;if(data.type==PIXI.Graphics.POLY){context.beginPath();context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++){context.lineTo(points[j*2],points[j*2+1])}if(points[0]==points[points.length-2]&&points[1]==points[points.length-1]){context.closePath()}}else if(data.type==PIXI.Graphics.RECT){context.beginPath();context.rect(points[0],points[1],points[2],points[3]);context.closePath()}else if(data.type==PIXI.Graphics.CIRC){context.beginPath();
context.arc(points[0],points[1],points[2],0,2*Math.PI);context.closePath()}else if(data.type==PIXI.Graphics.ELIP){var elipseData=data.points;var w=elipseData[2]*2;var h=elipseData[3]*2;var x=elipseData[0]-w/2;var y=elipseData[1]-h/2;context.beginPath();var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath()}}};PIXI.CanvasRenderer=function(width,height,view,transparent){this.transparent=transparent;this.width=width||800;this.height=height||600;this.view=view||document.createElement("canvas");this.context=this.view.getContext("2d");this.refresh=true;this.view.width=this.width;this.view.height=this.height;this.count=0};PIXI.CanvasRenderer.prototype.constructor=PIXI.CanvasRenderer;PIXI.CanvasRenderer.prototype.render=function(stage){PIXI.texturesToUpdate=[];PIXI.texturesToDestroy=[];PIXI.visibleCount++;stage.updateTransform();if(this.view.style.backgroundColor!=stage.backgroundColorString&&!this.transparent)this.view.style.backgroundColor=stage.backgroundColorString;this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(stage);if(stage.interactive){if(!stage._interactiveEventsAdded){stage._interactiveEventsAdded=true;stage.interactionManager.setTarget(this)}}if(PIXI.Texture.frameUpdates.length>0){PIXI.Texture.frameUpdates=[]}};PIXI.CanvasRenderer.prototype.resize=function(width,height){this.width=width;this.height=height;this.view.width=width;this.view.height=height};PIXI.CanvasRenderer.prototype.renderDisplayObject=function(displayObject){var transform;var context=this.context;context.globalCompositeOperation="source-over";var testObject=displayObject.last._iNext;displayObject=displayObject.first;do{transform=displayObject.worldTransform;if(!displayObject.visible){displayObject=displayObject.last._iNext;continue}if(!displayObject.renderable){displayObject=displayObject._iNext;continue}if(displayObject instanceof PIXI.Sprite){var frame=displayObject.texture.frame;if(frame&&frame.width&&frame.height){context.globalAlpha=displayObject.worldAlpha;context.setTransform(transform[0],transform[3],transform[1],transform[4],transform[2],transform[5]);context.drawImage(displayObject.texture.baseTexture.source,frame.x,frame.y,frame.width,frame.height,displayObject.anchor.x*-frame.width,displayObject.anchor.y*-frame.height,frame.width,frame.height)}}else if(displayObject instanceof PIXI.Strip){context.setTransform(transform[0],transform[3],transform[1],transform[4],transform[2],transform[5]);this.renderStrip(displayObject)}else if(displayObject instanceof PIXI.TilingSprite){context.setTransform(transform[0],transform[3],transform[1],transform[4],transform[2],transform[5]);this.renderTilingSprite(displayObject)}else if(displayObject instanceof PIXI.CustomRenderable){context.setTransform(transform[0],transform[3],transform[1],transform[4],transform[2],transform[5]);displayObject.renderCanvas(this)}else if(displayObject instanceof PIXI.Graphics){context.setTransform(transform[0],transform[3],transform[1],transform[4],transform[2],transform[5]);PIXI.CanvasGraphics.renderGraphics(displayObject,context)}else if(displayObject instanceof PIXI.FilterBlock){if(displayObject.data instanceof PIXI.Graphics){var mask=displayObject.data;if(displayObject.open){context.save();var cacheAlpha=mask.alpha;var maskTransform=mask.worldTransform;context.setTransform(maskTransform[0],maskTransform[3],maskTransform[1],maskTransform[4],maskTransform[2],maskTransform[5]);mask.worldAlpha=.5;context.worldAlpha=0;PIXI.CanvasGraphics.renderGraphicsMask(mask,context);context.clip();mask.worldAlpha=cacheAlpha}else{context.restore()}}else{}}displayObject=displayObject._iNext}while(displayObject!=testObject)};PIXI.CanvasRenderer.prototype.renderStripFlat=function(strip){var context=this.context;var verticies=strip.verticies;var uvs=strip.uvs;var length=verticies.length/2;this.count++;context.beginPath();for(var i=1;i<length-2;i++){var index=i*2;var x0=verticies[index],x1=verticies[index+2],x2=verticies[index+4];var y0=verticies[index+1],y1=verticies[index+3],y2=verticies[index+5];context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2)}context.fillStyle="#FF0000";context.fill();context.closePath()};PIXI.CanvasRenderer.prototype.renderTilingSprite=function(sprite){var context=this.context;context.globalAlpha=sprite.worldAlpha;if(!sprite.__tilePattern)sprite.__tilePattern=context.createPattern(sprite.texture.baseTexture.source,"repeat");context.beginPath();var tilePosition=sprite.tilePosition;var tileScale=sprite.tileScale;context.scale(tileScale.x,tileScale.y);context.translate(tilePosition.x,tilePosition.y);context.fillStyle=sprite.__tilePattern;context.fillRect(-tilePosition.x,-tilePosition.y,sprite.width/tileScale.x,sprite.height/tileScale.y);context.scale(1/tileScale.x,1/tileScale.y);context.translate(-tilePosition.x,-tilePosition.y);context.closePath()};PIXI.CanvasRenderer.prototype.renderStrip=function(strip){var context=this.context;var verticies=strip.verticies;var uvs=strip.uvs;var length=verticies.length/2;this.count++;for(var i=1;i<length-2;i++){var index=i*2;var x0=verticies[index],x1=verticies[index+2],x2=verticies[index+4];var y0=verticies[index+1],y1=verticies[index+3],y2=verticies[index+5];var u0=uvs[index]*strip.texture.width,u1=uvs[index+2]*strip.texture.width,u2=uvs[index+4]*strip.texture.width;var v0=uvs[index+1]*strip.texture.height,v1=uvs[index+3]*strip.texture.height,v2=uvs[index+5]*strip.texture.height;context.save();context.beginPath();context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.closePath();context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2;var delta_a=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2;var delta_b=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2;var delta_c=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2;var delta_d=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2;var delta_e=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2;var delta_f=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(delta_a/delta,delta_d/delta,delta_b/delta,delta_e/delta,delta_c/delta,delta_f/delta);context.drawImage(strip.texture.baseTexture.source,0,0);context.restore()}};PIXI.PixiShader=function(){this.program;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"];this.textureCount=0};PIXI.PixiShader.prototype.init=function(){var program=PIXI.compileProgram(this.vertexSrc||PIXI.PixiShader.defaultVertexSrc,this.fragmentSrc);var gl=PIXI.gl;gl.useProgram(program);this.uSampler=gl.getUniformLocation(program,"uSampler");this.projectionVector=gl.getUniformLocation(program,"projectionVector");this.offsetVector=gl.getUniformLocation(program,"offsetVector");this.dimensions=gl.getUniformLocation(program,"dimensions");this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition");this.colorAttribute=gl.getAttribLocation(program,"aColor");this.aTextureCoord=gl.getAttribLocation(program,"aTextureCoord");for(var key in this.uniforms){this.uniforms[key].uniformLocation=gl.getUniformLocation(program,key)}this.initUniforms();this.program=program};PIXI.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var uniform;for(var key in this.uniforms){var uniform=this.uniforms[key];var type=uniform.type;if(type=="sampler2D"){uniform._init=false;if(uniform.value!==null){this.initSampler2D(uniform)}}else if(type=="mat2"||type=="mat3"||type=="mat4"){uniform.glMatrix=true;uniform.glValueLength=1;if(type=="mat2"){uniform.glFunc=PIXI.gl.uniformMatrix2fv}else if(type=="mat3"){uniform.glFunc=PIXI.gl.uniformMatrix3fv}else if(type=="mat4"){uniform.glFunc=PIXI.gl.uniformMatrix4fv}}else{uniform.glFunc=PIXI.gl["uniform"+type];if(type=="2f"||type=="2i"){uniform.glValueLength=2}else if(type=="3f"||type=="3i"){uniform.glValueLength=3}else if(type=="4f"||type=="4i"){uniform.glValueLength=4}else{uniform.glValueLength=1}}}};PIXI.PixiShader.prototype.initSampler2D=function(uniform){if(!uniform.value||!uniform.value.baseTexture||!uniform.value.baseTexture.hasLoaded){return}PIXI.gl.activeTexture(PIXI.gl["TEXTURE"+this.textureCount]);PIXI.gl.bindTexture(PIXI.gl.TEXTURE_2D,uniform.value.baseTexture._glTexture);if(uniform.textureData){var data=uniform.textureData;var magFilter=data.magFilter?data.magFilter:PIXI.gl.LINEAR;var minFilter=data.minFilter?data.minFilter:PIXI.gl.LINEAR;var wrapS=data.wrapS?data.wrapS:PIXI.gl.CLAMP_TO_EDGE;var wrapT=data.wrapT?data.wrapT:PIXI.gl.CLAMP_TO_EDGE;var format=data.luminance?PIXI.gl.LUMINANCE:PIXI.gl.RGBA;if(data.repeat){wrapS=PIXI.gl.REPEAT;wrapT=PIXI.gl.REPEAT}PIXI.gl.pixelStorei(PIXI.gl.UNPACK_FLIP_Y_WEBGL,false);if(data.width){var width=data.width?data.width:512;var height=data.height?data.height:2;var border=data.border?data.border:0;PIXI.gl.texImage2D(PIXI.gl.TEXTURE_2D,0,format,width,height,border,format,PIXI.gl.UNSIGNED_BYTE,null)}else{PIXI.gl.texImage2D(PIXI.gl.TEXTURE_2D,0,format,PIXI.gl.RGBA,PIXI.gl.UNSIGNED_BYTE,uniform.value.baseTexture.source)}PIXI.gl.texParameteri(PIXI.gl.TEXTURE_2D,PIXI.gl.TEXTURE_MAG_FILTER,magFilter);PIXI.gl.texParameteri(PIXI.gl.TEXTURE_2D,PIXI.gl.TEXTURE_MIN_FILTER,minFilter);PIXI.gl.texParameteri(PIXI.gl.TEXTURE_2D,PIXI.gl.TEXTURE_WRAP_S,wrapS);PIXI.gl.texParameteri(PIXI.gl.TEXTURE_2D,PIXI.gl.TEXTURE_WRAP_T,wrapT)}PIXI.gl.uniform1i(uniform.uniformLocation,this.textureCount);uniform._init=true;this.textureCount++};PIXI.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var uniform;for(var key in this.uniforms){uniform=this.uniforms[key];if(uniform.glValueLength==1){if(uniform.glMatrix===true){uniform.glFunc.call(PIXI.gl,uniform.uniformLocation,uniform.transpose,uniform.value)}else{uniform.glFunc.call(PIXI.gl,uniform.uniformLocation,uniform.value)}}else if(uniform.glValueLength==2){uniform.glFunc.call(PIXI.gl,uniform.uniformLocation,uniform.value.x,uniform.value.y)}else if(uniform.glValueLength==3){uniform.glFunc.call(PIXI.gl,uniform.uniformLocation,uniform.value.x,uniform.value.y,uniform.value.z)}else if(uniform.glValueLength==4){uniform.glFunc.call(PIXI.gl,uniform.uniformLocation,uniform.value.x,uniform.value.y,uniform.value.z,uniform.value.w)}else if(uniform.type=="sampler2D"){if(uniform._init){PIXI.gl.activeTexture(PIXI.gl["TEXTURE"+this.textureCount]);PIXI.gl.bindTexture(PIXI.gl.TEXTURE_2D,uniform.value.baseTexture._glTexture);PIXI.gl.uniform1i(uniform.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(uniform)}}}};PIXI.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"];PIXI.PrimitiveShader=function(){this.program;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","v -= offsetVector.xyx;","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"]};PIXI.PrimitiveShader.prototype.init=function(){var program=PIXI.compileProgram(this.vertexSrc,this.fragmentSrc);var gl=PIXI.gl;gl.useProgram(program);this.projectionVector=gl.getUniformLocation(program,"projectionVector");this.offsetVector=gl.getUniformLocation(program,"offsetVector");this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition");this.colorAttribute=gl.getAttribLocation(program,"aColor");this.translationMatrix=gl.getUniformLocation(program,"translationMatrix");this.alpha=gl.getUniformLocation(program,"alpha");this.program=program};PIXI.StripShader=function(){this.program;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying vec2 offsetVector;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","v -= offsetVector.xyx;","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"]};PIXI.StripShader.prototype.init=function(){var program=PIXI.compileProgram(this.vertexSrc,this.fragmentSrc);var gl=PIXI.gl;gl.useProgram(program);this.uSampler=gl.getUniformLocation(program,"uSampler");this.projectionVector=gl.getUniformLocation(program,"projectionVector");this.offsetVector=gl.getUniformLocation(program,"offsetVector");this.colorAttribute=gl.getAttribLocation(program,"aColor");this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition");this.aTextureCoord=gl.getAttribLocation(program,"aTextureCoord");this.translationMatrix=gl.getUniformLocation(program,"translationMatrix");this.alpha=gl.getUniformLocation(program,"alpha");this.program=program};PIXI._batchs=[];PIXI._getBatch=function(gl){if(PIXI._batchs.length===0){return new PIXI.WebGLBatch(gl)}else{return PIXI._batchs.pop()}};PIXI._returnBatch=function(batch){batch.clean();PIXI._batchs.push(batch)};PIXI._restoreBatchs=function(gl){for(var i=0;i<PIXI._batchs.length;i++){PIXI._batchs[i].restoreLostContext(gl)}};PIXI.WebGLBatch=function(gl){this.gl=gl;this.size=0;this.vertexBuffer=gl.createBuffer();this.indexBuffer=gl.createBuffer();this.uvBuffer=gl.createBuffer();this.colorBuffer=gl.createBuffer();this.blendMode=PIXI.blendModes.NORMAL;this.dynamicSize=1};PIXI.WebGLBatch.prototype.constructor=PIXI.WebGLBatch;PIXI.WebGLBatch.prototype.clean=function(){this.verticies=[];this.uvs=[];this.indices=[];this.colors=[];this.dynamicSize=1;this.texture=null;this.last=null;this.size=0;this.head;this.tail};PIXI.WebGLBatch.prototype.restoreLostContext=function(gl){this.gl=gl;this.vertexBuffer=gl.createBuffer();this.indexBuffer=gl.createBuffer();this.uvBuffer=gl.createBuffer();this.colorBuffer=gl.createBuffer()};PIXI.WebGLBatch.prototype.init=function(sprite){sprite.batch=this;this.dirty=true;this.blendMode=sprite.blendMode;this.texture=sprite.texture.baseTexture;this.head=sprite;this.tail=sprite;this.size=1;this.growBatch()};PIXI.WebGLBatch.prototype.insertBefore=function(sprite,nextSprite){this.size++;sprite.batch=this;this.dirty=true;var tempPrev=nextSprite.__prev;nextSprite.__prev=sprite;sprite.__next=nextSprite;if(tempPrev){sprite.__prev=tempPrev;tempPrev.__next=sprite}else{this.head=sprite}};PIXI.WebGLBatch.prototype.insertAfter=function(sprite,previousSprite){this.size++;sprite.batch=this;this.dirty=true;var tempNext=previousSprite.__next;previousSprite.__next=sprite;sprite.__prev=previousSprite;if(tempNext){sprite.__next=tempNext;tempNext.__prev=sprite}else{this.tail=sprite}};PIXI.WebGLBatch.prototype.remove=function(sprite){this.size--;if(this.size===0){sprite.batch=null;sprite.__prev=null;sprite.__next=null;return}if(sprite.__prev){sprite.__prev.__next=sprite.__next}else{this.head=sprite.__next;this.head.__prev=null}if(sprite.__next){sprite.__next.__prev=sprite.__prev}else{this.tail=sprite.__prev;this.tail.__next=null}sprite.batch=null;sprite.__next=null;sprite.__prev=null;this.dirty=true};PIXI.WebGLBatch.prototype.split=function(sprite){this.dirty=true;var batch=new PIXI.WebGLBatch(this.gl);batch.init(sprite);batch.texture=this.texture;batch.tail=this.tail;this.tail=sprite.__prev;this.tail.__next=null;sprite.__prev=null;var tempSize=0;while(sprite){tempSize++;sprite.batch=batch;sprite=sprite.__next}batch.size=tempSize;this.size-=tempSize;return batch};PIXI.WebGLBatch.prototype.merge=function(batch){this.dirty=true;this.tail.__next=batch.head;batch.head.__prev=this.tail;this.size+=batch.size;this.tail=batch.tail;var sprite=batch.head;while(sprite){sprite.batch=this;sprite=sprite.__next}};PIXI.WebGLBatch.prototype.growBatch=function(){var gl=this.gl;if(this.size==1){this.dynamicSize=1}else{this.dynamicSize=this.size*1.5}this.verticies=new Float32Array(this.dynamicSize*8);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.verticies,gl.DYNAMIC_DRAW);this.uvs=new Float32Array(this.dynamicSize*8);gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.uvs,gl.DYNAMIC_DRAW);this.dirtyUVS=true;this.colors=new Float32Array(this.dynamicSize*4);gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.colors,gl.DYNAMIC_DRAW);this.dirtyColors=true;this.indices=new Uint16Array(this.dynamicSize*6);var length=this.indices.length/6;for(var i=0;i<length;i++){var index2=i*6;var index3=i*4;this.indices[index2+0]=index3+0;this.indices[index2+1]=index3+1;this.indices[index2+2]=index3+2;this.indices[index2+3]=index3+0;this.indices[index2+4]=index3+2;this.indices[index2+5]=index3+3}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW)};PIXI.WebGLBatch.prototype.refresh=function(){var gl=this.gl;if(this.dynamicSize<this.size){this.growBatch()}var indexRun=0;var worldTransform,width,height,aX,aY,w0,w1,h0,h1,index;var a,b,c,d,tx,ty;var displayObject=this.head;while(displayObject){index=indexRun*8;var texture=displayObject.texture;var frame=texture.frame;var tw=texture.baseTexture.width;var th=texture.baseTexture.height;this.uvs[index+0]=frame.x/tw;this.uvs[index+1]=frame.y/th;this.uvs[index+2]=(frame.x+frame.width)/tw;this.uvs[index+3]=frame.y/th;this.uvs[index+4]=(frame.x+frame.width)/tw;this.uvs[index+5]=(frame.y+frame.height)/th;this.uvs[index+6]=frame.x/tw;this.uvs[index+7]=(frame.y+frame.height)/th;displayObject.updateFrame=false;colorIndex=indexRun*4;this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=displayObject.worldAlpha;displayObject=displayObject.__next;indexRun++}this.dirtyUVS=true;this.dirtyColors=true};PIXI.WebGLBatch.prototype.update=function(){var gl=this.gl;var worldTransform,width,height,aX,aY,w0,w1,h0,h1,index,index2,index3;var a,b,c,d,tx,ty;var indexRun=0;var displayObject=this.head;var verticies=this.verticies;var uvs=this.uvs;var colors=this.colors;while(displayObject){if(displayObject.vcount===PIXI.visibleCount){width=displayObject.texture.frame.width;height=displayObject.texture.frame.height;aX=displayObject.anchor.x;aY=displayObject.anchor.y;w0=width*(1-aX);w1=width*-aX;h0=height*(1-aY);h1=height*-aY;index=indexRun*8;worldTransform=displayObject.worldTransform;a=worldTransform[0];b=worldTransform[3];c=worldTransform[1];d=worldTransform[4];tx=worldTransform[2];ty=worldTransform[5];verticies[index+0]=a*w1+c*h1+tx;verticies[index+1]=d*h1+b*w1+ty;verticies[index+2]=a*w0+c*h1+tx;verticies[index+3]=d*h1+b*w0+ty;verticies[index+4]=a*w0+c*h0+tx;verticies[index+5]=d*h0+b*w0+ty;verticies[index+6]=a*w1+c*h0+tx;verticies[index+7]=d*h0+b*w1+ty;if(displayObject.updateFrame||displayObject.texture.updateFrame){this.dirtyUVS=true;var texture=displayObject.texture;var frame=texture.frame;var tw=texture.baseTexture.width;var th=texture.baseTexture.height;uvs[index+0]=frame.x/tw;uvs[index+1]=frame.y/th;uvs[index+2]=(frame.x+frame.width)/tw;uvs[index+3]=frame.y/th;uvs[index+4]=(frame.x+frame.width)/tw;uvs[index+5]=(frame.y+frame.height)/th;uvs[index+6]=frame.x/tw;uvs[index+7]=(frame.y+frame.height)/th;displayObject.updateFrame=false}if(displayObject.cacheAlpha!=displayObject.worldAlpha){displayObject.cacheAlpha=displayObject.worldAlpha;var colorIndex=indexRun*4;colors[colorIndex]=colors[colorIndex+1]=colors[colorIndex+2]=colors[colorIndex+3]=displayObject.worldAlpha;this.dirtyColors=true}}else{index=indexRun*8;verticies[index+0]=verticies[index+1]=verticies[index+2]=verticies[index+3]=verticies[index+4]=verticies[index+5]=verticies[index+6]=verticies[index+7]=0}indexRun++;displayObject=displayObject.__next}};PIXI.WebGLBatch.prototype.render=function(start,end){start=start||0;if(end==undefined)end=this.size;if(this.dirty){this.refresh();this.dirty=false}if(this.size===0)return;this.update();var gl=this.gl;var shaderProgram=PIXI.defaultShader;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.verticies);gl.vertexAttribPointer(shaderProgram.aVertexPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer);if(this.dirtyUVS){this.dirtyUVS=false;gl.bufferSubData(gl.ARRAY_BUFFER,0,this.uvs)}gl.vertexAttribPointer(shaderProgram.aTextureCoord,2,gl.FLOAT,false,0,0);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,this.texture._glTexture);gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer);if(this.dirtyColors){this.dirtyColors=false;gl.bufferSubData(gl.ARRAY_BUFFER,0,this.colors)}gl.vertexAttribPointer(shaderProgram.colorAttribute,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var len=end-start;gl.drawElements(gl.TRIANGLES,len*6,gl.UNSIGNED_SHORT,start*2*6)};PIXI.WebGLFilterManager=function(transparent){this.transparent=transparent;this.filterStack=[];this.texturePool=[];this.offsetX=0;this.offsetY=0;this.initShaderBuffers()};PIXI.WebGLFilterManager.prototype.begin=function(projection,buffer){this.width=projection.x*2;this.height=-projection.y*2;this.buffer=buffer};PIXI.WebGLFilterManager.prototype.pushFilter=function(filterBlock){var gl=PIXI.gl;this.filterStack.push(filterBlock);var filter=filterBlock.filterPasses[0];this.offsetX+=filterBlock.target.filterArea.x;this.offsetY+=filterBlock.target.filterArea.y;var texture=this.texturePool.pop();if(!texture)texture=new PIXI.FilterTexture(this.width,this.height);gl.bindTexture(gl.TEXTURE_2D,texture.texture);this.getBounds(filterBlock.target);var filterArea=filterBlock.target.filterArea;var padidng=filter.padding;filterArea.x-=padidng;filterArea.y-=padidng;filterArea.width+=padidng*2;filterArea.height+=padidng*2;if(filterArea.x<0)filterArea.x=0;if(filterArea.width>this.width)filterArea.width=this.width;if(filterArea.y<0)filterArea.y=0;if(filterArea.height>this.height)filterArea.height=this.height;gl.bindFramebuffer(gl.FRAMEBUFFER,texture.frameBuffer);gl.viewport(0,0,filterArea.width,filterArea.height);PIXI.projection.x=filterArea.width/2;PIXI.projection.y=-filterArea.height/2;PIXI.offset.x=-filterArea.x;PIXI.offset.y=-filterArea.y;gl.uniform2f(PIXI.defaultShader.projectionVector,filterArea.width/2,-filterArea.height/2);gl.uniform2f(PIXI.defaultShader.offsetVector,-filterArea.x,-filterArea.y);gl.colorMask(true,true,true,true);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);filterBlock._glFilterTexture=texture};PIXI.WebGLFilterManager.prototype.popFilter=function(){var gl=PIXI.gl;var filterBlock=this.filterStack.pop();var filterArea=filterBlock.target.filterArea;var texture=filterBlock._glFilterTexture;if(filterBlock.filterPasses.length>1){gl.viewport(0,0,filterArea.width,filterArea.height);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=filterArea.height;this.vertexArray[2]=filterArea.width;this.vertexArray[3]=filterArea.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=filterArea.width;this.vertexArray[7]=0;gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertexArray);gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=filterArea.width/this.width;this.uvArray[5]=filterArea.height/this.height;this.uvArray[6]=filterArea.width/this.width;this.uvArray[7]=filterArea.height/this.height;gl.bufferSubData(gl.ARRAY_BUFFER,0,this.uvArray);var inputTexture=texture;var outputTexture=this.texturePool.pop();if(!outputTexture)outputTexture=new PIXI.FilterTexture(this.width,this.height);gl.bindFramebuffer(gl.FRAMEBUFFER,outputTexture.frameBuffer);gl.clear(gl.COLOR_BUFFER_BIT);gl.disable(gl.BLEND);for(var i=0;i<filterBlock.filterPasses.length-1;i++){var filterPass=filterBlock.filterPasses[i];gl.bindFramebuffer(gl.FRAMEBUFFER,outputTexture.frameBuffer);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,inputTexture.texture);this.applyFilterPass(filterPass,filterArea,filterArea.width,filterArea.height);var temp=inputTexture;inputTexture=outputTexture;outputTexture=temp}gl.enable(gl.BLEND);texture=inputTexture;this.texturePool.push(outputTexture)}var filter=filterBlock.filterPasses[filterBlock.filterPasses.length-1];this.offsetX-=filterArea.x;this.offsetY-=filterArea.y;var sizeX=this.width;var sizeY=this.height;var offsetX=0;var offsetY=0;var buffer=this.buffer;if(this.filterStack.length===0){gl.colorMask(true,true,true,this.transparent)}else{var currentFilter=this.filterStack[this.filterStack.length-1];var filterArea=currentFilter.target.filterArea;sizeX=filterArea.width;sizeY=filterArea.height;offsetX=filterArea.x;offsetY=filterArea.y;buffer=currentFilter._glFilterTexture.frameBuffer}PIXI.projection.x=sizeX/2;PIXI.projection.y=-sizeY/2;PIXI.offset.x=offsetX;PIXI.offset.y=offsetY;var filterArea=filterBlock.target.filterArea;var x=filterArea.x-offsetX;var y=filterArea.y-offsetY;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=x;this.vertexArray[1]=y+filterArea.height;this.vertexArray[2]=x+filterArea.width;this.vertexArray[3]=y+filterArea.height;this.vertexArray[4]=x;this.vertexArray[5]=y;this.vertexArray[6]=x+filterArea.width;this.vertexArray[7]=y;gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertexArray);gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=filterArea.width/this.width;this.uvArray[5]=filterArea.height/this.height;this.uvArray[6]=filterArea.width/this.width;this.uvArray[7]=filterArea.height/this.height;gl.bufferSubData(gl.ARRAY_BUFFER,0,this.uvArray);gl.viewport(0,0,sizeX,sizeY);gl.bindFramebuffer(gl.FRAMEBUFFER,buffer);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,texture.texture);this.applyFilterPass(filter,filterArea,sizeX,sizeY);gl.useProgram(PIXI.defaultShader.program);gl.uniform2f(PIXI.defaultShader.projectionVector,sizeX/2,-sizeY/2);gl.uniform2f(PIXI.defaultShader.offsetVector,-offsetX,-offsetY);this.texturePool.push(texture);filterBlock._glFilterTexture=null};PIXI.WebGLFilterManager.prototype.applyFilterPass=function(filter,filterArea,width,height){var gl=PIXI.gl;if(!filter.shader){var shader=new PIXI.PixiShader;shader.fragmentSrc=filter.fragmentSrc;shader.uniforms=filter.uniforms;shader.init();filter.shader=shader}var shader=filter.shader;gl.useProgram(shader.program);gl.uniform2f(shader.projectionVector,width/2,-height/2);gl.uniform2f(shader.offsetVector,0,0);if(filter.uniforms.dimensions){filter.uniforms.dimensions.value[0]=this.width;filter.uniforms.dimensions.value[1]=this.height;filter.uniforms.dimensions.value[2]=this.vertexArray[0];filter.uniforms.dimensions.value[3]=this.vertexArray[5]}shader.syncUniforms();gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer);gl.vertexAttribPointer(shader.aTextureCoord,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)};PIXI.WebGLFilterManager.prototype.initShaderBuffers=function(){var gl=PIXI.gl;this.vertexBuffer=gl.createBuffer();this.uvBuffer=gl.createBuffer();this.indexBuffer=gl.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.vertexArray,gl.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.uvArray,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),gl.STATIC_DRAW)};PIXI.WebGLFilterManager.prototype.getBounds=function(displayObject){var worldTransform,width,height,aX,aY,w0,w1,h0,h1,index,doTest;var a,b,c,d,tx,ty,x1,x2,x3,x4,y1,y2,y3,y4;var tempObject=displayObject.first;var testObject=displayObject.last._iNext;var maxX=-Infinity;var maxY=-Infinity;var minX=Infinity;var minY=Infinity;do{if(tempObject.visible){if(tempObject instanceof PIXI.Sprite){width=tempObject.texture.frame.width;height=tempObject.texture.frame.height;aX=tempObject.anchor.x;aY=tempObject.anchor.y;w0=width*(1-aX);w1=width*-aX;h0=height*(1-aY);h1=height*-aY;doTest=true}else if(tempObject instanceof PIXI.Graphics){tempObject.updateFilterBounds();var bounds=tempObject.bounds;width=bounds.width;height=bounds.height;w0=bounds.x;w1=bounds.x+bounds.width;h0=bounds.y;h1=bounds.y+bounds.height;doTest=true}}if(doTest){worldTransform=tempObject.worldTransform;a=worldTransform[0];b=worldTransform[3];c=worldTransform[1];d=worldTransform[4];tx=worldTransform[2];ty=worldTransform[5];x1=a*w1+c*h1+tx;y1=d*h1+b*w1+ty;x2=a*w0+c*h1+tx;y2=d*h1+b*w0+ty;x3=a*w0+c*h0+tx;y3=d*h0+b*w0+ty;x4=a*w1+c*h0+tx;y4=d*h0+b*w1+ty;minX=x1<minX?x1:minX;minX=x2<minX?x2:minX;minX=x3<minX?x3:minX;minX=x4<minX?x4:minX;minY=y1<minY?y1:minY;minY=y2<minY?y2:minY;minY=y3<minY?y3:minY;minY=y4<minY?y4:minY;maxX=x1>maxX?x1:maxX;maxX=x2>maxX?x2:maxX;maxX=x3>maxX?x3:maxX;maxX=x4>maxX?x4:maxX;maxY=y1>maxY?y1:maxY;maxY=y2>maxY?y2:maxY;maxY=y3>maxY?y3:maxY;maxY=y4>maxY?y4:maxY}doTest=false;tempObject=tempObject._iNext}while(tempObject!=testObject);displayObject.filterArea.x=minX;displayObject.filterArea.y=minY;displayObject.filterArea.width=maxX-minX;displayObject.filterArea.height=maxY-minY};PIXI.FilterTexture=function(width,height){var gl=PIXI.gl;this.frameBuffer=gl.createFramebuffer();this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebuffer);gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0);this.resize(width,height)};PIXI.FilterTexture.prototype.resize=function(width,height){this.width=width;this.height=height;var gl=PIXI.gl;gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null)};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.renderGraphics=function(graphics,projection){var gl=PIXI.gl;if(!graphics._webGL)graphics._webGL={points:[],indices:[],lastIndex:0,buffer:gl.createBuffer(),indexBuffer:gl.createBuffer()};if(graphics.dirty){graphics.dirty=false;if(graphics.clearDirty){graphics.clearDirty=false;graphics._webGL.lastIndex=0;graphics._webGL.points=[];graphics._webGL.indices=[]}PIXI.WebGLGraphics.updateGraphics(graphics)}PIXI.activatePrimitiveShader();var m=PIXI.mat3.clone(graphics.worldTransform);PIXI.mat3.transpose(m);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.uniformMatrix3fv(PIXI.primitiveShader.translationMatrix,false,m);gl.uniform2f(PIXI.primitiveShader.projectionVector,projection.x,-projection.y);gl.uniform2f(PIXI.primitiveShader.offsetVector,-PIXI.offset.x,-PIXI.offset.y);gl.uniform1f(PIXI.primitiveShader.alpha,graphics.worldAlpha);gl.bindBuffer(gl.ARRAY_BUFFER,graphics._webGL.buffer);gl.vertexAttribPointer(PIXI.primitiveShader.aVertexPosition,2,gl.FLOAT,false,4*6,0);
gl.vertexAttribPointer(PIXI.primitiveShader.colorAttribute,4,gl.FLOAT,false,4*6,2*4);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,graphics._webGL.indexBuffer);gl.drawElements(gl.TRIANGLE_STRIP,graphics._webGL.indices.length,gl.UNSIGNED_SHORT,0);PIXI.deactivatePrimitiveShader()};PIXI.WebGLGraphics.updateGraphics=function(graphics){for(var i=graphics._webGL.lastIndex;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];if(data.type==PIXI.Graphics.POLY){if(data.fill){if(data.points.length>3)PIXI.WebGLGraphics.buildPoly(data,graphics._webGL)}if(data.lineWidth>0){PIXI.WebGLGraphics.buildLine(data,graphics._webGL)}}else if(data.type==PIXI.Graphics.RECT){PIXI.WebGLGraphics.buildRectangle(data,graphics._webGL)}else if(data.type==PIXI.Graphics.CIRC||data.type==PIXI.Graphics.ELIP){PIXI.WebGLGraphics.buildCircle(data,graphics._webGL)}}graphics._webGL.lastIndex=graphics.graphicsData.length;var gl=PIXI.gl;graphics._webGL.glPoints=new Float32Array(graphics._webGL.points);gl.bindBuffer(gl.ARRAY_BUFFER,graphics._webGL.buffer);gl.bufferData(gl.ARRAY_BUFFER,graphics._webGL.glPoints,gl.STATIC_DRAW);graphics._webGL.glIndicies=new Uint16Array(graphics._webGL.indices);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,graphics._webGL.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,graphics._webGL.glIndicies,gl.STATIC_DRAW)};PIXI.WebGLGraphics.buildRectangle=function(graphicsData,webGLData){var rectData=graphicsData.points;var x=rectData[0];var y=rectData[1];var width=rectData[2];var height=rectData[3];if(graphicsData.fill){var color=HEXtoRGB(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vertPos=verts.length/6;verts.push(x,y);verts.push(r,g,b,alpha);verts.push(x+width,y);verts.push(r,g,b,alpha);verts.push(x,y+height);verts.push(r,g,b,alpha);verts.push(x+width,y+height);verts.push(r,g,b,alpha);indices.push(vertPos,vertPos,vertPos+1,vertPos+2,vertPos+3,vertPos+3)}if(graphicsData.lineWidth){graphicsData.points=[x,y,x+width,y,x+width,y+height,x,y+height,x,y];PIXI.WebGLGraphics.buildLine(graphicsData,webGLData)}};PIXI.WebGLGraphics.buildCircle=function(graphicsData,webGLData){var rectData=graphicsData.points;var x=rectData[0];var y=rectData[1];var width=rectData[2];var height=rectData[3];var totalSegs=40;var seg=Math.PI*2/totalSegs;if(graphicsData.fill){var color=HEXtoRGB(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vecPos=verts.length/6;indices.push(vecPos);for(var i=0;i<totalSegs+1;i++){verts.push(x,y,r,g,b,alpha);verts.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height,r,g,b,alpha);indices.push(vecPos++,vecPos++)}indices.push(vecPos-1)}if(graphicsData.lineWidth){graphicsData.points=[];for(var i=0;i<totalSegs+1;i++){graphicsData.points.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height)}PIXI.WebGLGraphics.buildLine(graphicsData,webGLData)}};PIXI.WebGLGraphics.buildLine=function(graphicsData,webGLData){var wrap=true;var points=graphicsData.points;if(points.length===0)return;if(graphicsData.lineWidth%2){for(var i=0;i<points.length;i++){points[i]+=.5}}var firstPoint=new PIXI.Point(points[0],points[1]);var lastPoint=new PIXI.Point(points[points.length-2],points[points.length-1]);if(firstPoint.x==lastPoint.x&&firstPoint.y==lastPoint.y){points.pop();points.pop();lastPoint=new PIXI.Point(points[points.length-2],points[points.length-1]);var midPointX=lastPoint.x+(firstPoint.x-lastPoint.x)*.5;var midPointY=lastPoint.y+(firstPoint.y-lastPoint.y)*.5;points.unshift(midPointX,midPointY);points.push(midPointX,midPointY)}var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var indexCount=points.length;var indexStart=verts.length/6;var width=graphicsData.lineWidth/2;var color=HEXtoRGB(graphicsData.lineColor);var alpha=graphicsData.lineAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var p1x,p1y,p2x,p2y,p3x,p3y;var perpx,perpy,perp2x,perp2y,perp3x,perp3y;var ipx,ipy;var a1,b1,c1,a2,b2,c2;var denom,pdist,dist;p1x=points[0];p1y=points[1];p2x=points[2];p2y=points[3];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p1x-perpx,p1y-perpy,r,g,b,alpha);verts.push(p1x+perpx,p1y+perpy,r,g,b,alpha);for(var i=1;i<length-1;i++){p1x=points[(i-1)*2];p1y=points[(i-1)*2+1];p2x=points[i*2];p2y=points[i*2+1];p3x=points[(i+1)*2];p3y=points[(i+1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x/=dist;perp2y/=dist;perp2x*=width;perp2y*=width;a1=-perpy+p1y-(-perpy+p2y);b1=-perpx+p2x-(-perpx+p1x);c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);a2=-perp2y+p3y-(-perp2y+p2y);b2=-perp2x+p2x-(-perp2x+p3x);c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);denom=a1*b2-a2*b1;if(Math.abs(denom)<.1){denom+=10.1;verts.push(p2x-perpx,p2y-perpy,r,g,b,alpha);verts.push(p2x+perpx,p2y+perpy,r,g,b,alpha);continue}px=(b1*c2-b2*c1)/denom;py=(a2*c1-a1*c2)/denom;pdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);if(pdist>140*140){perp3x=perpx-perp2x;perp3y=perpy-perp2y;dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y);perp3x/=dist;perp3y/=dist;perp3x*=width;perp3y*=width;verts.push(p2x-perp3x,p2y-perp3y);verts.push(r,g,b,alpha);verts.push(p2x+perp3x,p2y+perp3y);verts.push(r,g,b,alpha);verts.push(p2x-perp3x,p2y-perp3y);verts.push(r,g,b,alpha);indexCount++}else{verts.push(px,py);verts.push(r,g,b,alpha);verts.push(p2x-(px-p2x),p2y-(py-p2y));verts.push(r,g,b,alpha)}}p1x=points[(length-2)*2];p1y=points[(length-2)*2+1];p2x=points[(length-1)*2];p2y=points[(length-1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p2x-perpx,p2y-perpy);verts.push(r,g,b,alpha);verts.push(p2x+perpx,p2y+perpy);verts.push(r,g,b,alpha);indices.push(indexStart);for(var i=0;i<indexCount;i++){indices.push(indexStart++)}indices.push(indexStart-1)};PIXI.WebGLGraphics.buildPoly=function(graphicsData,webGLData){var points=graphicsData.points;if(points.length<6)return;var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var color=HEXtoRGB(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var triangles=PIXI.PolyK.Triangulate(points);var vertPos=verts.length/6;for(var i=0;i<triangles.length;i+=3){indices.push(triangles[i]+vertPos);indices.push(triangles[i]+vertPos);indices.push(triangles[i+1]+vertPos);indices.push(triangles[i+2]+vertPos);indices.push(triangles[i+2]+vertPos)}for(var i=0;i<length;i++){verts.push(points[i*2],points[i*2+1],r,g,b,alpha)}};function HEXtoRGB(hex){return[(hex>>16&255)/255,(hex>>8&255)/255,(hex&255)/255]}PIXI._defaultFrame=new PIXI.Rectangle(0,0,1,1);PIXI.gl;PIXI.WebGLRenderer=function(width,height,view,transparent,antialias){this.transparent=!!transparent;this.width=width||800;this.height=height||600;this.view=view||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;var scope=this;this.view.addEventListener("webglcontextlost",function(event){scope.handleContextLost(event)},false);this.view.addEventListener("webglcontextrestored",function(event){scope.handleContextRestored(event)},false);this.batchs=[];var options={alpha:this.transparent,antialias:!!antialias,premultipliedAlpha:false,stencil:true};try{PIXI.gl=this.gl=this.view.getContext("experimental-webgl",options)}catch(e){try{PIXI.gl=this.gl=this.view.getContext("webgl",options)}catch(e){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}PIXI.initDefaultShaders();var gl=this.gl;gl.useProgram(PIXI.defaultShader.program);PIXI.WebGLRenderer.gl=gl;this.batch=new PIXI.WebGLBatch(gl);gl.disable(gl.DEPTH_TEST);gl.disable(gl.CULL_FACE);gl.enable(gl.BLEND);gl.colorMask(true,true,true,this.transparent);PIXI.projection=new PIXI.Point(400,300);PIXI.offset=new PIXI.Point(0,0);this.resize(this.width,this.height);this.contextLost=false;this.stageRenderGroup=new PIXI.WebGLRenderGroup(this.gl,this.transparent)};PIXI.WebGLRenderer.prototype.constructor=PIXI.WebGLRenderer;PIXI.WebGLRenderer.getBatch=function(){if(PIXI._batchs.length===0){return new PIXI.WebGLBatch(PIXI.WebGLRenderer.gl)}else{return PIXI._batchs.pop()}};PIXI.WebGLRenderer.returnBatch=function(batch){batch.clean();PIXI._batchs.push(batch)};PIXI.WebGLRenderer.prototype.render=function(stage){if(this.contextLost)return;if(this.__stage!==stage){this.__stage=stage;this.stageRenderGroup.setRenderable(stage)}PIXI.WebGLRenderer.updateTextures();PIXI.visibleCount++;stage.updateTransform();var gl=this.gl;gl.colorMask(true,true,true,this.transparent);gl.viewport(0,0,this.width,this.height);gl.bindFramebuffer(gl.FRAMEBUFFER,null);gl.clearColor(stage.backgroundColorSplit[0],stage.backgroundColorSplit[1],stage.backgroundColorSplit[2],!this.transparent);gl.clear(gl.COLOR_BUFFER_BIT);this.stageRenderGroup.backgroundColor=stage.backgroundColorSplit;PIXI.projection.x=this.width/2;PIXI.projection.y=-this.height/2;this.stageRenderGroup.render(PIXI.projection);if(stage.interactive){if(!stage._interactiveEventsAdded){stage._interactiveEventsAdded=true;stage.interactionManager.setTarget(this)}}if(PIXI.Texture.frameUpdates.length>0){for(var i=0;i<PIXI.Texture.frameUpdates.length;i++){PIXI.Texture.frameUpdates[i].updateFrame=false}PIXI.Texture.frameUpdates=[]}};PIXI.WebGLRenderer.updateTextures=function(){for(var i=0;i<PIXI.texturesToUpdate.length;i++)PIXI.WebGLRenderer.updateTexture(PIXI.texturesToUpdate[i]);for(var i=0;i<PIXI.texturesToDestroy.length;i++)PIXI.WebGLRenderer.destroyTexture(PIXI.texturesToDestroy[i]);PIXI.texturesToUpdate=[];PIXI.texturesToDestroy=[]};PIXI.WebGLRenderer.updateTexture=function(texture){var gl=PIXI.gl;if(!texture._glTexture){texture._glTexture=gl.createTexture()}if(texture.hasLoaded){gl.bindTexture(gl.TEXTURE_2D,texture._glTexture);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.source);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);if(!texture._powerOf2){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)}gl.bindTexture(gl.TEXTURE_2D,null)}};PIXI.WebGLRenderer.destroyTexture=function(texture){var gl=PIXI.gl;if(texture._glTexture){texture._glTexture=gl.createTexture();gl.deleteTexture(gl.TEXTURE_2D,texture._glTexture)}};PIXI.WebGLRenderer.prototype.resize=function(width,height){this.width=width;this.height=height;this.view.width=width;this.view.height=height;this.gl.viewport(0,0,this.width,this.height);PIXI.projection.x=this.width/2;PIXI.projection.y=-this.height/2};PIXI.WebGLRenderer.prototype.handleContextLost=function(event){event.preventDefault();this.contextLost=true};PIXI.WebGLRenderer.prototype.handleContextRestored=function(event){this.gl=this.view.getContext("experimental-webgl",{alpha:true});this.initShaders();for(var key in PIXI.TextureCache){var texture=PIXI.TextureCache[key].baseTexture;texture._glTexture=null;PIXI.WebGLRenderer.updateTexture(texture)}for(var i=0;i<this.batchs.length;i++){this.batchs[i].restoreLostContext(this.gl);this.batchs[i].dirty=true}PIXI._restoreBatchs(this.gl);this.contextLost=false};PIXI.WebGLRenderGroup=function(gl,transparent){this.gl=gl;this.root;this.backgroundColor;this.transparent=transparent==undefined?true:transparent;this.batchs=[];this.toRemove=[];this.filterManager=new PIXI.WebGLFilterManager(this.transparent)};PIXI.WebGLRenderGroup.prototype.constructor=PIXI.WebGLRenderGroup;PIXI.WebGLRenderGroup.prototype.setRenderable=function(displayObject){if(this.root)this.removeDisplayObjectAndChildren(this.root);displayObject.worldVisible=displayObject.visible;this.root=displayObject;this.addDisplayObjectAndChildren(displayObject)};PIXI.WebGLRenderGroup.prototype.render=function(projection,buffer){PIXI.WebGLRenderer.updateTextures();var gl=this.gl;gl.uniform2f(PIXI.defaultShader.projectionVector,projection.x,projection.y);this.filterManager.begin(projection,buffer);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);var renderable;for(var i=0;i<this.batchs.length;i++){renderable=this.batchs[i];if(renderable instanceof PIXI.WebGLBatch){this.batchs[i].render();continue}this.renderSpecial(renderable,projection)}};PIXI.WebGLRenderGroup.prototype.renderSpecific=function(displayObject,projection,buffer){PIXI.WebGLRenderer.updateTextures();var gl=this.gl;gl.uniform2f(PIXI.defaultShader.projectionVector,projection.x,projection.y);this.filterManager.begin(projection,buffer);var startIndex;var startBatchIndex;var endIndex;var endBatchIndex;var nextRenderable=displayObject.first;while(nextRenderable._iNext){if(nextRenderable.renderable&&nextRenderable.__renderGroup)break;nextRenderable=nextRenderable._iNext}var startBatch=nextRenderable.batch;if(nextRenderable instanceof PIXI.Sprite){startBatch=nextRenderable.batch;var head=startBatch.head;var next=head;if(head==nextRenderable){startIndex=0}else{startIndex=1;while(head.__next!=nextRenderable){startIndex++;head=head.__next}}}else{startBatch=nextRenderable}var lastRenderable=displayObject.last;while(lastRenderable._iPrev){if(lastRenderable.renderable&&lastRenderable.__renderGroup)break;lastRenderable=lastRenderable._iNext}if(lastRenderable instanceof PIXI.Sprite){endBatch=lastRenderable.batch;var head=endBatch.head;if(head==lastRenderable){endIndex=0}else{endIndex=1;while(head.__next!=lastRenderable){endIndex++;head=head.__next}}}else{endBatch=lastRenderable}if(startBatch==endBatch){if(startBatch instanceof PIXI.WebGLBatch){startBatch.render(startIndex,endIndex+1)}else{this.renderSpecial(startBatch,projection)}return}startBatchIndex=this.batchs.indexOf(startBatch);endBatchIndex=this.batchs.indexOf(endBatch);if(startBatch instanceof PIXI.WebGLBatch){startBatch.render(startIndex)}else{this.renderSpecial(startBatch,projection)}for(var i=startBatchIndex+1;i<endBatchIndex;i++){renderable=this.batchs[i];if(renderable instanceof PIXI.WebGLBatch){this.batchs[i].render()}else{this.renderSpecial(renderable,projection)}}if(endBatch instanceof PIXI.WebGLBatch){endBatch.render(0,endIndex+1)}else{this.renderSpecial(endBatch,projection)}};PIXI.WebGLRenderGroup.prototype.renderSpecial=function(renderable,projection){var worldVisible=renderable.vcount===PIXI.visibleCount;if(renderable instanceof PIXI.TilingSprite){if(worldVisible)this.renderTilingSprite(renderable,projection)}else if(renderable instanceof PIXI.Strip){if(worldVisible)this.renderStrip(renderable,projection)}else if(renderable instanceof PIXI.CustomRenderable){if(worldVisible)renderable.renderWebGL(this,projection)}else if(renderable instanceof PIXI.Graphics){if(worldVisible&&renderable.renderable)PIXI.WebGLGraphics.renderGraphics(renderable,projection)}else if(renderable instanceof PIXI.FilterBlock){this.handleFilterBlock(renderable,projection)}};flip=false;var maskStack=[];var maskPosition=0;PIXI.WebGLRenderGroup.prototype.handleFilterBlock=function(filterBlock,projection){var gl=PIXI.gl;if(filterBlock.open){if(filterBlock.data instanceof Array){this.filterManager.pushFilter(filterBlock)}else{maskPosition++;maskStack.push(filterBlock);gl.enable(gl.STENCIL_TEST);gl.colorMask(false,false,false,false);gl.stencilFunc(gl.ALWAYS,1,1);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);PIXI.WebGLGraphics.renderGraphics(filterBlock.data,projection);gl.colorMask(true,true,true,true);gl.stencilFunc(gl.NOTEQUAL,0,maskStack.length);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}}else{if(filterBlock.data instanceof Array){this.filterManager.popFilter()}else{var maskData=maskStack.pop(filterBlock);if(maskData){gl.colorMask(false,false,false,false);gl.stencilFunc(gl.ALWAYS,1,1);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR);PIXI.WebGLGraphics.renderGraphics(maskData.data,projection);gl.colorMask(true,true,true,true);gl.stencilFunc(gl.NOTEQUAL,0,maskStack.length);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}gl.disable(gl.STENCIL_TEST)}}};PIXI.WebGLRenderGroup.prototype.updateTexture=function(displayObject){this.removeObject(displayObject);var previousRenderable=displayObject.first;while(previousRenderable!=this.root){previousRenderable=previousRenderable._iPrev;if(previousRenderable.renderable&&previousRenderable.__renderGroup)break}var nextRenderable=displayObject.last;while(nextRenderable._iNext){nextRenderable=nextRenderable._iNext;if(nextRenderable.renderable&&nextRenderable.__renderGroup)break}this.insertObject(displayObject,previousRenderable,nextRenderable)};PIXI.WebGLRenderGroup.prototype.addFilterBlocks=function(start,end){start.__renderGroup=this;end.__renderGroup=this;var previousRenderable=start;while(previousRenderable!=this.root.first){previousRenderable=previousRenderable._iPrev;if(previousRenderable.renderable&&previousRenderable.__renderGroup)break}this.insertAfter(start,previousRenderable);var previousRenderable2=end;while(previousRenderable2!=this.root.first){previousRenderable2=previousRenderable2._iPrev;if(previousRenderable2.renderable&&previousRenderable2.__renderGroup)break}this.insertAfter(end,previousRenderable2)};PIXI.WebGLRenderGroup.prototype.removeFilterBlocks=function(start,end){this.removeObject(start);this.removeObject(end)};PIXI.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(displayObject){if(displayObject.__renderGroup)displayObject.__renderGroup.removeDisplayObjectAndChildren(displayObject);var previousRenderable=displayObject.first;while(previousRenderable!=this.root.first){previousRenderable=previousRenderable._iPrev;if(previousRenderable.renderable&&previousRenderable.__renderGroup)break}var nextRenderable=displayObject.last;while(nextRenderable._iNext){nextRenderable=nextRenderable._iNext;if(nextRenderable.renderable&&nextRenderable.__renderGroup)break}var tempObject=displayObject.first;var testObject=displayObject.last._iNext;do{tempObject.__renderGroup=this;if(tempObject.renderable){this.insertObject(tempObject,previousRenderable,nextRenderable);previousRenderable=tempObject}tempObject=tempObject._iNext}while(tempObject!=testObject)};PIXI.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(displayObject){if(displayObject.__renderGroup!=this)return;var lastObject=displayObject.last;do{displayObject.__renderGroup=null;if(displayObject.renderable)this.removeObject(displayObject);displayObject=displayObject._iNext}while(displayObject)};PIXI.WebGLRenderGroup.prototype.insertObject=function(displayObject,previousObject,nextObject){var previousSprite=previousObject;var nextSprite=nextObject;if(displayObject instanceof PIXI.Sprite){var previousBatch;var nextBatch;if(previousSprite instanceof PIXI.Sprite){previousBatch=previousSprite.batch;if(previousBatch){if(previousBatch.texture==displayObject.texture.baseTexture&&previousBatch.blendMode==displayObject.blendMode){previousBatch.insertAfter(displayObject,previousSprite);return}}}else{previousBatch=previousSprite}if(nextSprite){if(nextSprite instanceof PIXI.Sprite){nextBatch=nextSprite.batch;if(nextBatch){if(nextBatch.texture==displayObject.texture.baseTexture&&nextBatch.blendMode==displayObject.blendMode){nextBatch.insertBefore(displayObject,nextSprite);return}else{if(nextBatch==previousBatch){var splitBatch=previousBatch.split(nextSprite);var batch=PIXI.WebGLRenderer.getBatch();var index=this.batchs.indexOf(previousBatch);batch.init(displayObject);this.batchs.splice(index+1,0,batch,splitBatch);return}}}}else{nextBatch=nextSprite}}var batch=PIXI.WebGLRenderer.getBatch();batch.init(displayObject);if(previousBatch){var index=this.batchs.indexOf(previousBatch);this.batchs.splice(index+1,0,batch)}else{this.batchs.push(batch)}return}else if(displayObject instanceof PIXI.TilingSprite){this.initTilingSprite(displayObject)}else if(displayObject instanceof PIXI.Strip){this.initStrip(displayObject)}else if(displayObject){}this.insertAfter(displayObject,previousSprite)};PIXI.WebGLRenderGroup.prototype.insertAfter=function(item,displayObject){if(displayObject instanceof PIXI.Sprite){var previousBatch=displayObject.batch;if(previousBatch){if(previousBatch.tail==displayObject){var index=this.batchs.indexOf(previousBatch);this.batchs.splice(index+1,0,item)}else{var splitBatch=previousBatch.split(displayObject.__next);var index=this.batchs.indexOf(previousBatch);this.batchs.splice(index+1,0,item,splitBatch)}}else{this.batchs.push(item)}}else{var index=this.batchs.indexOf(displayObject);this.batchs.splice(index+1,0,item)}};PIXI.WebGLRenderGroup.prototype.removeObject=function(displayObject){var batchToRemove;if(displayObject instanceof PIXI.Sprite){var batch=displayObject.batch;if(!batch)return;batch.remove(displayObject);if(batch.size==0){batchToRemove=batch}}else{batchToRemove=displayObject}if(batchToRemove){var index=this.batchs.indexOf(batchToRemove);if(index==-1)return;if(index===0||index==this.batchs.length-1){this.batchs.splice(index,1);if(batchToRemove instanceof PIXI.WebGLBatch)PIXI.WebGLRenderer.returnBatch(batchToRemove);return}if(this.batchs[index-1]instanceof PIXI.WebGLBatch&&this.batchs[index+1]instanceof PIXI.WebGLBatch){if(this.batchs[index-1].texture==this.batchs[index+1].texture&&this.batchs[index-1].blendMode==this.batchs[index+1].blendMode){this.batchs[index-1].merge(this.batchs[index+1]);if(batchToRemove instanceof PIXI.WebGLBatch)PIXI.WebGLRenderer.returnBatch(batchToRemove);PIXI.WebGLRenderer.returnBatch(this.batchs[index+1]);this.batchs.splice(index,2);return}}this.batchs.splice(index,1);if(batchToRemove instanceof PIXI.WebGLBatch)PIXI.WebGLRenderer.returnBatch(batchToRemove)}};PIXI.WebGLRenderGroup.prototype.initTilingSprite=function(sprite){var gl=this.gl;sprite.verticies=new Float32Array([0,0,sprite.width,0,sprite.width,sprite.height,0,sprite.height]);sprite.uvs=new Float32Array([0,0,1,0,1,1,0,1]);sprite.colors=new Float32Array([1,1,1,1]);sprite.indices=new Uint16Array([0,1,3,2]);sprite._vertexBuffer=gl.createBuffer();sprite._indexBuffer=gl.createBuffer();sprite._uvBuffer=gl.createBuffer();sprite._colorBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,sprite._vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,sprite.verticies,gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,sprite._uvBuffer);gl.bufferData(gl.ARRAY_BUFFER,sprite.uvs,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,sprite._colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,sprite.colors,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,sprite._indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,sprite.indices,gl.STATIC_DRAW);if(sprite.texture.baseTexture._glTexture){gl.bindTexture(gl.TEXTURE_2D,sprite.texture.baseTexture._glTexture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT);sprite.texture.baseTexture._powerOf2=true}else{sprite.texture.baseTexture._powerOf2=true}};PIXI.WebGLRenderGroup.prototype.renderStrip=function(strip,projection){var gl=this.gl;PIXI.activateStripShader();var shader=PIXI.stripShader;var program=shader.program;var m=PIXI.mat3.clone(strip.worldTransform);PIXI.mat3.transpose(m);gl.uniformMatrix3fv(shader.translationMatrix,false,m);gl.uniform2f(shader.projectionVector,projection.x,projection.y);gl.uniform2f(shader.offsetVector,-PIXI.offset.x,-PIXI.offset.y);gl.uniform1f(shader.alpha,strip.worldAlpha);if(!strip.dirty){gl.bindBuffer(gl.ARRAY_BUFFER,strip._vertexBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,strip.verticies);gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,strip._uvBuffer);gl.vertexAttribPointer(shader.aTextureCoord,2,gl.FLOAT,false,0,0);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,strip.texture.baseTexture._glTexture);gl.bindBuffer(gl.ARRAY_BUFFER,strip._colorBuffer);gl.vertexAttribPointer(shader.colorAttribute,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,strip._indexBuffer)}else{strip.dirty=false;gl.bindBuffer(gl.ARRAY_BUFFER,strip._vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,strip.verticies,gl.STATIC_DRAW);gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,strip._uvBuffer);gl.bufferData(gl.ARRAY_BUFFER,strip.uvs,gl.STATIC_DRAW);gl.vertexAttribPointer(shader.aTextureCoord,2,gl.FLOAT,false,0,0);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,strip.texture.baseTexture._glTexture);gl.bindBuffer(gl.ARRAY_BUFFER,strip._colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,strip.colors,gl.STATIC_DRAW);gl.vertexAttribPointer(shader.colorAttribute,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,strip._indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,strip.indices,gl.STATIC_DRAW)}gl.drawElements(gl.TRIANGLE_STRIP,strip.indices.length,gl.UNSIGNED_SHORT,0);PIXI.deactivateStripShader()};PIXI.WebGLRenderGroup.prototype.renderTilingSprite=function(sprite,projectionMatrix){var gl=this.gl;var shaderProgram=PIXI.shaderProgram;var tilePosition=sprite.tilePosition;var tileScale=sprite.tileScale;var offsetX=tilePosition.x/sprite.texture.baseTexture.width;var offsetY=tilePosition.y/sprite.texture.baseTexture.height;var scaleX=sprite.width/sprite.texture.baseTexture.width/tileScale.x;var scaleY=sprite.height/sprite.texture.baseTexture.height/tileScale.y;sprite.uvs[0]=0-offsetX;sprite.uvs[1]=0-offsetY;sprite.uvs[2]=1*scaleX-offsetX;sprite.uvs[3]=0-offsetY;sprite.uvs[4]=1*scaleX-offsetX;sprite.uvs[5]=1*scaleY-offsetY;sprite.uvs[6]=0-offsetX;sprite.uvs[7]=1*scaleY-offsetY;gl.bindBuffer(gl.ARRAY_BUFFER,sprite._uvBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,sprite.uvs);this.renderStrip(sprite,projectionMatrix)};PIXI.WebGLRenderGroup.prototype.initStrip=function(strip){var gl=this.gl;var shaderProgram=this.shaderProgram;strip._vertexBuffer=gl.createBuffer();strip._indexBuffer=gl.createBuffer();strip._uvBuffer=gl.createBuffer();strip._colorBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,strip._vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,strip.verticies,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,strip._uvBuffer);gl.bufferData(gl.ARRAY_BUFFER,strip.uvs,gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,strip._colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,strip.colors,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,strip._indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,strip.indices,gl.STATIC_DRAW)};PIXI.initDefaultShaders=function(){PIXI.primitiveShader=new PIXI.PrimitiveShader;PIXI.primitiveShader.init();PIXI.stripShader=new PIXI.StripShader;PIXI.stripShader.init();PIXI.defaultShader=new PIXI.PixiShader;PIXI.defaultShader.init();var gl=PIXI.gl;var shaderProgram=PIXI.defaultShader.program;gl.useProgram(shaderProgram);gl.enableVertexAttribArray(PIXI.defaultShader.aVertexPosition);gl.enableVertexAttribArray(PIXI.defaultShader.colorAttribute);gl.enableVertexAttribArray(PIXI.defaultShader.aTextureCoord)};PIXI.activatePrimitiveShader=function(){var gl=PIXI.gl;gl.useProgram(PIXI.primitiveShader.program);gl.disableVertexAttribArray(PIXI.defaultShader.aVertexPosition);gl.disableVertexAttribArray(PIXI.defaultShader.colorAttribute);gl.disableVertexAttribArray(PIXI.defaultShader.aTextureCoord);gl.enableVertexAttribArray(PIXI.primitiveShader.aVertexPosition);gl.enableVertexAttribArray(PIXI.primitiveShader.colorAttribute)};PIXI.deactivatePrimitiveShader=function(){var gl=PIXI.gl;gl.useProgram(PIXI.defaultShader.program);gl.disableVertexAttribArray(PIXI.primitiveShader.aVertexPosition);gl.disableVertexAttribArray(PIXI.primitiveShader.colorAttribute);gl.enableVertexAttribArray(PIXI.defaultShader.aVertexPosition);gl.enableVertexAttribArray(PIXI.defaultShader.colorAttribute);gl.enableVertexAttribArray(PIXI.defaultShader.aTextureCoord)};PIXI.activateStripShader=function(){var gl=PIXI.gl;gl.useProgram(PIXI.stripShader.program)};PIXI.deactivateStripShader=function(){var gl=PIXI.gl;gl.useProgram(PIXI.defaultShader.program)};PIXI.CompileVertexShader=function(gl,shaderSrc){return PIXI._CompileShader(gl,shaderSrc,gl.VERTEX_SHADER)};PIXI.CompileFragmentShader=function(gl,shaderSrc){return PIXI._CompileShader(gl,shaderSrc,gl.FRAGMENT_SHADER)};PIXI._CompileShader=function(gl,shaderSrc,shaderType){var src=shaderSrc.join("\n");var shader=gl.createShader(shaderType);gl.shaderSource(shader,src);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.log(gl.getShaderInfoLog(shader));return null}return shader};PIXI.compileProgram=function(vertexSrc,fragmentSrc){var gl=PIXI.gl;var fragmentShader=PIXI.CompileFragmentShader(gl,fragmentSrc);var vertexShader=PIXI.CompileVertexShader(gl,vertexSrc);var shaderProgram=gl.createProgram();gl.attachShader(shaderProgram,vertexShader);gl.attachShader(shaderProgram,fragmentShader);gl.linkProgram(shaderProgram);if(!gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)){console.log("Could not initialise shaders")}return shaderProgram};PIXI.BitmapText=function(text,style){PIXI.DisplayObjectContainer.call(this);this.setText(text);this.setStyle(style);this.updateText();this.dirty=false};PIXI.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.BitmapText.prototype.constructor=PIXI.BitmapText;PIXI.BitmapText.prototype.setText=function(text){this.text=text||" ";this.dirty=true};PIXI.BitmapText.prototype.setStyle=function(style){style=style||{};style.align=style.align||"left";this.style=style;var font=style.font.split(" ");this.fontName=font[font.length-1];this.fontSize=font.length>=2?parseInt(font[font.length-2],10):PIXI.BitmapText.fonts[this.fontName].size;this.dirty=true};PIXI.BitmapText.prototype.updateText=function(){var data=PIXI.BitmapText.fonts[this.fontName];var pos=new PIXI.Point;var prevCharCode=null;var chars=[];var maxLineWidth=0;var lineWidths=[];var line=0;var scale=this.fontSize/data.size;for(var i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(i))){lineWidths.push(pos.x);maxLineWidth=Math.max(maxLineWidth,pos.x);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;continue}var charData=data.chars[charCode];if(!charData)continue;if(prevCharCode&&charData[prevCharCode]){pos.x+=charData.kerning[prevCharCode]}chars.push({texture:charData.texture,line:line,charCode:charCode,position:new PIXI.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)});pos.x+=charData.xAdvance;prevCharCode=charCode}lineWidths.push(pos.x);maxLineWidth=Math.max(maxLineWidth,pos.x);var lineAlignOffsets=[];for(i=0;i<=line;i++){var alignOffset=0;if(this.style.align=="right"){alignOffset=maxLineWidth-lineWidths[i]}else if(this.style.align=="center"){alignOffset=(maxLineWidth-lineWidths[i])/2}lineAlignOffsets.push(alignOffset)}for(i=0;i<chars.length;i++){var c=new PIXI.Sprite(chars[i].texture);c.position.x=(chars[i].position.x+lineAlignOffsets[chars[i].line])*scale;c.position.y=chars[i].position.y*scale;c.scale.x=c.scale.y=scale;this.addChild(c)}this.width=pos.x*scale;this.height=(pos.y+data.lineHeight)*scale};PIXI.BitmapText.prototype.updateTransform=function(){if(this.dirty){while(this.children.length>0){this.removeChild(this.getChildAt(0))}this.updateText();this.dirty=false}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};PIXI.BitmapText.fonts={};PIXI.Text=function(text,style){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");PIXI.Sprite.call(this,PIXI.Texture.fromCanvas(this.canvas));this.setText(text);this.setStyle(style);this.updateText();this.dirty=false};PIXI.Text.prototype=Object.create(PIXI.Sprite.prototype);PIXI.Text.prototype.constructor=PIXI.Text;PIXI.Text.prototype.setStyle=function(style){style=style||{};style.font=style.font||"bold 20pt Arial";style.fill=style.fill||"black";
style.align=style.align||"left";style.stroke=style.stroke||"black";style.strokeThickness=style.strokeThickness||0;style.wordWrap=style.wordWrap||false;style.wordWrapWidth=style.wordWrapWidth||100;this.style=style;this.dirty=true};PIXI.Text.prototype.setText=function(text){this.text=text.toString()||" ";this.dirty=true};PIXI.Text.prototype.updateText=function(){this.context.font=this.style.font;var outputText=this.text;if(this.style.wordWrap)outputText=this.wordWrap(this.text);var lines=outputText.split(/(?:\r\n|\r|\n)/);var lineWidths=[];var maxLineWidth=0;for(var i=0;i<lines.length;i++){var lineWidth=this.context.measureText(lines[i]).width;lineWidths[i]=lineWidth;maxLineWidth=Math.max(maxLineWidth,lineWidth)}this.canvas.width=maxLineWidth+this.style.strokeThickness;var lineHeight=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;this.canvas.height=lineHeight*lines.length;this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="top";for(i=0;i<lines.length;i++){var linePosition=new PIXI.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+i*lineHeight);if(this.style.align=="right"){linePosition.x+=maxLineWidth-lineWidths[i]}else if(this.style.align=="center"){linePosition.x+=(maxLineWidth-lineWidths[i])/2}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(lines[i],linePosition.x,linePosition.y)}if(this.style.fill){this.context.fillText(lines[i],linePosition.x,linePosition.y)}}this.updateTexture()};PIXI.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.frame.width=this.canvas.width;this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;PIXI.texturesToUpdate.push(this.texture.baseTexture)};PIXI.Text.prototype.updateTransform=function(){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype.updateTransform.call(this)};PIXI.Text.prototype.determineFontHeight=function(fontStyle){var result=PIXI.Text.heightCache[fontStyle];if(!result){var body=document.getElementsByTagName("body")[0];var dummy=document.createElement("div");var dummyText=document.createTextNode("M");dummy.appendChild(dummyText);dummy.setAttribute("style",fontStyle+";position:absolute;top:0;left:0");body.appendChild(dummy);result=dummy.offsetHeight;PIXI.Text.heightCache[fontStyle]=result;body.removeChild(dummy)}return result};PIXI.Text.prototype.wordWrap=function(text){var result="";var lines=text.split("\n");for(var i=0;i<lines.length;i++){var spaceLeft=this.style.wordWrapWidth;var words=lines[i].split(" ");for(var j=0;j<words.length;j++){var wordWidth=this.context.measureText(words[j]).width;var wordWidthWithSpace=wordWidth+this.context.measureText(" ").width;if(wordWidthWithSpace>spaceLeft){if(j>0){result+="\n"}result+=words[j]+" ";spaceLeft=this.style.wordWrapWidth-wordWidth}else{spaceLeft-=wordWidthWithSpace;result+=words[j]+" "}}result+="\n"}return result};PIXI.Text.prototype.destroy=function(destroyTexture){if(destroyTexture){this.texture.destroy()}};PIXI.Text.heightCache={};PIXI.BaseTextureCache={};PIXI.texturesToUpdate=[];PIXI.texturesToDestroy=[];PIXI.BaseTexture=function(source){PIXI.EventTarget.call(this);this.width=100;this.height=100;this.hasLoaded=false;this.source=source;if(!source)return;if(this.source instanceof Image||this.source instanceof HTMLImageElement){if(this.source.complete){this.hasLoaded=true;this.width=this.source.width;this.height=this.source.height;PIXI.texturesToUpdate.push(this)}else{var scope=this;this.source.onload=function(){scope.hasLoaded=true;scope.width=scope.source.width;scope.height=scope.source.height;PIXI.texturesToUpdate.push(scope);scope.dispatchEvent({type:"loaded",content:scope})}}}else{this.hasLoaded=true;this.width=this.source.width;this.height=this.source.height;PIXI.texturesToUpdate.push(this)}this._powerOf2=false};PIXI.BaseTexture.prototype.constructor=PIXI.BaseTexture;PIXI.BaseTexture.prototype.destroy=function(){if(this.source instanceof Image){this.source.src=null}this.source=null;PIXI.texturesToDestroy.push(this)};PIXI.BaseTexture.fromImage=function(imageUrl,crossorigin){var baseTexture=PIXI.BaseTextureCache[imageUrl];if(!baseTexture){var image=new Image;if(crossorigin){image.crossOrigin=""}image.src=imageUrl;baseTexture=new PIXI.BaseTexture(image);PIXI.BaseTextureCache[imageUrl]=baseTexture}return baseTexture};PIXI.TextureCache={};PIXI.FrameCache={};PIXI.Texture=function(baseTexture,frame){PIXI.EventTarget.call(this);if(!frame){this.noFrame=true;frame=new PIXI.Rectangle(0,0,1,1)}if(baseTexture instanceof PIXI.Texture)baseTexture=baseTexture.baseTexture;this.baseTexture=baseTexture;this.frame=frame;this.trim=new PIXI.Point;this.scope=this;if(baseTexture.hasLoaded){if(this.noFrame)frame=new PIXI.Rectangle(0,0,baseTexture.width,baseTexture.height);this.setFrame(frame)}else{var scope=this;baseTexture.addEventListener("loaded",function(){scope.onBaseTextureLoaded()})}};PIXI.Texture.prototype.constructor=PIXI.Texture;PIXI.Texture.prototype.onBaseTextureLoaded=function(event){var baseTexture=this.baseTexture;baseTexture.removeEventListener("loaded",this.onLoaded);if(this.noFrame)this.frame=new PIXI.Rectangle(0,0,baseTexture.width,baseTexture.height);this.noFrame=false;this.width=this.frame.width;this.height=this.frame.height;this.scope.dispatchEvent({type:"update",content:this})};PIXI.Texture.prototype.destroy=function(destroyBase){if(destroyBase)this.baseTexture.destroy()};PIXI.Texture.prototype.setFrame=function(frame){this.frame=frame;this.width=frame.width;this.height=frame.height;if(frame.x+frame.width>this.baseTexture.width||frame.y+frame.height>this.baseTexture.height){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.updateFrame=true;PIXI.Texture.frameUpdates.push(this)};PIXI.Texture.fromImage=function(imageUrl,crossorigin){var texture=PIXI.TextureCache[imageUrl];if(!texture){texture=new PIXI.Texture(PIXI.BaseTexture.fromImage(imageUrl,crossorigin));PIXI.TextureCache[imageUrl]=texture}return texture};PIXI.Texture.fromFrame=function(frameId){var texture=PIXI.TextureCache[frameId];if(!texture)throw new Error("The frameId '"+frameId+"' does not exist in the texture cache "+this);return texture};PIXI.Texture.fromCanvas=function(canvas){var baseTexture=new PIXI.BaseTexture(canvas);return new PIXI.Texture(baseTexture)};PIXI.Texture.addTextureToCache=function(texture,id){PIXI.TextureCache[id]=texture};PIXI.Texture.removeTextureFromCache=function(id){var texture=PIXI.TextureCache[id];PIXI.TextureCache[id]=null;return texture};PIXI.Texture.frameUpdates=[];PIXI.RenderTexture=function(width,height){PIXI.EventTarget.call(this);this.width=width||100;this.height=height||100;this.indetityMatrix=PIXI.mat3.create();this.frame=new PIXI.Rectangle(0,0,this.width,this.height);if(PIXI.gl){this.initWebGL()}else{this.initCanvas()}};PIXI.RenderTexture.prototype=Object.create(PIXI.Texture.prototype);PIXI.RenderTexture.prototype.constructor=PIXI.RenderTexture;PIXI.RenderTexture.prototype.initWebGL=function(){var gl=PIXI.gl;this.glFramebuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,this.glFramebuffer);this.glFramebuffer.width=this.width;this.glFramebuffer.height=this.height;this.baseTexture=new PIXI.BaseTexture;this.baseTexture.width=this.width;this.baseTexture.height=this.height;this.baseTexture._glTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.baseTexture._glTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);this.baseTexture.isRender=true;gl.bindFramebuffer(gl.FRAMEBUFFER,this.glFramebuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.baseTexture._glTexture,0);this.projection=new PIXI.Point(this.width/2,-this.height/2);this.render=this.renderWebGL};PIXI.RenderTexture.prototype.resize=function(width,height){this.width=width;this.height=height;if(PIXI.gl){this.projection.x=this.width/2;this.projection.y=-this.height/2;var gl=PIXI.gl;gl.bindTexture(gl.TEXTURE_2D,this.baseTexture._glTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null)}else{this.frame.width=this.width;this.frame.height=this.height;this.renderer.resize(this.width,this.height)}};PIXI.RenderTexture.prototype.initCanvas=function(){this.renderer=new PIXI.CanvasRenderer(this.width,this.height,null,0);this.baseTexture=new PIXI.BaseTexture(this.renderer.view);this.frame=new PIXI.Rectangle(0,0,this.width,this.height);this.render=this.renderCanvas};PIXI.RenderTexture.prototype.renderWebGL=function(displayObject,position,clear){var gl=PIXI.gl;gl.colorMask(true,true,true,true);gl.viewport(0,0,this.width,this.height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.glFramebuffer);if(clear){gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT)}var children=displayObject.children;var originalWorldTransform=displayObject.worldTransform;displayObject.worldTransform=PIXI.mat3.create();displayObject.worldTransform[4]=-1;displayObject.worldTransform[5]=this.projection.y*-2;if(position){displayObject.worldTransform[2]=position.x;displayObject.worldTransform[5]-=position.y}PIXI.visibleCount++;displayObject.vcount=PIXI.visibleCount;for(var i=0,j=children.length;i<j;i++){children[i].updateTransform()}var renderGroup=displayObject.__renderGroup;if(renderGroup){if(displayObject==renderGroup.root){renderGroup.render(this.projection,this.glFramebuffer)}else{renderGroup.renderSpecific(displayObject,this.projection,this.glFramebuffer)}}else{if(!this.renderGroup)this.renderGroup=new PIXI.WebGLRenderGroup(gl);this.renderGroup.setRenderable(displayObject);this.renderGroup.render(this.projection,this.glFramebuffer)}displayObject.worldTransform=originalWorldTransform};PIXI.RenderTexture.prototype.renderCanvas=function(displayObject,position,clear){var children=displayObject.children;displayObject.worldTransform=PIXI.mat3.create();if(position){displayObject.worldTransform[2]=position.x;displayObject.worldTransform[5]=position.y}for(var i=0,j=children.length;i<j;i++){children[i].updateTransform()}if(clear)this.renderer.context.clearRect(0,0,this.width,this.height);this.renderer.renderDisplayObject(displayObject);this.renderer.context.setTransform(1,0,0,1,0,0)};PIXI.EventTarget=function(){var listeners={};this.addEventListener=this.on=function(type,listener){if(listeners[type]===undefined){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}};this.dispatchEvent=this.emit=function(event){if(!listeners[event.type]||!listeners[event.type].length){return}for(var i=0,l=listeners[event.type].length;i<l;i++){listeners[event.type][i](event)}};this.removeEventListener=this.off=function(type,listener){var index=listeners[type].indexOf(listener);if(index!==-1){listeners[type].splice(index,1)}}};PIXI.PolyK={};PIXI.PolyK.Triangulate=function(p){var sign=true;var n=p.length>>1;if(n<3)return[];var tgs=[];var avl=[];for(var i=0;i<n;i++)avl.push(i);var i=0;var al=n;while(al>3){var i0=avl[(i+0)%al];var i1=avl[(i+1)%al];var i2=avl[(i+2)%al];var ax=p[2*i0],ay=p[2*i0+1];var bx=p[2*i1],by=p[2*i1+1];var cx=p[2*i2],cy=p[2*i2+1];var earFound=false;if(PIXI.PolyK._convex(ax,ay,bx,by,cx,cy,sign)){earFound=true;for(var j=0;j<al;j++){var vi=avl[j];if(vi==i0||vi==i1||vi==i2)continue;if(PIXI.PolyK._PointInTriangle(p[2*vi],p[2*vi+1],ax,ay,bx,by,cx,cy)){earFound=false;break}}}if(earFound){tgs.push(i0,i1,i2);avl.splice((i+1)%al,1);al--;i=0}else if(i++>3*al){if(sign){var tgs=[];avl=[];for(var i=0;i<n;i++)avl.push(i);i=0;al=n;sign=false}else{console.log("PIXI Warning: shape too complex to fill");return[]}}}tgs.push(avl[0],avl[1],avl[2]);return tgs};PIXI.PolyK._PointInTriangle=function(px,py,ax,ay,bx,by,cx,cy){var v0x=cx-ax;var v0y=cy-ay;var v1x=bx-ax;var v1y=by-ay;var v2x=px-ax;var v2y=py-ay;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot02=v0x*v2x+v0y*v2y;var dot11=v1x*v1x+v1y*v1y;var dot12=v1x*v2x+v1y*v2y;var invDenom=1/(dot00*dot11-dot01*dot01);var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>=0&&u+v<1};PIXI.PolyK._convex=function(ax,ay,bx,by,cx,cy,sign){return(ay-by)*(cx-bx)+(bx-ax)*(cy-by)>=0==sign};Phaser.Camera=function(game,id,x,y,width,height){this.game=game;this.world=game.world;this.id=0;this.view=new Phaser.Rectangle(x,y,width,height);this.screenView=new Phaser.Rectangle(x,y,width,height);this.bounds=new Phaser.Rectangle(x,y,width,height);this.deadzone=null;this.visible=true;this.atLimit={x:false,y:false};this.target=null;this._edge=0;this.displayObject=null};Phaser.Camera.FOLLOW_LOCKON=0;Phaser.Camera.FOLLOW_PLATFORMER=1;Phaser.Camera.FOLLOW_TOPDOWN=2;Phaser.Camera.FOLLOW_TOPDOWN_TIGHT=3;Phaser.Camera.prototype={follow:function(target,style){if(typeof style==="undefined"){style=Phaser.Camera.FOLLOW_LOCKON}this.target=target;var helper;switch(style){case Phaser.Camera.FOLLOW_PLATFORMER:var w=this.width/8;var h=this.height/3;this.deadzone=new Phaser.Rectangle((this.width-w)/2,(this.height-h)/2-h*.25,w,h);break;case Phaser.Camera.FOLLOW_TOPDOWN:helper=Math.max(this.width,this.height)/4;this.deadzone=new Phaser.Rectangle((this.width-helper)/2,(this.height-helper)/2,helper,helper);break;case Phaser.Camera.FOLLOW_TOPDOWN_TIGHT:helper=Math.max(this.width,this.height)/8;this.deadzone=new Phaser.Rectangle((this.width-helper)/2,(this.height-helper)/2,helper,helper);break;case Phaser.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},focusOn:function(displayObject){this.setPosition(Math.round(displayObject.x-this.view.halfWidth),Math.round(displayObject.y-this.view.halfHeight))},focusOnXY:function(x,y){this.setPosition(Math.round(x-this.view.halfWidth),Math.round(y-this.view.halfHeight))},update:function(){if(this.target){this.updateTarget()}if(this.bounds){this.checkBounds()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){if(this.deadzone){this._edge=this.target.x-this.deadzone.x;if(this.view.x>this._edge){this.view.x=this._edge}this._edge=this.target.x+this.target.width-this.deadzone.x-this.deadzone.width;if(this.view.x<this._edge){this.view.x=this._edge}this._edge=this.target.y-this.deadzone.y;if(this.view.y>this._edge){this.view.y=this._edge}this._edge=this.target.y+this.target.height-this.deadzone.y-this.deadzone.height;if(this.view.y<this._edge){this.view.y=this._edge}}else{this.focusOnXY(this.target.x,this.target.y)}},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.x,this.game.world.y,this.game.world.width,this.game.world.height)},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;if(this.view.x<this.bounds.x){this.atLimit.x=true;this.view.x=this.bounds.x}if(this.view.x>this.bounds.right-this.width){this.atLimit.x=true;this.view.x=this.bounds.right-this.width+1}if(this.view.y<this.bounds.top){this.atLimit.y=true;this.view.y=this.bounds.top}if(this.view.y>this.bounds.bottom-this.height){this.atLimit.y=true;this.view.y=this.bounds.bottom-this.height+1}this.view.floor()},setPosition:function(x,y){this.view.x=x;this.view.y=y;if(this.bounds){this.checkBounds()}},setSize:function(width,height){this.view.width=width;this.view.height=height}};Object.defineProperty(Phaser.Camera.prototype,"x",{get:function(){return this.view.x},set:function(value){this.view.x=value;if(this.bounds){this.checkBounds()}}});Object.defineProperty(Phaser.Camera.prototype,"y",{get:function(){return this.view.y},set:function(value){this.view.y=value;if(this.bounds){this.checkBounds()}}});Object.defineProperty(Phaser.Camera.prototype,"width",{get:function(){return this.view.width},set:function(value){this.view.width=value}});Object.defineProperty(Phaser.Camera.prototype,"height",{get:function(){return this.view.height},set:function(value){this.view.height=value}});Phaser.State=function(){this.game=null;this.add=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null};Phaser.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},paused:function(){},destroy:function(){}};Phaser.StateManager=function(game,pendingState){this.game=game;this.states={};this._pendingState=null;if(pendingState!==null){this._pendingState=pendingState}this._created=false;this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onShutDownCallback=null};Phaser.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null){if(typeof this._pendingState==="string"){this.start(this._pendingState,false,false)}else{this.add("default",this._pendingState,true)}}},add:function(key,state,autoStart){if(typeof autoStart==="undefined"){autoStart=false}var newState;if(state instanceof Phaser.State){newState=state}else if(typeof state==="object"){newState=state;newState.game=this.game}else if(typeof state==="function"){newState=new state(this.game)}this.states[key]=newState;if(autoStart){if(this.game.isBooted){this.start(key)}else{this._pendingState=key}}return newState},remove:function(key){if(this.current==key){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onDestroyCallback=null}delete this.states[key]},start:function(key,clearWorld,clearCache){if(typeof clearWorld==="undefined"){clearWorld=true}if(typeof clearCache==="undefined"){clearCache=false}if(this.game.isBooted===false){this._pendingState=key;return}if(this.checkState(key)===false){return}else{if(this.current){this.onShutDownCallback.call(this.callbackContext,this.game)}if(clearWorld){this.game.tweens.removeAll();this.game.world.destroy();if(clearCache===true){this.game.cache.destroy()}}this.setCurrentState(key)}if(this.onPreloadCallback){this.game.load.reset();this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0){this.game.loadComplete()}else{this.game.load.start()}}else{this.game.loadComplete()}},dummy:function(){},checkState:function(key){if(this.states[key]){var valid=false;if(this.states[key]["preload"]){valid=true}if(valid===false&&this.states[key]["loadRender"]){valid=true}if(valid===false&&this.states[key]["loadUpdate"]){valid=true}if(valid===false&&this.states[key]["create"]){valid=true}if(valid===false&&this.states[key]["update"]){valid=true}if(valid===false&&this.states[key]["preRender"]){valid=true}if(valid===false&&this.states[key]["render"]){valid=true}if(valid===false&&this.states[key]["paused"]){valid=true}if(valid===false){console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions.");return false}return true}else{console.warn("Phaser.StateManager - No state found with the key: "+key);return false}},link:function(key){this.states[key].game=this.game;this.states[key].add=this.game.add;this.states[key].camera=this.game.camera;this.states[key].cache=this.game.cache;this.states[key].input=this.game.input;this.states[key].load=this.game.load;this.states[key].math=this.game.math;this.states[key].sound=this.game.sound;this.states[key].stage=this.game.stage;this.states[key].time=this.game.time;this.states[key].tweens=this.game.tweens;this.states[key].world=this.game.world;this.states[key].particles=this.game.particles;this.states[key].physics=this.game.physics;this.states[key].rnd=this.game.rnd},setCurrentState:function(key){this.callbackContext=this.states[key];this.link(key);this.onInitCallback=this.states[key]["init"]||this.dummy;this.onPreloadCallback=this.states[key]["preload"]||null;this.onLoadRenderCallback=this.states[key]["loadRender"]||null;this.onLoadUpdateCallback=this.states[key]["loadUpdate"]||null;this.onCreateCallback=this.states[key]["create"]||null;this.onUpdateCallback=this.states[key]["update"]||null;this.onPreRenderCallback=this.states[key]["preRender"]||null;this.onRenderCallback=this.states[key]["render"]||null;this.onPausedCallback=this.states[key]["paused"]||null;this.onShutDownCallback=this.states[key]["shutdown"]||this.dummy;this.current=key;this._created=false;this.onInitCallback.call(this.callbackContext,this.game)},loadComplete:function(){if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game,true)}},resume:function(){if(this._created&&this.onre){this.onPausedCallback.call(this.callbackContext,this.game,false)}},update:function(){if(this._created&&this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(){if(this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game)}},render:function(){if(this._created&&this.onRenderCallback){if(this.game.renderType===Phaser.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0)}this.onRenderCallback.call(this.callbackContext,this.game);if(this.game.renderType===Phaser.CANVAS){this.game.context.restore()}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onDestroyCallback=null;this.game=null;this.states={};this._pendingState=null}};Phaser.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};Phaser.LinkedList.prototype={add:function(child){if(this.total===0&&this.first==null&&this.last==null){this.first=child;this.last=child;this.next=child;child.prev=this;this.total++;return child}this.last.next=child;child.prev=this.last;this.last=child;this.total++;return child},remove:function(child){if(child==this.first){this.first=this.first.next}else if(child==this.last){this.last=this.last.prev}if(child.prev){child.prev.next=child.next}if(child.next){child.next.prev=child.prev}child.next=child.prev=null;if(this.first==null){this.last=null}this.total--},callAll:function(callback){if(!this.first||!this.last){return}var entity=this.first;do{if(entity&&entity[callback]){entity[callback].call(entity)}entity=entity.next}while(entity!=this.last.next)}};Phaser.Signal=function(){this._bindings=[];this._prevParams=null;var self=this;this.dispatch=function(){Phaser.Signal.prototype.dispatch.apply(self,arguments)}};Phaser.Signal.prototype={memorize:false,_shouldPropagate:true,active:true,validateListener:function(listener,fnName){if(typeof listener!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}},_registerListener:function(listener,isOnce,listenerContext,priority){var prevIndex=this._indexOfListener(listener,listenerContext),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce){throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(!isOnce?"":"Once")+"() the same listener without removing the relationship first.")}}else{binding=new Phaser.SignalBinding(this,listener,isOnce,listenerContext,priority);this._addBinding(binding)}if(this.memorize&&this._prevParams){binding.execute(this._prevParams)}return binding},_addBinding:function(binding){var n=this._bindings.length;do{--n}while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){var n=this._bindings.length,cur;while(n--){cur=this._bindings[n];if(cur._listener===listener&&cur.context===context){return n}}return-1},has:function(listener,context){return this._indexOfListener(listener,context)!==-1},add:function(listener,listenerContext,priority){this.validateListener(listener,"add");return this._registerListener(listener,false,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){this.validateListener(listener,"addOnce");return this._registerListener(listener,true,listenerContext,priority)},remove:function(listener,context){this.validateListener(listener,"remove");var i=this._indexOfListener(listener,context);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return listener},removeAll:function(){var n=this._bindings.length;while(n--){this._bindings[n]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active){return}var paramsArr=Array.prototype.slice.call(arguments);var n=this._bindings.length;var bindings;if(this.memorize){this._prevParams=paramsArr}if(!n){return}bindings=this._bindings.slice();this._shouldPropagate=true;do{n--}while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Phaser.SignalBinding=function(signal,listener,isOnce,listenerContext,priority){this._listener=listener;this._isOnce=isOnce;this.context=listenerContext;this._signal=signal;this._priority=priority||0};Phaser.SignalBinding.prototype={active:true,params:null,execute:function(paramsArr){var handlerReturn,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(paramsArr):paramsArr;handlerReturn=this._listener.apply(this.context,params);if(this._isOnce){this.detach()}}return handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};Phaser.Filter=function(game,uniforms,fragmentSrc){this.game=game;this.type=Phaser.WEBGL_FILTER;this.passes=[this];this.dirty=true;this.padding=0;this.uniforms={time:{type:"1f",value:0},resolution:{type:"2f",value:{x:256,y:256}},mouse:{type:"2f",value:{x:0,y:0}}};this.fragmentSrc=fragmentSrc||[]};Phaser.Filter.prototype={init:function(){},setResolution:function(width,height){this.uniforms.resolution.value.x=width;this.uniforms.resolution.value.y=height},update:function(pointer){if(typeof pointer!=="undefined"){if(pointer.x>0){this.uniforms.mouse.x=pointer.x.toFixed(2)}if(pointer.y>0){this.uniforms.mouse.y=pointer.y.toFixed(2)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};Object.defineProperty(Phaser.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(value){this.uniforms.resolution.value.x=value}});Object.defineProperty(Phaser.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(value){this.uniforms.resolution.value.y=value}});Phaser.Plugin=function(game,parent){if(typeof parent==="undefined"){parent=null}this.game=game;this.parent=parent;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};Phaser.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};Phaser.PluginManager=function(game,parent){this.game=game;this._parent=parent;this.plugins=[];this._pluginsLength=0};Phaser.PluginManager.prototype={add:function(plugin){var result=false;if(typeof plugin==="function"){plugin=new plugin(this.game,this._parent)}else{plugin.game=this.game;plugin.parent=this._parent}if(typeof plugin["preUpdate"]==="function"){plugin.hasPreUpdate=true;result=true}if(typeof plugin["update"]==="function"){plugin.hasUpdate=true;result=true}if(typeof plugin["postUpdate"]==="function"){plugin.hasPostUpdate=true;result=true}if(typeof plugin["render"]==="function"){plugin.hasRender=true;result=true}if(typeof plugin["postRender"]==="function"){plugin.hasPostRender=true;result=true}if(result){if(plugin.hasPreUpdate||plugin.hasUpdate||plugin.hasPostUpdate){plugin.active=true}if(plugin.hasRender||plugin.hasPostRender){plugin.visible=true}this._pluginsLength=this.plugins.push(plugin);if(typeof plugin["init"]==="function"){plugin.init()}return plugin}else{return null}},remove:function(plugin){if(this._pluginsLength===0){return}for(this._p=0;this._p<this._pluginsLength;this._p++){if(this.plugins[this._p]===plugin){plugin.destroy();this.plugins.splice(this._p,1);this._pluginsLength--;return}}},removeAll:function(){for(this._p=0;this._p<this._pluginsLength;this._p++){this.plugins[this._p].destroy()}this.plugins.length=0;this._pluginsLength=0},preUpdate:function(){if(this._pluginsLength===0){return}for(this._p=0;this._p<this._pluginsLength;this._p++){if(this.plugins[this._p].active&&this.plugins[this._p].hasPreUpdate){this.plugins[this._p].preUpdate()}}},update:function(){if(this._pluginsLength===0){return}for(this._p=0;this._p<this._pluginsLength;this._p++){if(this.plugins[this._p].active&&this.plugins[this._p].hasUpdate){this.plugins[this._p].update()}}},postUpdate:function(){if(this._pluginsLength===0){return}for(this._p=0;this._p<this._pluginsLength;this._p++){if(this.plugins[this._p].active&&this.plugins[this._p].hasPostUpdate){this.plugins[this._p].postUpdate()}}},render:function(){if(this._pluginsLength===0){return}for(this._p=0;this._p<this._pluginsLength;this._p++){if(this.plugins[this._p].visible&&this.plugins[this._p].hasRender){this.plugins[this._p].render()}}},postRender:function(){if(this._pluginsLength===0){return}for(this._p=0;this._p<this._pluginsLength;this._p++){if(this.plugins[this._p].visible&&this.plugins[this._p].hasPostRender){this.plugins[this._p].postRender()}}},destroy:function(){this.plugins.length=0;this._pluginsLength=0;this.game=null;this._parent=null}};Phaser.Stage=function(game,width,height){this.game=game;this._backgroundColor="rgb(0,0,0)";this.offset=new Phaser.Point;this.canvas=Phaser.Canvas.create(width,height);this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%";this._stage=new PIXI.Stage(0,false);this._stage.name="_stage_root";this._stage.interactive=false;this.scaleMode=Phaser.StageScaleMode.NO_SCALE;this.scale=new Phaser.StageScaleMode(this.game,width,height);this.aspectRatio=width/height;this._nextOffsetCheck=0;this.checkOffsetInterval=2500};Phaser.Stage.prototype={boot:function(){Phaser.Canvas.getOffset(this.canvas,this.offset);this.bounds=new Phaser.Rectangle(this.offset.x,this.offset.y,this.game.width,this.game.height);
var _this=this;this._onChange=function(event){return _this.visibilityChange(event)};Phaser.Canvas.setUserSelect(this.canvas,"none");Phaser.Canvas.setTouchAction(this.canvas,"none");this.backgroundColor="#000";document.addEventListener("visibilitychange",this._onChange,false);document.addEventListener("webkitvisibilitychange",this._onChange,false);document.addEventListener("pagehide",this._onChange,false);document.addEventListener("pageshow",this._onChange,false);window.onblur=this._onChange;window.onfocus=this._onChange},update:function(){if(this.checkOffsetInterval!==false){if(this.game.time.now>this._nextOffsetCheck){Phaser.Canvas.getOffset(this.canvas,this.offset);this._nextOffsetCheck=this.game.time.now+this.checkOffsetInterval}}},visibilityChange:function(event){if(this.disableVisibilityChange){return}if(event.type=="pagehide"||event.type=="blur"||document["hidden"]===true||document["webkitHidden"]===true){this.game.paused=true}else{this.game.paused=false}}};Object.defineProperty(Phaser.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(color){this._backgroundColor=color;if(this.game.transparent===false){if(this.game.renderType==Phaser.CANVAS){this.game.canvas.style.backgroundColor=color}else{if(typeof color==="string"){color=Phaser.Color.hexToRGB(color)}this._stage.setBackgroundColor(color)}}}});Phaser.Group=function(game,parent,name,useStage){if(typeof parent==="undefined"||typeof parent===null){parent=game.world}if(typeof useStage==="undefined"){useStage=false}this.game=game;this.name=name||"group";if(useStage){this._container=this.game.stage._stage}else{this._container=new PIXI.DisplayObjectContainer;this._container.name=this.name;if(parent){if(parent instanceof Phaser.Group){parent._container.addChild(this._container);parent._container.updateTransform()}else{parent.addChild(this._container);parent.updateTransform()}}else{this.game.stage._stage.addChild(this._container);this.game.stage._stage.updateTransform()}}this.type=Phaser.GROUP;this.exists=true;this.scale=new Phaser.Point(1,1);this.cursor=null};Phaser.Group.RETURN_NONE=0;Phaser.Group.RETURN_TOTAL=1;Phaser.Group.RETURN_CHILD=2;Phaser.Group.SORT_ASCENDING=-1;Phaser.Group.SORT_DESCENDING=1;Phaser.Group.prototype={add:function(child){if(child.group!==this){child.group=this;if(child.events){child.events.onAddedToGroup.dispatch(child,this)}this._container.addChild(child);child.updateTransform();if(this.cursor===null){this.cursor=child}}return child},addAt:function(child,index){if(child.group!==this){child.group=this;if(child.events){child.events.onAddedToGroup.dispatch(child,this)}this._container.addChildAt(child,index);child.updateTransform();if(this.cursor===null){this.cursor=child}}return child},getAt:function(index){return this._container.getChildAt(index)},create:function(x,y,key,frame,exists){if(typeof exists=="undefined"){exists=true}var child=new Phaser.Sprite(this.game,x,y,key,frame);child.group=this;child.exists=exists;child.visible=exists;child.alive=exists;if(child.events){child.events.onAddedToGroup.dispatch(child,this)}this._container.addChild(child);child.updateTransform();if(this.cursor===null){this.cursor=child}return child},createMultiple:function(quantity,key,frame,exists){if(typeof exists=="undefined"){exists=false}for(var i=0;i<quantity;i++){var child=new Phaser.Sprite(this.game,0,0,key,frame);child.group=this;child.exists=exists;child.visible=exists;child.alive=exists;if(child.events){child.events.onAddedToGroup.dispatch(child,this)}this._container.addChild(child);child.updateTransform();if(this.cursor===null){this.cursor=child}}},next:function(){if(this.cursor){if(this.cursor==this._container.last){this.cursor=this._container._iNext}else{this.cursor=this.cursor._iNext}}},previous:function(){if(this.cursor){if(this.cursor==this._container._iNext){this.cursor=this._container.last}else{this.cursor=this.cursor._iPrev}}},childTest:function(prefix,child){var s=prefix+" next: ";if(child._iNext){s=s+child._iNext.name}else{s=s+"-null-"}s=s+" "+prefix+" prev: ";if(child._iPrev){s=s+child._iPrev.name}else{s=s+"-null-"}console.log(s)},swapIndex:function(index1,index2){var child1=this.getAt(index1);var child2=this.getAt(index2);console.log("swapIndex ",index1," with ",index2);this.swap(child1,child2)},swap:function(child1,child2){if(child1===child2||!child1.parent||!child2.parent||child1.group!==this||child2.group!==this){return false}var child1Prev=child1._iPrev;var child1Next=child1._iNext;var child2Prev=child2._iPrev;var child2Next=child2._iNext;var endNode=this._container.last._iNext;var currentNode=this.game.stage._stage;do{if(currentNode!==child1&&currentNode!==child2){if(currentNode.first===child1){currentNode.first=child2}else if(currentNode.first===child2){currentNode.first=child1}if(currentNode.last===child1){currentNode.last=child2}else if(currentNode.last===child2){currentNode.last=child1}}currentNode=currentNode._iNext}while(currentNode!=endNode);if(child1._iNext==child2){child1._iNext=child2Next;child1._iPrev=child2;child2._iNext=child1;child2._iPrev=child1Prev;if(child1Prev){child1Prev._iNext=child2}if(child2Next){child2Next._iPrev=child1}if(child1.__renderGroup){child1.__renderGroup.updateTexture(child1)}if(child2.__renderGroup){child2.__renderGroup.updateTexture(child2)}return true}else if(child2._iNext==child1){child1._iNext=child2;child1._iPrev=child2Prev;child2._iNext=child1Next;child2._iPrev=child1;if(child2Prev){child2Prev._iNext=child1}if(child1Next){child1Next._iPrev=child2}if(child1.__renderGroup){child1.__renderGroup.updateTexture(child1)}if(child2.__renderGroup){child2.__renderGroup.updateTexture(child2)}return true}else{child1._iNext=child2Next;child1._iPrev=child2Prev;child2._iNext=child1Next;child2._iPrev=child1Prev;if(child1Prev){child1Prev._iNext=child2}if(child1Next){child1Next._iPrev=child2}if(child2Prev){child2Prev._iNext=child1}if(child2Next){child2Next._iPrev=child1}if(child1.__renderGroup){child1.__renderGroup.updateTexture(child1)}if(child2.__renderGroup){child2.__renderGroup.updateTexture(child2)}return true}return false},bringToTop:function(child){if(child.group===this){this.remove(child);this.add(child)}return child},getIndex:function(child){return this._container.children.indexOf(child)},replace:function(oldChild,newChild){if(!this._container.first._iNext){return}var index=this.getIndex(oldChild);if(index!=-1){if(newChild.parent!==undefined){newChild.events.onRemovedFromGroup.dispatch(newChild,this);newChild.parent.removeChild(newChild)}this._container.removeChild(oldChild);this._container.addChildAt(newChild,index);newChild.events.onAddedToGroup.dispatch(newChild,this);newChild.updateTransform();if(this.cursor==oldChild){this.cursor=this._container._iNext}}},setProperty:function(child,key,value,operation){operation=operation||0;var len=key.length;if(len==1){if(operation===0){child[key[0]]=value}else if(operation==1){child[key[0]]+=value}else if(operation==2){child[key[0]]-=value}else if(operation==3){child[key[0]]*=value}else if(operation==4){child[key[0]]/=value}}else if(len==2){if(operation===0){child[key[0]][key[1]]=value}else if(operation==1){child[key[0]][key[1]]+=value}else if(operation==2){child[key[0]][key[1]]-=value}else if(operation==3){child[key[0]][key[1]]*=value}else if(operation==4){child[key[0]][key[1]]/=value}}else if(len==3){if(operation===0){child[key[0]][key[1]][key[2]]=value}else if(operation==1){child[key[0]][key[1]][key[2]]+=value}else if(operation==2){child[key[0]][key[1]][key[2]]-=value}else if(operation==3){child[key[0]][key[1]][key[2]]*=value}else if(operation==4){child[key[0]][key[1]][key[2]]/=value}}else if(len==4){if(operation===0){child[key[0]][key[1]][key[2]][key[3]]=value}else if(operation==1){child[key[0]][key[1]][key[2]][key[3]]+=value}else if(operation==2){child[key[0]][key[1]][key[2]][key[3]]-=value}else if(operation==3){child[key[0]][key[1]][key[2]][key[3]]*=value}else if(operation==4){child[key[0]][key[1]][key[2]][key[3]]/=value}}},setAll:function(key,value,checkAlive,checkVisible,operation){key=key.split(".");if(typeof checkAlive==="undefined"){checkAlive=false}if(typeof checkVisible==="undefined"){checkVisible=false}operation=operation||0;if(this._container.children.length>0&&this._container.first._iNext){var currentNode=this._container.first._iNext;do{if((checkAlive===false||checkAlive&&currentNode.alive)&&(checkVisible===false||checkVisible&&currentNode.visible)){this.setProperty(currentNode,key,value,operation)}currentNode=currentNode._iNext}while(currentNode!=this._container.last._iNext)}},addAll:function(property,amount,checkAlive,checkVisible){this.setAll(property,amount,checkAlive,checkVisible,1)},subAll:function(property,amount,checkAlive,checkVisible){this.setAll(property,amount,checkAlive,checkVisible,2)},multiplyAll:function(property,amount,checkAlive,checkVisible){this.setAll(property,amount,checkAlive,checkVisible,3)},divideAll:function(property,amount,checkAlive,checkVisible){this.setAll(property,amount,checkAlive,checkVisible,4)},callAllExists:function(callback,existsValue){var args=Array.prototype.splice.call(arguments,2);if(this._container.children.length>0&&this._container.first._iNext){var currentNode=this._container.first._iNext;do{if(currentNode.exists==existsValue&&currentNode[callback]){currentNode[callback].apply(currentNode,args)}currentNode=currentNode._iNext}while(currentNode!=this._container.last._iNext)}},callbackFromArray:function(child,callback,length){if(length==1){if(child[callback[0]]){return child[callback[0]]}}else if(length==2){if(child[callback[0]][callback[1]]){return child[callback[0]][callback[1]]}}else if(length==3){if(child[callback[0]][callback[1]][callback[2]]){return child[callback[0]][callback[1]][callback[2]]}}else if(length==4){if(child[callback[0]][callback[1]][callback[2]][callback[3]]){return child[callback[0]][callback[1]][callback[2]][callback[3]]}}else{if(child[callback]){return child[callback]}}return false},callAll:function(method,context){if(typeof method==="undefined"){return}method=method.split(".");var methodLength=method.length;if(typeof context==="undefined"){context=null}else{if(typeof context==="string"){context=context.split(".");var contextLength=context.length}}var args=Array.prototype.splice.call(arguments,2);var callback=null;var callbackContext=null;if(this._container.children.length>0&&this._container.first._iNext){var child=this._container.first._iNext;do{callback=this.callbackFromArray(child,method,methodLength);if(context&&callback){callbackContext=this.callbackFromArray(child,context,contextLength);if(callback){callback.apply(callbackContext,args)}}else if(callback){callback.apply(child,args)}child=child._iNext}while(child!=this._container.last._iNext)}},forEach:function(callback,callbackContext,checkExists){if(typeof checkExists==="undefined"){checkExists=false}var args=Array.prototype.splice.call(arguments,3);args.unshift(null);if(this._container.children.length>0&&this._container.first._iNext){var currentNode=this._container.first._iNext;do{if(checkExists===false||checkExists&&currentNode.exists){args[0]=currentNode;callback.apply(callbackContext,args)}currentNode=currentNode._iNext}while(currentNode!=this._container.last._iNext)}},forEachExists:function(callback,callbackContext){var args=Array.prototype.splice.call(arguments,2);args.unshift(null);this.iterate("exists",true,Phaser.Group.RETURN_TOTAL,callback,callbackContext,args)},forEachAlive:function(callback,callbackContext){var args=Array.prototype.splice.call(arguments,2);args.unshift(null);this.iterate("alive",true,Phaser.Group.RETURN_TOTAL,callback,callbackContext,args)},forEachDead:function(callback,callbackContext){var args=Array.prototype.splice.call(arguments,2);args.unshift(null);this.iterate("alive",false,Phaser.Group.RETURN_TOTAL,callback,callbackContext,args)},sort:function(index,order){if(typeof index==="undefined"){index="y"}if(typeof order==="undefined"){order=Phaser.Group.SORT_ASCENDING}var swapped;var temp;do{swapped=false;for(var i=0,len=this._container.children.length-1;i<len;i++){if(order==Phaser.Group.SORT_ASCENDING){if(this._container.children[i][index]>this._container.children[i+1][index]){this.swap(this.getAt(i),this.getAt(i+1));temp=this._container.children[i];this._container.children[i]=this._container.children[i+1];this._container.children[i+1]=temp;swapped=true}}else{if(this._container.children[i][index]<this._container.children[i+1][index]){this.swap(this.getAt(i),this.getAt(i+1));temp=this._container.children[i];this._container.children[i]=this._container.children[i+1];this._container.children[i+1]=temp;swapped=true}}}}while(swapped)},iterate:function(key,value,returnType,callback,callbackContext,args){if(returnType==Phaser.Group.RETURN_TOTAL&&this._container.children.length===0){return-1}if(typeof callback==="undefined"){callback=false}var total=0;if(this._container.children.length>0&&this._container.first._iNext){var currentNode=this._container.first._iNext;do{if(currentNode[key]===value){total++;if(callback){args[0]=currentNode;callback.apply(callbackContext,args)}if(returnType==Phaser.Group.RETURN_CHILD){return currentNode}}currentNode=currentNode._iNext}while(currentNode!=this._container.last._iNext)}if(returnType==Phaser.Group.RETURN_TOTAL){return total}else if(returnType==Phaser.Group.RETURN_CHILD){return null}},getFirstExists:function(state){if(typeof state!=="boolean"){state=true}return this.iterate("exists",state,Phaser.Group.RETURN_CHILD)},getFirstAlive:function(){return this.iterate("alive",true,Phaser.Group.RETURN_CHILD)},getFirstDead:function(){return this.iterate("alive",false,Phaser.Group.RETURN_CHILD)},countLiving:function(){return this.iterate("alive",true,Phaser.Group.RETURN_TOTAL)},countDead:function(){return this.iterate("alive",false,Phaser.Group.RETURN_TOTAL)},getRandom:function(startIndex,length){if(this._container.children.length===0){return null}startIndex=startIndex||0;length=length||this._container.children.length;return this.game.math.getRandom(this._container.children,startIndex,length)},remove:function(child){if(child.group!==this){return false}if(child.events){child.events.onRemovedFromGroup.dispatch(child,this)}if(child.parent===this._container){this._container.removeChild(child)}if(this.cursor==child){if(this._container._iNext){this.cursor=this._container._iNext}else{this.cursor=null}}child.group=null;return true},removeAll:function(){if(this._container.children.length===0){return}do{if(this._container.children[0].events){this._container.children[0].events.onRemovedFromGroup.dispatch(this._container.children[0],this)}this._container.removeChild(this._container.children[0])}while(this._container.children.length>0);this.cursor=null},removeBetween:function(startIndex,endIndex){if(this._container.children.length===0){return}if(startIndex>endIndex||startIndex<0||endIndex>this._container.children.length){return false}for(var i=startIndex;i<endIndex;i++){var child=this._container.children[i];child.events.onRemovedFromGroup.dispatch(child,this);this._container.removeChild(child);if(this.cursor==child){if(this._container._iNext){this.cursor=this._container._iNext}else{this.cursor=null}}}},destroy:function(){this.removeAll();this._container.parent.removeChild(this._container);this._container=null;this.game=null;this.exists=false;this.cursor=null},validate:function(){var testObject=this.game.stage._stage.last._iNext;var displayObject=this.game.stage._stage;var nextObject=null;var prevObject=null;var count=0;do{if(count>0){if(displayObject!==nextObject){console.log("check next fail");return false}if(displayObject._iPrev!==prevObject){console.log("check previous fail");return false}}nextObject=displayObject._iNext;prevObject=displayObject;displayObject=displayObject._iNext;count++}while(displayObject!=testObject);return true},dump:function(full){if(typeof full=="undefined"){full=false}var spacing=20;var output="\n"+Phaser.Utils.pad("Node",spacing)+"|"+Phaser.Utils.pad("Next",spacing)+"|"+Phaser.Utils.pad("Previous",spacing)+"|"+Phaser.Utils.pad("First",spacing)+"|"+Phaser.Utils.pad("Last",spacing);console.log(output);var output=Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing);console.log(output);if(full){var testObject=this.game.stage._stage.last._iNext;var displayObject=this.game.stage._stage}else{var testObject=this._container.last._iNext;var displayObject=this._container}do{var name=displayObject.name||"*";if(this.cursor==displayObject){var name="> "+name}var nameNext="-";var namePrev="-";var nameFirst="-";var nameLast="-";if(displayObject._iNext){nameNext=displayObject._iNext.name}if(displayObject._iPrev){namePrev=displayObject._iPrev.name}if(displayObject.first){nameFirst=displayObject.first.name}if(displayObject.last){nameLast=displayObject.last.name}if(typeof nameNext==="undefined"){nameNext="-"}if(typeof namePrev==="undefined"){namePrev="-"}if(typeof nameFirst==="undefined"){nameFirst="-"}if(typeof nameLast==="undefined"){nameLast="-"}var output=Phaser.Utils.pad(name,spacing)+"|"+Phaser.Utils.pad(nameNext,spacing)+"|"+Phaser.Utils.pad(namePrev,spacing)+"|"+Phaser.Utils.pad(nameFirst,spacing)+"|"+Phaser.Utils.pad(nameLast,spacing);console.log(output);displayObject=displayObject._iNext}while(displayObject!=testObject)}};Object.defineProperty(Phaser.Group.prototype,"total",{get:function(){return this.iterate("exists",true,Phaser.Group.RETURN_TOTAL)}});Object.defineProperty(Phaser.Group.prototype,"length",{get:function(){return this.iterate("exists",true,Phaser.Group.RETURN_TOTAL)}});Object.defineProperty(Phaser.Group.prototype,"x",{get:function(){return this._container.position.x},set:function(value){this._container.position.x=value}});Object.defineProperty(Phaser.Group.prototype,"y",{get:function(){return this._container.position.y},set:function(value){this._container.position.y=value}});Object.defineProperty(Phaser.Group.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this._container.rotation)},set:function(value){this._container.rotation=Phaser.Math.degToRad(value)}});Object.defineProperty(Phaser.Group.prototype,"rotation",{get:function(){return this._container.rotation},set:function(value){this._container.rotation=value}});Object.defineProperty(Phaser.Group.prototype,"visible",{get:function(){return this._container.visible},set:function(value){this._container.visible=value}});Object.defineProperty(Phaser.Group.prototype,"alpha",{get:function(){return this._container.alpha},set:function(value){this._container.alpha=value}});Phaser.World=function(game){Phaser.Group.call(this,game,null,"__world",false);this.scale=new Phaser.Point(1,1);this.bounds=new Phaser.Rectangle(0,0,game.width,game.height);this.camera=null;this.currentRenderOrderID=0};Phaser.World.prototype=Object.create(Phaser.Group.prototype);Phaser.World.prototype.constructor=Phaser.World;Phaser.World.prototype.boot=function(){this.camera=new Phaser.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this._container;this.game.camera=this.camera};Phaser.World.prototype.update=function(){this.currentRenderOrderID=0;if(this.game.stage._stage.first._iNext){var currentNode=this.game.stage._stage.first._iNext;var skipChildren;do{skipChildren=false;if(currentNode["preUpdate"]){skipChildren=currentNode.preUpdate()===false}if(currentNode["update"]){skipChildren=currentNode.update()===false||skipChildren}if(skipChildren){currentNode=currentNode.last._iNext}else{currentNode=currentNode._iNext}}while(currentNode!=this.game.stage._stage.last._iNext)}};Phaser.World.prototype.postUpdate=function(){if(this.game.stage._stage.first._iNext){var currentNode=this.game.stage._stage.first._iNext;do{if(currentNode["postUpdate"]){currentNode.postUpdate()}currentNode=currentNode._iNext}while(currentNode!=this.game.stage._stage.last._iNext)}this.camera.update()};Phaser.World.prototype.setBounds=function(x,y,width,height){this.bounds.setTo(x,y,width,height);if(this.camera.bounds){this.camera.bounds.setTo(x,y,width,height)}};Phaser.World.prototype.destroy=function(){this.camera.x=0;this.camera.y=0;this.game.input.reset(true);this.removeAll()};Object.defineProperty(Phaser.World.prototype,"width",{get:function(){return this.bounds.width},set:function(value){this.bounds.width=value}});Object.defineProperty(Phaser.World.prototype,"height",{get:function(){return this.bounds.height},set:function(value){this.bounds.height=value}});Object.defineProperty(Phaser.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(Phaser.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(Phaser.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x))}else{return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}});Object.defineProperty(Phaser.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y))}else{return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}});Object.defineProperty(Phaser.World.prototype,"visible",{get:function(){return this._container.visible},set:function(value){this._container.visible=value}});Phaser.Game=function(width,height,renderer,parent,state,transparent,antialias){width=width||800;height=height||600;renderer=renderer||Phaser.AUTO;parent=parent||"";state=state||null;if(typeof transparent=="undefined"){transparent=false}if(typeof antialias=="undefined"){antialias=true}this.id=Phaser.GAMES.push(this)-1;this.parent=parent;this.width=width;this.height=height;this.transparent=transparent;this.antialias=antialias;this.renderer=null;this.state=new Phaser.StateManager(this,state);this._paused=false;this.renderType=renderer;this._loadComplete=false;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.rnd=null;this.device=null;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;var _this=this;this._onBoot=function(){return _this.boot()};if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(this._onBoot,0)}else{document.addEventListener("DOMContentLoaded",this._onBoot,false);window.addEventListener("load",this._onBoot,false)}return this};Phaser.Game.prototype={boot:function(){if(this.isBooted){return}if(!document.body){window.setTimeout(this._onBoot,20)}else{document.removeEventListener("DOMContentLoaded",this._onBoot);window.removeEventListener("load",this._onBoot);this.onPause=new Phaser.Signal;this.onResume=new Phaser.Signal;this.isBooted=true;this.device=new Phaser.Device;this.math=Phaser.Math;this.rnd=new Phaser.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.stage=new Phaser.Stage(this,this.width,this.height);this.setUpRenderer();this.world=new Phaser.World(this);this.add=new Phaser.GameObjectFactory(this);this.cache=new Phaser.Cache(this);this.load=new Phaser.Loader(this);this.time=new Phaser.Time(this);this.tweens=new Phaser.TweenManager(this);this.input=new Phaser.Input(this);this.sound=new Phaser.SoundManager(this);this.physics=new Phaser.Physics.Arcade(this);this.particles=new Phaser.Particles(this);this.plugins=new Phaser.PluginManager(this,this);this.net=new Phaser.Net(this);this.debug=new Phaser.Utils.Debug(this);this.stage.boot();this.world.boot();this.input.boot();this.sound.boot();this.state.boot();this.load.onLoadComplete.add(this.loadComplete,this);this.showDebugHeader();this.isRunning=true;this._loadComplete=false;this.raf=new Phaser.RequestAnimationFrame(this);this.raf.start()}},showDebugHeader:function(){var v=Phaser.DEV_VERSION;var r="Canvas";var a="HTML Audio";if(this.renderType==Phaser.WEBGL){r="WebGL"}else if(this.renderType==Phaser.HEADLESS){r="Headless"}if(this.device.webAudio){a="WebAudio"}if(this.device.chrome){var args=["%c %c %c  Phaser v"+v+" - Renderer: "+r+" - Audio: "+a+"  %c %c ","background: #00bff3","background: #0072bc","color: #ffffff; background: #003471","background: #0072bc","background: #00bff3"];console.log.apply(console,args)}else{console.log("Phaser v"+v+" - Renderer: "+r+" - Audio: "+a)}},setUpRenderer:function(){if(this.renderType===Phaser.HEADLESS||this.renderType===Phaser.CANVAS||this.renderType===Phaser.AUTO&&this.device.webGL===false){if(this.device.canvas){if(this.renderType===Phaser.AUTO){this.renderType=Phaser.CANVAS}this.renderer=new PIXI.CanvasRenderer(this.width,this.height,this.stage.canvas,this.transparent);Phaser.Canvas.setSmoothingEnabled(this.renderer.context,this.antialias);this.canvas=this.renderer.view;this.context=this.renderer.context}else{throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=Phaser.WEBGL;this.renderer=new PIXI.WebGLRenderer(this.width,this.height,this.stage.canvas,this.transparent,this.antialias);this.canvas=this.renderer.view;this.context=null}Phaser.Canvas.addToDOM(this.renderer.view,this.parent,true);Phaser.Canvas.setTouchAction(this.renderer.view)},loadComplete:function(){this._loadComplete=true;this.state.loadComplete()},update:function(time){this.time.update(time);if(this._paused){this.renderer.render(this.stage._stage);this.plugins.render();this.state.render()}else{this.plugins.preUpdate();this.physics.preUpdate();this.stage.update();this.input.update();this.tweens.update();this.sound.update();this.world.update();this.particles.update();this.state.update();this.plugins.update();this.world.postUpdate();this.plugins.postUpdate();if(this.renderType!==Phaser.HEADLESS){this.renderer.render(this.stage._stage);this.plugins.render();this.state.render();this.plugins.postRender()}}},destroy:function(){this.raf.stop();this.input.destroy();this.state.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=false}};Object.defineProperty(Phaser.Game.prototype,"paused",{get:function(){return this._paused},set:function(value){if(value===true){if(this._paused===false){this._paused=true;this.onPause.dispatch(this)}}else{if(this._paused){this._paused=false;this.onResume.dispatch(this)}}}});Phaser.Input=function(game){this.game=game;this.hitCanvas=null;this.hitContext=null};Phaser.Input.MOUSE_OVERRIDES_TOUCH=0;Phaser.Input.TOUCH_OVERRIDES_MOUSE=1;Phaser.Input.MOUSE_TOUCH_COMBINE=2;Phaser.Input.prototype={pollRate:0,_pollCounter:0,_oldPosition:null,_x:0,_y:0,disabled:false,multiInputOverride:Phaser.Input.MOUSE_TOUCH_COMBINE,position:null,speed:null,circle:null,scale:null,maxPointers:10,currentPointers:0,tapRate:200,doubleTapRate:300,holdRate:2e3,justPressedRate:200,justReleasedRate:200,recordPointerHistory:false,recordRate:100,recordLimit:100,pointer1:null,pointer2:null,pointer3:null,pointer4:null,pointer5:null,pointer6:null,pointer7:null,pointer8:null,pointer9:null,pointer10:null,activePointer:null,mousePointer:null,mouse:null,keyboard:null,touch:null,mspointer:null,onDown:null,onUp:null,onTap:null,onHold:null,interactiveItems:new Phaser.LinkedList,boot:function(){this.mousePointer=new Phaser.Pointer(this.game,0);this.pointer1=new Phaser.Pointer(this.game,1);this.pointer2=new Phaser.Pointer(this.game,2);this.mouse=new Phaser.Mouse(this.game);this.keyboard=new Phaser.Keyboard(this.game);this.touch=new Phaser.Touch(this.game);this.mspointer=new Phaser.MSPointer(this.game);this.onDown=new Phaser.Signal;this.onUp=new Phaser.Signal;this.onTap=new Phaser.Signal;this.onHold=new Phaser.Signal;this.scale=new Phaser.Point(1,1);this.speed=new Phaser.Point;this.position=new Phaser.Point;this._oldPosition=new Phaser.Point;this.circle=new Phaser.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.keyboard.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true},destroy:function(){this.mouse.stop();this.keyboard.stop();this.touch.stop();this.mspointer.stop()},addPointer:function(){var next=0;for(var i=10;i>0;i--){if(this["pointer"+i]===null){next=i}}if(next===0){console.warn("You can only have 10 Pointer objects");return null}else{this["pointer"+next]=new Phaser.Pointer(this.game,next);return this["pointer"+next]}},update:function(){if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();this.pointer1.update();this.pointer2.update();if(this.pointer3){this.pointer3.update()}if(this.pointer4){this.pointer4.update()}if(this.pointer5){this.pointer5.update()}if(this.pointer6){this.pointer6.update()}if(this.pointer7){this.pointer7.update()}if(this.pointer8){this.pointer8.update()}if(this.pointer9){this.pointer9.update()}if(this.pointer10){this.pointer10.update()}this._pollCounter=0},reset:function(hard){if(this.game.isBooted===false){return}if(typeof hard=="undefined"){hard=false}this.keyboard.reset();this.mousePointer.reset();for(var i=1;i<=10;i++){if(this["pointer"+i]){this["pointer"+i].reset()}}this.currentPointers=0;this.game.stage.canvas.style.cursor="default";if(hard===true){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new Phaser.Signal;this.onUp=new Phaser.Signal;this.onTap=new Phaser.Signal;this.onHold=new Phaser.Signal;this.interactiveItems.callAll("reset")}this._pollCounter=0},resetSpeed:function(x,y){this._oldPosition.setTo(x,y);this.speed.setTo(0,0)},startPointer:function(event){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers){return null}if(this.pointer1.active===false){return this.pointer1.start(event)}else if(this.pointer2.active===false){return this.pointer2.start(event)}else{for(var i=3;i<=10;i++){if(this["pointer"+i]&&this["pointer"+i].active===false){return this["pointer"+i].start(event)}}}return null},updatePointer:function(event){if(this.pointer1.active&&this.pointer1.identifier==event.identifier){return this.pointer1.move(event)}else if(this.pointer2.active&&this.pointer2.identifier==event.identifier){return this.pointer2.move(event)}else{for(var i=3;i<=10;i++){if(this["pointer"+i]&&this["pointer"+i].active&&this["pointer"+i].identifier==event.identifier){return this["pointer"+i].move(event)}}}return null},stopPointer:function(event){if(this.pointer1.active&&this.pointer1.identifier==event.identifier){return this.pointer1.stop(event)}else if(this.pointer2.active&&this.pointer2.identifier==event.identifier){return this.pointer2.stop(event)}else{for(var i=3;i<=10;i++){if(this["pointer"+i]&&this["pointer"+i].active&&this["pointer"+i].identifier==event.identifier){return this["pointer"+i].stop(event)}}}return null},getPointer:function(state){state=state||false;if(this.pointer1.active==state){return this.pointer1}else if(this.pointer2.active==state){return this.pointer2}else{for(var i=3;i<=10;i++){if(this["pointer"+i]&&this["pointer"+i].active==state){return this["pointer"+i]}}}return null},getPointerFromIdentifier:function(identifier){if(this.pointer1.identifier==identifier){return this.pointer1}else if(this.pointer2.identifier==identifier){return this.pointer2}else{for(var i=3;i<=10;i++){if(this["pointer"+i]&&this["pointer"+i].identifier==identifier){return this["pointer"+i]}}}return null}};Object.defineProperty(Phaser.Input.prototype,"x",{get:function(){return this._x},set:function(value){this._x=Math.floor(value)}});Object.defineProperty(Phaser.Input.prototype,"y",{get:function(){return this._y},set:function(value){this._y=Math.floor(value)
}});Object.defineProperty(Phaser.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}});Object.defineProperty(Phaser.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}});Object.defineProperty(Phaser.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var i=1;i<=10;i++){if(this["pointer"+i]&&this["pointer"+i].active){this.currentPointers++}}return this.currentPointers}});Object.defineProperty(Phaser.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(Phaser.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});Phaser.Key=function(game,keycode){this.game=game;this.isDown=false;this.isUp=false;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.keyCode=keycode;this.onDown=new Phaser.Signal;this.onUp=new Phaser.Signal};Phaser.Key.prototype={processKeyDown:function(event){this.altKey=event.altKey;this.ctrlKey=event.ctrlKey;this.shiftKey=event.shiftKey;if(this.isDown){this.duration=event.timeStamp-this.timeDown;this.repeats++}else{this.isDown=true;this.isUp=false;this.timeDown=event.timeStamp;this.duration=0;this.repeats=0;this.onDown.dispatch(this)}},processKeyUp:function(event){this.isDown=false;this.isUp=true;this.timeUp=event.timeStamp;this.onUp.dispatch(this)},justPressed:function(duration){if(typeof duration==="undefined"){duration=250}return this.isDown&&this.duration<duration},justReleased:function(duration){if(typeof duration==="undefined"){duration=250}return this.isDown===false&&this.game.time.now-this.timeUp<duration}};Phaser.Keyboard=function(game){this.game=game;this._keys={};this._hotkeys={};this._capture={};this.disabled=false;this._onKeyDown=null;this._onKeyUp=null;this.callbackContext=this;this.onDownCallback=null;this.onUpCallback=null};Phaser.Keyboard.prototype={addCallbacks:function(context,onDown,onUp){this.callbackContext=context;this.onDownCallback=onDown;if(typeof onUp!=="undefined"){this.onUpCallback=onUp}},addKey:function(keycode){this._hotkeys[keycode]=new Phaser.Key(this.game,keycode);this.addKeyCapture(keycode);return this._hotkeys[keycode]},removeKey:function(keycode){delete this._hotkeys[keycode]},createCursorKeys:function(){return{up:this.addKey(Phaser.Keyboard.UP),down:this.addKey(Phaser.Keyboard.DOWN),left:this.addKey(Phaser.Keyboard.LEFT),right:this.addKey(Phaser.Keyboard.RIGHT)}},start:function(){var _this=this;this._onKeyDown=function(event){return _this.processKeyDown(event)};this._onKeyUp=function(event){return _this.processKeyUp(event)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp)},addKeyCapture:function(keycode){if(typeof keycode==="object"){for(var key in keycode){this._capture[keycode[key]]=true}}else{this._capture[keycode]=true}},removeKeyCapture:function(keycode){delete this._capture[keycode]},clearCaptures:function(){this._capture={}},processKeyDown:function(event){if(this.game.input.disabled||this.disabled){return}if(this._capture[event.keyCode]){event.preventDefault()}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,event)}if(this._keys[event.keyCode]&&this._keys[event.keyCode].isDown){this._keys[event.keyCode].duration=this.game.time.now-this._keys[event.keyCode].timeDown}else{if(!this._keys[event.keyCode]){this._keys[event.keyCode]={isDown:true,timeDown:this.game.time.now,timeUp:0,duration:0}}else{this._keys[event.keyCode].isDown=true;this._keys[event.keyCode].timeDown=this.game.time.now;this._keys[event.keyCode].duration=0}}if(this._hotkeys[event.keyCode]){this._hotkeys[event.keyCode].processKeyDown(event)}},processKeyUp:function(event){if(this.game.input.disabled||this.disabled){return}if(this._capture[event.keyCode]){event.preventDefault()}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,event)}if(this._hotkeys[event.keyCode]){this._hotkeys[event.keyCode].processKeyUp(event)}if(this._keys[event.keyCode]){this._keys[event.keyCode].isDown=false;this._keys[event.keyCode].timeUp=this.game.time.now}else{this._keys[event.keyCode]={isDown:false,timeDown:this.game.time.now,timeUp:this.game.time.now,duration:0}}},reset:function(){for(var key in this._keys){this._keys[key].isDown=false}},justPressed:function(keycode,duration){if(typeof duration==="undefined"){duration=250}if(this._keys[keycode]&&this._keys[keycode].isDown&&this._keys[keycode].duration<duration){return true}return false},justReleased:function(keycode,duration){if(typeof duration==="undefined"){duration=250}if(this._keys[keycode]&&this._keys[keycode].isDown===false&&this.game.time.now-this._keys[keycode].timeUp<duration){return true}return false},isDown:function(keycode){if(this._keys[keycode]){return this._keys[keycode].isDown}return false}};Phaser.Keyboard.A="A".charCodeAt(0);Phaser.Keyboard.B="B".charCodeAt(0);Phaser.Keyboard.C="C".charCodeAt(0);Phaser.Keyboard.D="D".charCodeAt(0);Phaser.Keyboard.E="E".charCodeAt(0);Phaser.Keyboard.F="F".charCodeAt(0);Phaser.Keyboard.G="G".charCodeAt(0);Phaser.Keyboard.H="H".charCodeAt(0);Phaser.Keyboard.I="I".charCodeAt(0);Phaser.Keyboard.J="J".charCodeAt(0);Phaser.Keyboard.K="K".charCodeAt(0);Phaser.Keyboard.L="L".charCodeAt(0);Phaser.Keyboard.M="M".charCodeAt(0);Phaser.Keyboard.N="N".charCodeAt(0);Phaser.Keyboard.O="O".charCodeAt(0);Phaser.Keyboard.P="P".charCodeAt(0);Phaser.Keyboard.Q="Q".charCodeAt(0);Phaser.Keyboard.R="R".charCodeAt(0);Phaser.Keyboard.S="S".charCodeAt(0);Phaser.Keyboard.T="T".charCodeAt(0);Phaser.Keyboard.U="U".charCodeAt(0);Phaser.Keyboard.V="V".charCodeAt(0);Phaser.Keyboard.W="W".charCodeAt(0);Phaser.Keyboard.X="X".charCodeAt(0);Phaser.Keyboard.Y="Y".charCodeAt(0);Phaser.Keyboard.Z="Z".charCodeAt(0);Phaser.Keyboard.ZERO="0".charCodeAt(0);Phaser.Keyboard.ONE="1".charCodeAt(0);Phaser.Keyboard.TWO="2".charCodeAt(0);Phaser.Keyboard.THREE="3".charCodeAt(0);Phaser.Keyboard.FOUR="4".charCodeAt(0);Phaser.Keyboard.FIVE="5".charCodeAt(0);Phaser.Keyboard.SIX="6".charCodeAt(0);Phaser.Keyboard.SEVEN="7".charCodeAt(0);Phaser.Keyboard.EIGHT="8".charCodeAt(0);Phaser.Keyboard.NINE="9".charCodeAt(0);Phaser.Keyboard.NUMPAD_0=96;Phaser.Keyboard.NUMPAD_1=97;Phaser.Keyboard.NUMPAD_2=98;Phaser.Keyboard.NUMPAD_3=99;Phaser.Keyboard.NUMPAD_4=100;Phaser.Keyboard.NUMPAD_5=101;Phaser.Keyboard.NUMPAD_6=102;Phaser.Keyboard.NUMPAD_7=103;Phaser.Keyboard.NUMPAD_8=104;Phaser.Keyboard.NUMPAD_9=105;Phaser.Keyboard.NUMPAD_MULTIPLY=106;Phaser.Keyboard.NUMPAD_ADD=107;Phaser.Keyboard.NUMPAD_ENTER=108;Phaser.Keyboard.NUMPAD_SUBTRACT=109;Phaser.Keyboard.NUMPAD_DECIMAL=110;Phaser.Keyboard.NUMPAD_DIVIDE=111;Phaser.Keyboard.F1=112;Phaser.Keyboard.F2=113;Phaser.Keyboard.F3=114;Phaser.Keyboard.F4=115;Phaser.Keyboard.F5=116;Phaser.Keyboard.F6=117;Phaser.Keyboard.F7=118;Phaser.Keyboard.F8=119;Phaser.Keyboard.F9=120;Phaser.Keyboard.F10=121;Phaser.Keyboard.F11=122;Phaser.Keyboard.F12=123;Phaser.Keyboard.F13=124;Phaser.Keyboard.F14=125;Phaser.Keyboard.F15=126;Phaser.Keyboard.COLON=186;Phaser.Keyboard.EQUALS=187;Phaser.Keyboard.UNDERSCORE=189;Phaser.Keyboard.QUESTION_MARK=191;Phaser.Keyboard.TILDE=192;Phaser.Keyboard.OPEN_BRACKET=219;Phaser.Keyboard.BACKWARD_SLASH=220;Phaser.Keyboard.CLOSED_BRACKET=221;Phaser.Keyboard.QUOTES=222;Phaser.Keyboard.BACKSPACE=8;Phaser.Keyboard.TAB=9;Phaser.Keyboard.CLEAR=12;Phaser.Keyboard.ENTER=13;Phaser.Keyboard.SHIFT=16;Phaser.Keyboard.CONTROL=17;Phaser.Keyboard.ALT=18;Phaser.Keyboard.CAPS_LOCK=20;Phaser.Keyboard.ESC=27;Phaser.Keyboard.SPACEBAR=32;Phaser.Keyboard.PAGE_UP=33;Phaser.Keyboard.PAGE_DOWN=34;Phaser.Keyboard.END=35;Phaser.Keyboard.HOME=36;Phaser.Keyboard.LEFT=37;Phaser.Keyboard.UP=38;Phaser.Keyboard.RIGHT=39;Phaser.Keyboard.DOWN=40;Phaser.Keyboard.INSERT=45;Phaser.Keyboard.DELETE=46;Phaser.Keyboard.HELP=47;Phaser.Keyboard.NUM_LOCK=144;Phaser.Mouse=function(game){this.game=game;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.capture=false;this.button=-1;this.disabled=false;this.locked=false;this.pointerLock=new Phaser.Signal;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null};Phaser.Mouse.NO_BUTTON=-1;Phaser.Mouse.LEFT_BUTTON=0;Phaser.Mouse.MIDDLE_BUTTON=1;Phaser.Mouse.RIGHT_BUTTON=2;Phaser.Mouse.prototype={start:function(){var _this=this;if(this.game.device.android&&this.game.device.chrome===false){return}this._onMouseDown=function(event){return _this.onMouseDown(event)};this._onMouseMove=function(event){return _this.onMouseMove(event)};this._onMouseUp=function(event){return _this.onMouseUp(event)};document.addEventListener("mousedown",this._onMouseDown,true);document.addEventListener("mousemove",this._onMouseMove,true);document.addEventListener("mouseup",this._onMouseUp,true)},onMouseDown:function(event){this.event=event;if(this.capture){event.preventDefault()}this.button=event.which;if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,event)}if(this.game.input.disabled||this.disabled){return}event["identifier"]=0;this.game.input.mousePointer.start(event)},onMouseMove:function(event){this.event=event;if(this.capture){event.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,event)}if(this.game.input.disabled||this.disabled){return}event["identifier"]=0;this.game.input.mousePointer.move(event)},onMouseUp:function(event){this.event=event;if(this.capture){event.preventDefault()}this.button=Phaser.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,event)}if(this.game.input.disabled||this.disabled){return}event["identifier"]=0;this.game.input.mousePointer.stop(event)},requestPointerLock:function(){if(this.game.device.pointerLock){var element=this.game.stage.canvas;element.requestPointerLock=element.requestPointerLock||element.mozRequestPointerLock||element.webkitRequestPointerLock;element.requestPointerLock();var _this=this;this._pointerLockChange=function(event){return _this.pointerLockChange(event)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(event){var element=this.game.stage.canvas;if(document.pointerLockElement===element||document.mozPointerLockElement===element||document.webkitPointerLockElement===element){this.locked=true;this.pointerLock.dispatch(true,event)}else{this.locked=false;this.pointerLock.dispatch(false,event)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){document.removeEventListener("mousedown",this._onMouseDown,true);document.removeEventListener("mousemove",this._onMouseMove,true);document.removeEventListener("mouseup",this._onMouseUp,true)}};Phaser.MSPointer=function(game){this.game=game;this.callbackContext=this.game;this.disabled=false;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};Phaser.MSPointer.prototype={start:function(){var _this=this;if(this.game.device.mspointer===true){this._onMSPointerDown=function(event){return _this.onPointerDown(event)};this._onMSPointerMove=function(event){return _this.onPointerMove(event)};this._onMSPointerUp=function(event){return _this.onPointerUp(event)};this.game.renderer.view.addEventListener("MSPointerDown",this._onMSPointerDown,false);this.game.renderer.view.addEventListener("MSPointerMove",this._onMSPointerMove,false);this.game.renderer.view.addEventListener("MSPointerUp",this._onMSPointerUp,false);this.game.renderer.view.addEventListener("pointerDown",this._onMSPointerDown,false);this.game.renderer.view.addEventListener("pointerMove",this._onMSPointerMove,false);this.game.renderer.view.addEventListener("pointerUp",this._onMSPointerUp,false);this.game.renderer.view.style["-ms-content-zooming"]="none";this.game.renderer.view.style["-ms-touch-action"]="none"}},onPointerDown:function(event){if(this.game.input.disabled||this.disabled){return}event.preventDefault();event.identifier=event.pointerId;this.game.input.startPointer(event)},onPointerMove:function(event){if(this.game.input.disabled||this.disabled){return}event.preventDefault();event.identifier=event.pointerId;this.game.input.updatePointer(event)},onPointerUp:function(event){if(this.game.input.disabled||this.disabled){return}event.preventDefault();event.identifier=event.pointerId;this.game.input.stopPointer(event)},stop:function(){this.game.stage.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.stage.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.stage.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.stage.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.stage.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.stage.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};Phaser.Pointer=function(game,id){this.game=game;this.id=id;this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.x=-1;this.y=-1;this.isMouse=false;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=false;this.position=new Phaser.Point;this.positionDown=new Phaser.Point;this.circle=new Phaser.Circle(0,0,44);if(id===0){this.isMouse=true}};Phaser.Pointer.prototype={start:function(event){this.identifier=event.identifier;this.target=event.target;if(typeof event.button!=="undefined"){this.button=event.button}if(this.game.paused===true&&this.game.stage.scale.incorrectOrientation===false){this.game.paused=false;return this}this._history.length=0;this.active=true;this.withinGame=true;this.isDown=true;this.isUp=false;this.msSinceLastClick=this.game.time.now-this.timeDown;this.timeDown=this.game.time.now;this._holdSent=false;this.move(event);this.positionDown.setTo(this.x,this.y);if(this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.x,this.y);this.game.input.onDown.dispatch(this,event);this.game.input.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(this.isMouse===false){this.game.input.currentPointers++}if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){if(this.active){if(this._holdSent===false&&this.duration>=this.game.input.holdRate){if(this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.onHold.dispatch(this)}this._holdSent=true}if(this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop){this._nextDrop=this.game.time.now+this.game.input.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>this.game.input.recordLimit){this._history.shift()}}}},move:function(event){if(this.game.input.pollLocked){return}if(typeof event.button!=="undefined"){this.button=event.button}this.clientX=event.clientX;this.clientY=event.clientY;this.pageX=event.pageX;this.pageY=event.pageY;this.screenX=event.screenX;this.screenY=event.screenY;this.x=(this.pageX-this.game.stage.offset.x)*this.game.input.scale.x;this.y=(this.pageY-this.game.stage.offset.y)*this.game.input.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.activePointer=this;this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.game.input.x,this.game.input.y);this.game.input.circle.x=this.game.input.x;this.game.input.circle.y=this.game.input.y}if(this.game.paused){return this}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}return this}this._highestRenderOrderID=-1;this._highestRenderObject=null;this._highestInputPriorityID=-1;if(this.game.input.interactiveItems.total>0){var currentNode=this.game.input.interactiveItems.next;do{if(currentNode.pixelPerfect||currentNode.priorityID>this._highestInputPriorityID||currentNode.priorityID==this._highestInputPriorityID&&currentNode.sprite.renderOrderID>this._highestRenderOrderID){if(currentNode.checkPointerOver(this)){this._highestRenderOrderID=currentNode.sprite.renderOrderID;this._highestInputPriorityID=currentNode.priorityID;this._highestRenderObject=currentNode}}currentNode=currentNode.next}while(currentNode!=null)}if(this._highestRenderObject==null){if(this.targetObject){this.targetObject._pointerOutHandler(this);this.targetObject=null}}else{if(this.targetObject==null){this.targetObject=this._highestRenderObject;this._highestRenderObject._pointerOverHandler(this)}else{if(this.targetObject==this._highestRenderObject){if(this._highestRenderObject.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this);this.targetObject=this._highestRenderObject;this.targetObject._pointerOverHandler(this)}}}return this},leave:function(event){this.withinGame=false;this.move(event)},stop:function(event){if(this._stateReset){event.preventDefault();return}this.timeUp=this.game.time.now;if(this.game.input.multiInputOverride==Phaser.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==Phaser.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==Phaser.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0){this.game.input.onUp.dispatch(this,event);if(this.duration>=0&&this.duration<=this.game.input.tapRate){if(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate){this.game.input.onTap.dispatch(this,true)}else{this.game.input.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.id>0){this.active=false}this.withinGame=false;this.isDown=false;this.isUp=true;if(this.isMouse===false){this.game.input.currentPointers--}if(this.game.input.interactiveItems.total>0){var currentNode=this.game.input.interactiveItems.next;do{if(currentNode){currentNode._releasedHandler(this)}currentNode=currentNode.next}while(currentNode!=null)}if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null;return this},justPressed:function(duration){duration=duration||this.game.input.justPressedRate;return this.isDown===true&&this.timeDown+duration>this.game.time.now},justReleased:function(duration){duration=duration||this.game.input.justReleasedRate;return this.isUp===true&&this.timeUp+duration>this.game.time.now},reset:function(){if(this.isMouse===false){this.active=false}this.identifier=null;this.isDown=false;this.isUp=true;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null}};Object.defineProperty(Phaser.Pointer.prototype,"duration",{get:function(){if(this.isUp){return-1}return this.game.time.now-this.timeDown}});Object.defineProperty(Phaser.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(Phaser.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});Phaser.Touch=function(game){this.game=game;this.disabled=false;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};Phaser.Touch.prototype={start:function(){var _this=this;if(this.game.device.touch){this._onTouchStart=function(event){return _this.onTouchStart(event)};this._onTouchMove=function(event){return _this.onTouchMove(event)};this._onTouchEnd=function(event){return _this.onTouchEnd(event)};this._onTouchEnter=function(event){return _this.onTouchEnter(event)};this._onTouchLeave=function(event){return _this.onTouchLeave(event)};this._onTouchCancel=function(event){return _this.onTouchCancel(event)};this.game.renderer.view.addEventListener("touchstart",this._onTouchStart,false);this.game.renderer.view.addEventListener("touchmove",this._onTouchMove,false);this.game.renderer.view.addEventListener("touchend",this._onTouchEnd,false);this.game.renderer.view.addEventListener("touchenter",this._onTouchEnter,false);this.game.renderer.view.addEventListener("touchleave",this._onTouchLeave,false);this.game.renderer.view.addEventListener("touchcancel",this._onTouchCancel,false)}},consumeDocumentTouches:function(){this._documentTouchMove=function(event){event.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},onTouchStart:function(event){this.event=event;if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,event)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){event.preventDefault()}for(var i=0;i<event.changedTouches.length;i++){this.game.input.startPointer(event.changedTouches[i])}},onTouchCancel:function(event){this.event=event;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,event)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){event.preventDefault()}for(var i=0;i<event.changedTouches.length;i++){this.game.input.stopPointer(event.changedTouches[i])}},onTouchEnter:function(event){this.event=event;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,event)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){event.preventDefault()}},onTouchLeave:function(event){this.event=event;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,event)}if(this.preventDefault){event.preventDefault()}},onTouchMove:function(event){this.event=event;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,event)}if(this.preventDefault){event.preventDefault()}for(var i=0;i<event.changedTouches.length;i++){this.game.input.updatePointer(event.changedTouches[i])}},onTouchEnd:function(event){this.event=event;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,event)}if(this.preventDefault){event.preventDefault()}for(var i=0;i<event.changedTouches.length;i++){this.game.input.stopPointer(event.changedTouches[i])}},stop:function(){if(this.game.device.touch){this.game.stage.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.stage.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.stage.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.stage.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.stage.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.stage.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};Phaser.InputHandler=function(sprite){this.sprite=sprite;this.game=sprite.game;this.enabled=false;this.priorityID=0;this.useHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.pixelPerfect=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=false;this._tempPoint=new Phaser.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};Phaser.InputHandler.prototype={start:function(priority,useHandCursor){console.log("InputHandler start");priority=priority||0;if(typeof useHandCursor=="undefined"){useHandCursor=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=useHandCursor;this.priorityID=priority;for(var i=0;i<10;i++){this._pointerData[i]={id:i,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new Phaser.Point;this.enabled=true;if(this.sprite.events&&this.sprite.events.onInputOver==null){this.sprite.events.onInputOver=new Phaser.Signal;this.sprite.events.onInputOut=new Phaser.Signal;this.sprite.events.onInputDown=new Phaser.Signal;this.sprite.events.onInputUp=new Phaser.Signal;this.sprite.events.onDragStart=new Phaser.Signal;this.sprite.events.onDragStop=new Phaser.Signal}}return this.sprite},reset:function(){this.enabled=false;for(var i=0;i<10;i++){this._pointerData[i]={id:i,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.enabled){this.enabled=false;this.game.input.interactiveItems.remove(this);this.stop();this.sprite=null}},pointerX:function(pointer){pointer=pointer||0;return this._pointerData[pointer].x},pointerY:function(pointer){pointer=pointer||0;return this._pointerData[pointer].y},pointerDown:function(pointer){pointer=pointer||0;return this._pointerData[pointer].isDown},pointerUp:function(pointer){pointer=pointer||0;return this._pointerData[pointer].isUp},pointerTimeDown:function(pointer){pointer=pointer||0;return this._pointerData[pointer].timeDown},pointerTimeUp:function(pointer){pointer=pointer||0;return this._pointerData[pointer].timeUp},pointerOver:function(index){if(this.enabled){if(typeof index==="undefined"){for(var i=0;i<10;i++){if(this._pointerData[i].isOver){return true}}}else{return this._pointerData[index].isOver}}return false},pointerOut:function(index){if(this.enabled){if(typeof index==="undefined"){for(var i=0;i<10;i++){if(this._pointerData[i].isOut){return true}}}else{return this._pointerData[index].isOut}}return false},pointerTimeOver:function(pointer){pointer=pointer||0;return this._pointerData[pointer].timeOver},pointerTimeOut:function(pointer){pointer=pointer||0;return this._pointerData[pointer].timeOut},pointerDragged:function(pointer){pointer=pointer||0;return this._pointerData[pointer].isDragged},checkPointerOver:function(pointer){if(this.enabled===false||this.sprite.visible===false||this.sprite.group&&this.sprite.group.visible===false){return false}this.sprite.getLocalUnmodifiedPosition(this._tempPoint,pointer.x,pointer.y);if(this._tempPoint.x>=0&&this._tempPoint.x<=this.sprite.currentFrame.width&&this._tempPoint.y>=0&&this._tempPoint.y<=this.sprite.currentFrame.height){if(this.pixelPerfect){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}},checkPixel:function(x,y){if(this.sprite.texture.baseTexture.source){this.game.input.hitContext.clearRect(0,0,1,1);x+=this.sprite.texture.frame.x;y+=this.sprite.texture.frame.y;this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,x,y,1,1,0,0,1,1);var rgb=this.game.input.hitContext.getImageData(0,0,1,1);if(rgb.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(pointer){if(this.enabled===false||this.sprite.visible===false||this.sprite.group&&this.sprite.group.visible===false){this._pointerOutHandler(pointer);return false}if(this.draggable&&this._draggedPointerID==pointer.id){return this.updateDrag(pointer)}else if(this._pointerData[pointer.id].isOver===true){if(this.checkPointerOver(pointer)){this._pointerData[pointer.id].x=pointer.x-this.sprite.x;this._pointerData[pointer.id].y=pointer.y-this.sprite.y;return true}else{this._pointerOutHandler(pointer);return false}}},_pointerOverHandler:function(pointer){if(this._pointerData[pointer.id].isOver===false){this._pointerData[pointer.id].isOver=true;this._pointerData[pointer.id].isOut=false;this._pointerData[pointer.id].timeOver=this.game.time.now;this._pointerData[pointer.id].x=pointer.x-this.sprite.x;this._pointerData[pointer.id].y=pointer.y-this.sprite.y;if(this.useHandCursor&&this._pointerData[pointer.id].isDragged===false){this.game.stage.canvas.style.cursor="pointer"}this.sprite.events.onInputOver.dispatch(this.sprite,pointer)}},_pointerOutHandler:function(pointer){this._pointerData[pointer.id].isOver=false;this._pointerData[pointer.id].isOut=true;this._pointerData[pointer.id].timeOut=this.game.time.now;if(this.useHandCursor&&this._pointerData[pointer.id].isDragged===false){this.game.stage.canvas.style.cursor="default"}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOut.dispatch(this.sprite,pointer)}},_touchedHandler:function(pointer){if(this._pointerData[pointer.id].isDown===false&&this._pointerData[pointer.id].isOver===true){this._pointerData[pointer.id].isDown=true;this._pointerData[pointer.id].isUp=false;this._pointerData[pointer.id].timeDown=this.game.time.now;this.sprite.events.onInputDown.dispatch(this.sprite,pointer);if(this.draggable&&this.isDragged===false){this.startDrag(pointer)}if(this.bringToTop){this.sprite.bringToTop()}}return this.consumePointerEvent},_releasedHandler:function(pointer){if(this._pointerData[pointer.id].isDown&&pointer.isUp){this._pointerData[pointer.id].isDown=false;this._pointerData[pointer.id].isUp=true;this._pointerData[pointer.id].timeUp=this.game.time.now;this._pointerData[pointer.id].downDuration=this._pointerData[pointer.id].timeUp-this._pointerData[pointer.id].timeDown;if(this.checkPointerOver(pointer)){this.sprite.events.onInputUp.dispatch(this.sprite,pointer)}else{if(this.useHandCursor){this.game.stage.canvas.style.cursor="default"}}if(this.draggable&&this.isDragged&&this._draggedPointerID==pointer.id){this.stopDrag(pointer)}}},updateDrag:function(pointer){if(pointer.isUp){this.stopDrag(pointer);return false}if(this.allowHorizontalDrag){this.sprite.x=pointer.x+this._dragPoint.x+this.dragOffset.x}if(this.allowVerticalDrag){this.sprite.y=pointer.y+this._dragPoint.y+this.dragOffset.y}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round(this.sprite.x/this.snapX)*this.snapX;this.sprite.y=Math.round(this.sprite.y/this.snapY)*this.snapY}return true},justOver:function(pointer,delay){pointer=pointer||0;delay=delay||500;return this._pointerData[pointer].isOver&&this.overDuration(pointer)<delay},justOut:function(pointer,delay){pointer=pointer||0;delay=delay||500;return this._pointerData[pointer].isOut&&this.game.time.now-this._pointerData[pointer].timeOut<delay},justPressed:function(pointer,delay){pointer=pointer||0;delay=delay||500;return this._pointerData[pointer].isDown&&this.downDuration(pointer)<delay},justReleased:function(pointer,delay){pointer=pointer||0;delay=delay||500;return this._pointerData[pointer].isUp&&this.game.time.now-this._pointerData[pointer].timeUp<delay
},overDuration:function(pointer){pointer=pointer||0;if(this._pointerData[pointer].isOver){return this.game.time.now-this._pointerData[pointer].timeOver}return-1},downDuration:function(pointer){pointer=pointer||0;if(this._pointerData[pointer].isDown){return this.game.time.now-this._pointerData[pointer].timeDown}return-1},enableDrag:function(lockCenter,bringToTop,pixelPerfect,alphaThreshold,boundsRect,boundsSprite){if(typeof lockCenter=="undefined"){lockCenter=false}if(typeof bringToTop=="undefined"){bringToTop=false}if(typeof pixelPerfect=="undefined"){pixelPerfect=false}if(typeof alphaThreshold=="undefined"){alphaThreshold=255}if(typeof boundsRect=="undefined"){boundsRect=null}if(typeof boundsSprite=="undefined"){boundsSprite=null}this._dragPoint=new Phaser.Point;this.draggable=true;this.bringToTop=bringToTop;this.dragOffset=new Phaser.Point;this.dragFromCenter=lockCenter;this.pixelPerfect=pixelPerfect;this.pixelPerfectAlpha=alphaThreshold;if(boundsRect){this.boundsRect=boundsRect}if(boundsSprite){this.boundsSprite=boundsSprite}},disableDrag:function(){if(this._pointerData){for(var i=0;i<10;i++){this._pointerData[i].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1},startDrag:function(pointer){this.isDragged=true;this._draggedPointerID=pointer.id;this._pointerData[pointer.id].isDragged=true;if(this.dragFromCenter){this.sprite.centerOn(pointer.x,pointer.y);this._dragPoint.setTo(this.sprite.x-pointer.x,this.sprite.y-pointer.y)}else{this._dragPoint.setTo(this.sprite.x-pointer.x,this.sprite.y-pointer.y)}this.updateDrag(pointer);if(this.bringToTop){this.sprite.bringToTop()}this.sprite.events.onDragStart.dispatch(this.sprite,pointer)},stopDrag:function(pointer){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[pointer.id].isDragged=false;if(this.snapOnRelease){this.sprite.x=Math.round(this.sprite.x/this.snapX)*this.snapX;this.sprite.y=Math.round(this.sprite.y/this.snapY)*this.snapY}this.sprite.events.onDragStop.dispatch(this.sprite,pointer);this.sprite.events.onInputUp.dispatch(this.sprite,pointer);if(this.checkPointerOver(pointer)===false){this._pointerOutHandler(pointer)}},setDragLock:function(allowHorizontal,allowVertical){if(typeof allowHorizontal=="undefined"){allowHorizontal=true}if(typeof allowVertical=="undefined"){allowVertical=true}this.allowHorizontalDrag=allowHorizontal;this.allowVerticalDrag=allowVertical},enableSnap:function(snapX,snapY,onDrag,onRelease){if(typeof onDrag=="undefined"){onDrag=true}if(typeof onRelease=="undefined"){onRelease=false}this.snapX=snapX;this.snapY=snapY;this.snapOnDrag=onDrag;this.snapOnRelease=onRelease},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.x<this.boundsRect.left){this.sprite.x=this.boundsRect.x}else if(this.sprite.x+this.sprite.width>this.boundsRect.right){this.sprite.x=this.boundsRect.right-this.sprite.width}if(this.sprite.y<this.boundsRect.top){this.sprite.y=this.boundsRect.top}else if(this.sprite.y+this.sprite.height>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-this.sprite.height}},checkBoundsSprite:function(){if(this.sprite.x<this.boundsSprite.x){this.sprite.x=this.boundsSprite.x}else if(this.sprite.x+this.sprite.width>this.boundsSprite.x+this.boundsSprite.width){this.sprite.x=this.boundsSprite.x+this.boundsSprite.width-this.sprite.width}if(this.sprite.y<this.boundsSprite.y){this.sprite.y=this.boundsSprite.y}else if(this.sprite.y+this.sprite.height>this.boundsSprite.y+this.boundsSprite.height){this.sprite.y=this.boundsSprite.y+this.boundsSprite.height-this.sprite.height}}};Phaser.Events=function(sprite){this.parent=sprite;this.onAddedToGroup=new Phaser.Signal;this.onRemovedFromGroup=new Phaser.Signal;this.onKilled=new Phaser.Signal;this.onRevived=new Phaser.Signal;this.onOutOfBounds=new Phaser.Signal;this.onInputOver=null;this.onInputOut=null;this.onInputDown=null;this.onInputUp=null;this.onDragStart=null;this.onDragStop=null;this.onAnimationStart=null;this.onAnimationComplete=null;this.onAnimationLoop=null};Phaser.Events.prototype={destroy:function(){this.parent=null;this.onAddedToGroup.dispose();this.onRemovedFromGroup.dispose();this.onKilled.dispose();this.onRevived.dispose();this.onOutOfBounds.dispose();if(this.onInputOver){this.onInputOver.dispose();this.onInputOut.dispose();this.onInputDown.dispose();this.onInputUp.dispose();this.onDragStart.dispose();this.onDragStop.dispose()}if(this.onAnimationStart){this.onAnimationStart.dispose();this.onAnimationComplete.dispose();this.onAnimationLoop.dispose()}}};Phaser.GameObjectFactory=function(game){this.game=game;this.world=this.game.world};Phaser.GameObjectFactory.prototype={existing:function(object){return this.world.add(object)},sprite:function(x,y,key,frame){return this.world.create(x,y,key,frame)},child:function(group,x,y,key,frame){return group.create(x,y,key,frame)},tween:function(obj){return this.game.tweens.create(obj)},group:function(parent,name){return new Phaser.Group(this.game,parent,name)},audio:function(key,volume,loop,connect){return this.game.sound.add(key,volume,loop,connect)},tileSprite:function(x,y,width,height,key,frame){return this.world.add(new Phaser.TileSprite(this.game,x,y,width,height,key,frame))},text:function(x,y,text,style){return this.world.add(new Phaser.Text(this.game,x,y,text,style))},button:function(x,y,key,callback,callbackContext,overFrame,outFrame,downFrame){return this.world.add(new Phaser.Button(this.game,x,y,key,callback,callbackContext,overFrame,outFrame,downFrame))},graphics:function(x,y){return this.world.add(new Phaser.Graphics(this.game,x,y))},emitter:function(x,y,maxParticles){return this.game.particles.add(new Phaser.Particles.Arcade.Emitter(this.game,x,y,maxParticles))},bitmapText:function(x,y,text,style){return this.world.add(new Phaser.BitmapText(this.game,x,y,text,style))},tilemap:function(key){return new Phaser.Tilemap(this.game,key)},tileset:function(key){return this.game.cache.getTileset(key)},tilemapLayer:function(x,y,width,height,tileset,tilemap,layer){return this.world.add(new Phaser.TilemapLayer(this.game,x,y,width,height,tileset,tilemap,layer))},renderTexture:function(key,width,height){var texture=new Phaser.RenderTexture(this.game,key,width,height);this.game.cache.addRenderTexture(key,texture);return texture},bitmapData:function(width,height){return new Phaser.BitmapData(this.game,width,height)},filter:function(filter){var args=Array.prototype.splice.call(arguments,1);var filter=new Phaser.Filter[filter](this.game);filter.init.apply(filter,args);return filter}};Phaser.BitmapData=function(game,width,height){if(typeof width==="undefined"){width=256}if(typeof height==="undefined"){height=256}this.game=game;this.name="";this.width=width;this.height=height;this.canvas=Phaser.Canvas.create(width,height);this.context=this.canvas.getContext("2d");this.imageData=this.context.getImageData(0,0,width,height);if(this.imageData.data.buffer){this.pixels=this.imageData.data.buffer}else{this.pixels=this.imageData.data}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new Phaser.Frame(0,0,0,width,height,"bitmapData",game.rnd.uuid());this.type=Phaser.BITMAPDATA;this._dirty=false};Phaser.BitmapData.prototype={add:function(sprite){sprite.loadTexture(this)},addTo:function(sprites){for(var i=0;i<sprites.length;i++){if(sprites[i].texture){sprites[i].loadTexture(this)}}},clear:function(){this.context.clearRect(0,0,this.width,this.height);this._dirty=true},refreshBuffer:function(){this.imageData=this.context.getImageData(0,0,this.width,this.height);this.pixels=new Int32Array(this.imageData.data.buffer)},setPixel32:function(x,y,red,green,blue,alpha){if(x>=0&&x<=this.width&&y>=0&&y<=this.height){this.pixels[y*this.width+x]=alpha<<24|blue<<16|green<<8|red;this.context.putImageData(this.imageData,0,0);this._dirty=true}},setPixel:function(x,y,red,green,blue){this.setPixel32(x,y,red,green,blue,255)},getPixel:function(x,y){if(x>=0&&x<=this.width&&y>=0&&y<=this.height){return this.data32[y*this.width+x]}},getPixel32:function(x,y){if(x>=0&&x<=this.width&&y>=0&&y<=this.height){return this.data32[y*this.width+x]}},getPixels:function(rect){return this.context.getImageData(rect.x,rect.y,rect.width,rect.height)},arc:function(x,y,radius,startAngle,endAngle,anticlockwise){if(typeof anticlockwise==="undefined"){anticlockwise=false}this._dirty=true;this.context.arc(x,y,radius,startAngle,endAngle,anticlockwise);return this},arcTo:function(x1,y1,x2,y2,radius){this._dirty=true;this.context.arcTo(x1,y1,x2,y2,radius);return this},beginFill:function(color){this.fillStyle(color);return this},beginLinearGradientFill:function(colors,ratios,x0,y0,x1,y1){var gradient=this.createLinearGradient(x0,y0,x1,y1);for(var i=0,len=colors.length;i<len;i++){gradient.addColorStop(ratios[i],colors[i])}this.fillStyle(gradient);return this},beginLinearGradientStroke:function(colors,ratios,x0,y0,x1,y1){var gradient=this.createLinearGradient(x0,y0,x1,y1);for(var i=0,len=colors.length;i<len;i++){gradient.addColorStop(ratios[i],colors[i])}this.strokeStyle(gradient);return this},beginRadialGradientStroke:function(colors,ratios,x0,y0,r0,x1,y1,r1){var gradient=this.createRadialGradient(x0,y0,r0,x1,y1,r1);for(var i=0,len=colors.length;i<len;i++){gradient.addColorStop(ratios[i],colors[i])}this.strokeStyle(gradient);return this},beginPath:function(){this.context.beginPath();return this},beginStroke:function(color){this.strokeStyle(color);return this},bezierCurveTo:function(cp1x,cp1y,cp2x,cp2y,x,y){this._dirty=true;this.context.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y);return this},circle:function(x,y,radius){this.arc(x,y,radius,0,Math.PI*2);return this},clearRect:function(x,y,width,height){this._dirty=true;this.context.clearRect(x,y,width,height);return this},clip:function(){this._dirty=true;this.context.clip();return this},closePath:function(){this._dirty=true;this.context.closePath();return this},createLinearGradient:function(x,y,width,height){return this.context.createLinearGradient(x,y,width,height)},createRadialGradient:function(x0,y0,r0,x1,y1,r1){return this.context.createRadialGradient(x0,y0,r0,x1,y1,r1)},ellipse:function(x,y,w,h){var k=.5522848;var ox=w/2*k;var oy=h/2*k;var xe=x+w;var ye=y+h;var xm=x+w/2;var ym=y+h/2;this.moveTo(x,ym);this.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);this.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);this.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);this.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);return this},fill:function(){this._dirty=true;this.context.fill();return this},fillRect:function(x,y,width,height){this._dirty=true;this.context.fillRect(x,y,width,height);return this},fillStyle:function(color){this.context.fillStyle=color;return this},font:function(font){this.context.font=font;return this},globalAlpha:function(alpha){this.context.globalAlpha=alpha;return this},globalCompositeOperation:function(operation){this.context.globalCompositeOperation=operation;return this},lineCap:function(style){this.context.lineCap=style;return this},lineDashOffset:function(offset){this.context.lineDashOffset=offset;return this},lineJoin:function(join){this.context.lineJoin=join;return this},lineWidth:function(width){this.context.lineWidth=width;return this},miterLimit:function(limit){this.context.miterLimit=limit;return this},lineTo:function(x,y){this._dirty=true;this.context.lineTo(x,y);return this},moveTo:function(x,y){this.context.moveTo(x,y);return this},quadraticCurveTo:function(cpx,cpy,x,y){this._dirty=true;this.context.quadraticCurveTo(cpx,cpy,x,y);return this},rect:function(x,y,width,height){this._dirty=true;this.context.rect(x,y,width,height);return this},restore:function(){this._dirty=true;this.context.restore();return this},rotate:function(angle){this._dirty=true;this.context.rotate(angle);return this},setStrokeStyle:function(thickness,caps,joints,miterLimit,ignoreScale){if(typeof thickness==="undefined"){thickness=1}if(typeof caps==="undefined"){caps="butt"}if(typeof joints==="undefined"){joints="miter"}if(typeof miterLimit==="undefined"){miterLimit=10}ignoreScale=false;this.lineWidth(thickness);this.lineCap(caps);this.lineJoin(joints);this.miterLimit(miterLimit);return this},save:function(){this._dirty=true;this.context.save();return this},scale:function(x,y){this._dirty=true;this.context.scale(x,y);return this},scrollPathIntoView:function(){this._dirty=true;this.context.scrollPathIntoView();return this},stroke:function(){this._dirty=true;this.context.stroke();return this},strokeRect:function(x,y,width,height){this._dirty=true;this.context.strokeRect(x,y,width,height);return this},strokeStyle:function(style){this.context.strokeStyle=style;return this},render:function(){if(this._dirty){if(this.game.renderType==Phaser.WEBGL){PIXI.texturesToUpdate.push(this.baseTexture)}this._dirty=false}}};Phaser.BitmapData.prototype.mt=Phaser.BitmapData.prototype.moveTo;Phaser.BitmapData.prototype.lt=Phaser.BitmapData.prototype.lineTo;Phaser.BitmapData.prototype.at=Phaser.BitmapData.prototype.arcTo;Phaser.BitmapData.prototype.bt=Phaser.BitmapData.prototype.bezierCurveTo;Phaser.BitmapData.prototype.qt=Phaser.BitmapData.prototype.quadraticCurveTo;Phaser.BitmapData.prototype.a=Phaser.BitmapData.prototype.arc;Phaser.BitmapData.prototype.r=Phaser.BitmapData.prototype.rect;Phaser.BitmapData.prototype.cp=Phaser.BitmapData.prototype.closePath;Phaser.BitmapData.prototype.c=Phaser.BitmapData.prototype.clear;Phaser.BitmapData.prototype.f=Phaser.BitmapData.prototype.beginFill;Phaser.BitmapData.prototype.lf=Phaser.BitmapData.prototype.beginLinearGradientFill;Phaser.BitmapData.prototype.rf=Phaser.BitmapData.prototype.beginRadialGradientFill;Phaser.BitmapData.prototype.ef=Phaser.BitmapData.prototype.endFill;Phaser.BitmapData.prototype.ss=Phaser.BitmapData.prototype.setStrokeStyle;Phaser.BitmapData.prototype.s=Phaser.BitmapData.prototype.beginStroke;Phaser.BitmapData.prototype.ls=Phaser.BitmapData.prototype.beginLinearGradientStroke;Phaser.BitmapData.prototype.rs=Phaser.BitmapData.prototype.beginRadialGradientStroke;Phaser.BitmapData.prototype.dr=Phaser.BitmapData.prototype.rect;Phaser.BitmapData.prototype.dc=Phaser.BitmapData.prototype.circle;Phaser.BitmapData.prototype.de=Phaser.BitmapData.prototype.ellipse;Phaser.Sprite=function(game,x,y,key,frame){x=x||0;y=y||0;key=key||null;frame=frame||null;this.game=game;this.exists=true;this.alive=true;this.group=null;this.name="";this.type=Phaser.SPRITE;this.renderOrderID=-1;this.lifespan=0;this.events=new Phaser.Events(this);this.animations=new Phaser.AnimationManager(this);this.input=new Phaser.InputHandler(this);this.key=key;this.currentFrame=null;if(key instanceof Phaser.RenderTexture){PIXI.Sprite.call(this,key);this.currentFrame=this.game.cache.getTextureFrame(key.name)}else if(key instanceof Phaser.BitmapData){PIXI.Sprite.call(this,key.texture,key.textureFrame);this.currentFrame=key.textureFrame}else if(key instanceof PIXI.Texture){PIXI.Sprite.call(this,key);this.currentFrame=frame}else{if(key===null||typeof key==="undefined"){key="__default";this.key=key}else if(typeof key==="string"&&this.game.cache.checkImageKey(key)===false){key="__missing";this.key=key}PIXI.Sprite.call(this,PIXI.TextureCache[key]);if(this.game.cache.isSpriteSheet(key)){this.animations.loadFrameData(this.game.cache.getFrameData(key));if(frame!==null){if(typeof frame==="string"){this.frameName=frame}else{this.frame=frame}}}else{this.currentFrame=this.game.cache.getFrame(key)}}this.textureRegion=new Phaser.Rectangle(this.texture.frame.x,this.texture.frame.y,this.texture.frame.width,this.texture.frame.height);this.anchor=new Phaser.Point;this.x=x;this.y=y;this.position.x=x;this.position.y=y;this.world=new Phaser.Point(x,y);this.autoCull=false;this.scale=new Phaser.Point(1,1);this._cache={dirty:false,a00:-1,a01:-1,a02:-1,a10:-1,a11:-1,a12:-1,id:-1,i01:-1,i10:-1,idi:-1,left:null,right:null,top:null,bottom:null,prevX:x,prevY:y,x:-1,y:-1,scaleX:1,scaleY:1,width:this.currentFrame.sourceSizeW,height:this.currentFrame.sourceSizeH,halfWidth:Math.floor(this.currentFrame.sourceSizeW/2),halfHeight:Math.floor(this.currentFrame.sourceSizeH/2),calcWidth:-1,calcHeight:-1,frameID:-1,frameWidth:this.currentFrame.width,frameHeight:this.currentFrame.height,cameraVisible:true,cropX:0,cropY:0,cropWidth:this.currentFrame.sourceSizeW,cropHeight:this.currentFrame.sourceSizeH};this.offset=new Phaser.Point;this.center=new Phaser.Point(x+Math.floor(this._cache.width/2),y+Math.floor(this._cache.height/2));this.topLeft=new Phaser.Point(x,y);this.topRight=new Phaser.Point(x+this._cache.width,y);this.bottomRight=new Phaser.Point(x+this._cache.width,y+this._cache.height);this.bottomLeft=new Phaser.Point(x,y+this._cache.height);this.bounds=new Phaser.Rectangle(x,y,this._cache.width,this._cache.height);this.body=new Phaser.Physics.Arcade.Body(this);this.health=1;this.inWorld=Phaser.Rectangle.intersects(this.bounds,this.game.world.bounds);this.inWorldThreshold=0;this.outOfBoundsKill=false;this._outOfBoundsFired=false;this.fixedToCamera=false;this.cameraOffset=new Phaser.Point;this.crop=new Phaser.Rectangle(0,0,this._cache.width,this._cache.height);this.cropEnabled=false;this.updateCache();this.updateBounds()};Phaser.Sprite.prototype=Object.create(PIXI.Sprite.prototype);Phaser.Sprite.prototype.constructor=Phaser.Sprite;Phaser.Sprite.prototype.preUpdate=function(){if(!this.exists||this.group&&!this.group.exists){this.renderOrderID=-1;return false}if(this.lifespan>0){this.lifespan-=this.game.time.elapsed;if(this.lifespan<=0){this.kill();return false}}this._cache.dirty=false;if(this.visible){this.renderOrderID=this.game.world.currentRenderOrderID++}this.updateCache();this.updateAnimation();this.updateCrop();if(this._cache.dirty||this.world.x!==this._cache.prevX||this.world.y!==this._cache.prevY){this.updateBounds()}if(this.body){this.body.preUpdate()}return true};Phaser.Sprite.prototype.updateCache=function(){this._cache.prevX=this.world.x;this._cache.prevY=this.world.y;if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]);if(this.worldTransform[1]!=this._cache.i01||this.worldTransform[3]!=this._cache.i10||this.worldTransform[0]!=this._cache.a00||this.worldTransform[41]!=this._cache.a11){this._cache.a00=this.worldTransform[0];this._cache.a01=this.worldTransform[1];this._cache.a10=this.worldTransform[3];this._cache.a11=this.worldTransform[4];this._cache.i01=this.worldTransform[1];this._cache.i10=this.worldTransform[3];this._cache.scaleX=Math.sqrt(this._cache.a00*this._cache.a00+this._cache.a01*this._cache.a01);this._cache.scaleY=Math.sqrt(this._cache.a10*this._cache.a10+this._cache.a11*this._cache.a11);this._cache.a01*=-1;this._cache.a10*=-1;this._cache.id=1/(this._cache.a00*this._cache.a11+this._cache.a01*-this._cache.a10);this._cache.idi=1/(this._cache.a00*this._cache.a11+this._cache.i01*-this._cache.i10);this._cache.dirty=true}this._cache.a02=this.worldTransform[2];this._cache.a12=this.worldTransform[5]};Phaser.Sprite.prototype.updateAnimation=function(){if(this.animations.update()||this.currentFrame&&this.currentFrame.uuid!=this._cache.frameID){this._cache.frameID=this.currentFrame.uuid;this._cache.frameWidth=this.texture.frame.width;this._cache.frameHeight=this.texture.frame.height;this._cache.width=this.currentFrame.width;this._cache.height=this.currentFrame.height;this._cache.halfWidth=Math.floor(this._cache.width/2);this._cache.halfHeight=Math.floor(this._cache.height/2);this._cache.dirty=true}};Phaser.Sprite.prototype.updateCrop=function(){if(this.cropEnabled&&(this.crop.width!=this._cache.cropWidth||this.crop.height!=this._cache.cropHeight||this.crop.x!=this._cache.cropX||this.crop.y!=this._cache.cropY)){this.crop.floorAll();this._cache.cropX=this.crop.x;this._cache.cropY=this.crop.y;this._cache.cropWidth=this.crop.width;this._cache.cropHeight=this.crop.height;this.texture.frame=this.crop;this.texture.width=this.crop.width;this.texture.height=this.crop.height;this.texture.updateFrame=true;PIXI.Texture.frameUpdates.push(this.texture)}};Phaser.Sprite.prototype.updateBounds=function(){this.offset.setTo(this._cache.a02-this.anchor.x*this.width,this._cache.a12-this.anchor.y*this.height);this.getLocalPosition(this.center,this.offset.x+this.width/2,this.offset.y+this.height/2);this.getLocalPosition(this.topLeft,this.offset.x,this.offset.y);this.getLocalPosition(this.topRight,this.offset.x+this.width,this.offset.y);this.getLocalPosition(this.bottomLeft,this.offset.x,this.offset.y+this.height);this.getLocalPosition(this.bottomRight,this.offset.x+this.width,this.offset.y+this.height);this._cache.left=Phaser.Math.min(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x);this._cache.right=Phaser.Math.max(this.topLeft.x,this.topRight.x,this.bottomLeft.x,this.bottomRight.x);this._cache.top=Phaser.Math.min(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y);this._cache.bottom=Phaser.Math.max(this.topLeft.y,this.topRight.y,this.bottomLeft.y,this.bottomRight.y);this.bounds.setTo(this._cache.left,this._cache.top,this._cache.right-this._cache.left,this._cache.bottom-this._cache.top);this.updateFrame=true;if(this.inWorld===false){this.inWorld=Phaser.Rectangle.intersects(this.bounds,this.game.world.bounds,this.inWorldThreshold);if(this.inWorld){this._outOfBoundsFired=false}}else{this.inWorld=Phaser.Rectangle.intersects(this.bounds,this.game.world.bounds,this.inWorldThreshold);if(this.inWorld===false){this.events.onOutOfBounds.dispatch(this);this._outOfBoundsFired=true;if(this.outOfBoundsKill){this.kill()}}}this._cache.cameraVisible=Phaser.Rectangle.intersects(this.game.world.camera.screenView,this.bounds,0);if(this.autoCull){this.renderable=this._cache.cameraVisible}if(this.body){this.body.updateBounds(this.center.x,this.center.y,this._cache.scaleX,this._cache.scaleY)}};Phaser.Sprite.prototype.getLocalPosition=function(p,x,y){p.x=(this._cache.a11*this._cache.id*x+-this._cache.a01*this._cache.id*y+(this._cache.a12*this._cache.a01-this._cache.a02*this._cache.a11)*this._cache.id)*this.scale.x+this._cache.a02;p.y=(this._cache.a00*this._cache.id*y+-this._cache.a10*this._cache.id*x+(-this._cache.a12*this._cache.a00+this._cache.a02*this._cache.a10)*this._cache.id)*this.scale.y+this._cache.a12;return p};Phaser.Sprite.prototype.getLocalUnmodifiedPosition=function(p,gx,gy){p.x=this._cache.a11*this._cache.idi*gx+-this._cache.i01*this._cache.idi*gy+(this._cache.a12*this._cache.i01-this._cache.a02*this._cache.a11)*this._cache.idi+this.anchor.x*this._cache.width;p.y=this._cache.a00*this._cache.idi*gy+-this._cache.i10*this._cache.idi*gx+(-this._cache.a12*this._cache.a00+this._cache.a02*this._cache.i10)*this._cache.idi+this.anchor.y*this._cache.height;return p};Phaser.Sprite.prototype.resetCrop=function(){this.crop=new Phaser.Rectangle(0,0,this._cache.width,this._cache.height);this.texture.setFrame(this.crop);this.cropEnabled=false};Phaser.Sprite.prototype.postUpdate=function(){if(this.key instanceof Phaser.BitmapData&&this.key._dirty){this.key.render()}if(this.exists){if(this.body){this.body.postUpdate()}if(this.fixedToCamera){this._cache.x=this.game.camera.view.x+this.cameraOffset.x;this._cache.y=this.game.camera.view.y+this.cameraOffset.y}else{this._cache.x=this.x;this._cache.y=this.y}this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]);this.position.x=this._cache.x;this.position.y=this._cache.y}};Phaser.Sprite.prototype.loadTexture=function(key,frame){this.key=key;if(key instanceof Phaser.RenderTexture){this.currentFrame=this.game.cache.getTextureFrame(key.name)}else if(key instanceof Phaser.BitmapData){this.setTexture(key.texture);this.currentFrame=key.textureFrame}else if(key instanceof PIXI.Texture){this.currentFrame=frame}else{if(typeof key==="undefined"||this.game.cache.checkImageKey(key)===false){key="__default";this.key=key}if(this.game.cache.isSpriteSheet(key)){this.animations.loadFrameData(this.game.cache.getFrameData(key));if(typeof frame!=="undefined"){if(typeof frame==="string"){this.frameName=frame}else{this.frame=frame}}}else{this.currentFrame=this.game.cache.getFrame(key);this.setTexture(PIXI.TextureCache[key])}}};Phaser.Sprite.prototype.centerOn=function(x,y){this.x=x+(this.x-this.center.x);this.y=y+(this.y-this.center.y);return this};Phaser.Sprite.prototype.revive=function(health){if(typeof health==="undefined"){health=1}this.alive=true;this.exists=true;this.visible=true;this.health=health;if(this.events){this.events.onRevived.dispatch(this)}return this};Phaser.Sprite.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled.dispatch(this)}return this};Phaser.Sprite.prototype.destroy=function(){if(this.group){this.group.remove(this)}if(this.input){this.input.destroy()}if(this.events){this.events.destroy()}if(this.animations){this.animations.destroy()}this.alive=false;this.exists=false;this.visible=false;this.game=null};Phaser.Sprite.prototype.damage=function(amount){if(this.alive){this.health-=amount;if(this.health<0){this.kill()}}return this};Phaser.Sprite.prototype.reset=function(x,y,health){if(typeof health==="undefined"){health=1}this.x=x;this.y=y;this.position.x=this.x;this.position.y=this.y;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;this._outOfBoundsFired=false;this.health=health;if(this.body){this.body.reset()}return this};Phaser.Sprite.prototype.bringToTop=function(){if(this.group){this.group.bringToTop(this)}else{this.game.world.bringToTop(this)}return this};Phaser.Sprite.prototype.play=function(name,frameRate,loop,killOnComplete){if(this.animations){return this.animations.play(name,frameRate,loop,killOnComplete)}};Object.defineProperty(Phaser.Sprite.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.rotation))},set:function(value){this.rotation=Phaser.Math.degToRad(Phaser.Math.wrapAngle(value))}});Object.defineProperty(Phaser.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(value){this.animations.frame=value}});Object.defineProperty(Phaser.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(value){this.animations.frameName=value}});Object.defineProperty(Phaser.Sprite.prototype,"inCamera",{get:function(){return this._cache.cameraVisible}});Object.defineProperty(Phaser.Sprite.prototype,"width",{get:function(){return this.scale.x*this.currentFrame.width},set:function(value){this.scale.x=value/this.currentFrame.width;this._cache.scaleX=value/this.currentFrame.width;this._width=value}});Object.defineProperty(Phaser.Sprite.prototype,"height",{get:function(){return this.scale.y*this.currentFrame.height},set:function(value){this.scale.y=value/this.currentFrame.height;this._cache.scaleY=value/this.currentFrame.height;this._height=value}});Object.defineProperty(Phaser.Sprite.prototype,"inputEnabled",{get:function(){return this.input.enabled},set:function(value){console.log("inputEnabled",value,this.input);if(value){if(this.input.enabled===false){this.input.start()}}else{if(this.input.enabled){this.input.stop()}}}});Phaser.TileSprite=function(game,x,y,width,height,key,frame){x=x||0;y=y||0;width=width||256;height=height||256;key=key||null;frame=frame||null;Phaser.Sprite.call(this,game,x,y,key,frame);this.texture=PIXI.TextureCache[key];PIXI.TilingSprite.call(this,this.texture,width,height);this.type=Phaser.TILESPRITE;this.tileScale=new Phaser.Point(1,1);this.tilePosition=new Phaser.Point(0,0)};Phaser.TileSprite.prototype=Phaser.Utils.extend(true,PIXI.TilingSprite.prototype,Phaser.Sprite.prototype);Phaser.TileSprite.prototype.constructor=Phaser.TileSprite;Phaser.Text=function(game,x,y,text,style){x=x||0;y=y||0;text=text||"";style=style||"";this.game=game;this.exists=true;this.alive=true;this.group=null;this.name="";this.type=Phaser.TEXT;this._text=text;this._style=style;PIXI.Text.call(this,text,style);this.position.x=this.x=x;this.position.y=this.y=y;this.anchor=new Phaser.Point;this.scale=new Phaser.Point(1,1);this._cache={dirty:false,a00:1,a01:0,a02:x,a10:0,a11:1,a12:y,id:1,x:-1,y:-1,scaleX:1,scaleY:1};this._cache.x=this.x;this._cache.y=this.y;this.renderable=true};Phaser.Text.prototype=Object.create(PIXI.Text.prototype);Phaser.Text.prototype.constructor=Phaser.Text;Phaser.Text.prototype.update=function(){if(!this.exists){return}this._cache.dirty=false;this._cache.x=this.x;this._cache.y=this.y;if(this.position.x!=this._cache.x||this.position.y!=this._cache.y){this.position.x=this._cache.x;this.position.y=this._cache.y;this._cache.dirty=true}};Phaser.Text.prototype.destroy=function(){if(this.group){this.group.remove(this)}if(this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}else{this.canvas=null;this.context=null}this.exists=false;this.group=null};Object.defineProperty(Phaser.Text.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(value){this.rotation=Phaser.Math.degToRad(value)}});Object.defineProperty(Phaser.Text.prototype,"x",{get:function(){return this.position.x},set:function(value){this.position.x=value}});Object.defineProperty(Phaser.Text.prototype,"y",{get:function(){return this.position.y},set:function(value){this.position.y=value}});Object.defineProperty(Phaser.Text.prototype,"content",{get:function(){return this._text},set:function(value){if(value!==this._text){this._text=value;this.setText(value)}}});Object.defineProperty(Phaser.Text.prototype,"font",{get:function(){return this._style},set:function(value){if(value!==this._style){this._style=value;this.setStyle(value)}}});Phaser.BitmapText=function(game,x,y,text,style){x=x||0;y=y||0;text=text||"";style=style||"";this.game=game;this.exists=true;this.alive=true;this.group=null;this.name="";this.type=Phaser.BITMAPTEXT;PIXI.BitmapText.call(this,text,style);this.position.x=x;this.position.y=y;this.anchor=new Phaser.Point;this.scale=new Phaser.Point(1,1);this._cache={dirty:false,a00:1,a01:0,a02:x,a10:0,a11:1,a12:y,id:1,x:-1,y:-1,scaleX:1,scaleY:1};this._cache.x=this.x;this._cache.y=this.y;this.renderable=true};Phaser.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);Phaser.BitmapText.prototype.constructor=Phaser.BitmapText;Phaser.BitmapText.prototype.update=function(){if(!this.exists){return}this._cache.dirty=false;this._cache.x=this.x;this._cache.y=this.y;if(this.position.x!=this._cache.x||this.position.y!=this._cache.y){this.position.x=this._cache.x;this.position.y=this._cache.y;this._cache.dirty=true}this.pivot.x=this.anchor.x*this.width;this.pivot.y=this.anchor.y*this.height};Phaser.BitmapText.prototype.destroy=function(){if(this.group){this.group.remove(this)}if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}else{this.canvas=null;this.context=null}this.exists=false;this.group=null};Object.defineProperty(Phaser.BitmapText.prototype,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(value){this.rotation=Phaser.Math.degToRad(value)}});Object.defineProperty(Phaser.BitmapText.prototype,"x",{get:function(){return this.position.x},set:function(value){this.position.x=value}});Object.defineProperty(Phaser.BitmapText.prototype,"y",{get:function(){return this.position.y},set:function(value){this.position.y=value}});Phaser.Button=function(game,x,y,key,callback,callbackContext,overFrame,outFrame,downFrame){x=x||0;y=y||0;key=key||null;callback=callback||null;callbackContext=callbackContext||this;Phaser.Sprite.call(this,game,x,y,key,outFrame);this.type=Phaser.BUTTON;this._onOverFrameName=null;this._onOutFrameName=null;this._onDownFrameName=null;this._onUpFrameName=null;this._onOverFrameID=null;this._onOutFrameID=null;this._onDownFrameID=null;this._onUpFrameID=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";
this.onInputOver=new Phaser.Signal;this.onInputOut=new Phaser.Signal;this.onInputDown=new Phaser.Signal;this.onInputUp=new Phaser.Signal;this.freezeFrames=false;this.forceOut=true;this.setFrames(overFrame,outFrame,downFrame);if(callback!==null){this.onInputUp.add(callback,callbackContext)}this.input.start(0,true);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this)};Phaser.Button.prototype=Object.create(Phaser.Sprite.prototype);Phaser.Button.prototype=Phaser.Utils.extend(true,Phaser.Button.prototype,Phaser.Sprite.prototype,PIXI.Sprite.prototype);Phaser.Button.prototype.constructor=Phaser.Button;Phaser.Button.prototype.setFrames=function(overFrame,outFrame,downFrame){if(overFrame!==null){if(typeof overFrame==="string"){this._onOverFrameName=overFrame;if(this.input.pointerOver()){this.frameName=overFrame}}else{this._onOverFrameID=overFrame;if(this.input.pointerOver()){this.frame=overFrame}}}if(outFrame!==null){if(typeof outFrame==="string"){this._onOutFrameName=outFrame;this._onUpFrameName=outFrame;if(this.input.pointerOver()===false){this.frameName=outFrame}}else{this._onOutFrameID=outFrame;this._onUpFrameID=outFrame;if(this.input.pointerOver()===false){this.frame=outFrame}}}if(downFrame!==null){if(typeof downFrame==="string"){this._onDownFrameName=downFrame;if(this.input.pointerDown()){this.frameName=downFrame}}else{this._onDownFrameID=downFrame;if(this.input.pointerDown()){this.frame=downFrame}}}};Phaser.Button.prototype.setSounds=function(overSound,overMarker,downSound,downMarker,outSound,outMarker,upSound,upMarker){this.setOverSound(overSound,overMarker);this.setOutSound(outSound,outMarker);this.setUpSound(upSound,upMarker);this.setDownSound(downSound,downMarker)};Phaser.Button.prototype.setOverSound=function(sound,marker){this.onOverSound=null;this.onOverSoundMarker="";if(sound instanceof Phaser.Sound){this.onOverSound=sound}if(typeof marker==="string"){this.onOverSoundMarker=marker}};Phaser.Button.prototype.setOutSound=function(sound,marker){this.onOutSound=null;this.onOutSoundMarker="";if(sound instanceof Phaser.Sound){this.onOutSound=sound}if(typeof marker==="string"){this.onOutSoundMarker=marker}};Phaser.Button.prototype.setUpSound=function(sound,marker){this.onUpSound=null;this.onUpSoundMarker="";if(sound instanceof Phaser.Sound){this.onUpSound=sound}if(typeof marker==="string"){this.onUpSoundMarker=marker}};Phaser.Button.prototype.setDownSound=function(sound,marker){this.onDownSound=null;this.onDownSoundMarker="";if(sound instanceof Phaser.Sound){this.onDownSound=sound}if(typeof marker==="string"){this.onDownSoundMarker=marker}};Phaser.Button.prototype.onInputOverHandler=function(pointer){if(this.freezeFrames===false){if(this._onOverFrameName!=null){this.frameName=this._onOverFrameName}else if(this._onOverFrameID!=null){this.frame=this._onOverFrameID}}if(this.onOverSound){this.onOverSound.play(this.onOverSoundMarker)}if(this.onInputOver){this.onInputOver.dispatch(this,pointer)}};Phaser.Button.prototype.onInputOutHandler=function(pointer){if(this.freezeFrames===false){if(this._onOutFrameName!=null){this.frameName=this._onOutFrameName}else if(this._onOutFrameID!=null){this.frame=this._onOutFrameID}}if(this.onOutSound){this.onOutSound.play(this.onOutSoundMarker)}if(this.onInputOut){this.onInputOut.dispatch(this,pointer)}};Phaser.Button.prototype.onInputDownHandler=function(pointer){if(this.freezeFrames===false){if(this._onDownFrameName!=null){this.frameName=this._onDownFrameName}else if(this._onDownFrameID!=null){this.frame=this._onDownFrameID}}if(this.onDownSound){this.onDownSound.play(this.onDownSoundMarker)}if(this.onInputDown){this.onInputDown.dispatch(this,pointer)}};Phaser.Button.prototype.onInputUpHandler=function(pointer){if(this.freezeFrames===false){if(this._onUpFrameName!=null){this.frameName=this._onUpFrameName}else if(this._onUpFrameID!=null){this.frame=this._onUpFrameID}}if(this.onUpSound){this.onUpSound.play(this.onUpSoundMarker)}if(this.forceOut&&this.freezeFrames===false){if(this._onOutFrameName!=null){this.frameName=this._onOutFrameName}else if(this._onOutFrameID!=null){this.frame=this._onOutFrameID}}if(this.onInputUp){this.onInputUp.dispatch(this,pointer)}};Phaser.Graphics=function(game,x,y){this.game=game;PIXI.Graphics.call(this);this.type=Phaser.GRAPHICS;this.position.x=x;this.position.y=y};Phaser.Graphics.prototype=Object.create(PIXI.Graphics.prototype);Phaser.Graphics.prototype.constructor=Phaser.Graphics;Phaser.Graphics.prototype.destroy=function(){this.clear();if(this.group){this.group.remove(this)}this.game=null};Phaser.Graphics.prototype.drawPolygon=function(poly){this.moveTo(poly.points[0].x,poly.points[0].y);for(var i=1;i<poly.points.length;i+=1){this.lineTo(poly.points[i].x,poly.points[i].y)}this.lineTo(poly.points[0].x,poly.points[0].y)};Object.defineProperty(Phaser.Graphics.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.rotation))},set:function(value){this.rotation=Phaser.Math.degToRad(Phaser.Math.wrapAngle(value))}});Object.defineProperty(Phaser.Graphics.prototype,"x",{get:function(){return this.position.x},set:function(value){this.position.x=value}});Object.defineProperty(Phaser.Graphics.prototype,"y",{get:function(){return this.position.y},set:function(value){this.position.y=value}});Phaser.RenderTexture=function(game,key,width,height){this.game=game;this.name=key;PIXI.EventTarget.call(this);this.width=width||100;this.height=height||100;this.indetityMatrix=PIXI.mat3.create();this.frame=new PIXI.Rectangle(0,0,this.width,this.height);this.type=Phaser.RENDERTEXTURE;this._tempPoint={x:0,y:0};if(PIXI.gl){this.initWebGL()}else{this.initCanvas()}};Phaser.RenderTexture.prototype=Object.create(PIXI.Texture.prototype);Phaser.RenderTexture.prototype.constructor=PIXI.RenderTexture;Phaser.RenderTexture.prototype.render=function(displayObject,position,clear){if(typeof position==="undefined"){position=false}if(typeof clear==="undefined"){clear=false}if(displayObject instanceof Phaser.Group){displayObject=displayObject._container}if(PIXI.gl){this.renderWebGL(displayObject,position,clear)}else{this.renderCanvas(displayObject,position,clear)}};Phaser.RenderTexture.prototype.renderXY=function(displayObject,x,y,clear){this._tempPoint.x=x;this._tempPoint.y=y;this.render(displayObject,this._tempPoint,clear)};Phaser.RenderTexture.prototype.initWebGL=function(){var gl=PIXI.gl;this.glFramebuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,this.glFramebuffer);this.glFramebuffer.width=this.width;this.glFramebuffer.height=this.height;this.baseTexture=new PIXI.BaseTexture;this.baseTexture.width=this.width;this.baseTexture.height=this.height;this.baseTexture._glTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.baseTexture._glTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);this.baseTexture.isRender=true;gl.bindFramebuffer(gl.FRAMEBUFFER,this.glFramebuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.baseTexture._glTexture,0);this.projection=new PIXI.Point(this.width/2,-this.height/2)};Phaser.RenderTexture.prototype.resize=function(width,height){this.width=width;this.height=height;if(PIXI.gl){this.projection.x=this.width/2;this.projection.y=-this.height/2;var gl=PIXI.gl;gl.bindTexture(gl.TEXTURE_2D,this.baseTexture._glTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.width,this.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null)}else{this.frame.width=this.width;this.frame.height=this.height;this.renderer.resize(this.width,this.height)}};Phaser.RenderTexture.prototype.initCanvas=function(){this.renderer=new PIXI.CanvasRenderer(this.width,this.height,null,0);this.baseTexture=new PIXI.BaseTexture(this.renderer.view);this.frame=new PIXI.Rectangle(0,0,this.width,this.height)};Phaser.RenderTexture.prototype.renderWebGL=function(displayObject,position,clear){var gl=PIXI.gl;gl.colorMask(true,true,true,true);gl.viewport(0,0,this.width,this.height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.glFramebuffer);if(clear){gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT)}var children=displayObject.children;var originalWorldTransform=displayObject.worldTransform;displayObject.worldTransform=PIXI.mat3.create();displayObject.worldTransform[4]=-1;displayObject.worldTransform[5]=this.projection.y*-2;if(position){displayObject.worldTransform[2]=position.x;displayObject.worldTransform[5]-=position.y}PIXI.visibleCount++;displayObject.vcount=PIXI.visibleCount;for(var i=0,j=children.length;i<j;i++){children[i].updateTransform()}var renderGroup=displayObject.__renderGroup;if(renderGroup){if(displayObject==renderGroup.root){renderGroup.render(this.projection,this.glFramebuffer)}else{renderGroup.renderSpecific(displayObject,this.projection,this.glFramebuffer)}}else{if(!this.renderGroup){this.renderGroup=new PIXI.WebGLRenderGroup(gl)}this.renderGroup.setRenderable(displayObject);this.renderGroup.render(this.projection,this.glFramebuffer)}displayObject.worldTransform=originalWorldTransform};Phaser.RenderTexture.prototype.renderCanvas=function(displayObject,position,clear){var children=displayObject.children;displayObject.worldTransform=PIXI.mat3.create();if(position){displayObject.worldTransform[2]=position.x;displayObject.worldTransform[5]=position.y}for(var i=0,j=children.length;i<j;i++){children[i].updateTransform()}if(clear){this.renderer.context.clearRect(0,0,this.width,this.height)}this.renderer.renderDisplayObject(displayObject);this.renderer.context.setTransform(1,0,0,1,0,0)};Phaser.Canvas={create:function(width,height){width=width||256;height=height||256;var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;canvas.style.display="block";return canvas},getOffset:function(element,point){point=point||new Phaser.Point;var box=element.getBoundingClientRect();var clientTop=element.clientTop||document.body.clientTop||0;var clientLeft=element.clientLeft||document.body.clientLeft||0;var scrollTop=window.pageYOffset||element.scrollTop||document.body.scrollTop;var scrollLeft=window.pageXOffset||element.scrollLeft||document.body.scrollLeft;point.x=box.left+scrollLeft-clientLeft;point.y=box.top+scrollTop-clientTop;return point},getAspectRatio:function(canvas){return canvas.width/canvas.height},setBackgroundColor:function(canvas,color){color=color||"rgb(0,0,0)";canvas.style.backgroundColor=color;return canvas},setTouchAction:function(canvas,value){value=value||"none";canvas.style.msTouchAction=value;canvas.style["ms-touch-action"]=value;canvas.style["touch-action"]=value;return canvas},setUserSelect:function(canvas,value){value=value||"none";canvas.style["-webkit-touch-callout"]=value;canvas.style["-webkit-user-select"]=value;canvas.style["-khtml-user-select"]=value;canvas.style["-moz-user-select"]=value;canvas.style["-ms-user-select"]=value;canvas.style["user-select"]=value;canvas.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return canvas},addToDOM:function(canvas,parent,overflowHidden){var target;if(typeof overflowHidden==="undefined"){overflowHidden=true}if(parent){if(typeof parent==="string"){target=document.getElementById(parent)}else if(typeof parent==="object"&&parent.nodeType===1){target=parent}if(overflowHidden){target.style.overflow="hidden"}}if(!target){target=document.body}target.appendChild(canvas);return canvas},setTransform:function(context,translateX,translateY,scaleX,scaleY,skewX,skewY){context.setTransform(scaleX,skewX,skewY,scaleY,translateX,translateY);return context},setSmoothingEnabled:function(context,value){context["imageSmoothingEnabled"]=value;context["mozImageSmoothingEnabled"]=value;context["oImageSmoothingEnabled"]=value;context["webkitImageSmoothingEnabled"]=value;context["msImageSmoothingEnabled"]=value;return context},setImageRenderingCrisp:function(canvas){canvas.style["image-rendering"]="crisp-edges";canvas.style["image-rendering"]="-moz-crisp-edges";canvas.style["image-rendering"]="-webkit-optimize-contrast";canvas.style.msInterpolationMode="nearest-neighbor";return canvas},setImageRenderingBicubic:function(canvas){canvas.style["image-rendering"]="auto";canvas.style.msInterpolationMode="bicubic";return canvas}};Phaser.StageScaleMode=function(game,width,height){this.game=game;this.width=width;this.height=height;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this._startHeight=0;this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this.pageAlignHorizontally=false;this.pageAlignVertically=false;this._width=0;this._height=0;this.maxIterations=5;this.orientationSprite=null;this.enterLandscape=new Phaser.Signal;this.enterPortrait=new Phaser.Signal;this.enterIncorrectOrientation=new Phaser.Signal;this.leaveIncorrectOrientation=new Phaser.Signal;this.hasResized=new Phaser.Signal;if(window["orientation"]){this.orientation=window["orientation"]}else{if(window.outerWidth>window.outerHeight){this.orientation=90}else{this.orientation=0}}this.scaleFactor=new Phaser.Point(1,1);this.scaleFactorInversed=new Phaser.Point(1,1);this.margin=new Phaser.Point(0,0);this.aspectRatio=0;this.event=null;var _this=this;window.addEventListener("orientationchange",function(event){return _this.checkOrientation(event)},false);window.addEventListener("resize",function(event){return _this.checkResize(event)},false);document.addEventListener("webkitfullscreenchange",function(event){return _this.fullScreenChange(event)},false);document.addEventListener("mozfullscreenchange",function(event){return _this.fullScreenChange(event)},false);document.addEventListener("fullscreenchange",function(event){return _this.fullScreenChange(event)},false)};Phaser.StageScaleMode.EXACT_FIT=0;Phaser.StageScaleMode.NO_SCALE=1;Phaser.StageScaleMode.SHOW_ALL=2;Phaser.StageScaleMode.prototype={startFullScreen:function(antialias){if(this.isFullScreen){return}if(typeof antialias!=="undefined"){Phaser.Canvas.setSmoothingEnabled(this.game.context,antialias)}var element=this.game.canvas;this._width=this.width;this._height=this.height;console.log("startFullScreen",this._width,this._height);if(element["requestFullScreen"]){element["requestFullScreen"]()}else if(element["mozRequestFullScreen"]){element["mozRequestFullScreen"]()}else if(element["webkitRequestFullScreen"]){element["webkitRequestFullScreen"](Element.ALLOW_KEYBOARD_INPUT)}},stopFullScreen:function(){if(document["cancelFullScreen"]){document["cancelFullScreen"]()}else if(document["mozCancelFullScreen"]){document["mozCancelFullScreen"]()}else if(document["webkitCancelFullScreen"]){document["webkitCancelFullScreen"]()}},fullScreenChange:function(event){this.event=event;if(this.isFullScreen){this.game.stage.canvas.style["width"]="100%";this.game.stage.canvas.style["height"]="100%";this.setMaximum();this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height}else{this.game.stage.canvas.style["width"]=this.game.width+"px";this.game.stage.canvas.style["height"]=this.game.height+"px";this.width=this._width;this.height=this._height;this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height}},forceOrientation:function(forceLandscape,forcePortrait,orientationImage){if(typeof forcePortrait==="undefined"){forcePortrait=false}this.forceLandscape=forceLandscape;this.forcePortrait=forcePortrait;if(typeof orientationImage!=="undefined"){if(orientationImage==null||this.game.cache.checkImageKey(orientationImage)===false){orientationImage="__default"}this.orientationSprite=new PIXI.Sprite(PIXI.TextureCache[orientationImage]);this.orientationSprite.anchor.x=.5;this.orientationSprite.anchor.y=.5;this.orientationSprite.position.x=this.game.width/2;this.orientationSprite.position.y=this.game.height/2;this.checkOrientationState();if(this.incorrectOrientation){this.orientationSprite.visible=true;this.game.world.visible=false}else{this.orientationSprite.visible=false;this.game.world.visible=true}this.game.stage._stage.addChild(this.orientationSprite)}},checkOrientationState:function(){if(this.incorrectOrientation){if(this.forceLandscape&&window.innerWidth>window.innerHeight||this.forcePortrait&&window.innerHeight>window.innerWidth){this.game.paused=false;this.incorrectOrientation=false;this.leaveIncorrectOrientation.dispatch();if(this.orientationSprite){this.orientationSprite.visible=false;this.game.world.visible=true}this.refresh()}}else{if(this.forceLandscape&&window.innerWidth<window.innerHeight||this.forcePortrait&&window.innerHeight<window.innerWidth){this.game.paused=true;this.incorrectOrientation=true;this.enterIncorrectOrientation.dispatch();if(this.orientationSprite&&this.orientationSprite.visible===false){this.orientationSprite.visible=true;this.game.world.visible=false}this.refresh()}}},checkOrientation:function(event){this.event=event;this.orientation=window["orientation"];if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}if(this.game.stage.scaleMode!==Phaser.StageScaleMode.NO_SCALE){this.refresh()}},checkResize:function(event){this.event=event;if(window.outerWidth>window.outerHeight){this.orientation=90}else{this.orientation=0}if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}if(this.game.stage.scaleMode!==Phaser.StageScaleMode.NO_SCALE){this.refresh()}this.checkOrientationState()},refresh:function(){if(this.game.device.iPad===false&&this.game.device.webApp===false&&this.game.device.desktop===false){if(this.game.device.android&&this.game.device.chrome===false){window.scrollTo(0,1)}else{window.scrollTo(0,0)}}if(this._check==null&&this.maxIterations>0){this._iterations=this.maxIterations;var _this=this;this._check=window.setInterval(function(){return _this.setScreenSize()},10);this.setScreenSize()}},setScreenSize:function(force){if(typeof force=="undefined"){force=false}if(this.game.device.iPad===false&&this.game.device.webApp===false&&this.game.device.desktop===false){if(this.game.device.android&&this.game.device.chrome===false){window.scrollTo(0,1)}else{window.scrollTo(0,0)}}this._iterations--;if(force||window.innerHeight>this._startHeight||this._iterations<0){document.documentElement["style"].minHeight=window.innerHeight+"px";if(this.incorrectOrientation===true){this.setMaximum()}else if(this.game.stage.scaleMode==Phaser.StageScaleMode.EXACT_FIT){this.setExactFit()}else if(this.game.stage.scaleMode==Phaser.StageScaleMode.SHOW_ALL){this.setShowAll()}this.setSize();clearInterval(this._check);this._check=null}},setSize:function(){if(this.incorrectOrientation===false){if(this.maxWidth&&this.width>this.maxWidth){this.width=this.maxWidth}if(this.maxHeight&&this.height>this.maxHeight){this.height=this.maxHeight}if(this.minWidth&&this.width<this.minWidth){this.width=this.minWidth}if(this.minHeight&&this.height<this.minHeight){this.height=this.minHeight}}this.game.canvas.style.width=this.width+"px";this.game.canvas.style.height=this.height+"px";this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);if(this.pageAlignHorizontally){if(this.width<window.innerWidth&&this.incorrectOrientation===false){this.margin.x=Math.round((window.innerWidth-this.width)/2);this.game.canvas.style.marginLeft=this.margin.x+"px"}else{this.margin.x=0;this.game.canvas.style.marginLeft="0px"}}if(this.pageAlignVertically){if(this.height<window.innerHeight&&this.incorrectOrientation===false){this.margin.y=Math.round((window.innerHeight-this.height)/2);this.game.canvas.style.marginTop=this.margin.y+"px"}else{this.margin.y=0;this.game.canvas.style.marginTop="0px"}}Phaser.Canvas.getOffset(this.game.canvas,this.game.stage.offset);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.hasResized.dispatch(this.width,this.height);this.checkOrientationState()},setMaximum:function(){this.width=window.innerWidth;this.height=window.innerHeight},setShowAll:function(){var multiplier=Math.min(window.innerHeight/this.game.height,window.innerWidth/this.game.width);this.width=Math.round(this.game.width*multiplier);this.height=Math.round(this.game.height*multiplier)},setExactFit:function(){var availableWidth=window.innerWidth;var availableHeight=window.innerHeight;if(this.maxWidth&&availableWidth>this.maxWidth){this.width=this.maxWidth}else{this.width=availableWidth}if(this.maxHeight&&availableHeight>this.maxHeight){this.height=this.maxHeight}else{this.height=availableHeight}}};Object.defineProperty(Phaser.StageScaleMode.prototype,"isFullScreen",{get:function(){return document["fullscreenElement"]||document["mozFullScreenElement"]||document["webkitFullscreenElement"]}});Object.defineProperty(Phaser.StageScaleMode.prototype,"isPortrait",{get:function(){return this.orientation===0||this.orientation==180}});Object.defineProperty(Phaser.StageScaleMode.prototype,"isLandscape",{get:function(){return this.orientation===90||this.orientation===-90}});Phaser.Device=function(){this.patchAndroidClearRectBug=false;this.desktop=false;this.iOS=false;this.cocoonJS=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.canvas=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.webGL=false;this.worker=false;this.touch=false;this.mspointer=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.arora=false;this.chrome=false;this.epiphany=false;this.firefox=false;this.ie=false;this.ieVersion=0;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.webApp=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this._checkAudio();this._checkBrowser();this._checkCSS3D();this._checkDevice();this._checkFeatures();this._checkOS()};Phaser.Device.prototype={_checkOS:function(){var ua=navigator.userAgent;if(/Android/.test(ua)){this.android=true}else if(/CrOS/.test(ua)){this.chromeOS=true}else if(/iP[ao]d|iPhone/i.test(ua)){this.iOS=true}else if(/Linux/.test(ua)){this.linux=true}else if(/Mac OS/.test(ua)){this.macOS=true}else if(/Windows/.test(ua)){this.windows=true}if(this.windows||this.macOS||this.linux){this.desktop=true}},_checkFeatures:function(){this.canvas=!!window["CanvasRenderingContext2D"];try{this.localStorage=!!localStorage.getItem}catch(error){this.localStorage=false}this.file=!!window["File"]&&!!window["FileReader"]&&!!window["FileList"]&&!!window["Blob"];this.fileSystem=!!window["requestFileSystem"];this.webGL=function(){try{var canvas=document.createElement("canvas");return!!window.WebGLRenderingContext&&(canvas.getContext("webgl")||canvas.getContext("experimental-webgl"))}catch(e){return false}}();if(this.webGL===null||this.webGL===false){this.webGL=false}else{this.webGL=true}this.worker=!!window["Worker"];if("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1){this.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){this.mspointer=true}this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document},_checkBrowser:function(){var ua=navigator.userAgent;if(/Arora/.test(ua)){this.arora=true}else if(/Chrome/.test(ua)){this.chrome=true}else if(/Epiphany/.test(ua)){this.epiphany=true}else if(/Firefox/.test(ua)){this.firefox=true}else if(/Mobile Safari/.test(ua)){this.mobileSafari=true}else if(/MSIE (\d+\.\d+);/.test(ua)){this.ie=true;this.ieVersion=parseInt(RegExp.$1,10)}else if(/Midori/.test(ua)){this.midori=true}else if(/Opera/.test(ua)){this.opera=true}else if(/Safari/.test(ua)){this.safari=true}if(navigator["standalone"]){this.webApp=true}if(navigator["isCocoonJS"]){this.cocoonJS=true}},_checkAudio:function(){this.audioData=!!window["Audio"];this.webAudio=!!(window["webkitAudioContext"]||window["AudioContext"]);var audioElement=document.createElement("audio");var result=false;try{if(result=!!audioElement.canPlayType){if(audioElement.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){this.ogg=true}if(audioElement.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")){this.opus=true}if(audioElement.canPlayType("audio/mpeg;").replace(/^no$/,"")){this.mp3=true}if(audioElement.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){this.wav=true}if(audioElement.canPlayType("audio/x-m4a;")||audioElement.canPlayType("audio/aac;").replace(/^no$/,"")){this.m4a=true}if(audioElement.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){this.webm=true}}}catch(e){}},_checkDevice:function(){this.pixelRatio=window["devicePixelRatio"]||1;this.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;this.iPhone4=this.pixelRatio==2&&this.iPhone;this.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;if(typeof Int8Array!=="undefined"){this.littleEndian=new Int8Array(new Int16Array([1]).buffer)[0]>0;this.typedArray=true}else{this.littleEndian=false;this.typedArray=false}},_checkCSS3D:function(){var el=document.createElement("p");var has3d;var transforms={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(el,null);for(var t in transforms){if(el.style[t]!==undefined){el.style[t]="translate3d(1px,1px,1px)";has3d=window.getComputedStyle(el).getPropertyValue(transforms[t])}}document.body.removeChild(el);this.css3D=has3d!==undefined&&has3d.length>0&&has3d!=="none"},canPlayAudio:function(type){if(type=="mp3"&&this.mp3){return true}else if(type=="ogg"&&(this.ogg||this.opus)){return true}else if(type=="m4a"&&this.m4a){return true}else if(type=="wav"&&this.wav){return true}else if(type=="webm"&&this.webm){return true}return false},isConsoleOpen:function(){if(window.console&&window.console["firebug"]){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}return console["profiles"].length>0}return false}};Phaser.RequestAnimationFrame=function(game){this.game=game;this.isRunning=false;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;x++){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};Phaser.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var _this=this;if(!window.requestAnimationFrame){this._isSetTimeOut=true;this._onLoop=function(){return _this.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(time){return _this.updateRAF(time)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(time){this.game.update(time);this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===false}};Phaser.RandomDataGenerator=function(seeds){if(typeof seeds==="undefined"){seeds=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(seeds)};Phaser.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=t|0;this.s0=this.s1;this.s1=this.s2;this.s2=t-this.c;return this.s2},sow:function(seeds){if(typeof seeds==="undefined"){seeds=[]}this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;var seed;for(var i=0;seed=seeds[i++];){this.s0-=this.hash(seed);this.s0+=~~(this.s0<0);this.s1-=this.hash(seed);this.s1+=~~(this.s1<0);this.s2-=this.hash(seed);this.s2+=~~(this.s2<0)}},hash:function(data){var h,i,n;n=4022871197;data=data.toString();for(i=0;i<data.length;i++){n+=data.charCodeAt(i);h=.02519603282416938*n;n=h>>>0;h-=n;h*=n;n=h>>>0;h-=n;n+=h*4294967296}return(n>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(min,max){return Math.floor(this.realInRange(min,max))},realInRange:function(min,max){return this.frac()*(max-min)+min},normal:function(){return 1-2*this.frac()},uuid:function(){var a="";var b="";for(b=a="";a++<36;b+=~a%5|a*3&4?(a^15?8^this.frac()*(a^20?16:4):4).toString(16):"-"){}return b},pick:function(ary){return ary[this.integerInRange(0,ary.length)]},weightedPick:function(ary){return ary[~~(Math.pow(this.frac(),2)*ary.length)]},timestamp:function(min,max){return this.realInRange(min||9466848e5,max||1577862e6)},angle:function(){return this.integerInRange(-180,180)}};Phaser.Math={PI2:Math.PI*2,fuzzyEqual:function(a,b,epsilon){if(typeof epsilon==="undefined"){epsilon=1e-4}return Math.abs(a-b)<epsilon},fuzzyLessThan:function(a,b,epsilon){if(typeof epsilon==="undefined"){epsilon=1e-4}return a<b+epsilon},fuzzyGreaterThan:function(a,b,epsilon){if(typeof epsilon==="undefined"){epsilon=1e-4}return a>b-epsilon},fuzzyCeil:function(val,epsilon){if(typeof epsilon==="undefined"){epsilon=1e-4}return Math.ceil(val-epsilon)},fuzzyFloor:function(val,epsilon){if(typeof epsilon==="undefined"){epsilon=1e-4}return Math.floor(val+epsilon)},average:function(){var args=[];for(var _i=0;_i<arguments.length-0;_i++){args[_i]=arguments[_i+0]}var avg=0;for(var i=0;i<args.length;i++){avg+=args[i]}return avg/args.length},truncate:function(n){return n>0?Math.floor(n):Math.ceil(n)},shear:function(n){return n%1},snapTo:function(input,gap,start){if(typeof start==="undefined"){start=0}if(gap===0){return input}input-=start;input=gap*Math.round(input/gap);return start+input},snapToFloor:function(input,gap,start){if(typeof start==="undefined"){start=0}if(gap===0){return input}input-=start;input=gap*Math.floor(input/gap);return start+input},snapToCeil:function(input,gap,start){if(typeof start==="undefined"){start=0}if(gap===0){return input}input-=start;input=gap*Math.ceil(input/gap);return start+input},snapToInArray:function(input,arr,sort){if(typeof sort==="undefined"){sort=true}if(sort){arr.sort()}if(input<arr[0]){return arr[0]}var i=1;while(arr[i]<input){i++}var low=arr[i-1];var high=i<arr.length?arr[i]:Number.POSITIVE_INFINITY;return high-input<=input-low?high:low},roundTo:function(value,place,base){if(typeof place==="undefined"){place=0}if(typeof base==="undefined"){base=10}var p=Math.pow(base,-place);return Math.round(value*p)/p},floorTo:function(value,place,base){if(typeof place==="undefined"){place=0}if(typeof base==="undefined"){base=10}var p=Math.pow(base,-place);return Math.floor(value*p)/p},ceilTo:function(value,place,base){if(typeof place==="undefined"){place=0}if(typeof base==="undefined"){base=10}var p=Math.pow(base,-place);return Math.ceil(value*p)/p},interpolateFloat:function(a,b,weight){return(b-a)*weight+a
},angleBetween:function(x1,y1,x2,y2){return Math.atan2(y2-y1,x2-x1)},normalizeAngle:function(angle,radians){if(typeof radians==="undefined"){radians=true}var rd=radians?Math.PI:180;return this.wrap(angle,-rd,rd)},nearestAngleBetween:function(a1,a2,radians){if(typeof radians==="undefined"){radians=true}var rd=radians?Math.PI:180;a1=this.normalizeAngle(a1,radians);a2=this.normalizeAngle(a2,radians);if(a1<-rd/2&&a2>rd/2){a1+=rd*2}if(a2<-rd/2&&a1>rd/2){a2+=rd*2}return a2-a1},interpolateAngles:function(a1,a2,weight,radians,ease){if(typeof radians==="undefined"){radians=true}if(typeof ease==="undefined"){ease=null}a1=this.normalizeAngle(a1,radians);a2=this.normalizeAngleToAnother(a2,a1,radians);return typeof ease==="function"?ease(weight,a1,a2-a1,1):this.interpolateFloat(a1,a2,weight)},chanceRoll:function(chance){if(typeof chance==="undefined"){chance=50}if(chance<=0){return false}else if(chance>=100){return true}else{if(Math.random()*100>=chance){return false}else{return true}}},numberArray:function(min,max){var result=[];for(var i=min;i<=max;i++){result.push(i)}return result},maxAdd:function(value,amount,max){value+=amount;if(value>max){value=max}return value},minSub:function(value,amount,min){value-=amount;if(value<min){value=min}return value},wrap:function(value,min,max){var range=max-min;if(range<=0){return 0}var result=(value-min)%range;if(result<0){result+=range}return result+min},wrapValue:function(value,amount,max){var diff;value=Math.abs(value);amount=Math.abs(amount);max=Math.abs(max);diff=(value+amount)%max;return diff},randomSign:function(){return Math.random()>.5?1:-1},isOdd:function(n){return n&1},isEven:function(n){if(n&1){return false}else{return true}},max:function(){for(var i=1,max=0,len=arguments.length;i<len;i++){if(arguments[max]<arguments[i]){max=i}}return arguments[max]},min:function(){for(var i=1,min=0,len=arguments.length;i<len;i++){if(arguments[i]<arguments[min]){min=i}}return arguments[min]},wrapAngle:function(angle){return this.wrap(angle,-180,180)},angleLimit:function(angle,min,max){var result=angle;if(angle>max){result=max}else if(angle<min){result=min}return result},linearInterpolation:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);if(k<0){return this.linear(v[0],v[1],f)}if(k>1){return this.linear(v[m],v[m-1],m-f)}return this.linear(v[i],v[i+1>m?m:i+1],f-i)},bezierInterpolation:function(v,k){var b=0;var n=v.length-1;for(var i=0;i<=n;i++){b+=Math.pow(1-k,n-i)*Math.pow(k,i)*v[i]*this.bernstein(n,i)}return b},catmullRomInterpolation:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);if(v[0]===v[m]){if(k<0){i=Math.floor(f=m*(1+k))}return this.catmullRom(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)}else{if(k<0){return v[0]-(this.catmullRom(v[0],v[0],v[1],v[1],-f)-v[0])}if(k>1){return v[m]-(this.catmullRom(v[m],v[m],v[m-1],v[m-1],f-m)-v[m])}return this.catmullRom(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)}},linear:function(p0,p1,t){return(p1-p0)*t+p0},bernstein:function(n,i){return this.factorial(n)/this.factorial(i)/this.factorial(n-i)},catmullRom:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5,v1=(p3-p1)*.5,t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1},difference:function(a,b){return Math.abs(a-b)},getRandom:function(objects,startIndex,length){if(typeof startIndex==="undefined"){startIndex=0}if(typeof length==="undefined"){length=0}if(objects!=null){var l=length;if(l===0||l>objects.length-startIndex){l=objects.length-startIndex}if(l>0){return objects[startIndex+Math.floor(Math.random()*l)]}}return null},floor:function(value){var n=value|0;return value>0?n:n!=value?n-1:n},ceil:function(value){var n=value|0;return value>0?n!=value?n+1:n:n},sinCosGenerator:function(length,sinAmplitude,cosAmplitude,frequency){if(typeof sinAmplitude==="undefined"){sinAmplitude=1}if(typeof cosAmplitude==="undefined"){cosAmplitude=1}if(typeof frequency==="undefined"){frequency=1}var sin=sinAmplitude;var cos=cosAmplitude;var frq=frequency*Math.PI/length;var cosTable=[];var sinTable=[];for(var c=0;c<length;c++){cos-=sin*frq;sin+=cos*frq;cosTable[c]=cos;sinTable[c]=sin}return{sin:sinTable,cos:cosTable,length:length}},shift:function(stack){var s=stack.shift();stack.push(s);return s},shuffleArray:function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array},distance:function(x1,y1,x2,y2){var dx=x1-x2;var dy=y1-y2;return Math.sqrt(dx*dx+dy*dy)},distanceRounded:function(x1,y1,x2,y2){return Math.round(Phaser.Math.distance(x1,y1,x2,y2))},clamp:function(x,a,b){return x<a?a:x>b?b:x},clampBottom:function(x,a){return x<a?a:x},within:function(a,b,tolerance){return Math.abs(a-b)<=tolerance},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},smoothstep:function(x,min,max){if(x<=min){return 0}if(x>=max){return 1}x=(x-min)/(max-min);return x*x*(3-2*x)},smootherstep:function(x,min,max){if(x<=min){return 0}if(x>=max){return 1}x=(x-min)/(max-min);return x*x*x*(x*(x*6-15)+10)},sign:function(x){return x<0?-1:x>0?1:0},degToRad:function(){var degreeToRadiansFactor=Math.PI/180;return function(degrees){return degrees*degreeToRadiansFactor}}(),radToDeg:function(){var radianToDegreesFactor=180/Math.PI;return function(radians){return radians*radianToDegreesFactor}}()};Phaser.QuadTree=function(physicsManager,x,y,width,height,maxObjects,maxLevels,level){this.physicsManager=physicsManager;this.ID=physicsManager.quadTreeID;physicsManager.quadTreeID++;this.maxObjects=maxObjects||10;this.maxLevels=maxLevels||4;this.level=level||0;this.bounds={x:Math.round(x),y:Math.round(y),width:width,height:height,subWidth:Math.floor(width/2),subHeight:Math.floor(height/2),right:Math.round(x)+Math.floor(width/2),bottom:Math.round(y)+Math.floor(height/2)};this.objects=[];this.nodes=[]};Phaser.QuadTree.prototype={split:function(){this.level++;this.nodes[0]=new Phaser.QuadTree(this.physicsManager,this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[1]=new Phaser.QuadTree(this.physicsManager,this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[2]=new Phaser.QuadTree(this.physicsManager,this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[3]=new Phaser.QuadTree(this.physicsManager,this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level)},insert:function(body){var i=0;var index;if(this.nodes[0]!=null){index=this.getIndex(body);if(index!==-1){this.nodes[index].insert(body);return}}this.objects.push(body);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(i<this.objects.length){index=this.getIndex(this.objects[i]);if(index!==-1){this.nodes[index].insert(this.objects.splice(i,1)[0])}else{i++}}}},getIndex:function(rect){var index=-1;if(rect.x<this.bounds.right&&rect.right<this.bounds.right){if(rect.y<this.bounds.bottom&&rect.bottom<this.bounds.bottom){index=1}else if(rect.y>this.bounds.bottom){index=2}}else if(rect.x>this.bounds.right){if(rect.y<this.bounds.bottom&&rect.bottom<this.bounds.bottom){index=0}else if(rect.y>this.bounds.bottom){index=3}}return index},retrieve:function(sprite){var returnObjects=this.objects;sprite.body.quadTreeIndex=this.getIndex(sprite.body);sprite.body.quadTreeIDs.push(this.ID);if(this.nodes[0]){if(sprite.body.quadTreeIndex!==-1){returnObjects=returnObjects.concat(this.nodes[sprite.body.quadTreeIndex].retrieve(sprite))}else{returnObjects=returnObjects.concat(this.nodes[0].retrieve(sprite));returnObjects=returnObjects.concat(this.nodes[1].retrieve(sprite));returnObjects=returnObjects.concat(this.nodes[2].retrieve(sprite));returnObjects=returnObjects.concat(this.nodes[3].retrieve(sprite))}}return returnObjects},clear:function(){this.objects=[];for(var i=0,len=this.nodes.length;i<len;i++){if(this.nodes[i]){this.nodes[i].clear();delete this.nodes[i]}}}};Phaser.Circle=function(x,y,diameter){x=x||0;y=y||0;diameter=diameter||0;this.x=x;this.y=y;this._diameter=diameter;if(diameter>0){this._radius=diameter*.5}else{this._radius=0}};Phaser.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},setTo:function(x,y,diameter){this.x=x;this.y=y;this._diameter=diameter;this._radius=diameter*.5;return this},copyFrom:function(source){return this.setTo(source.x,source.y,source.diameter)},copyTo:function(dest){dest.x=this.x;dest.y=this.y;dest.diameter=this._diameter;return dest},distance:function(dest,round){if(typeof round==="undefined"){round=false}if(round){return Phaser.Math.distanceRound(this.x,this.y,dest.x,dest.y)}else{return Phaser.Math.distance(this.x,this.y,dest.x,dest.y)}},clone:function(out){if(typeof out==="undefined"){out=new Phaser.Circle}return out.setTo(this.x,this.y,this.diameter)},contains:function(x,y){return Phaser.Circle.contains(this,x,y)},circumferencePoint:function(angle,asDegrees,out){return Phaser.Circle.circumferencePoint(this,angle,asDegrees,out)},offset:function(dx,dy){this.x+=dx;this.y+=dy;return this},offsetPoint:function(point){return this.offset(point.x,point.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};Object.defineProperty(Phaser.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(value){if(value>0){this._diameter=value;this._radius=value*.5}}});Object.defineProperty(Phaser.Circle.prototype,"radius",{get:function(){return this._radius},set:function(value){if(value>0){this._radius=value;this._diameter=value*2}}});Object.defineProperty(Phaser.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(value){if(value>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-value}}});Object.defineProperty(Phaser.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(value){if(value<this.x){this._radius=0;this._diameter=0}else{this.radius=value-this.x}}});Object.defineProperty(Phaser.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(value){if(value>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-value}}});Object.defineProperty(Phaser.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(value){if(value<this.y){this._radius=0;this._diameter=0}else{this.radius=value-this.y}}});Object.defineProperty(Phaser.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(Phaser.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(value){if(value===true){this.setTo(0,0,0)}}});Phaser.Circle.contains=function(a,x,y){if(x>=a.left&&x<=a.right&&y>=a.top&&y<=a.bottom){var dx=(a.x-x)*(a.x-x);var dy=(a.y-y)*(a.y-y);return dx+dy<=a.radius*a.radius}return false};Phaser.Circle.equals=function(a,b){return a.x==b.x&&a.y==b.y&&a.diameter==b.diameter};Phaser.Circle.intersects=function(a,b){return Phaser.Math.distance(a.x,a.y,b.x,b.y)<=a.radius+b.radius};Phaser.Circle.circumferencePoint=function(a,angle,asDegrees,out){if(typeof asDegrees==="undefined"){asDegrees=false}if(typeof out==="undefined"){out=new Phaser.Point}if(asDegrees===true){angle=Phaser.Math.radToDeg(angle)}out.x=a.x+a.radius*Math.cos(angle);out.y=a.y+a.radius*Math.sin(angle);return out};Phaser.Circle.intersectsRectangle=function(c,r){var cx=Math.abs(c.x-r.x-r.halfWidth);var xDist=r.halfWidth+c.radius;if(cx>xDist){return false}var cy=Math.abs(c.y-r.y-r.halfHeight);var yDist=r.halfHeight+c.radius;if(cy>yDist){return false}if(cx<=r.halfWidth||cy<=r.halfHeight){return true}var xCornerDist=cx-r.halfWidth;var yCornerDist=cy-r.halfHeight;var xCornerDistSq=xCornerDist*xCornerDist;var yCornerDistSq=yCornerDist*yCornerDist;var maxCornerDistSq=c.radius*c.radius;return xCornerDistSq+yCornerDistSq<=maxCornerDistSq};Phaser.Point=function(x,y){x=x||0;y=y||0;this.x=x;this.y=y};Phaser.Point.prototype={copyFrom:function(source){return this.setTo(source.x,source.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(x,y){this.x=x;this.y=y;return this},add:function(x,y){this.x+=x;this.y+=y;return this},subtract:function(x,y){this.x-=x;this.y-=y;return this},multiply:function(x,y){this.x*=x;this.y*=y;return this},divide:function(x,y){this.x/=x;this.y/=y;return this},clampX:function(min,max){this.x=Phaser.Math.clamp(this.x,min,max);return this},clampY:function(min,max){this.y=Phaser.Math.clamp(this.y,min,max);return this},clamp:function(min,max){this.x=Phaser.Math.clamp(this.x,min,max);this.y=Phaser.Math.clamp(this.y,min,max);return this},clone:function(output){if(typeof output==="undefined"){output=new Phaser.Point}return output.setTo(this.x,this.y)},copyTo:function(dest){dest.x=this.x;dest.y=this.y;return dest},distance:function(dest,round){return Phaser.Point.distance(this,dest,round)},equals:function(a){return a.x==this.x&&a.y==this.y},rotate:function(x,y,angle,asDegrees,distance){return Phaser.Point.rotate(this,x,y,angle,asDegrees,distance)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setMagnitude:function(magnitude){return this.normalize().multiply(magnitude,magnitude)},normalize:function(){if(!this.isZero()){var m=this.getMagnitude();this.x/=m;this.y/=m}return this},isZero:function(){return this.x===0&&this.y===0},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};Phaser.Point.add=function(a,b,out){if(typeof out==="undefined"){out=new Phaser.Point}out.x=a.x+b.x;out.y=a.y+b.y;return out};Phaser.Point.subtract=function(a,b,out){if(typeof out==="undefined"){out=new Phaser.Point}out.x=a.x-b.x;out.y=a.y-b.y;return out};Phaser.Point.multiply=function(a,b,out){if(typeof out==="undefined"){out=new Phaser.Point}out.x=a.x*b.x;out.y=a.y*b.y;return out};Phaser.Point.divide=function(a,b,out){if(typeof out==="undefined"){out=new Phaser.Point}out.x=a.x/b.x;out.y=a.y/b.y;return out};Phaser.Point.equals=function(a,b){return a.x==b.x&&a.y==b.y};Phaser.Point.distance=function(a,b,round){if(typeof round==="undefined"){round=false}if(round){return Phaser.Math.distanceRound(a.x,a.y,b.x,b.y)}else{return Phaser.Math.distance(a.x,a.y,b.x,b.y)}};Phaser.Point.rotate=function(a,x,y,angle,asDegrees,distance){asDegrees=asDegrees||false;distance=distance||null;if(asDegrees){angle=Phaser.Math.degToRad(angle)}if(distance===null){distance=Math.sqrt((x-a.x)*(x-a.x)+(y-a.y)*(y-a.y))}return a.setTo(x+distance*Math.cos(angle),y+distance*Math.sin(angle))};Phaser.Rectangle=function(x,y,width,height){x=x||0;y=y||0;width=width||0;height=height||0;this.x=x;this.y=y;this.width=width;this.height=height};Phaser.Rectangle.prototype={offset:function(dx,dy){this.x+=dx;this.y+=dy;return this},offsetPoint:function(point){return this.offset(point.x,point.y)},setTo:function(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(source){return this.setTo(source.x,source.y,source.width,source.height)},copyTo:function(dest){dest.x=this.x;dest.y=this.y;dest.width=this.width;dest.height=this.height;return dest},inflate:function(dx,dy){return Phaser.Rectangle.inflate(this,dx,dy)},size:function(output){return Phaser.Rectangle.size(this,output)},clone:function(output){return Phaser.Rectangle.clone(this,output)},contains:function(x,y){return Phaser.Rectangle.contains(this,x,y)},containsRect:function(b){return Phaser.Rectangle.containsRect(this,b)},equals:function(b){return Phaser.Rectangle.equals(this,b)},intersection:function(b,out){return Phaser.Rectangle.intersection(this,b,out)},intersects:function(b,tolerance){return Phaser.Rectangle.intersects(this,b,tolerance)},intersectsRaw:function(left,right,top,bottom,tolerance){return Phaser.Rectangle.intersectsRaw(this,left,right,top,bottom,tolerance)},union:function(b,out){return Phaser.Rectangle.union(this,b,out)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(Phaser.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(Phaser.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(Phaser.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(value){if(value<=this.y){this.height=0}else{this.height=this.y-value}}});Object.defineProperty(Phaser.Rectangle.prototype,"bottomRight",{get:function(){return new Phaser.Point(this.right,this.bottom)},set:function(value){this.right=value.x;this.bottom=value.y}});Object.defineProperty(Phaser.Rectangle.prototype,"left",{get:function(){return this.x},set:function(value){if(value>=this.right){this.width=0}else{this.width=this.right-value}this.x=value}});Object.defineProperty(Phaser.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(value){if(value<=this.x){this.width=0}else{this.width=this.x+value}}});Object.defineProperty(Phaser.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(Phaser.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}});Object.defineProperty(Phaser.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(value){this.x=value-this.halfWidth}});Object.defineProperty(Phaser.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(value){this.y=value-this.halfHeight}});Object.defineProperty(Phaser.Rectangle.prototype,"top",{get:function(){return this.y},set:function(value){if(value>=this.bottom){this.height=0;this.y=value}else{this.height=this.bottom-value}}});Object.defineProperty(Phaser.Rectangle.prototype,"topLeft",{get:function(){return new Phaser.Point(this.x,this.y)},set:function(value){this.x=value.x;this.y=value.y}});Object.defineProperty(Phaser.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(value){if(value===true){this.setTo(0,0,0,0)}}});Phaser.Rectangle.inflate=function(a,dx,dy){a.x-=dx;a.width+=2*dx;a.y-=dy;a.height+=2*dy;return a};Phaser.Rectangle.inflatePoint=function(a,point){return Phaser.Rectangle.inflate(a,point.x,point.y)};Phaser.Rectangle.size=function(a,output){if(typeof output==="undefined"){output=new Phaser.Point}return output.setTo(a.width,a.height)};Phaser.Rectangle.clone=function(a,output){if(typeof output==="undefined"){output=new Phaser.Rectangle}return output.setTo(a.x,a.y,a.width,a.height)};Phaser.Rectangle.contains=function(a,x,y){return x>=a.x&&x<=a.right&&y>=a.y&&y<=a.bottom};Phaser.Rectangle.containsRaw=function(rx,ry,rw,rh,x,y){return x>=rx&&x<=rx+rw&&y>=ry&&y<=ry+rh};Phaser.Rectangle.containsPoint=function(a,point){return Phaser.Rectangle.contains(a,point.x,point.y)};Phaser.Rectangle.containsRect=function(a,b){if(a.volume>b.volume){return false}return a.x>=b.x&&a.y>=b.y&&a.right<=b.right&&a.bottom<=b.bottom};Phaser.Rectangle.equals=function(a,b){return a.x==b.x&&a.y==b.y&&a.width==b.width&&a.height==b.height};Phaser.Rectangle.intersection=function(a,b,out){out=out||new Phaser.Rectangle;if(Phaser.Rectangle.intersects(a,b)){out.x=Math.max(a.x,b.x);out.y=Math.max(a.y,b.y);out.width=Math.min(a.right,b.right)-out.x;out.height=Math.min(a.bottom,b.bottom)-out.y}return out};Phaser.Rectangle.intersects=function(a,b){return a.x<b.right&&b.x<a.right&&a.y<b.bottom&&b.y<a.bottom};Phaser.Rectangle.intersectsRaw=function(a,left,right,top,bottom,tolerance){if(typeof tolerance==="undefined"){tolerance=0}return!(left>a.right+tolerance||right<a.left-tolerance||top>a.bottom+tolerance||bottom<a.top-tolerance)};Phaser.Rectangle.union=function(a,b,out){if(typeof out==="undefined"){out=new Phaser.Rectangle}return out.setTo(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.max(a.right,b.right)-Math.min(a.left,b.left),Math.max(a.bottom,b.bottom)-Math.min(a.top,b.top))};Phaser.Polygon=function(points){PIXI.Polygon.call(this,points);this.type=Phaser.POLYGON};Phaser.Polygon.prototype=Object.create(PIXI.Polygon.prototype);Phaser.Polygon.prototype.constructor=Phaser.Polygon;Phaser.Net=function(game){this.game=game};Phaser.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(domain){return window.location.hostname.indexOf(domain)!==-1},updateQueryString:function(key,value,redirect,url){if(typeof redirect==="undefined"){redirect=false}if(typeof url==="undefined"||url===""){url=window.location.href}var output="";var re=new RegExp("([?|&])"+key+"=.*?(&|#|$)(.*)","gi");if(re.test(url)){if(typeof value!=="undefined"&&value!==null){output=url.replace(re,"$1"+key+"="+value+"$2$3")}else{output=url.replace(re,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof value!=="undefined"&&value!==null){var separator=url.indexOf("?")!==-1?"&":"?";var hash=url.split("#");url=hash[0]+separator+key+"="+value;if(hash[1]){url+="#"+hash[1]}output=url}else{output=url}}if(redirect){window.location.href=output}else{return output}},getQueryString:function(parameter){if(typeof parameter==="undefined"){parameter=""}var output={};var keyValues=location.search.substring(1).split("&");for(var i in keyValues){var key=keyValues[i].split("=");if(key.length>1){if(parameter&&parameter==this.decodeURI(key[0])){return this.decodeURI(key[1])}else{output[this.decodeURI(key[0])]=this.decodeURI(key[1])}}}return output},decodeURI:function(value){return decodeURIComponent(value.replace(/\+/g," "))}};Phaser.TweenManager=function(game){this.game=game;this._tweens=[];this._add=[];this.game.onPause.add(this.pauseAll,this);this.game.onResume.add(this.resumeAll,this)};Phaser.TweenManager.prototype={REVISION:"11dev",getAll:function(){return this._tweens},removeAll:function(){this._tweens=[]},add:function(tween){this._add.push(tween)},create:function(object){return new Phaser.Tween(object,this.game)},remove:function(tween){var i=this._tweens.indexOf(tween);if(i!==-1){this._tweens[i].pendingDelete=true}},update:function(){if(this._tweens.length===0&&this._add.length===0){return false}var i=0;var numTweens=this._tweens.length;while(i<numTweens){if(this._tweens[i].update(this.game.time.now)){i++}else{this._tweens.splice(i,1);numTweens--}}if(this._add.length>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(object){return this._tweens.some(function(tween){return tween._object===object})},pauseAll:function(){for(var i=this._tweens.length-1;i>=0;i--){this._tweens[i].pause()}},resumeAll:function(){for(var i=this._tweens.length-1;i>=0;i--){this._tweens[i].resume()}}};Phaser.Tween=function(object,game){this._object=object;this.game=game;this._manager=this.game.tweens;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1e3;this._repeat=0;this._yoyo=false;this._reversed=false;this._delayTime=0;this._startTime=null;this._easingFunction=Phaser.Easing.Linear.None;this._interpolationFunction=Phaser.Math.linearInterpolation;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=false;this._onUpdateCallback=null;this._onCompleteCallback=null;this._pausedTime=0;this.pendingDelete=false;for(var field in object){this._valuesStart[field]=parseFloat(object[field],10)}this.onStart=new Phaser.Signal;this.onComplete=new Phaser.Signal;this.isRunning=false};Phaser.Tween.prototype={to:function(properties,duration,ease,autoStart,delay,repeat,yoyo){duration=duration||1e3;ease=ease||null;autoStart=autoStart||false;delay=delay||0;repeat=repeat||0;yoyo=yoyo||false;var self;if(this._parent){self=this._manager.create(this._object);this._lastChild.chain(self);this._lastChild=self}else{self=this;this._parent=this;this._lastChild=this}self._repeat=repeat;self._duration=duration;self._valuesEnd=properties;if(ease!==null){self._easingFunction=ease}if(delay>0){self._delayTime=delay}self._yoyo=yoyo;if(autoStart){return this.start()}else{return this}},start:function(){if(this.game===null||this._object===null){return}this._manager.add(this);this.onStart.dispatch(this._object);this.isRunning=true;this._onStartCallbackFired=false;this._startTime=this.game.time.now+this._delayTime;for(var property in this._valuesEnd){if(this._valuesEnd[property]instanceof Array){if(this._valuesEnd[property].length===0){continue}this._valuesEnd[property]=[this._object[property]].concat(this._valuesEnd[property])}this._valuesStart[property]=this._object[property];if(this._valuesStart[property]instanceof Array===false){this._valuesStart[property]*=1}this._valuesStartRepeat[property]=this._valuesStart[property]||0}return this},stop:function(){this.isRunning=false;this._manager.remove(this);return this},delay:function(amount){this._delayTime=amount;return this},repeat:function(times){this._repeat=times;return this},yoyo:function(yoyo){this._yoyo=yoyo;return this},easing:function(easing){this._easingFunction=easing;return this},interpolation:function(interpolation){this._interpolationFunction=interpolation;return this},chain:function(){this._chainedTweens=arguments;return this},loop:function(){this._lastChild.chain(this);return this},onStartCallback:function(callback){this._onStartCallback=callback;return this},onUpdateCallback:function(callback){this._onUpdateCallback=callback;return this},onCompleteCallback:function(callback){this._onCompleteCallback=callback;return this},pause:function(){this._paused=true;this._pausedTime=this.game.time.now},resume:function(){this._paused=false;this._startTime+=this.game.time.now-this._pausedTime},update:function(time){if(this.pendingDelete){return false}if(this._paused||time<this._startTime){return true}var property;if(time<this._startTime){return true}if(this._onStartCallbackFired===false){if(this._onStartCallback!==null){this._onStartCallback.call(this._object)}this._onStartCallbackFired=true}var elapsed=(time-this._startTime)/this._duration;elapsed=elapsed>1?1:elapsed;var value=this._easingFunction(elapsed);for(property in this._valuesEnd){var start=this._valuesStart[property]||0;var end=this._valuesEnd[property];if(end instanceof Array){this._object[property]=this._interpolationFunction(end,value)}else{if(typeof end==="string"){end=start+parseFloat(end,10)}if(typeof end==="number"){this._object[property]=start+(end-start)*value}}}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._object,value)}if(elapsed==1){if(this._repeat>0){if(isFinite(this._repeat)){this._repeat--}for(property in this._valuesStartRepeat){if(typeof this._valuesEnd[property]==="string"){this._valuesStartRepeat[property]=this._valuesStartRepeat[property]+parseFloat(this._valuesEnd[property],10)}if(this._yoyo){var tmp=this._valuesStartRepeat[property];this._valuesStartRepeat[property]=this._valuesEnd[property];this._valuesEnd[property]=tmp;this._reversed=!this._reversed}this._valuesStart[property]=this._valuesStartRepeat[property]}this._startTime=time+this._delayTime;this.onComplete.dispatch(this._object);if(this._onCompleteCallback!==null){this._onCompleteCallback.call(this._object)}return true}else{this.isRunning=false;this.onComplete.dispatch(this._object);if(this._onCompleteCallback!==null){this._onCompleteCallback.call(this._object)}for(var i=0,numChainedTweens=this._chainedTweens.length;i<numChainedTweens;i++){this._chainedTweens[i].start(time)}return false}}return true}};Phaser.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){if((k*=2)<1)return.5*k*k;return-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){if((k*=2)<1)return.5*k*k*k;return.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){if((k*=2)<1)return.5*k*k*k*k;return-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){if((k*=2)<1)return.5*k*k*k*k*k;return.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){if(k===0)return 0;if(k===1)return 1;if((k*=2)<1)return.5*Math.pow(1024,k-1);return.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){if((k*=2)<1)return-.5*(Math.sqrt(1-k*k)-1);return.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){var s,a=.1,p=.4;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k){var s,a=.1,p=.4;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1},InOut:function(k){var s,a=.1,p=.4;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);if((k*=2)<1)return-.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=1.70158*1.525;if((k*=2)<1)return.5*(k*k*((s+1)*k-s));return.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-Phaser.Easing.Bounce.Out(1-k)},Out:function(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:function(k){if(k<.5)return Phaser.Easing.Bounce.In(k*2)*.5;return Phaser.Easing.Bounce.Out(k*2-1)*.5+.5}}};Phaser.Time=function(game){this.game=game;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this.physicsElapsed=0;this.time=0;this.pausedTime=0;this.now=0;this.elapsed=0;this.fps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.frames=0;this.pauseDuration=0;this.timeToCall=0;this.lastTime=0;this.game.onPause.add(this.gamePaused,this);this.game.onResume.add(this.gameResumed,this);this._justResumed=false};Phaser.Time.prototype={update:function(time){this.now=time;if(this._justResumed){this.time=this.now;this._justResumed=false}this.timeToCall=this.game.math.max(0,16-(time-this.lastTime));this.elapsed=this.now-this.time;this.msMin=this.game.math.min(this.msMin,this.elapsed);this.msMax=this.game.math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1e3){this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond));this.fpsMin=this.game.math.min(this.fpsMin,this.fps);this.fpsMax=this.game.math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}this.time=this.now;this.lastTime=time+this.timeToCall;this.physicsElapsed=1*(this.elapsed/1e3);if(this.physicsElapsed>1){this.physicsElapsed=1}if(this.game.paused){this.pausedTime=this.now-this._pauseStarted}},gamePaused:function(){this._pauseStarted=this.now},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.pausedTime;this._justResumed=true},totalElapsedSeconds:function(){return(this.now-this._started)*.001},elapsedSince:function(since){return this.now-since},elapsedSecondsSince:function(since){return(this.now-since)*.001},reset:function(){this._started=this.now}};Phaser.Timer=function(game){this.game=game;this._started=0;this._timeLastSecond=0;this.running=false;this.events=[];this.onEvent=new Phaser.Signal};Phaser.Timer.prototype={add:function(delay){this.events.push({delay:delay,dispatched:false,args:Array.prototype.splice.call(arguments,1)})
},start:function(){this._started=this.game.time.now;this.running=true},stop:function(){this.running=false;this.events.length=0},update:function(){if(this.running){var seconds=this.seconds();for(var i=0,len=this.events.length;i<len;i++){if(this.events[i].dispatched===false&&seconds>=this.events[i].delay){this.events[i].dispatched=true;this.onEvent.dispatch.apply(this,this.events[i].args)}}}},seconds:function(){return(this.game.time.now-this._started)*.001}};Phaser.AnimationManager=function(sprite){this.sprite=sprite;this.game=sprite.game;this.currentFrame=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};Phaser.AnimationManager.prototype={loadFrameData:function(frameData){this._frameData=frameData;this.frame=0;this.isLoaded=true},add:function(name,frames,frameRate,loop,useNumericIndex){if(this._frameData==null){console.warn("No FrameData available for Phaser.Animation "+name);return}frameRate=frameRate||60;if(typeof loop==="undefined"){loop=false}if(typeof useNumericIndex==="undefined"){if(frames&&typeof frames[0]==="number"){useNumericIndex=true}else{useNumericIndex=false}}if(this.sprite.events.onAnimationStart==null){this.sprite.events.onAnimationStart=new Phaser.Signal;this.sprite.events.onAnimationComplete=new Phaser.Signal;this.sprite.events.onAnimationLoop=new Phaser.Signal}this._outputFrames.length=0;this._frameData.getFrameIndexes(frames,useNumericIndex,this._outputFrames);this._anims[name]=new Phaser.Animation(this.game,this.sprite,name,this._frameData,this._outputFrames,frameRate,loop);this.currentAnim=this._anims[name];this.currentFrame=this.currentAnim.currentFrame;this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);return this._anims[name]},validateFrames:function(frames,useNumericIndex){if(typeof useNumericIndex=="undefined"){useNumericIndex=true}for(var i=0;i<frames.length;i++){if(useNumericIndex===true){if(frames[i]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(frames[i])===false){return false}}}return true},play:function(name,frameRate,loop,killOnComplete){if(this._anims[name]){if(this.currentAnim==this._anims[name]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(frameRate,loop,killOnComplete)}}else{this.currentAnim=this._anims[name];this.currentAnim.paused=false;return this.currentAnim.play(frameRate,loop,killOnComplete)}}},stop:function(name,resetFrame){if(typeof resetFrame=="undefined"){resetFrame=false}if(typeof name=="string"){if(this._anims[name]){this.currentAnim=this._anims[name];this.currentAnim.stop(resetFrame)}}else{if(this.currentAnim){this.currentAnim.stop(resetFrame)}}},update:function(){if(this.updateIfVisible&&this.sprite.visible===false){return false}if(this.currentAnim&&this.currentAnim.update()===true){this.currentFrame=this.currentAnim.currentFrame;this.sprite.currentFrame=this.currentFrame;return true}return false},getAnimation:function(name){if(typeof name=="string"){if(this._anims[name]){return this._anims[name]}}return false},refreshFrame:function(){this.sprite.currentFrame=this.currentFrame;this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid])},destroy:function(){this._anims={};this._frameData=null;this._frameIndex=0;this.currentAnim=null;this.currentFrame=null}};Object.defineProperty(Phaser.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(Phaser.AnimationManager.prototype,"frameTotal",{get:function(){if(this._frameData){return this._frameData.total}else{return-1}}});Object.defineProperty(Phaser.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(value){this.currentAnim.paused=value}});Object.defineProperty(Phaser.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this._frameIndex}},set:function(value){if(typeof value==="number"&&this._frameData&&this._frameData.getFrame(value)!==null){this.currentFrame=this._frameData.getFrame(value);this._frameIndex=value;this.sprite.currentFrame=this.currentFrame;this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid])}}});Object.defineProperty(Phaser.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(value){if(typeof value==="string"&&this._frameData&&this._frameData.getFrameByName(value)!==null){this.currentFrame=this._frameData.getFrameByName(value);this._frameIndex=this.currentFrame.index;this.sprite.currentFrame=this.currentFrame;this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid])}else{console.warn("Cannot set frameName: "+value)}}});Phaser.Animation=function(game,parent,name,frameData,frames,delay,looped){this.game=game;this._parent=parent;this._frameData=frameData;this.name=name;this._frames=[];this._frames=this._frames.concat(frames);this.delay=1e3/delay;this.looped=looped;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex])};Phaser.Animation.prototype={play:function(frameRate,loop,killOnComplete){if(typeof frameRate==="number"){this.delay=1e3/frameRate}if(typeof loop==="boolean"){this.looped=loop}if(typeof killOnComplete!=="undefined"){this.killOnComplete=killOnComplete}this.isPlaying=true;this.isFinished=false;this.paused=false;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this._parent.events){this._parent.events.onAnimationStart.dispatch(this._parent,this)}return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex])},stop:function(resetFrame){if(typeof resetFrame==="undefined"){resetFrame=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(resetFrame){this.currentFrame=this._frameData.getFrame(this._frames[0])}},update:function(){if(this.isPaused){return false}if(this.isPlaying===true&&this.game.time.now>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.now-this._timeNextFrame;this._timeLastFrame=this.game.time.now;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=this._frameSkip*this.delay}this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff);this._frameIndex+=this._frameSkip;if(this._frameIndex>=this._frames.length){if(this.looped){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid])}this._parent.events.onAnimationLoop.dispatch(this._parent,this)}else{this.onComplete()}}else{this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid])}}return true}return false},destroy:function(){this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false},onComplete:function(){this.isPlaying=false;this.isFinished=true;this.paused=false;if(this._parent.events){this._parent.events.onAnimationComplete.dispatch(this._parent,this)}if(this.killOnComplete){this._parent.kill()}}};Object.defineProperty(Phaser.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(value){this.isPaused=value;if(value){this._pauseStartTime=this.game.time.now}else{if(this.isPlaying){this._timeNextFrame=this.game.time.now+this.delay}}}});Object.defineProperty(Phaser.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(Phaser.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(value){this.currentFrame=this._frameData.getFrame(value);if(this.currentFrame!==null){this._frameIndex=value;this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid])}}});Phaser.Animation.generateFrameNames=function(prefix,start,stop,suffix,zeroPad){if(typeof suffix=="undefined"){suffix=""}var output=[];var frame="";if(start<stop){for(var i=start;i<=stop;i++){if(typeof zeroPad=="number"){frame=Phaser.Utils.pad(i.toString(),zeroPad,"0",1)}else{frame=i.toString()}frame=prefix+frame+suffix;output.push(frame)}}else{for(var i=start;i>=stop;i--){if(typeof zeroPad=="number"){frame=Phaser.Utils.pad(i.toString(),zeroPad,"0",1)}else{frame=i.toString()}frame=prefix+frame+suffix;output.push(frame)}}return output};Phaser.Frame=function(index,x,y,width,height,name,uuid){this.index=index;this.x=x;this.y=y;this.width=width;this.height=height;this.name=name;this.uuid=uuid;this.centerX=Math.floor(width/2);this.centerY=Math.floor(height/2);this.distance=Phaser.Math.distance(0,0,width,height);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=width;this.sourceSizeH=height;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0};Phaser.Frame.prototype={setTrim:function(trimmed,actualWidth,actualHeight,destX,destY,destWidth,destHeight){this.trimmed=trimmed;if(trimmed){this.width=actualWidth;this.height=actualHeight;this.sourceSizeW=actualWidth;this.sourceSizeH=actualHeight;this.centerX=Math.floor(actualWidth/2);this.centerY=Math.floor(actualHeight/2);this.spriteSourceSizeX=destX;this.spriteSourceSizeY=destY;this.spriteSourceSizeW=destWidth;this.spriteSourceSizeH=destHeight}}};Phaser.FrameData=function(){this._frames=[];this._frameNames=[]};Phaser.FrameData.prototype={addFrame:function(frame){frame.index=this._frames.length;this._frames.push(frame);if(frame.name!==""){this._frameNames[frame.name]=frame.index}return frame},getFrame:function(index){if(this._frames.length>index){return this._frames[index]}return null},getFrameByName:function(name){if(typeof this._frameNames[name]==="number"){return this._frames[this._frameNames[name]]}return null},checkFrameName:function(name){if(this._frameNames[name]==null){return false}return true},getFrameRange:function(start,end,output){if(typeof output==="undefined"){output=[]}for(var i=start;i<=end;i++){output.push(this._frames[i])}return output},getFrames:function(frames,useNumericIndex,output){if(typeof useNumericIndex==="undefined"){useNumericIndex=true}if(typeof output==="undefined"){output=[]}if(typeof frames==="undefined"||frames.length===0){for(var i=0;i<this._frames.length;i++){output.push(this._frames[i])}}else{for(var i=0,len=frames.length;i<len;i++){if(useNumericIndex){output.push(this.getFrame(frames[i]))}else{output.push(this.getFrameByName(frames[i]))}}}return output},getFrameIndexes:function(frames,useNumericIndex,output){if(typeof useNumericIndex==="undefined"){useNumericIndex=true}if(typeof output==="undefined"){output=[]}if(typeof frames==="undefined"||frames.length===0){for(var i=0,len=this._frames.length;i<len;i++){output.push(this._frames[i].index)}}else{for(var i=0,len=frames.length;i<len;i++){if(useNumericIndex){output.push(frames[i])}else{if(this.getFrameByName(frames[i])){output.push(this.getFrameByName(frames[i]).index)}}}}return output}};Object.defineProperty(Phaser.FrameData.prototype,"total",{get:function(){return this._frames.length}});Phaser.AnimationParser={spriteSheet:function(game,key,frameWidth,frameHeight,frameMax){var img=game.cache.getImage(key);if(img==null){return null}var width=img.width;var height=img.height;if(frameWidth<=0){frameWidth=Math.floor(-width/Math.min(-1,frameWidth))}if(frameHeight<=0){frameHeight=Math.floor(-height/Math.min(-1,frameHeight))}var row=Math.round(width/frameWidth);var column=Math.round(height/frameHeight);var total=row*column;if(frameMax!==-1){total=frameMax}if(width===0||height===0||width<frameWidth||height<frameHeight||total===0){console.warn("Phaser.AnimationParser.spriteSheet: width/height zero or width/height < given frameWidth/frameHeight");return null}var data=new Phaser.FrameData;var x=0;var y=0;for(var i=0;i<total;i++){var uuid=game.rnd.uuid();data.addFrame(new Phaser.Frame(i,x,y,frameWidth,frameHeight,"",uuid));PIXI.TextureCache[uuid]=new PIXI.Texture(PIXI.BaseTextureCache[key],{x:x,y:y,width:frameWidth,height:frameHeight});x+=frameWidth;if(x===width){x=0;y+=frameHeight}}return data},JSONData:function(game,json,cacheKey){if(!json["frames"]){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(json);return}var data=new Phaser.FrameData;var frames=json["frames"];var newFrame;for(var i=0;i<frames.length;i++){var uuid=game.rnd.uuid();newFrame=data.addFrame(new Phaser.Frame(i,frames[i].frame.x,frames[i].frame.y,frames[i].frame.w,frames[i].frame.h,frames[i].filename,uuid));PIXI.TextureCache[uuid]=new PIXI.Texture(PIXI.BaseTextureCache[cacheKey],{x:frames[i].frame.x,y:frames[i].frame.y,width:frames[i].frame.w,height:frames[i].frame.h});if(frames[i].trimmed){newFrame.setTrim(frames[i].trimmed,frames[i].sourceSize.w,frames[i].sourceSize.h,frames[i].spriteSourceSize.x,frames[i].spriteSourceSize.y,frames[i].spriteSourceSize.w,frames[i].spriteSourceSize.h);PIXI.TextureCache[uuid].trimmed=true;PIXI.TextureCache[uuid].trim.x=frames[i].spriteSourceSize.x;PIXI.TextureCache[uuid].trim.y=frames[i].spriteSourceSize.y}}return data},JSONDataHash:function(game,json,cacheKey){if(!json["frames"]){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(json);return}var data=new Phaser.FrameData;var frames=json["frames"];var newFrame;var i=0;for(var key in frames){var uuid=game.rnd.uuid();newFrame=data.addFrame(new Phaser.Frame(i,frames[key].frame.x,frames[key].frame.y,frames[key].frame.w,frames[key].frame.h,key,uuid));PIXI.TextureCache[uuid]=new PIXI.Texture(PIXI.BaseTextureCache[cacheKey],{x:frames[key].frame.x,y:frames[key].frame.y,width:frames[key].frame.w,height:frames[key].frame.h});if(frames[key].trimmed){newFrame.setTrim(frames[key].trimmed,frames[key].sourceSize.w,frames[key].sourceSize.h,frames[key].spriteSourceSize.x,frames[key].spriteSourceSize.y,frames[key].spriteSourceSize.w,frames[key].spriteSourceSize.h);PIXI.TextureCache[uuid].trimmed=true;PIXI.TextureCache[uuid].trim.x=frames[key].spriteSourceSize.x;PIXI.TextureCache[uuid].trim.y=frames[key].spriteSourceSize.y}i++}return data},XMLData:function(game,xml,cacheKey){if(!xml.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var data=new Phaser.FrameData;var frames=xml.getElementsByTagName("SubTexture");var newFrame;var uuid;var name;var frame;var x;var y;var width;var height;var frameX;var frameY;var frameWidth;var frameHeight;for(var i=0;i<frames.length;i++){uuid=game.rnd.uuid();frame=frames[i].attributes;name=frame.name.nodeValue;x=parseInt(frame.x.nodeValue,10);y=parseInt(frame.y.nodeValue,10);width=parseInt(frame.width.nodeValue,10);height=parseInt(frame.height.nodeValue,10);frameX=null;frameY=null;if(frame.frameX){frameX=Math.abs(parseInt(frame.frameX.nodeValue,10));frameY=Math.abs(parseInt(frame.frameY.nodeValue,10));frameWidth=parseInt(frame.frameWidth.nodeValue,10);frameHeight=parseInt(frame.frameHeight.nodeValue,10)}newFrame=data.addFrame(new Phaser.Frame(i,x,y,width,height,name,uuid));PIXI.TextureCache[uuid]=new PIXI.Texture(PIXI.BaseTextureCache[cacheKey],{x:x,y:y,width:width,height:height});if(frameX!==null||frameY!==null){newFrame.setTrim(true,width,height,frameX,frameY,frameWidth,frameHeight);PIXI.TextureCache[uuid].realSize={x:frameX,y:frameY,w:frameWidth,h:frameHeight};PIXI.TextureCache[uuid].trimmed=true;PIXI.TextureCache[uuid].trim.x=frameX;PIXI.TextureCache[uuid].trim.y=frameY}}return data}};Phaser.Cache=function(game){this.game=game;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._tilemaps={};this._tilesets={};this._bitmapDatas={};this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new Phaser.Signal};Phaser.Cache.prototype={addCanvas:function(key,canvas,context){this._canvases[key]={canvas:canvas,context:context}},addBitmapData:function(key,bitmapData){this._bitmapDatas[key]=bitmapData;return bitmapData},addRenderTexture:function(key,texture){var frame=new Phaser.Frame(0,0,0,texture.width,texture.height,"","");this._textures[key]={texture:texture,frame:frame}},addSpriteSheet:function(key,url,data,frameWidth,frameHeight,frameMax){this._images[key]={url:url,data:data,spriteSheet:true,frameWidth:frameWidth,frameHeight:frameHeight};PIXI.BaseTextureCache[key]=new PIXI.BaseTexture(data);PIXI.TextureCache[key]=new PIXI.Texture(PIXI.BaseTextureCache[key]);this._images[key].frameData=Phaser.AnimationParser.spriteSheet(this.game,key,frameWidth,frameHeight,frameMax)},addTileset:function(key,url,data,tileWidth,tileHeight,tileMax,tileMargin,tileSpacing){this._tilesets[key]={url:url,data:data,tileWidth:tileWidth,tileHeight:tileHeight,tileMargin:tileMargin,tileSpacing:tileSpacing};PIXI.BaseTextureCache[key]=new PIXI.BaseTexture(data);PIXI.TextureCache[key]=new PIXI.Texture(PIXI.BaseTextureCache[key]);this._tilesets[key].tileData=Phaser.TilemapParser.tileset(this.game,key,tileWidth,tileHeight,tileMax,tileMargin,tileSpacing)},addTilemap:function(key,url,mapData,format){this._tilemaps[key]={url:url,data:mapData,format:format};this._tilemaps[key].layers=Phaser.TilemapParser.parse(this.game,mapData,format)},addTextureAtlas:function(key,url,data,atlasData,format){this._images[key]={url:url,data:data,spriteSheet:true};PIXI.BaseTextureCache[key]=new PIXI.BaseTexture(data);PIXI.TextureCache[key]=new PIXI.Texture(PIXI.BaseTextureCache[key]);if(format==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY){this._images[key].frameData=Phaser.AnimationParser.JSONData(this.game,atlasData,key)}else if(format==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH){this._images[key].frameData=Phaser.AnimationParser.JSONDataHash(this.game,atlasData,key)}else if(format==Phaser.Loader.TEXTURE_ATLAS_XML_STARLING){this._images[key].frameData=Phaser.AnimationParser.XMLData(this.game,atlasData,key)}},addBitmapFont:function(key,url,data,xmlData){this._images[key]={url:url,data:data,spriteSheet:true};PIXI.BaseTextureCache[key]=new PIXI.BaseTexture(data);PIXI.TextureCache[key]=new PIXI.Texture(PIXI.BaseTextureCache[key]);Phaser.LoaderParser.bitmapFont(this.game,xmlData,key)},addDefaultImage:function(){var img=new Image;img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images["__default"]={url:null,data:img,spriteSheet:false};this._images["__default"].frame=new Phaser.Frame(0,0,0,32,32,"","");PIXI.BaseTextureCache["__default"]=new PIXI.BaseTexture(img);PIXI.TextureCache["__default"]=new PIXI.Texture(PIXI.BaseTextureCache["__default"])},addMissingImage:function(){var img=new Image;img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images["__missing"]={url:null,data:img,spriteSheet:false};this._images["__missing"].frame=new Phaser.Frame(0,0,0,32,32,"","");PIXI.BaseTextureCache["__missing"]=new PIXI.BaseTexture(img);PIXI.TextureCache["__missing"]=new PIXI.Texture(PIXI.BaseTextureCache["__missing"])},addText:function(key,url,data){this._text[key]={url:url,data:data}},addImage:function(key,url,data){this._images[key]={url:url,data:data,spriteSheet:false};this._images[key].frame=new Phaser.Frame(0,0,0,data.width,data.height,key,this.game.rnd.uuid());PIXI.BaseTextureCache[key]=new PIXI.BaseTexture(data);PIXI.TextureCache[key]=new PIXI.Texture(PIXI.BaseTextureCache[key])},addSound:function(key,url,data,webAudio,audioTag){webAudio=webAudio||true;audioTag=audioTag||false;var decoded=false;if(audioTag){decoded=true}this._sounds[key]={url:url,data:data,isDecoding:false,decoded:decoded,webAudio:webAudio,audioTag:audioTag}},reloadSound:function(key){var _this=this;if(this._sounds[key]){this._sounds[key].data.src=this._sounds[key].url;this._sounds[key].data.addEventListener("canplaythrough",function(){return _this.reloadSoundComplete(key)},false);this._sounds[key].data.load()}},reloadSoundComplete:function(key){if(this._sounds[key]){this._sounds[key].locked=false;this.onSoundUnlock.dispatch(key)}},updateSound:function(key,property,value){if(this._sounds[key]){this._sounds[key][property]=value}},decodedSound:function(key,data){this._sounds[key].data=data;this._sounds[key].decoded=true;this._sounds[key].isDecoding=false},getCanvas:function(key){if(this._canvases[key]){return this._canvases[key].canvas}return null},getBitmapData:function(key){if(this._bitmapDatas[key]){return this._bitmapDatas[key]}return null},checkImageKey:function(key){if(this._images[key]){return true}return false},getImage:function(key){if(this._images[key]){return this._images[key].data}return null},getTilesetImage:function(key){if(this._tilesets[key]){return this._tilesets[key].data}return null},getTileset:function(key){if(this._tilesets[key]){return this._tilesets[key].tileData}return null},getTilemapData:function(key){if(this._tilemaps[key]){return this._tilemaps[key]}return null},getFrameData:function(key){if(this._images[key]&&this._images[key].frameData){return this._images[key].frameData}return null},getFrameByIndex:function(key,frame){if(this._images[key]&&this._images[key].frameData){return this._images[key].frameData.getFrame(frame)}return null},getFrameByName:function(key,frame){if(this._images[key]&&this._images[key].frameData){return this._images[key].frameData.getFrameByName(frame)}return null},getFrame:function(key){if(this._images[key]&&this._images[key].spriteSheet===false){return this._images[key].frame}return null},getTextureFrame:function(key){if(this._textures[key]){return this._textures[key].frame}return null},getTexture:function(key){if(this._textures[key]){return this._textures[key]}return null},getSound:function(key){if(this._sounds[key]){return this._sounds[key]}return null},getSoundData:function(key){if(this._sounds[key]){return this._sounds[key].data}return null},isSoundDecoded:function(key){if(this._sounds[key]){return this._sounds[key].decoded}},isSoundReady:function(key){return this._sounds[key]&&this._sounds[key].decoded&&this.game.sound.touchLocked===false},isSpriteSheet:function(key){if(this._images[key]){return this._images[key].spriteSheet}return false},getText:function(key){if(this._text[key]){return this._text[key].data}return null},getKeys:function(array){var output=[];for(var item in array){if(item!=="__default"){output.push(item)}}return output},getImageKeys:function(){return this.getKeys(this._images)},getSoundKeys:function(){return this.getKeys(this._sounds)},getTextKeys:function(){return this.getKeys(this._text)},removeCanvas:function(key){delete this._canvases[key]},removeImage:function(key){delete this._images[key]},removeSound:function(key){delete this._sounds[key]},removeText:function(key){delete this._text[key]},destroy:function(){for(var item in this._canvases){delete this._canvases[item["key"]]}for(var item in this._images){delete this._images[item["key"]]}for(var item in this._sounds){delete this._sounds[item["key"]]}for(var item in this._text){delete this._text[item["key"]]}}};Phaser.Loader=function(game){this.game=game;this._fileList=[];this._fileIndex=0;this._progressChunk=0;this._xhr=new XMLHttpRequest;this.isLoading=false;this.hasLoaded=false;this.progress=0;this.preloadSprite=null;this.crossOrigin="";this.baseURL="";this.onFileComplete=new Phaser.Signal;this.onFileError=new Phaser.Signal;this.onLoadStart=new Phaser.Signal;this.onLoadComplete=new Phaser.Signal};Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;Phaser.Loader.TEXTURE_ATLAS_JSON_HASH=1;Phaser.Loader.TEXTURE_ATLAS_XML_STARLING=2;Phaser.Loader.prototype={setPreloadSprite:function(sprite,direction){direction=direction||0;this.preloadSprite={sprite:sprite,direction:direction,width:sprite.width,height:sprite.height,crop:null};if(direction===0){this.preloadSprite.crop=new Phaser.Rectangle(0,0,1,sprite.height)}else{this.preloadSprite.crop=new Phaser.Rectangle(0,0,sprite.width,1)}sprite.crop=this.preloadSprite.crop;sprite.cropEnabled=true},checkKeyExists:function(type,key){if(this._fileList.length>0){for(var i=0;i<this._fileList.length;i++){if(this._fileList[i].type===type&&this._fileList[i].key===key){return true}}}return false},getAsset:function(type,key){if(this._fileList.length>0){for(var i=0;i<this._fileList.length;i++){if(this._fileList[i].type===type&&this._fileList[i].key===key){return{index:i,file:this._fileList[i]}}}}return false},reset:function(){this.preloadSprite=null;this.isLoading=false;this._fileList.length=0;this._fileIndex=0},addToFileList:function(type,key,url,properties){var entry={type:type,key:key,url:url,data:null,error:false,loaded:false};if(typeof properties!=="undefined"){for(var prop in properties){entry[prop]=properties[prop]}}if(this.checkKeyExists(type,key)===false){this._fileList.push(entry)}},replaceInFileList:function(type,key,url,properties){var entry={type:type,key:key,url:url,data:null,error:false,loaded:false};if(typeof properties!=="undefined"){for(var prop in properties){entry[prop]=properties[prop]}}if(this.checkKeyExists(type,key)===false){this._fileList.push(entry)}},image:function(key,url,overwrite){if(typeof overwrite==="undefined"){overwrite=false}if(overwrite){this.replaceInFileList("image",key,url)}else{this.addToFileList("image",key,url)}return this},text:function(key,url,overwrite){if(typeof overwrite==="undefined"){overwrite=false}if(overwrite){this.replaceInFileList("text",key,url)}else{this.addToFileList("text",key,url)}return this},script:function(key,url){this.addToFileList("script",key,url);return this},spritesheet:function(key,url,frameWidth,frameHeight,frameMax){if(typeof frameMax==="undefined"){frameMax=-1}this.addToFileList("spritesheet",key,url,{frameWidth:frameWidth,frameHeight:frameHeight,frameMax:frameMax});return this},tileset:function(key,url,tileWidth,tileHeight,tileMax,tileMargin,tileSpacing){if(typeof tileMax==="undefined"){tileMax=-1}if(typeof tileMargin==="undefined"){tileMargin=0}if(typeof tileSpacing==="undefined"){tileSpacing=0}this.addToFileList("tileset",key,url,{tileWidth:tileWidth,tileHeight:tileHeight,tileMax:tileMax,tileMargin:tileMargin,tileSpacing:tileSpacing});return this},audio:function(key,urls,autoDecode){if(typeof autoDecode==="undefined"){autoDecode=true}this.addToFileList("audio",key,urls,{buffer:null,autoDecode:autoDecode});return this},tilemap:function(key,mapDataURL,mapData,format){if(typeof mapDataURL==="undefined"){mapDataURL=null}if(typeof mapData==="undefined"){mapData=null}if(typeof format==="undefined"){format=Phaser.Tilemap.CSV}if(mapDataURL==null&&mapData==null){console.warn("Phaser.Loader.tilemap - Both mapDataURL and mapData are null. One must be set.");return this}if(mapData){switch(format){case Phaser.Tilemap.CSV:break;case Phaser.Tilemap.TILED_JSON:if(typeof mapData==="string"){mapData=JSON.parse(mapData)}break}this.game.cache.addTilemap(key,null,mapData,format)}else{this.addToFileList("tilemap",key,mapDataURL,{format:format})}return this},bitmapFont:function(key,textureURL,xmlURL,xmlData){if(typeof xmlURL==="undefined"){xmlURL=null}if(typeof xmlData==="undefined"){xmlData=null}if(xmlURL){this.addToFileList("bitmapfont",key,textureURL,{xmlURL:xmlURL})}else{if(typeof xmlData==="string"){var xml;try{if(window["DOMParser"]){var domparser=new DOMParser;xml=domparser.parseFromString(xmlData,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(xmlData)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid Bitmap Font XML given")}else{this.addToFileList("bitmapfont",key,textureURL,{xmlURL:null,xmlData:xml})}}}return this},atlasJSONArray:function(key,textureURL,atlasURL,atlasData){return this.atlas(key,textureURL,atlasURL,atlasData,Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(key,textureURL,atlasURL,atlasData){return this.atlas(key,textureURL,atlasURL,atlasData,Phaser.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(key,textureURL,atlasURL,atlasData){return this.atlas(key,textureURL,atlasURL,atlasData,Phaser.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(key,textureURL,atlasURL,atlasData,format){if(typeof atlasURL==="undefined"){atlasURL=null}if(typeof atlasData==="undefined"){atlasData=null}if(typeof format==="undefined"){format=Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(atlasURL){this.addToFileList("textureatlas",key,textureURL,{atlasURL:atlasURL,format:format})}else{switch(format){case Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof atlasData==="string"){atlasData=JSON.parse(atlasData)}break;case Phaser.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof atlasData==="string"){var xml;try{if(window["DOMParser"]){var domparser=new DOMParser;xml=domparser.parseFromString(atlasData,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(atlasData)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}else{atlasData=xml}}break}this.addToFileList("textureatlas",key,textureURL,{atlasURL:null,atlasData:atlasData,format:format})}return this},removeFile:function(type,key){var file=this.getAsset(type,key);if(file!==false){this._fileList.splice(file.index,1)}},removeAll:function(){this._fileList.length=0},start:function(){if(this.isLoading){return}this.progress=0;this.hasLoaded=false;this.isLoading=true;this.onLoadStart.dispatch(this._fileList.length);if(this._fileList.length>0){this._fileIndex=0;this._progressChunk=100/this._fileList.length;this.loadFile()}else{this.progress=100;this.hasLoaded=true;this.onLoadComplete.dispatch()}},loadFile:function(){if(!this._fileList[this._fileIndex]){console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);return}var file=this._fileList[this._fileIndex];var _this=this;switch(file.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":case"tileset":file.data=new Image;file.data.name=file.key;file.data.onload=function(){return _this.fileComplete(_this._fileIndex)};file.data.onerror=function(){return _this.fileError(_this._fileIndex)};file.data.crossOrigin=this.crossOrigin;file.data.src=this.baseURL+file.url;break;case"audio":file.url=this.getAudioURL(file.url);if(file.url!==null){if(this.game.sound.usingWebAudio){this._xhr.open("GET",this.baseURL+file.url,true);this._xhr.responseType="arraybuffer";this._xhr.onload=function(){return _this.fileComplete(_this._fileIndex)};this._xhr.onerror=function(){return _this.fileError(_this._fileIndex)};this._xhr.send()}else if(this.game.sound.usingAudioTag){if(this.game.sound.touchLocked){file.data=new Audio;file.data.name=file.key;file.data.preload="auto";file.data.src=this.baseURL+file.url;this.fileComplete(this._fileIndex)}else{file.data=new Audio;file.data.name=file.key;file.data.onerror=function(){return _this.fileError(_this._fileIndex)};file.data.preload="auto";file.data.src=this.baseURL+file.url;file.data.addEventListener("canplaythrough",Phaser.GAMES[this.game.id].load.fileComplete(this._fileIndex),false);file.data.load()}}}else{this.fileError(this._fileIndex)}break;case"tilemap":this._xhr.open("GET",this.baseURL+file.url,true);
this._xhr.responseType="text";if(file.format===Phaser.Tilemap.TILED_JSON){this._xhr.onload=function(){return _this.jsonLoadComplete(_this._fileIndex)}}else if(file.format===Phaser.Tilemap.CSV){this._xhr.onload=function(){return _this.csvLoadComplete(_this._fileIndex)}}else{throw new Error("Phaser.Loader. Invalid Tilemap format: "+file.format)}this._xhr.onerror=function(){return _this.dataLoadError(_this._fileIndex)};this._xhr.send();break;case"text":this._xhr.open("GET",this.baseURL+file.url,true);this._xhr.responseType="text";this._xhr.onload=function(){return _this.fileComplete(_this._fileIndex)};this._xhr.onerror=function(){return _this.fileError(_this._fileIndex)};this._xhr.send();break;case"script":this._xhr.open("GET",this.baseURL+file.url,true);this._xhr.responseType="text";this._xhr.onload=function(){return _this.fileComplete(_this._fileIndex)};this._xhr.onerror=function(){return _this.fileError(_this._fileIndex)};this._xhr.send();break}},getAudioURL:function(urls){var extension;if(typeof urls==="string"){urls=[urls]}for(var i=0;i<urls.length;i++){extension=urls[i].toLowerCase();extension=extension.substr((Math.max(0,extension.lastIndexOf("."))||Infinity)+1);if(this.game.device.canPlayAudio(extension)){return urls[i]}}return null},fileError:function(index){this._fileList[index].loaded=true;this._fileList[index].error=true;this.onFileError.dispatch(this._fileList[index].key,this._fileList[index]);console.warn("Phaser.Loader error loading file: "+this._fileList[index].key+" from URL "+this._fileList[index].url);this.nextFile(index,false)},fileComplete:function(index){if(!this._fileList[index]){console.warn("Phaser.Loader fileComplete invalid index "+index);return}var file=this._fileList[index];file.loaded=true;var loadNext=true;var _this=this;switch(file.type){case"image":this.game.cache.addImage(file.key,file.url,file.data);break;case"spritesheet":this.game.cache.addSpriteSheet(file.key,file.url,file.data,file.frameWidth,file.frameHeight,file.frameMax);break;case"tileset":this.game.cache.addTileset(file.key,file.url,file.data,file.tileWidth,file.tileHeight,file.tileMax,file.tileMargin,file.tileSpacing);break;case"textureatlas":if(file.atlasURL==null){this.game.cache.addTextureAtlas(file.key,file.url,file.data,file.atlasData,file.format)}else{loadNext=false;this._xhr.open("GET",this.baseURL+file.atlasURL,true);this._xhr.responseType="text";if(file.format==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY||file.format==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH){this._xhr.onload=function(){return _this.jsonLoadComplete(index)}}else if(file.format==Phaser.Loader.TEXTURE_ATLAS_XML_STARLING){this._xhr.onload=function(){return _this.xmlLoadComplete(index)}}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+file.format)}this._xhr.onerror=function(){return _this.dataLoadError(index)};this._xhr.send()}break;case"bitmapfont":if(file.xmlURL==null){this.game.cache.addBitmapFont(file.key,file.url,file.data,file.xmlData)}else{loadNext=false;this._xhr.open("GET",this.baseURL+file.xmlURL,true);this._xhr.responseType="text";this._xhr.onload=function(){return _this.xmlLoadComplete(index)};this._xhr.onerror=function(){return _this.dataLoadError(index)};this._xhr.send()}break;case"audio":if(this.game.sound.usingWebAudio){file.data=this._xhr.response;this.game.cache.addSound(file.key,file.url,file.data,true,false);if(file.autoDecode){this.game.cache.updateSound(key,"isDecoding",true);var that=this;var key=file.key;this.game.sound.context.decodeAudioData(file.data,function(buffer){if(buffer){that.game.cache.decodedSound(key,buffer)}})}}else{file.data.removeEventListener("canplaythrough",Phaser.GAMES[this.game.id].load.fileComplete);this.game.cache.addSound(file.key,file.url,file.data,false,true)}break;case"text":file.data=this._xhr.responseText;this.game.cache.addText(file.key,file.url,file.data);break;case"script":file.data=document.createElement("script");file.data.language="javascript";file.data.type="text/javascript";file.data.defer=false;file.data.text=this._xhr.responseText;document.head.appendChild(file.data);break}if(loadNext){this.nextFile(index,true)}},jsonLoadComplete:function(index){if(!this._fileList[index]){console.warn("Phaser.Loader jsonLoadComplete invalid index "+index);return}var file=this._fileList[index];var data=JSON.parse(this._xhr.responseText);file.loaded=true;if(file.type==="tilemap"){this.game.cache.addTilemap(file.key,file.url,data,file.format)}else{this.game.cache.addTextureAtlas(file.key,file.url,file.data,data,file.format)}this.nextFile(index,true)},csvLoadComplete:function(index){if(!this._fileList[index]){console.warn("Phaser.Loader csvLoadComplete invalid index "+index);return}var file=this._fileList[index];var data=this._xhr.responseText;file.loaded=true;this.game.cache.addTilemap(file.key,file.url,data,file.format);this.nextFile(index,true)},dataLoadError:function(index){var file=this._fileList[index];file.loaded=true;file.error=true;console.warn("Phaser.Loader dataLoadError: "+file.key);this.nextFile(index,true)},xmlLoadComplete:function(index){var data=this._xhr.responseText;var xml;try{if(window["DOMParser"]){var domparser=new DOMParser;xml=domparser.parseFromString(data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid XML given")}var file=this._fileList[index];file.loaded=true;if(file.type=="bitmapfont"){this.game.cache.addBitmapFont(file.key,file.url,file.data,xml)}else if(file.type=="textureatlas"){this.game.cache.addTextureAtlas(file.key,file.url,file.data,xml,file.format)}this.nextFile(index,true)},nextFile:function(previousIndex,success){this.progress=Math.round(this.progress+this._progressChunk);if(this.progress>100){this.progress=100}if(this.preloadSprite!==null){if(this.preloadSprite.direction===0){this.preloadSprite.crop.width=Math.floor(this.preloadSprite.width/100*this.progress)}else{this.preloadSprite.crop.height=Math.floor(this.preloadSprite.height/100*this.progress)}this.preloadSprite.sprite.crop=this.preloadSprite.crop}this.onFileComplete.dispatch(this.progress,this._fileList[previousIndex].key,success,this.totalLoadedFiles(),this._fileList.length);if(this.totalQueuedFiles()>0){this._fileIndex++;this.loadFile()}else{this.hasLoaded=true;this.isLoading=false;this.removeAll();this.onLoadComplete.dispatch()}},totalLoadedFiles:function(){var total=0;for(var i=0;i<this._fileList.length;i++){if(this._fileList[i].loaded){total++}}return total},totalQueuedFiles:function(){var total=0;for(var i=0;i<this._fileList.length;i++){if(this._fileList[i].loaded===false){total++}}return total}};Phaser.LoaderParser={bitmapFont:function(game,xml,cacheKey){if(!xml.getElementsByTagName("font")){console.warn("Phaser.LoaderParser.bitmapFont: Invalid XML given, missing <font> tag");return}var texture=PIXI.TextureCache[cacheKey];var data={};var info=xml.getElementsByTagName("info")[0];var common=xml.getElementsByTagName("common")[0];data.font=info.attributes.getNamedItem("face").nodeValue;data.size=parseInt(info.attributes.getNamedItem("size").nodeValue,10);data.lineHeight=parseInt(common.attributes.getNamedItem("lineHeight").nodeValue,10);data.chars={};var letters=xml.getElementsByTagName("char");for(var i=0;i<letters.length;i++){var charCode=parseInt(letters[i].attributes.getNamedItem("id").nodeValue,10);var textureRect={x:parseInt(letters[i].attributes.getNamedItem("x").nodeValue,10),y:parseInt(letters[i].attributes.getNamedItem("y").nodeValue,10),width:parseInt(letters[i].attributes.getNamedItem("width").nodeValue,10),height:parseInt(letters[i].attributes.getNamedItem("height").nodeValue,10)};PIXI.TextureCache[charCode]=new PIXI.Texture(texture,textureRect);data.chars[charCode]={xOffset:parseInt(letters[i].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(letters[i].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(letters[i].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new PIXI.Texture(texture,textureRect)}}var kernings=xml.getElementsByTagName("kerning");for(i=0;i<kernings.length;i++){var first=parseInt(kernings[i].attributes.getNamedItem("first").nodeValue,10);var second=parseInt(kernings[i].attributes.getNamedItem("second").nodeValue,10);var amount=parseInt(kernings[i].attributes.getNamedItem("amount").nodeValue,10);data.chars[second].kerning[first]=amount}PIXI.BitmapText.fonts[data.font]=data}};Phaser.Sound=function(game,key,volume,loop,connect){if(typeof volume=="undefined"){volume=1}if(typeof loop=="undefined"){loop=false}if(typeof connect==="undefined"){connect=game.sound.connectToMaster}this.game=game;this.name=key;this.key=key;this.loop=loop;this._volume=volume;this.markers={};this.context=null;this._buffer=null;this._muted=false;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.pendingPlayback=false;this.override=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(typeof this.context.createGain==="undefined"){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=volume*this.game.sound.volume;if(connect){this.gainNode.connect(this.masterGainNode)}}else{if(this.game.cache.getSound(key)&&this.game.cache.isSoundReady(key)){this._sound=this.game.cache.getSoundData(key);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}this.onDecoded=new Phaser.Signal;this.onPlay=new Phaser.Signal;this.onPause=new Phaser.Signal;this.onResume=new Phaser.Signal;this.onLoop=new Phaser.Signal;this.onStop=new Phaser.Signal;this.onMute=new Phaser.Signal;this.onMarkerComplete=new Phaser.Signal};Phaser.Sound.prototype={soundHasUnlocked:function(key){if(key==this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(name,start,duration,volume,loop){volume=volume||1;if(typeof loop=="undefined"){loop=false}this.markers[name]={name:name,start:start,stop:start+duration,volume:volume,duration:duration,durationMS:duration*1e3,loop:loop}},removeMarker:function(name){delete this.markers[name]},update:function(){if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.now-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.now}else{this.play(this.currentMarker,0,this.volume,true,true)}}else{this.stop()}}else{if(this.loop){this.onLoop.dispatch(this);this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},play:function(marker,position,volume,loop,forceRestart){marker=marker||"";position=position||0;if(typeof volume==="undefined"){volume=this._volume}if(typeof loop==="undefined"){loop=false}if(typeof forceRestart==="undefined"){forceRestart=true}if(this.isPlaying===true&&forceRestart===false&&this.override===false){return}if(this.isPlaying&&this.override){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{this._sound.stop(0)}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.currentMarker=marker;if(marker!==""){if(this.markers[marker]){this.position=this.markers[marker].start;this.volume=this.markers[marker].volume;this.loop=this.markers[marker].loop;this.duration=this.markers[marker].duration;this.durationMS=this.markers[marker].durationMS;this._tempMarker=marker;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn("Phaser.Sound.play: audio marker "+marker+" doesn't exist");return}}else{this.position=position;this.volume=volume;this.loop=loop;this.duration=0;this.durationMS=0;this._tempMarker=marker;this._tempPosition=position;this._tempVolume=volume;this._tempLoop=loop}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){if(this._buffer==null){this._buffer=this.game.cache.getSoundData(this.key)}this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode.input)}else{this._sound.connect(this.gainNode)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1e3}if(this.loop&&marker===""){this._sound.loop=true}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,this.position,this.duration)}else{this._sound.start(0,this.position,this.duration)}this.isPlaying=true;this.startTime=this.game.time.now;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&this._sound.readyState==4){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1e3}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.now;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}},restart:function(marker,position,volume,loop){marker=marker||"";position=position||0;volume=volume||1;if(typeof loop=="undefined"){loop=false}this.play(marker,position,volume,loop,true)},pause:function(){if(this.isPlaying&&this._sound){this.stop();this.isPlaying=false;this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.now;this.onPause.dispatch(this)}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var p=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this._sound.connect(this.gainNode);if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,p,this.duration)}else{this._sound.start(0,p,this.duration)}}else{this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=this.game.time.now-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{this._sound.stop(0)}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.isPlaying=false;var prevMarker=this.currentMarker;this.currentMarker="";this.onStop.dispatch(this,prevMarker)}};Object.defineProperty(Phaser.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(Phaser.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(Phaser.Sound.prototype,"mute",{get:function(){return this._muted},set:function(value){value=value||null;if(value){this._muted=true;if(this.usingWebAudio){this._muteVolume=this.gainNode.gain.value;this.gainNode.gain.value=0}else if(this.usingAudioTag&&this._sound){this._muteVolume=this._sound.volume;this._sound.volume=0}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}this.onMute.dispatch(this)}});Object.defineProperty(Phaser.Sound.prototype,"volume",{get:function(){return this._volume},set:function(value){if(this.usingWebAudio){this._volume=value;this.gainNode.gain.value=value}else if(this.usingAudioTag&&this._sound){if(value>=0&&value<=1){this._volume=value;this._sound.volume=value}}}});Phaser.SoundManager=function(game){this.game=game;this.onSoundDecode=new Phaser.Signal;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this.context=null;this.usingWebAudio=true;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32};Phaser.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(this.game.device.iOS||window["PhaserGlobal"]&&window["PhaserGlobal"].fakeiOSTouchLock){this.game.input.touch.callbackContext=this;this.game.input.touch.touchStartCallback=this.unlock;this.game.input.mouse.callbackContext=this;this.game.input.mouse.mouseDownCallback=this.unlock;this.touchLocked=true}else{this.touchLocked=false}if(window["PhaserGlobal"]){if(window["PhaserGlobal"].disableAudio===true){this.usingWebAudio=false;this.noAudio=true;return}if(window["PhaserGlobal"].disableWebAudio===true){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false;return}}if(!!window["AudioContext"]){this.context=new window["AudioContext"]}else if(!!window["webkitAudioContext"]){this.context=new window["webkitAudioContext"]}else if(!!window["Audio"]){this.usingWebAudio=false;this.usingAudioTag=true}else{this.usingWebAudio=false;this.noAudio=true}if(this.context!==null){if(typeof this.context.createGain==="undefined"){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}},unlock:function(){if(this.touchLocked===false){return}if(this.game.device.webAudio===false||window["PhaserGlobal"]&&window["PhaserGlobal"].disableWebAudio===true){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null;this.game.input.mouse.callbackContext=null;this.game.input.mouse.mouseDownCallback=null}else{var buffer=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=buffer;this._unlockSource.connect(this.context.destination);this._unlockSource.noteOn(0)}},stopAll:function(){for(var i=0;i<this._sounds.length;i++){if(this._sounds[i]){this._sounds[i].stop()}}},pauseAll:function(){for(var i=0;i<this._sounds.length;i++){if(this._sounds[i]){this._sounds[i].pause()}}},resumeAll:function(){for(var i=0;i<this._sounds.length;i++){if(this._sounds[i]){this._sounds[i].resume()}}},decode:function(key,sound){sound=sound||null;var soundData=this.game.cache.getSoundData(key);if(soundData){if(this.game.cache.isSoundDecoded(key)===false){this.game.cache.updateSound(key,"isDecoding",true);var that=this;this.context.decodeAudioData(soundData,function(buffer){that.game.cache.decodedSound(key,buffer);if(sound){that.onSoundDecode.dispatch(sound)}})}}},update:function(){if(this.touchLocked){if(this.game.device.webAudio&&this._unlockSource!==null){if(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null}}}for(var i=0;i<this._sounds.length;i++){this._sounds[i].update()}},add:function(key,volume,loop,connect){if(typeof volume==="undefined"){volume=1}if(typeof loop==="undefined"){loop=false}if(typeof connect==="undefined"){connect=this.connectToMaster}var sound=new Phaser.Sound(this.game,key,volume,loop,connect);this._sounds.push(sound);return sound},play:function(key,volume,loop,destroyOnComplete){if(typeof destroyOnComplete=="undefined"){destroyOnComplete=false}var sound=this.add(key,volume,loop);sound.play();return sound}};Object.defineProperty(Phaser.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(value){value=value||null;if(value){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i].usingAudioTag){this._sounds[i].mute=true}}}else{if(this._muted===false){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i].usingAudioTag){this._sounds[i].mute=false}}}}});Object.defineProperty(Phaser.SoundManager.prototype,"volume",{get:function(){if(this.usingWebAudio){return this.masterGain.gain.value}else{return this._volume}},set:function(value){value=this.game.math.clamp(value,1,0);this._volume=value;if(this.usingWebAudio){this.masterGain.gain.value=value}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i].usingAudioTag){this._sounds[i].volume=this._sounds[i].volume*value}}}});Phaser.Utils.Debug=function(game){this.game=game;this.context=game.context;this.font="14px Courier";this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1};Phaser.Utils.Debug.prototype={start:function(x,y,color){if(this.context==null){return}if(typeof x!=="number"){x=0}if(typeof y!=="number"){y=0}color=color||"rgb(255,255,255)";this.currentX=x;this.currentY=y;this.currentColor=color;this.currentAlpha=this.context.globalAlpha;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.fillStyle=color;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha},line:function(text,x,y){if(this.context==null){return}x=x||null;y=y||null;if(x!==null){this.currentX=x}if(y!==null){this.currentY=y}if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(text,this.currentX+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(text,this.currentX,this.currentY);this.currentY+=this.lineHeight},renderQuadTree:function(quadtree,color){color=color||"rgba(255,0,0,0.3)";this.start();var bounds=quadtree.bounds;if(quadtree.nodes.length===0){this.context.strokeStyle=color;this.context.strokeRect(bounds.x,bounds.y,bounds.width,bounds.height);this.renderText(quadtree.ID+" / "+quadtree.objects.length,bounds.x+4,bounds.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var i=0;i<quadtree.objects.length;i++){this.context.strokeRect(quadtree.objects[i].x,quadtree.objects[i].y,quadtree.objects[i].width,quadtree.objects[i].height)}}else{for(var i=0;i<quadtree.nodes.length;i++){this.renderQuadTree(quadtree.nodes[i])}}this.stop()},renderSpriteCorners:function(sprite,showText,showBounds,color){if(this.context==null){return}showText=showText||false;showBounds=showBounds||false;color=color||"rgb(255,255,255)";this.start(0,0,color);if(showBounds){this.context.beginPath();this.context.strokeStyle="rgba(0, 255, 0, 0.7)";this.context.strokeRect(sprite.bounds.x,sprite.bounds.y,sprite.bounds.width,sprite.bounds.height);this.context.closePath();this.context.stroke()}this.context.beginPath();this.context.moveTo(sprite.topLeft.x,sprite.topLeft.y);this.context.lineTo(sprite.topRight.x,sprite.topRight.y);this.context.lineTo(sprite.bottomRight.x,sprite.bottomRight.y);this.context.lineTo(sprite.bottomLeft.x,sprite.bottomLeft.y);this.context.closePath();this.context.strokeStyle="rgba(255, 0, 255, 0.7)";this.context.stroke();this.renderPoint(sprite.offset);this.renderPoint(sprite.center);this.renderPoint(sprite.topLeft);this.renderPoint(sprite.topRight);this.renderPoint(sprite.bottomLeft);this.renderPoint(sprite.bottomRight);if(showText){this.currentColor=color;this.line("x: "+Math.floor(sprite.topLeft.x)+" y: "+Math.floor(sprite.topLeft.y),sprite.topLeft.x,sprite.topLeft.y);this.line("x: "+Math.floor(sprite.topRight.x)+" y: "+Math.floor(sprite.topRight.y),sprite.topRight.x,sprite.topRight.y);this.line("x: "+Math.floor(sprite.bottomLeft.x)+" y: "+Math.floor(sprite.bottomLeft.y),sprite.bottomLeft.x,sprite.bottomLeft.y);this.line("x: "+Math.floor(sprite.bottomRight.x)+" y: "+Math.floor(sprite.bottomRight.y),sprite.bottomRight.x,sprite.bottomRight.y)}this.stop()},renderSoundInfo:function(sound,x,y,color){if(this.context==null){return}color=color||"rgb(255,255,255)";this.start(x,y,color);this.line("Sound: "+sound.key+" Locked: "+sound.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(sound.key)+" Pending Playback: "+sound.pendingPlayback);this.line("Decoded: "+sound.isDecoded+" Decoding: "+sound.isDecoding);this.line("Total Duration: "+sound.totalDuration+" Playing: "+sound.isPlaying);this.line("Time: "+sound.currentTime);this.line("Volume: "+sound.volume+" Muted: "+sound.mute);this.line("WebAudio: "+sound.usingWebAudio+" Audio: "+sound.usingAudioTag);if(sound.currentMarker!==""){this.line("Marker: "+sound.currentMarker+" Duration: "+sound.duration);this.line("Start: "+sound.markers[sound.currentMarker].start+" Stop: "+sound.markers[sound.currentMarker].stop);this.line("Position: "+sound.position)}this.stop()},renderCameraInfo:function(camera,x,y,color){if(this.context==null){return}color=color||"rgb(255,255,255)";this.start(x,y,color);this.line("Camera ("+camera.width+" x "+camera.height+")");this.line("X: "+camera.x+" Y: "+camera.y);this.line("Bounds x: "+camera.bounds.x+" Y: "+camera.bounds.y+" w: "+camera.bounds.width+" h: "+camera.bounds.height);this.line("View x: "+camera.view.x+" Y: "+camera.view.y+" w: "+camera.view.width+" h: "+camera.view.height);this.stop()},renderPointer:function(pointer,hideIfUp,downColor,upColor,color){if(this.context==null||pointer==null){return}if(typeof hideIfUp==="undefined"){hideIfUp=false}downColor=downColor||"rgba(0,255,0,0.5)";upColor=upColor||"rgba(255,0,0,0.5)";color=color||"rgb(255,255,255)";if(hideIfUp===true&&pointer.isUp===true){return}this.start(pointer.x,pointer.y-100,color);this.context.beginPath();this.context.arc(pointer.x,pointer.y,pointer.circle.radius,0,Math.PI*2);if(pointer.active){this.context.fillStyle=downColor}else{this.context.fillStyle=upColor}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(pointer.positionDown.x,pointer.positionDown.y);this.context.lineTo(pointer.position.x,pointer.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+pointer.id+" Active: "+pointer.active);this.line("World X: "+pointer.worldX+" World Y: "+pointer.worldY);this.line("Screen X: "+pointer.x+" Screen Y: "+pointer.y);this.line("Duration: "+pointer.duration+" ms");this.stop()},renderSpriteInputInfo:function(sprite,x,y,color){color=color||"rgb(255,255,255)";this.start(x,y,color);this.line("Sprite Input: ("+sprite.width+" x "+sprite.height+")");this.line("x: "+sprite.input.pointerX().toFixed(1)+" y: "+sprite.input.pointerY().toFixed(1));this.line("over: "+sprite.input.pointerOver()+" duration: "+sprite.input.overDuration().toFixed(0));this.line("down: "+sprite.input.pointerDown()+" duration: "+sprite.input.downDuration().toFixed(0));this.line("just over: "+sprite.input.justOver()+" just out: "+sprite.input.justOut());this.stop()},renderSpriteCollision:function(sprite,x,y,color){color=color||"rgb(255,255,255)";this.start(x,y,color);this.line("Sprite Collision: ("+sprite.width+" x "+sprite.height+")");this.line("left: "+sprite.body.touching.left);this.line("right: "+sprite.body.touching.right);this.line("up: "+sprite.body.touching.up);this.line("down: "+sprite.body.touching.down);this.line("velocity.x: "+sprite.body.velocity.x);this.line("velocity.y: "+sprite.body.velocity.y);this.stop()},renderInputInfo:function(x,y,color){if(this.context==null){return}color=color||"rgb(255,255,0)";this.start(x,y,color);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},renderSpriteInfo:function(sprite,x,y,color){if(this.context==null){return}color=color||"rgb(255, 255, 255)";this.start(x,y,color);this.line("Sprite: "+" ("+sprite.width+" x "+sprite.height+") anchor: "+sprite.anchor.x+" x "+sprite.anchor.y);this.line("x: "+sprite.x.toFixed(1)+" y: "+sprite.y.toFixed(1));this.line("angle: "+sprite.angle.toFixed(1)+" rotation: "+sprite.rotation.toFixed(1));this.line("visible: "+sprite.visible+" in camera: "+sprite.inCamera);this.line("body x: "+sprite.body.x.toFixed(1)+" y: "+sprite.body.y.toFixed(1));this.line("deltaX: "+sprite.body.deltaX());this.line("deltaY: "+sprite.body.deltaY());this.stop()},renderWorldTransformInfo:function(sprite,x,y,color){if(this.context==null){return}color=color||"rgb(255, 255, 255)";this.start(x,y,color);this.line("World Transform");this.line("skewX:  "+sprite.worldTransform[3]);this.line("skewY:  "+sprite.worldTransform[1]);this.line("scaleX: "+sprite.worldTransform[0]);this.line("scaleY: "+sprite.worldTransform[4]);this.line("transX: "+sprite.worldTransform[2]);this.line("transY: "+sprite.worldTransform[5]);this.stop()},renderLocalTransformInfo:function(sprite,x,y,color){if(this.context==null){return}color=color||"rgb(255, 255, 255)";this.start(x,y,color);this.line("Local Transform");this.line("skewX:  "+sprite.localTransform[3]);this.line("skewY:  "+sprite.localTransform[1]);this.line("scaleX: "+sprite.localTransform[0]);this.line("scaleY: "+sprite.localTransform[4]);this.line("transX: "+sprite.localTransform[2]);this.line("transY: "+sprite.localTransform[5]);this.stop()},renderSpriteCoords:function(sprite,x,y,color){if(this.context==null){return}color=color||"rgb(255, 255, 255)";this.start(x,y,color);if(sprite.name){this.line(sprite.name)}this.line("x: "+sprite.x);this.line("y: "+sprite.y);this.line("pos x: "+sprite.position.x);this.line("pos y: "+sprite.position.y);this.line("local x: "+sprite.localTransform[2]);this.line("local y: "+sprite.localTransform[5]);this.line("t x: "+sprite.worldTransform[2]);this.line("t y: "+sprite.worldTransform[5]);this.line("world x: "+sprite.world.x);this.line("world y: "+sprite.world.y);this.stop()},renderGroupInfo:function(group,x,y,color){if(this.context==null){return}color=color||"rgb(255, 255, 255)";this.start(x,y,color);this.line("Group (size: "+group.length+")");this.line("x: "+group.x);this.line("y: "+group.y);this.stop()},renderPointInfo:function(point,x,y,color){if(this.context==null){return}color=color||"rgb(255, 255, 255)";this.start(x,y,color);this.line("px: "+point.x.toFixed(1)+" py: "+point.y.toFixed(1));this.stop()},renderSpriteBody:function(sprite,color){if(this.context==null){return}color=color||"rgba(255,0,255, 0.3)";this.start(0,0,color);this.context.fillStyle=color;this.context.fillRect(sprite.body.screenX,sprite.body.screenY,sprite.body.width,sprite.body.height);this.stop()},renderSpriteBounds:function(sprite,color,fill){if(this.context==null){return}color=color||"rgb(255,0,255)";if(typeof fill==="undefined"){fill=false}this.start(0,0,color);if(fill){this.context.fillStyle=color;this.context.fillRect(sprite.bounds.x,sprite.bounds.y,sprite.bounds.width,sprite.bounds.height)}else{this.context.strokeStyle=color;this.context.strokeRect(sprite.bounds.x,sprite.bounds.y,sprite.bounds.width,sprite.bounds.height);this.context.stroke()}this.stop()},renderPixel:function(x,y,color){if(this.context==null){return}color=color||"rgba(0,255,0,1)";this.start();this.context.fillStyle=color;this.context.fillRect(x,y,2,2);this.stop()},renderPoint:function(point,color){if(this.context==null){return}color=color||"rgba(0,255,0,1)";
this.start();this.context.fillStyle=color;this.context.fillRect(point.x,point.y,4,4);this.stop()},renderRectangle:function(rect,color){if(this.context==null){return}color=color||"rgba(0,255,0,0.3)";this.start();this.context.fillStyle=color;this.context.fillRect(rect.x,rect.y,rect.width,rect.height);this.stop()},renderCircle:function(circle,color){if(this.context==null){return}color=color||"rgba(0,255,0,0.3)";this.start();this.context.beginPath();this.context.fillStyle=color;this.context.arc(circle.x,circle.y,circle.radius,0,Math.PI*2,false);this.context.fill();this.context.closePath();this.stop()},renderText:function(text,x,y,color,font){if(this.context==null){return}color=color||"rgb(255,255,255)";font=font||"16px Courier";this.start();this.context.font=font;this.context.fillStyle=color;this.context.fillText(text,x,y);this.stop()},dumpLinkedList:function(list){var spacing=20;var output="\n"+Phaser.Utils.pad("Node",spacing)+"|"+Phaser.Utils.pad("Next",spacing)+"|"+Phaser.Utils.pad("Previous",spacing)+"|"+Phaser.Utils.pad("First",spacing)+"|"+Phaser.Utils.pad("Last",spacing);console.log(output);var output=Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing)+"|"+Phaser.Utils.pad("----------",spacing);console.log(output);var entity=list;var testObject=entity.last.next;entity=entity.first;do{var name=entity.sprite.name||"*";var nameNext="-";var namePrev="-";var nameFirst="-";var nameLast="-";if(entity.next){nameNext=entity.next.sprite.name}if(entity.prev){namePrev=entity.prev.sprite.name}if(entity.first){nameFirst=entity.first.sprite.name}if(entity.last){nameLast=entity.last.sprite.name}if(typeof nameNext==="undefined"){nameNext="-"}if(typeof namePrev==="undefined"){namePrev="-"}if(typeof nameFirst==="undefined"){nameFirst="-"}if(typeof nameLast==="undefined"){nameLast="-"}var output=Phaser.Utils.pad(name,spacing)+"|"+Phaser.Utils.pad(nameNext,spacing)+"|"+Phaser.Utils.pad(namePrev,spacing)+"|"+Phaser.Utils.pad(nameFirst,spacing)+"|"+Phaser.Utils.pad(nameLast,spacing);console.log(output);entity=entity.next}while(entity!=testObject)}};Phaser.Color={getColor32:function(alpha,red,green,blue){return alpha<<24|red<<16|green<<8|blue},getColor:function(red,green,blue){return red<<16|green<<8|blue},hexToRGB:function(h){var hex16=h.charAt(0)=="#"?h.substring(1,7):h;if(hex16.length==3){hex16=hex16.charAt(0)+hex16.charAt(0)+hex16.charAt(1)+hex16.charAt(1)+hex16.charAt(2)+hex16.charAt(2)}var red=parseInt(hex16.substring(0,2),16);var green=parseInt(hex16.substring(2,4),16);var blue=parseInt(hex16.substring(4,6),16);return red<<16|green<<8|blue},getColorInfo:function(color){var argb=Phaser.Color.getRGB(color);var hsl=Phaser.Color.RGBtoHSV(color);var result=Phaser.Color.RGBtoHexstring(color)+"\n";result=result.concat("Alpha: "+argb.alpha+" Red: "+argb.red+" Green: "+argb.green+" Blue: "+argb.blue)+"\n";result=result.concat("Hue: "+hsl.hue+" Saturation: "+hsl.saturation+" Lightnes: "+hsl.lightness);return result},RGBtoHexstring:function(color){var argb=Phaser.Color.getRGB(color);return"0x"+Phaser.Color.colorToHexstring(argb.alpha)+Phaser.Color.colorToHexstring(argb.red)+Phaser.Color.colorToHexstring(argb.green)+Phaser.Color.colorToHexstring(argb.blue)},RGBtoWebstring:function(color){var argb=Phaser.Color.getRGB(color);return"#"+Phaser.Color.colorToHexstring(argb.red)+Phaser.Color.colorToHexstring(argb.green)+Phaser.Color.colorToHexstring(argb.blue)},colorToHexstring:function(color){var digits="0123456789ABCDEF";var lsd=color%16;var msd=(color-lsd)/16;var hexified=digits.charAt(msd)+digits.charAt(lsd);return hexified},interpolateColor:function(color1,color2,steps,currentStep,alpha){if(typeof alpha==="undefined"){alpha=255}var src1=Phaser.Color.getRGB(color1);var src2=Phaser.Color.getRGB(color2);var r=(src2.red-src1.red)*currentStep/steps+src1.red;var g=(src2.green-src1.green)*currentStep/steps+src1.green;var b=(src2.blue-src1.blue)*currentStep/steps+src1.blue;return Phaser.Color.getColor32(alpha,r,g,b)},interpolateColorWithRGB:function(color,r,g,b,steps,currentStep){var src=Phaser.Color.getRGB(color);var or=(r-src.red)*currentStep/steps+src.red;var og=(g-src.green)*currentStep/steps+src.green;var ob=(b-src.blue)*currentStep/steps+src.blue;return Phaser.Color.getColor(or,og,ob)},interpolateRGB:function(r1,g1,b1,r2,g2,b2,steps,currentStep){var r=(r2-r1)*currentStep/steps+r1;var g=(g2-g1)*currentStep/steps+g1;var b=(b2-b1)*currentStep/steps+b1;return Phaser.Color.getColor(r,g,b)},getRandomColor:function(min,max,alpha){if(typeof min==="undefined"){min=0}if(typeof max==="undefined"){max=255}if(typeof alpha==="undefined"){alpha=255}if(max>255){return Phaser.Color.getColor(255,255,255)}if(min>max){return Phaser.Color.getColor(255,255,255)}var red=min+Math.round(Math.random()*(max-min));var green=min+Math.round(Math.random()*(max-min));var blue=min+Math.round(Math.random()*(max-min));return Phaser.Color.getColor32(alpha,red,green,blue)},getRGB:function(color){return{alpha:color>>>24,red:color>>16&255,green:color>>8&255,blue:color&255}},getWebRGB:function(color){var alpha=(color>>>24)/255;var red=color>>16&255;var green=color>>8&255;var blue=color&255;return"rgba("+red.toString()+","+green.toString()+","+blue.toString()+","+alpha.toString()+")"},getAlpha:function(color){return color>>>24},getAlphaFloat:function(color){return(color>>>24)/255},getRed:function(color){return color>>16&255},getGreen:function(color){return color>>8&255},getBlue:function(color){return color&255}};Phaser.Physics={};Phaser.Physics.Arcade=function(game){this.game=game;this.gravity=new Phaser.Point;this.bounds=new Phaser.Rectangle(0,0,game.world.width,game.world.height);this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.quadTree=new Phaser.QuadTree(this,this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTreeID=0;this._bounds1=new Phaser.Rectangle;this._bounds2=new Phaser.Rectangle;this._overlap=0;this._maxOverlap=0;this._velocity1=0;this._velocity2=0;this._newVelocity1=0;this._newVelocity2=0;this._average=0;this._mapData=[];this._mapTiles=0;this._result=false;this._total=0;this._angle=0;this._dx=0;this._dy=0};Phaser.Physics.Arcade.prototype={updateMotion:function(body){this._velocityDelta=(this.computeVelocity(0,body,body.angularVelocity,body.angularAcceleration,body.angularDrag,body.maxAngular)-body.angularVelocity)*this.game.time.physicsElapsed*.5*60;body.angularVelocity+=this._velocityDelta;body.rotation+=body.angularVelocity*this.game.time.physicsElapsed;body.angularVelocity+=this._velocityDelta;this._velocityDelta=(this.computeVelocity(1,body,body.velocity.x,body.acceleration.x,body.drag.x,body.maxVelocity.x)-body.velocity.x)*this.game.time.physicsElapsed*.5*60;body.velocity.x+=this._velocityDelta;body.x+=body.velocity.x*this.game.time.physicsElapsed;body.velocity.x+=this._velocityDelta;this._velocityDelta=(this.computeVelocity(2,body,body.velocity.y,body.acceleration.y,body.drag.y,body.maxVelocity.y)-body.velocity.y)*this.game.time.physicsElapsed*.5*60;body.velocity.y+=this._velocityDelta;body.y+=body.velocity.y*this.game.time.physicsElapsed;body.velocity.y+=this._velocityDelta},computeVelocity:function(axis,body,velocity,acceleration,drag,max){max=max||1e4;if(axis==1&&body.allowGravity){velocity+=this.gravity.x+body.gravity.x}else if(axis==2&&body.allowGravity){velocity+=this.gravity.y+body.gravity.y}if(acceleration!==0){velocity+=acceleration*this.game.time.physicsElapsed}else if(drag!==0){this._drag=drag*this.game.time.physicsElapsed;if(velocity-this._drag>0){velocity-=this._drag}else if(velocity+this._drag<0){velocity+=this._drag}else{velocity=0}}if(velocity>max){velocity=max}else if(velocity<-max){velocity=-max}return velocity},preUpdate:function(){this.quadTree.clear();this.quadTreeID=0;this.quadTree=new Phaser.QuadTree(this,this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels)},postUpdate:function(){this.quadTree.clear()},overlap:function(object1,object2,overlapCallback,processCallback,callbackContext){overlapCallback=overlapCallback||null;processCallback=processCallback||null;callbackContext=callbackContext||overlapCallback;this._result=false;this._total=0;if(object1&&object2&&object1.exists&&object2.exists){if(object1.type==Phaser.SPRITE){if(object2.type==Phaser.SPRITE){this.overlapSpriteVsSprite(object1,object2,overlapCallback,processCallback,callbackContext)}else if(object2.type==Phaser.GROUP||object2.type==Phaser.EMITTER){this.overlapSpriteVsGroup(object1,object2,overlapCallback,processCallback,callbackContext)}}else if(object1.type==Phaser.GROUP){if(object2.type==Phaser.SPRITE){this.overlapSpriteVsGroup(object2,object1,overlapCallback,processCallback,callbackContext)}else if(object2.type==Phaser.GROUP||object2.type==Phaser.EMITTER){this.overlapGroupVsGroup(object1,object2,overlapCallback,processCallback,callbackContext)}}else if(object1.type==Phaser.EMITTER){if(object2.type==Phaser.SPRITE){this.overlapSpriteVsGroup(object2,object1,overlapCallback,processCallback,callbackContext)}else if(object2.type==Phaser.GROUP||object2.type==Phaser.EMITTER){this.overlapGroupVsGroup(object1,object2,overlapCallback,processCallback,callbackContext)}}}return this._total>0},overlapSpriteVsSprite:function(sprite1,sprite2,overlapCallback,processCallback,callbackContext){this._result=Phaser.Rectangle.intersects(sprite1.body,sprite2.body);if(this._result){if(processCallback){if(processCallback.call(callbackContext,sprite1,sprite2)){this._total++;if(overlapCallback){overlapCallback.call(callbackContext,sprite1,sprite2)}}}else{this._total++;if(overlapCallback){overlapCallback.call(callbackContext,sprite1,sprite2)}}}},overlapSpriteVsGroup:function(sprite,group,overlapCallback,processCallback,callbackContext){if(group.length===0){return}this._potentials=this.quadTree.retrieve(sprite);for(var i=0,len=this._potentials.length;i<len;i++){if(this._potentials[i].sprite.group==group){this._result=Phaser.Rectangle.intersects(sprite.body,this._potentials[i]);if(this._result&&processCallback){this._result=processCallback.call(callbackContext,sprite,this._potentials[i].sprite)}if(this._result){this._total++;if(overlapCallback){overlapCallback.call(callbackContext,sprite,this._potentials[i].sprite)}}}}},overlapGroupVsGroup:function(group1,group2,overlapCallback,processCallback,callbackContext){if(group1.length===0||group2.length===0){return}if(group1._container.first._iNext){var currentNode=group1._container.first._iNext;do{if(currentNode.exists){this.overlapSpriteVsGroup(currentNode,group2,overlapCallback,processCallback,callbackContext)}currentNode=currentNode._iNext}while(currentNode!=group1._container.last._iNext)}},collide:function(object1,object2,collideCallback,processCallback,callbackContext){collideCallback=collideCallback||null;processCallback=processCallback||null;callbackContext=callbackContext||collideCallback;this._result=false;this._total=0;if(object1&&object2&&object1.exists&&object2.exists){if(object1.type==Phaser.SPRITE){if(object2.type==Phaser.SPRITE){this.collideSpriteVsSprite(object1,object2,collideCallback,processCallback,callbackContext)}else if(object2.type==Phaser.GROUP||object2.type==Phaser.EMITTER){this.collideSpriteVsGroup(object1,object2,collideCallback,processCallback,callbackContext)}else if(object2.type==Phaser.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(object1,object2,collideCallback,processCallback,callbackContext)}}else if(object1.type==Phaser.GROUP){if(object2.type==Phaser.SPRITE){this.collideSpriteVsGroup(object2,object1,collideCallback,processCallback,callbackContext)}else if(object2.type==Phaser.GROUP||object2.type==Phaser.EMITTER){this.collideGroupVsGroup(object1,object2,collideCallback,processCallback,callbackContext)}else if(object2.type==Phaser.TILEMAPLAYER){this.collideGroupVsTilemapLayer(object1,object2,collideCallback,processCallback,callbackContext)}}else if(object1.type==Phaser.TILEMAPLAYER){if(object2.type==Phaser.SPRITE){this.collideSpriteVsTilemapLayer(object2,object1,collideCallback,processCallback,callbackContext)}else if(object2.type==Phaser.GROUP||object2.type==Phaser.EMITTER){this.collideGroupVsTilemapLayer(object2,object1,collideCallback,processCallback,callbackContext)}}else if(object1.type==Phaser.EMITTER){if(object2.type==Phaser.SPRITE){this.collideSpriteVsGroup(object2,object1,collideCallback,processCallback,callbackContext)}else if(object2.type==Phaser.GROUP||object2.type==Phaser.EMITTER){this.collideGroupVsGroup(object1,object2,collideCallback,processCallback,callbackContext)}else if(object2.type==Phaser.TILEMAPLAYER){this.collideGroupVsTilemapLayer(object1,object2,collideCallback,processCallback,callbackContext)}}}return this._total>0},collideSpriteVsTilemapLayer:function(sprite,tilemapLayer,collideCallback,processCallback,callbackContext){this._mapData=tilemapLayer.getTiles(sprite.body.x,sprite.body.y,sprite.body.width,sprite.body.height,true);if(this._mapData.length===0){return}for(var i=0;i<this._mapData.length;i++){if(this.separateTile(sprite.body,this._mapData[i])){if(processCallback){if(processCallback.call(callbackContext,sprite,this._mapData[i])){this._total++;if(collideCallback){collideCallback.call(callbackContext,sprite,this._mapData[i])}}}else{this._total++;if(collideCallback){collideCallback.call(callbackContext,sprite,this._mapData[i])}}}}},collideGroupVsTilemapLayer:function(group,tilemapLayer,collideCallback,processCallback,callbackContext){if(group.length===0){return}if(group.length===0){return}if(group._container.first._iNext){var currentNode=group._container.first._iNext;do{if(currentNode.exists){this.collideSpriteVsTilemapLayer(currentNode,tilemapLayer,collideCallback,processCallback,callbackContext)}currentNode=currentNode._iNext}while(currentNode!=group._container.last._iNext)}},collideSpriteVsSprite:function(sprite1,sprite2,collideCallback,processCallback,callbackContext){this.separate(sprite1.body,sprite2.body);if(this._result){if(processCallback){if(processCallback.call(callbackContext,sprite1,sprite2)){this._total++;if(collideCallback){collideCallback.call(callbackContext,sprite1,sprite2)}}}else{this._total++;if(collideCallback){collideCallback.call(callbackContext,sprite1,sprite2)}}}},collideSpriteVsGroup:function(sprite,group,collideCallback,processCallback,callbackContext){if(group.length===0){return}this._potentials=this.quadTree.retrieve(sprite);for(var i=0,len=this._potentials.length;i<len;i++){if(this._potentials[i].sprite.group==group){this.separate(sprite.body,this._potentials[i]);if(this._result&&processCallback){this._result=processCallback.call(callbackContext,sprite,this._potentials[i].sprite)}if(this._result){this._total++;if(collideCallback){collideCallback.call(callbackContext,sprite,this._potentials[i].sprite)}}}}},collideGroupVsGroup:function(group1,group2,collideCallback,processCallback,callbackContext){if(group1.length===0||group2.length===0){return}if(group1._container.first._iNext){var currentNode=group1._container.first._iNext;do{if(currentNode.exists){this.collideSpriteVsGroup(currentNode,group2,collideCallback,processCallback,callbackContext)}currentNode=currentNode._iNext}while(currentNode!=group1._container.last._iNext)}},separate:function(body1,body2){this._result=this.separateX(body1,body2)||this.separateY(body1,body2)},separateX:function(body1,body2){if(body1.immovable&&body2.immovable){return false}this._overlap=0;if(Phaser.Rectangle.intersects(body1,body2)){this._maxOverlap=body1.deltaAbsX()+body2.deltaAbsX()+this.OVERLAP_BIAS;if(body1.deltaX()===0&&body2.deltaX()===0){body1.embedded=true;body2.embedded=true}else if(body1.deltaX()>body2.deltaX()){this._overlap=body1.x+body1.width-body2.x;if(this._overlap>this._maxOverlap||body1.allowCollision.right===false||body2.allowCollision.left===false){this._overlap=0}else{body1.touching.right=true;body2.touching.left=true}}else if(body1.deltaX()<body2.deltaX()){this._overlap=body1.x-body2.width-body2.x;if(-this._overlap>this._maxOverlap||body1.allowCollision.left===false||body2.allowCollision.right===false){this._overlap=0}else{body1.touching.left=true;body2.touching.right=true}}if(this._overlap!==0){body1.overlapX=this._overlap;body2.overlapX=this._overlap;if(body1.customSeparateX||body2.customSeparateX){return true}this._velocity1=body1.velocity.x;this._velocity2=body2.velocity.x;if(!body1.immovable&&!body2.immovable){this._overlap*=.5;body1.x=body1.x-this._overlap;body2.x+=this._overlap;this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*body2.mass/body1.mass)*(this._velocity2>0?1:-1);this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*body1.mass/body2.mass)*(this._velocity1>0?1:-1);this._average=(this._newVelocity1+this._newVelocity2)*.5;this._newVelocity1-=this._average;this._newVelocity2-=this._average;body1.velocity.x=this._average+this._newVelocity1*body1.bounce.x;body2.velocity.x=this._average+this._newVelocity2*body2.bounce.x}else if(!body1.immovable){body1.x=body1.x-this._overlap;body1.velocity.x=this._velocity2-this._velocity1*body1.bounce.x}else if(!body2.immovable){body2.x+=this._overlap;body2.velocity.x=this._velocity1-this._velocity2*body2.bounce.x}body1.updateHulls();body2.updateHulls();return true}}return false},separateY:function(body1,body2){if(body1.immovable&&body2.immovable){return false}this._overlap=0;if(Phaser.Rectangle.intersects(body1,body2)){this._maxOverlap=body1.deltaAbsY()+body2.deltaAbsY()+this.OVERLAP_BIAS;if(body1.deltaY()===0&&body2.deltaY()===0){body1.embedded=true;body2.embedded=true}else if(body1.deltaY()>body2.deltaY()){this._overlap=body1.y+body1.height-body2.y;if(this._overlap>this._maxOverlap||body1.allowCollision.down===false||body2.allowCollision.up===false){this._overlap=0}else{body1.touching.down=true;body2.touching.up=true}}else if(body1.deltaY()<body2.deltaY()){this._overlap=body1.y-body2.height-body2.y;if(-this._overlap>this._maxOverlap||body1.allowCollision.up===false||body2.allowCollision.down===false){this._overlap=0}else{body1.touching.up=true;body2.touching.down=true}}if(this._overlap!==0){body1.overlapY=this._overlap;body2.overlapY=this._overlap;if(body1.customSeparateY||body2.customSeparateY){return true}this._velocity1=body1.velocity.y;this._velocity2=body2.velocity.y;if(!body1.immovable&&!body2.immovable){this._overlap*=.5;body1.y=body1.y-this._overlap;body2.y+=this._overlap;this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*body2.mass/body1.mass)*(this._velocity2>0?1:-1);this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*body1.mass/body2.mass)*(this._velocity1>0?1:-1);this._average=(this._newVelocity1+this._newVelocity2)*.5;this._newVelocity1-=this._average;this._newVelocity2-=this._average;body1.velocity.y=this._average+this._newVelocity1*body1.bounce.y;body2.velocity.y=this._average+this._newVelocity2*body2.bounce.y}else if(!body1.immovable){body1.y=body1.y-this._overlap;body1.velocity.y=this._velocity2-this._velocity1*body1.bounce.y;if(body2.active&&body2.moves&&body1.deltaY()>body2.deltaY()){body1.x+=body2.x-body2.lastX}}else if(!body2.immovable){body2.y+=this._overlap;body2.velocity.y=this._velocity1-this._velocity2*body2.bounce.y;if(body1.sprite.active&&body1.moves&&body1.deltaY()<body2.deltaY()){body2.x+=body1.x-body1.lastX}}body1.updateHulls();body2.updateHulls();return true}}return false},separateTile:function(body,tile){this._result=this.separateTileX(body,tile,true)||this.separateTileY(body,tile,true);return this._result},separateTileX:function(body,tile,separate){if(body.immovable||body.deltaX()===0||Phaser.Rectangle.intersects(body.hullX,tile)===false){return false}this._overlap=0;if(body.deltaX()<0){this._overlap=tile.right-body.hullX.x;if(body.allowCollision.left===false||tile.tile.collideRight===false){this._overlap=0}else{body.touching.left=true}}else{this._overlap=body.hullX.right-tile.x;if(body.allowCollision.right===false||tile.tile.collideLeft===false){this._overlap=0}else{body.touching.right=true}}if(this._overlap!==0){if(separate){if(body.deltaX()<0){body.x=body.x+this._overlap}else{body.x=body.x-this._overlap}if(body.bounce.x===0){body.velocity.x=0}else{body.velocity.x=-body.velocity.x*body.bounce.x}body.updateHulls()}return true}else{return false}},separateTileY:function(body,tile,separate){if(body.immovable||body.deltaY()===0||Phaser.Rectangle.intersects(body.hullY,tile)===false){return false}this._overlap=0;if(body.deltaY()<0){this._overlap=tile.bottom-body.hullY.y;if(body.allowCollision.up===false||tile.tile.collideDown===false){this._overlap=0}else{body.touching.up=true}}else{this._overlap=body.hullY.bottom-tile.y;if(body.allowCollision.down===false||tile.tile.collideUp===false){this._overlap=0}else{body.touching.down=true}}if(this._overlap!==0){if(separate){if(body.deltaY()<0){body.y=body.y+this._overlap}else{body.y=body.y-this._overlap}if(body.bounce.y===0){body.velocity.y=0}else{body.velocity.y=-body.velocity.y*body.bounce.y}body.updateHulls()}return true}else{return false}},moveToObject:function(displayObject,destination,speed,maxTime){if(typeof speed==="undefined"){speed=60}if(typeof maxTime==="undefined"){maxTime=0}this._angle=Math.atan2(destination.y-displayObject.y,destination.x-displayObject.x);if(maxTime>0){speed=this.distanceBetween(displayObject,destination)/(maxTime/1e3)}displayObject.body.velocity.x=Math.cos(this._angle)*speed;displayObject.body.velocity.y=Math.sin(this._angle)*speed;return this._angle},moveToPointer:function(displayObject,speed,pointer,maxTime){if(typeof speed==="undefined"){speed=60}pointer=pointer||this.game.input.activePointer;if(typeof maxTime==="undefined"){maxTime=0}this._angle=this.angleToPointer(displayObject,pointer);if(maxTime>0){speed=this.distanceToPointer(displayObject,pointer)/(maxTime/1e3)}displayObject.body.velocity.x=Math.cos(this._angle)*speed;displayObject.body.velocity.y=Math.sin(this._angle)*speed;return this._angle},moveToXY:function(displayObject,x,y,speed,maxTime){if(typeof speed==="undefined"){speed=60}if(typeof maxTime==="undefined"){maxTime=0}this._angle=Math.atan2(y-displayObject.y,x-displayObject.x);if(maxTime>0){speed=this.distanceToXY(displayObject,x,y)/(maxTime/1e3)}displayObject.body.velocity.x=Math.cos(this._angle)*speed;displayObject.body.velocity.y=Math.sin(this._angle)*speed;return this._angle},velocityFromAngle:function(angle,speed,point){if(typeof speed==="undefined"){speed=60}point=point||new Phaser.Point;return point.setTo(Math.cos(this.game.math.degToRad(angle))*speed,Math.sin(this.game.math.degToRad(angle))*speed)},velocityFromRotation:function(rotation,speed,point){if(typeof speed==="undefined"){speed=60}point=point||new Phaser.Point;return point.setTo(Math.cos(rotation)*speed,Math.sin(rotation)*speed)},accelerationFromRotation:function(rotation,speed,point){if(typeof speed==="undefined"){speed=60}point=point||new Phaser.Point;return point.setTo(Math.cos(rotation)*speed,Math.sin(rotation)*speed)},accelerateToObject:function(displayObject,destination,speed,xSpeedMax,ySpeedMax){if(typeof speed==="undefined"){speed=60}if(typeof xSpeedMax==="undefined"){xSpeedMax=1e3}if(typeof ySpeedMax==="undefined"){ySpeedMax=1e3}this._angle=this.angleBetween(displayObject,destination);displayObject.body.acceleration.setTo(Math.cos(this._angle)*speed,Math.sin(this._angle)*speed);displayObject.body.maxVelocity.setTo(xSpeedMax,ySpeedMax);return this._angle},accelerateToPointer:function(displayObject,pointer,speed,xSpeedMax,ySpeedMax){if(typeof speed==="undefined"){speed=60}if(typeof pointer==="undefined"){pointer=this.game.input.activePointer}if(typeof xSpeedMax==="undefined"){xSpeedMax=1e3}if(typeof ySpeedMax==="undefined"){ySpeedMax=1e3}this._angle=this.angleToPointer(displayObject,pointer);displayObject.body.acceleration.setTo(Math.cos(this._angle)*speed,Math.sin(this._angle)*speed);displayObject.body.maxVelocity.setTo(xSpeedMax,ySpeedMax);return this._angle},accelerateToXY:function(displayObject,x,y,speed,xSpeedMax,ySpeedMax){if(typeof speed==="undefined"){speed=60}if(typeof xSpeedMax==="undefined"){xSpeedMax=1e3}if(typeof ySpeedMax==="undefined"){ySpeedMax=1e3}this._angle=this.angleToXY(displayObject,x,y);displayObject.body.acceleration.setTo(Math.cos(this._angle)*speed,Math.sin(this._angle)*speed);displayObject.body.maxVelocity.setTo(xSpeedMax,ySpeedMax);return this._angle},distanceBetween:function(source,target){this._dx=source.x-target.x;this._dy=source.y-target.y;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(displayObject,x,y){this._dx=displayObject.x-x;this._dy=displayObject.y-y;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(displayObject,pointer){pointer=pointer||this.game.input.activePointer;this._dx=displayObject.x-pointer.x;this._dy=displayObject.y-pointer.y;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(source,target){this._dx=target.x-source.x;this._dy=target.y-source.y;return Math.atan2(this._dy,this._dx)},angleToXY:function(displayObject,x,y){this._dx=x-displayObject.x;this._dy=y-displayObject.y;return Math.atan2(this._dy,this._dx)},angleToPointer:function(displayObject,pointer){pointer=pointer||this.game.input.activePointer;this._dx=pointer.worldX-displayObject.x;this._dy=pointer.worldY-displayObject.y;return Math.atan2(this._dy,this._dx)}};Phaser.Physics.Arcade.Body=function(sprite){this.sprite=sprite;this.game=sprite.game;this.offset=new Phaser.Point;this.x=sprite.x;this.y=sprite.y;this.preX=sprite.x;this.preY=sprite.y;this.preRotation=sprite.angle;this.screenX=sprite.x;this.screenY=sprite.y;this.sourceWidth=sprite.currentFrame.sourceSizeW;this.sourceHeight=sprite.currentFrame.sourceSizeH;this.width=sprite.currentFrame.sourceSizeW;this.height=sprite.currentFrame.sourceSizeH;this.halfWidth=Math.floor(sprite.currentFrame.sourceSizeW/2);this.halfHeight=Math.floor(sprite.currentFrame.sourceSizeH/2);this.center=new Phaser.Point(this.x+this.halfWidth,this.y+this.halfHeight);this._sx=sprite.scale.x;this._sy=sprite.scale.y;this.velocity=new Phaser.Point;this.acceleration=new Phaser.Point;this.drag=new Phaser.Point;this.gravity=new Phaser.Point;this.bounce=new Phaser.Point;this.maxVelocity=new Phaser.Point(1e4,1e4);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e3;this.mass=1;this.skipQuadTree=false;this.quadTreeIDs=[];this.quadTreeIndex=-1;this.allowCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.facing=Phaser.NONE;this.immovable=false;this.moves=true;this.rotation=0;this.allowRotation=true;this.allowGravity=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.hullX=new Phaser.Rectangle;this.hullY=new Phaser.Rectangle;this.embedded=false;this.collideWorldBounds=false};Phaser.Physics.Arcade.Body.prototype={updateBounds:function(centerX,centerY,scaleX,scaleY){if(scaleX!=this._sx||scaleY!=this._sy){this.width=this.sourceWidth*scaleX;this.height=this.sourceHeight*scaleY;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this._sx=scaleX;this._sy=scaleY;this.center.setTo(this.x+this.halfWidth,this.y+this.halfHeight)}},preUpdate:function(){this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.embedded=false;this.screenX=this.sprite.worldTransform[2]-this.sprite.anchor.x*this.width+this.offset.x;this.screenY=this.sprite.worldTransform[5]-this.sprite.anchor.y*this.height+this.offset.y;this.preX=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x;this.preY=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y;this.preRotation=this.sprite.angle;this.x=this.preX;this.y=this.preY;this.rotation=this.preRotation;if(this.moves){this.game.physics.updateMotion(this);if(this.collideWorldBounds){this.checkWorldBounds()}this.updateHulls()}if(this.skipQuadTree===false&&this.allowCollision.none===false&&this.sprite.visible&&this.sprite.alive){this.quadTreeIDs=[];this.quadTreeIndex=-1;this.game.physics.quadTree.insert(this)}},postUpdate:function(){if(this.deltaX()<0){this.facing=Phaser.LEFT}else if(this.deltaX()>0){this.facing=Phaser.RIGHT}if(this.deltaY()<0){this.facing=Phaser.UP}else if(this.deltaY()>0){this.facing=Phaser.DOWN}if(this.deltaX()!==0||this.deltaY()!==0){this.sprite.x+=this.deltaX();this.sprite.y+=this.deltaY();this.center.setTo(this.x+this.halfWidth,this.y+this.halfHeight)}if(this.allowRotation){this.sprite.angle+=this.deltaZ()}},updateHulls:function(){this.hullX.setTo(this.x,this.preY,this.width,this.height);this.hullY.setTo(this.preX,this.y,this.width,this.height)},checkWorldBounds:function(){if(this.x<this.game.world.bounds.x){this.x=this.game.world.bounds.x;this.velocity.x*=-this.bounce.x}else if(this.right>this.game.world.bounds.right){this.x=this.game.world.bounds.right-this.width;this.velocity.x*=-this.bounce.x}if(this.y<this.game.world.bounds.y){this.y=this.game.world.bounds.y;this.velocity.y*=-this.bounce.y}else if(this.bottom>this.game.world.bounds.bottom){this.y=this.game.world.bounds.bottom-this.height;this.velocity.y*=-this.bounce.y}},setSize:function(width,height,offsetX,offsetY){offsetX=offsetX||this.offset.x;offsetY=offsetY||this.offset.y;this.sourceWidth=width;this.sourceHeight=height;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(offsetX,offsetY);this.center.setTo(this.x+this.halfWidth,this.y+this.halfHeight)},reset:function(){this.velocity.setTo(0,0);this.acceleration.setTo(0,0);this.angularVelocity=0;this.angularAcceleration=0;this.preX=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x;this.preY=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y;this.preRotation=this.sprite.angle;this.x=this.preX;this.y=this.preY;this.rotation=this.preRotation;this.center.setTo(this.x+this.halfWidth,this.y+this.halfHeight)},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.x-this.preX},deltaY:function(){return this.y-this.preY},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(Phaser.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.y+this.height},set:function(value){if(value<=this.y){this.height=0}else{this.height=this.y-value}}});Object.defineProperty(Phaser.Physics.Arcade.Body.prototype,"right",{get:function(){return this.x+this.width},set:function(value){if(value<=this.x){this.width=0}else{this.width=this.x+value}}});Phaser.Particles=function(game){this.game=game;this.emitters={};this.ID=0};Phaser.Particles.prototype={add:function(emitter){this.emitters[emitter.name]=emitter;return emitter},remove:function(emitter){delete this.emitters[emitter.name]},update:function(){for(var key in this.emitters){if(this.emitters[key].exists){this.emitters[key].update()}}}};Phaser.Particles.Arcade={};Phaser.Particles.Arcade.Emitter=function(game,x,y,maxParticles){this.maxParticles=maxParticles||50;Phaser.Group.call(this,game);this.name="emitter"+this.game.particles.ID++;this.type=Phaser.EMITTER;this.x=0;this.y=0;this.width=1;this.height=1;this.minParticleSpeed=new Phaser.Point(-100,-100);this.maxParticleSpeed=new Phaser.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.minRotation=-360;this.maxRotation=360;this.gravity=2;this.particleClass=null;this.particleDrag=new Phaser.Point;this.angularDrag=0;
this.frequency=100;this.lifespan=2e3;this.bounce=new Phaser.Point;this._quantity=0;this._timer=0;this._counter=0;this._explode=true;this.on=false;this.exists=true;this.emitX=x;this.emitY=y};Phaser.Particles.Arcade.Emitter.prototype=Object.create(Phaser.Group.prototype);Phaser.Particles.Arcade.Emitter.prototype.constructor=Phaser.Particles.Arcade.Emitter;Phaser.Particles.Arcade.Emitter.prototype.update=function(){if(this.on){if(this._explode){this._counter=0;do{this.emitParticle();this._counter++}while(this._counter<this._quantity);this.on=false}else{if(this.game.time.now>=this._timer){this.emitParticle();this._counter++;if(this._quantity>0){if(this._counter>=this._quantity){this.on=false}}this._timer=this.game.time.now+this.frequency}}}};Phaser.Particles.Arcade.Emitter.prototype.makeParticles=function(keys,frames,quantity,collide,collideWorldBounds){if(typeof frames=="undefined"){frames=0}quantity=quantity||this.maxParticles;collide=collide||0;if(typeof collideWorldBounds=="undefined"){collideWorldBounds=false}var particle;var i=0;var rndKey=keys;var rndFrame=0;while(i<quantity){if(this.particleClass==null){if(typeof keys=="object"){rndKey=this.game.rnd.pick(keys)}if(typeof frames=="object"){rndFrame=this.game.rnd.pick(frames)}particle=new Phaser.Sprite(this.game,0,0,rndKey,rndFrame)}if(collide>0){particle.body.allowCollision.any=true;particle.body.allowCollision.none=false}else{particle.body.allowCollision.none=true}particle.body.collideWorldBounds=collideWorldBounds;particle.exists=false;particle.visible=false;particle.anchor.setTo(.5,.5);this.add(particle);i++}return this};Phaser.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false};Phaser.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true};Phaser.Particles.Arcade.Emitter.prototype.start=function(explode,lifespan,frequency,quantity){if(typeof explode!=="boolean"){explode=true}lifespan=lifespan||0;frequency=frequency||250;quantity=quantity||0;this.revive();this.visible=true;this.on=true;this._explode=explode;this.lifespan=lifespan;this.frequency=frequency;if(explode){this._quantity=quantity}else{this._quantity+=quantity}this._counter=0;this._timer=this.game.time.now+frequency};Phaser.Particles.Arcade.Emitter.prototype.emitParticle=function(){var particle=this.getFirstExists(false);if(particle==null){return}if(this.width>1||this.height>1){particle.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom))}else{particle.reset(this.emitX,this.emitY)}particle.lifespan=this.lifespan;particle.body.bounce.setTo(this.bounce.x,this.bounce.y);if(this.minParticleSpeed.x!=this.maxParticleSpeed.x){particle.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x)}else{particle.body.velocity.x=this.minParticleSpeed.x}if(this.minParticleSpeed.y!=this.maxParticleSpeed.y){particle.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y)}else{particle.body.velocity.y=this.minParticleSpeed.y}particle.body.gravity.y=this.gravity;if(this.minRotation!=this.maxRotation){particle.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation)}else{particle.body.angularVelocity=this.minRotation}if(this.minParticleScale!==1||this.maxParticleScale!==1){var scale=this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale);particle.scale.setTo(scale,scale)}particle.body.drag.x=this.particleDrag.x;particle.body.drag.y=this.particleDrag.y;particle.body.angularDrag=this.angularDrag};Phaser.Particles.Arcade.Emitter.prototype.setSize=function(width,height){this.width=width;this.height=height};Phaser.Particles.Arcade.Emitter.prototype.setXSpeed=function(min,max){min=min||0;max=max||0;this.minParticleSpeed.x=min;this.maxParticleSpeed.x=max};Phaser.Particles.Arcade.Emitter.prototype.setYSpeed=function(min,max){min=min||0;max=max||0;this.minParticleSpeed.y=min;this.maxParticleSpeed.y=max};Phaser.Particles.Arcade.Emitter.prototype.setRotation=function(min,max){min=min||0;max=max||0;this.minRotation=min;this.maxRotation=max};Phaser.Particles.Arcade.Emitter.prototype.at=function(object){this.emitX=object.center.x;this.emitY=object.center.y};Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"alpha",{get:function(){return this._container.alpha},set:function(value){this._container.alpha=value}});Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"visible",{get:function(){return this._container.visible},set:function(value){this._container.visible=value}});Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(value){this.emitX=value}});Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(value){this.emitY=value}});Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.width/2)}});Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.width/2)}});Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.height/2)}});Object.defineProperty(Phaser.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.height/2)}});Phaser.Tile=function(tileset,index,x,y,width,height){this.tileset=tileset;this.index=index;this.width=width;this.height=height;this.x=x;this.y=y;this.mass=1;this.collideNone=true;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.separateX=true;this.separateY=true;this.collisionCallback=null;this.collisionCallbackContext=this};Phaser.Tile.prototype={setCollisionCallback:function(callback,context){this.collisionCallbackContext=context;this.collisionCallback=callback},destroy:function(){this.tileset=null},setCollision:function(left,right,up,down){this.collideLeft=left;this.collideRight=right;this.collideUp=up;this.collideDown=down;if(left||right||up||down){this.collideNone=false}else{this.collideNone=true}},resetCollision:function(){this.collideNone=true;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false}};Object.defineProperty(Phaser.Tile.prototype,"bottom",{get:function(){return this.y+this.height}});Object.defineProperty(Phaser.Tile.prototype,"right",{get:function(){return this.x+this.width}});Phaser.Tilemap=function(game,key){this.game=game;this.layers=null;if(typeof key==="string"){this.key=key;this.layers=game.cache.getTilemapData(key).layers;this.calculateIndexes()}else{this.layers=[]}this.currentLayer=0;this.debugMap=[];this.dirty=false;this._results=[];this._tempA=0;this._tempB=0};Phaser.Tilemap.CSV=0;Phaser.Tilemap.TILED_JSON=1;Phaser.Tilemap.prototype={create:function(name,width,height){var data=[];for(var y=0;y<height;y++){data[y]=[];for(var x=0;x<width;x++){data[y][x]=0}}this.layers.push({name:name,width:width,height:height,alpha:1,visible:true,tileMargin:0,tileSpacing:0,format:Phaser.Tilemap.CSV,data:data,indexes:[]});this.currentLayer=this.layers.length-1;this.dirty=true},calculateIndexes:function(){for(var layer=0;layer<this.layers.length;layer++){this.layers[layer].indexes=[];for(var y=0;y<this.layers[layer].height;y++){for(var x=0;x<this.layers[layer].width;x++){var idx=this.layers[layer].data[y][x];if(this.layers[layer].indexes.indexOf(idx)===-1){this.layers[layer].indexes.push(idx)}}}}},setLayer:function(layer){if(this.layers[layer]){this.currentLayer=layer}},putTile:function(index,x,y,layer){if(typeof layer==="undefined"){layer=this.currentLayer}if(x>=0&&x<this.layers[layer].width&&y>=0&&y<this.layers[layer].height){this.layers[layer].data[y][x]=index}this.dirty=true},getTile:function(x,y,layer){if(typeof layer==="undefined"){layer=this.currentLayer}if(x>=0&&x<this.layers[layer].width&&y>=0&&y<this.layers[layer].height){return this.layers[layer].data[y][x]}},getTileWorldXY:function(x,y,tileWidth,tileHeight,layer){if(typeof layer==="undefined"){layer=this.currentLayer}x=this.game.math.snapToFloor(x,tileWidth)/tileWidth;y=this.game.math.snapToFloor(y,tileHeight)/tileHeight;if(x>=0&&x<this.layers[layer].width&&y>=0&&y<this.layers[layer].height){return this.layers[layer].data[y][x]}},putTileWorldXY:function(index,x,y,tileWidth,tileHeight,layer){if(typeof layer==="undefined"){layer=this.currentLayer}x=this.game.math.snapToFloor(x,tileWidth)/tileWidth;y=this.game.math.snapToFloor(y,tileHeight)/tileHeight;if(x>=0&&x<this.layers[layer].width&&y>=0&&y<this.layers[layer].height){this.layers[layer].data[y][x]=index}this.dirty=true},copy:function(x,y,width,height,layer){if(typeof layer==="undefined"){layer=this.currentLayer}if(!this.layers[layer]){this._results.length=0;return}if(typeof x==="undefined"){x=0}if(typeof y==="undefined"){y=0}if(typeof width==="undefined"){width=this.layers[layer].width}if(typeof height==="undefined"){height=this.layers[layer].height}if(x<0){x=0}if(y<0){y=0}if(width>this.layers[layer].width){width=this.layers[layer].width}if(height>this.layers[layer].height){height=this.layers[layer].height}this._results.length=0;this._results.push({x:x,y:y,width:width,height:height,layer:layer});for(var ty=y;ty<y+height;ty++){for(var tx=x;tx<x+width;tx++){this._results.push({x:tx,y:ty,index:this.layers[layer].data[ty][tx]})}}return this._results},paste:function(x,y,tileblock,layer){if(typeof x==="undefined"){x=0}if(typeof y==="undefined"){y=0}if(typeof layer==="undefined"){layer=this.currentLayer}if(!tileblock||tileblock.length<2){return}var diffX=tileblock[1].x-x;var diffY=tileblock[1].y-y;for(var i=1;i<tileblock.length;i++){this.layers[layer].data[diffY+tileblock[i].y][diffX+tileblock[i].x]=tileblock[i].index}this.dirty=true},swap:function(tileA,tileB,x,y,width,height,layer){this.copy(x,y,width,height,layer);if(this._results.length<2){return}this._tempA=tileA;this._tempB=tileB;this._results.forEach(this.swapHandler,this);this.paste(x,y,this._results)},swapHandler:function(value,index){if(value.index===this._tempA){this._results[index].index=this._tempB}else if(value.index===this._tempB){this._results[index].index=this._tempA}},forEach:function(callback,context,x,y,width,height,layer){this.copy(x,y,width,height,layer);if(this._results.length<2){return}this._results.forEach(callback,context);this.paste(x,y,this._results)},replace:function(tileA,tileB,x,y,width,height,layer){this.copy(x,y,width,height,layer);if(this._results.length<2){return}for(var i=1;i<this._results.length;i++){if(this._results[i].index===tileA){this._results[i].index=tileB}}this.paste(x,y,this._results)},random:function(x,y,width,height,layer){if(typeof layer==="undefined"){layer=this.currentLayer}this.copy(x,y,width,height,layer);if(this._results.length<2){return}var indexes=[];for(var t=1;t<this._results.length;t++){var idx=this._results[t].index;if(indexes.indexOf(idx)===-1){indexes.push(idx)}}for(var i=1;i<this._results.length;i++){this._results[i].index=this.game.rnd.pick(indexes)}this.paste(x,y,this._results)},shuffle:function(x,y,width,height,layer){if(typeof layer==="undefined"){layer=this.currentLayer}this.copy(x,y,width,height,layer);if(this._results.length<2){return}var header=this._results.shift();Phaser.Utils.shuffle(this._results);this._results.unshift(header);this.paste(x,y,this._results)},fill:function(index,x,y,width,height,layer){this.copy(x,y,width,height,layer);if(this._results.length<2){return}for(var i=1;i<this._results.length;i++){this._results[i].index=index}this.paste(x,y,this._results)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var txt="";var args=[""];for(var y=0;y<this.layers[this.currentLayer].height;y++){for(var x=0;x<this.layers[this.currentLayer].width;x++){txt+="%c  ";if(this.layers[this.currentLayer].data[y][x]>1){if(this.debugMap[this.layers[this.currentLayer].data[y][x]]){args.push("background: "+this.debugMap[this.layers[this.currentLayer].data[y][x]])}else{args.push("background: #ffffff")}}else{args.push("background: rgb(0, 0, 0)")}}txt+="\n"}args[0]=txt;console.log.apply(console,args)},destroy:function(){this.removeAllLayers();this.game=null}};Phaser.TilemapLayer=function(game,x,y,renderWidth,renderHeight,tileset,tilemap,layer){this.game=game;this.canvas=Phaser.Canvas.create(renderWidth,renderHeight);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new Phaser.Frame(0,0,0,renderWidth,renderHeight,"tilemaplayer",game.rnd.uuid());Phaser.Sprite.call(this,this.game,x,y,this.texture,this.textureFrame);this.type=Phaser.TILEMAPLAYER;this.fixedToCamera=true;this.tileset=null;this.tileWidth=0;this.tileHeight=0;this.tileMargin=0;this.tileSpacing=0;this.widthInPixels=0;this.heightInPixels=0;this.renderWidth=renderWidth;this.renderHeight=renderHeight;this._ga=1;this._dx=0;this._dy=0;this._dw=0;this._dh=0;this._tx=0;this._ty=0;this._tw=0;this._th=0;this._tl=0;this._maxX=0;this._maxY=0;this._startX=0;this._startY=0;this._results=[];this._x=0;this._y=0;this._prevX=0;this._prevY=0;this.scrollFactorX=1;this.scrollFactorY=1;this.tilemap=null;this.layer=null;this.index=0;this.dirty=true;if(tileset instanceof Phaser.Tileset||typeof tileset==="string"){this.updateTileset(tileset)}if(tilemap instanceof Phaser.Tilemap){this.updateMapData(tilemap,layer)}};Phaser.TilemapLayer.prototype=Object.create(Phaser.Sprite.prototype);Phaser.TilemapLayer.prototype=Phaser.Utils.extend(true,Phaser.TilemapLayer.prototype,Phaser.Sprite.prototype,PIXI.Sprite.prototype);Phaser.TilemapLayer.prototype.constructor=Phaser.TilemapLayer;Phaser.TilemapLayer.prototype.update=function(){this.scrollX=this.game.camera.x*this.scrollFactorX;this.scrollY=this.game.camera.y*this.scrollFactorY;this.render()};Phaser.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.widthInPixels,this.heightInPixels)};Phaser.TilemapLayer.prototype.updateTileset=function(tileset){if(tileset instanceof Phaser.Tileset){this.tileset=tileset}else if(typeof tileset==="string"){this.tileset=this.game.cache.getTileset("tiles")}else{return}this.tileWidth=this.tileset.tileWidth;this.tileHeight=this.tileset.tileHeight;this.tileMargin=this.tileset.tileMargin;this.tileSpacing=this.tileset.tileSpacing;this.updateMax()};Phaser.TilemapLayer.prototype.updateMapData=function(tilemap,layer){if(typeof layer==="undefined"){layer=0}if(tilemap instanceof Phaser.Tilemap){this.tilemap=tilemap;this.layer=this.tilemap.layers[layer];this.index=layer;this.updateMax();this.tilemap.dirty=true}};Phaser.TilemapLayer.prototype._fixX=function(x){if(this.scrollFactorX===1){return x}var leftEdge=x-this._x/this.scrollFactorX;return this._x+leftEdge};Phaser.TilemapLayer.prototype._unfixX=function(x){if(this.scrollFactorX===1){return x}var leftEdge=x-this._x;return this._x/this.scrollFactorX+leftEdge};Phaser.TilemapLayer.prototype._fixY=function(y){if(this.scrollFactorY===1){return y}var topEdge=y-this._y/this.scrollFactorY;return this._y+topEdge};Phaser.TilemapLayer.prototype._unfixY=function(y){if(this.scrollFactorY===1){return y}var topEdge=y-this._y;return this._y/this.scrollFactorY+topEdge};Phaser.TilemapLayer.prototype.getTileX=function(x){var tileWidth=this.tileWidth*this.scale.x;return this.game.math.snapToFloor(this._fixX(x),tileWidth)/tileWidth};Phaser.TilemapLayer.prototype.getTileY=function(y){var tileHeight=this.tileHeight*this.scale.y;return this.game.math.snapToFloor(this._fixY(y),tileHeight)/tileHeight};Phaser.TilemapLayer.prototype.getTileXY=function(x,y,point){point.x=this.getTileX(x);point.y=this.getTileY(y);return point};Phaser.TilemapLayer.prototype.getTiles=function(x,y,width,height,collides){if(this.tilemap===null){return}if(typeof collides==="undefined"){collides=false}if(x<0){x=0}if(y<0){y=0}x=this._fixX(x);y=this._fixY(y);if(width>this.widthInPixels){width=this.widthInPixels}if(height>this.heightInPixels){height=this.heightInPixels}var tileWidth=this.tileWidth*this.scale.x;var tileHeight=this.tileHeight*this.scale.y;this._tx=this.game.math.snapToFloor(x,tileWidth)/tileWidth;this._ty=this.game.math.snapToFloor(y,tileHeight)/tileHeight;this._tw=(this.game.math.snapToCeil(width,tileWidth)+tileWidth)/tileWidth;this._th=(this.game.math.snapToCeil(height,tileHeight)+tileHeight)/tileHeight;this._results=[];var _index=0;var _tile=null;var sx=0;var sy=0;for(var wy=this._ty;wy<this._ty+this._th;wy++){for(var wx=this._tx;wx<this._tx+this._tw;wx++){if(this.layer.data[wy]&&this.layer.data[wy][wx]){_index=this.layer.data[wy][wx]-1;_tile=this.tileset.getTile(_index);sx=_tile.width*this.scale.x;sy=_tile.height*this.scale.y;if(collides===false||collides&&_tile.collideNone===false){var _wx=this._unfixX(wx*sx)/tileWidth;var _wy=this._unfixY(wy*sy)/tileHeight;this._results.push({x:_wx*sx,right:_wx*sx+sx,y:_wy*sy,bottom:_wy*sy+sy,width:sx,height:sy,tx:_wx,ty:_wy,tile:_tile})}}}}return this._results};Phaser.TilemapLayer.prototype.updateMax=function(){this._maxX=this.game.math.ceil(this.canvas.width/this.tileWidth)+1;this._maxY=this.game.math.ceil(this.canvas.height/this.tileHeight)+1;if(this.layer){if(this._maxX>this.layer.width){this._maxX=this.layer.width}if(this._maxY>this.layer.height){this._maxY=this.layer.height}this.widthInPixels=this.layer.width*this.tileWidth;this.heightInPixels=this.layer.height*this.tileHeight}this.dirty=true};Phaser.TilemapLayer.prototype.render=function(){if(this.tilemap&&this.tilemap.dirty){this.dirty=true}if(!this.dirty||!this.tileset||!this.tilemap||!this.visible){return}this._prevX=this._dx;this._prevY=this._dy;this._dx=-(this._x-this._startX*this.tileWidth);this._dy=-(this._y-this._startY*this.tileHeight);this._tx=this._dx;this._ty=this._dy;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var y=this._startY;y<this._startY+this._maxY;y++){this._column=this.layer.data[y];for(var x=this._startX;x<this._startX+this._maxX;x++){var tile=this.tileset.tiles[this._column[x]-1];if(tile){this.context.drawImage(this.tileset.image,tile.x,tile.y,this.tileWidth,this.tileHeight,Math.floor(this._tx),Math.floor(this._ty),this.tileWidth,this.tileHeight)}this._tx+=this.tileWidth}this._tx=this._dx;this._ty+=this.tileHeight}if(this.game.renderType==Phaser.WEBGL){PIXI.texturesToUpdate.push(this.baseTexture)}this.dirty=false;if(this.tilemap.dirty){this.tilemap.dirty=false}return true};Phaser.TilemapLayer.prototype.deltaAbsX=function(){return this.deltaX()>0?this.deltaX():-this.deltaX()};Phaser.TilemapLayer.prototype.deltaAbsY=function(){return this.deltaY()>0?this.deltaY():-this.deltaY()};Phaser.TilemapLayer.prototype.deltaX=function(){return this._dx-this._prevX};Phaser.TilemapLayer.prototype.deltaY=function(){return this._dy-this._prevY};Object.defineProperty(Phaser.TilemapLayer.prototype,"scrollX",{get:function(){return this._x},set:function(value){if(value!==this._x&&value>=0&&this.layer){this._x=value;if(this._x>this.widthInPixels-this.renderWidth){this._x=this.widthInPixels-this.renderWidth}this._startX=this.game.math.floor(this._x/this.tileWidth);if(this._startX<0){this._startX=0}if(this._startX+this._maxX>this.layer.width){this._startX=this.layer.width-this._maxX}this.dirty=true}}});Object.defineProperty(Phaser.TilemapLayer.prototype,"scrollY",{get:function(){return this._y},set:function(value){if(value!==this._y&&value>=0&&this.layer){this._y=value;if(this._y>this.heightInPixels-this.renderHeight){this._y=this.heightInPixels-this.renderHeight}this._startY=this.game.math.floor(this._y/this.tileHeight);if(this._startY<0){this._startY=0}if(this._startY+this._maxY>this.layer.height){this._startY=this.layer.height-this._maxY}this.dirty=true}}});Phaser.TilemapParser={tileset:function(game,key,tileWidth,tileHeight,tileMax,tileMargin,tileSpacing){var img=game.cache.getTilesetImage(key);if(img==null){return null}var width=img.width;var height=img.height;if(tileWidth<=0){tileWidth=Math.floor(-width/Math.min(-1,tileWidth))}if(tileHeight<=0){tileHeight=Math.floor(-height/Math.min(-1,tileHeight))}var row=Math.round(width/tileWidth);var column=Math.round(height/tileHeight);var total=row*column;if(tileMax!==-1){total=tileMax}if(width===0||height===0||width<tileWidth||height<tileHeight||total===0){console.warn("Phaser.TilemapParser.tileSet: width/height zero or width/height < given tileWidth/tileHeight");return null}var x=tileMargin;var y=tileMargin;var tileset=new Phaser.Tileset(img,key,tileWidth,tileHeight,tileMargin,tileSpacing);for(var i=0;i<total;i++){tileset.addTile(new Phaser.Tile(tileset,i,x,y,tileWidth,tileHeight));x+=tileWidth+tileSpacing;if(x===width){x=tileMargin;y+=tileHeight+tileSpacing}}return tileset},parse:function(game,data,format){if(format===Phaser.Tilemap.CSV){return this.parseCSV(data)}else if(format===Phaser.Tilemap.TILED_JSON){return this.parseTiledJSON(data)}},parseCSV:function(data){data=data.trim();var output=[];var rows=data.split("\n");var height=rows.length;var width=0;for(var i=0;i<rows.length;i++){output[i]=[];var column=rows[i].split(",");for(var c=0;c<column.length;c++){output[i][c]=parseInt(column[c],10)}if(width===0){width=column.length}}return[{name:"csv",width:width,height:height,alpha:1,visible:true,indexes:[],tileMargin:0,tileSpacing:0,data:output}]},parseTiledJSON:function(json){var layers=[];for(var i=0;i<json.layers.length;i++){if(!json.layers[i].data){continue}var layer={name:json.layers[i].name,width:json.layers[i].width,height:json.layers[i].height,alpha:json.layers[i].opacity,visible:json.layers[i].visible,indexes:[],tileMargin:json.tilesets[0].margin,tileSpacing:json.tilesets[0].spacing};var output=[];var c=0;var row;for(var t=0;t<json.layers[i].data.length;t++){if(c===0){row=[]}row.push(json.layers[i].data[t]);c++;if(c==json.layers[i].width){output.push(row);c=0}}layer.data=output;layers.push(layer)}return layers}};Phaser.Tileset=function(image,key,tileWidth,tileHeight,tileMargin,tileSpacing){if(typeof tileMargin==="undefined"){tileMargin=0}if(typeof tileSpacing==="undefined"){tileSpacing=0}this.key=key;this.image=image;this.tileWidth=tileWidth;this.tileHeight=tileHeight;this.margin=tileMargin;this.spacing=tileSpacing;this.tiles=[]};Phaser.Tileset.prototype={addTile:function(tile){this.tiles.push(tile);return tile},getTile:function(index){if(this.tiles[index]){return this.tiles[index]}return null},setSpacing:function(margin,spacing){this.tileMargin=margin;this.tileSpacing=spacing},canCollide:function(index){if(this.tiles[index]){return this.tiles[index].collideNone}return null},checkTileIndex:function(index){return this.tiles[index]},setCollisionRange:function(start,stop,left,right,up,down){if(this.tiles[start]&&this.tiles[stop]&&start<stop){for(var i=start;i<=stop;i++){this.tiles[i].setCollision(left,right,up,down)}}},setCollision:function(index,left,right,up,down){if(this.tiles[index]){this.tiles[index].setCollision(left,right,up,down)}}};Object.defineProperty(Phaser.Tileset.prototype,"total",{get:function(){return this.tiles.length}});PIXI.CanvasRenderer.prototype.render=function(stage){PIXI.texturesToUpdate.length=0;PIXI.texturesToDestroy.length=0;PIXI.visibleCount++;stage.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(stage);if(PIXI.Texture.frameUpdates.length>0){PIXI.Texture.frameUpdates.length=0}};PIXI.CanvasRenderer.prototype.renderDisplayObject=function(displayObject){var testObject=displayObject.last._iNext;displayObject=displayObject.first;do{if(!displayObject.visible){displayObject=displayObject.last._iNext;continue}if(!displayObject.renderable||displayObject.alpha===0){displayObject=displayObject._iNext;continue}if(displayObject instanceof PIXI.Sprite){if(displayObject.texture.frame){this.context.globalAlpha=displayObject.worldAlpha;if(displayObject.texture.trimmed){this.context.setTransform(displayObject.worldTransform[0],displayObject.worldTransform[3],displayObject.worldTransform[1],displayObject.worldTransform[4],displayObject.worldTransform[2]+displayObject.texture.trim.x,displayObject.worldTransform[5]+displayObject.texture.trim.y)}else{this.context.setTransform(displayObject.worldTransform[0],displayObject.worldTransform[3],displayObject.worldTransform[1],displayObject.worldTransform[4],displayObject.worldTransform[2],displayObject.worldTransform[5])}this.context.drawImage(displayObject.texture.baseTexture.source,displayObject.texture.frame.x,displayObject.texture.frame.y,displayObject.texture.frame.width,displayObject.texture.frame.height,displayObject.anchor.x*-displayObject.texture.frame.width,displayObject.anchor.y*-displayObject.texture.frame.height,displayObject.texture.frame.width,displayObject.texture.frame.height)}}else if(displayObject instanceof PIXI.Strip){this.context.setTransform(displayObject.worldTransform[0],displayObject.worldTransform[3],displayObject.worldTransform[1],displayObject.worldTransform[4],displayObject.worldTransform[2],displayObject.worldTransform[5]);this.renderStrip(displayObject)}else if(displayObject instanceof PIXI.TilingSprite){this.context.setTransform(displayObject.worldTransform[0],displayObject.worldTransform[3],displayObject.worldTransform[1],displayObject.worldTransform[4],displayObject.worldTransform[2],displayObject.worldTransform[5]);this.renderTilingSprite(displayObject)}else if(displayObject instanceof PIXI.CustomRenderable){displayObject.renderCanvas(this)}else if(displayObject instanceof PIXI.Graphics){this.context.setTransform(displayObject.worldTransform[0],displayObject.worldTransform[3],displayObject.worldTransform[1],displayObject.worldTransform[4],displayObject.worldTransform[2],displayObject.worldTransform[5]);PIXI.CanvasGraphics.renderGraphics(displayObject,this.context)}else if(displayObject instanceof PIXI.FilterBlock){if(displayObject.open){this.context.save();var cacheAlpha=displayObject.mask.alpha;var maskTransform=displayObject.mask.worldTransform;this.context.setTransform(maskTransform[0],maskTransform[3],maskTransform[1],maskTransform[4],maskTransform[2],maskTransform[5]);displayObject.mask.worldAlpha=.5;this.context.worldAlpha=0;PIXI.CanvasGraphics.renderGraphicsMask(displayObject.mask,this.context);this.context.clip();displayObject.mask.worldAlpha=cacheAlpha}else{this.context.restore()}}displayObject=displayObject._iNext}while(displayObject!=testObject)};PIXI.WebGLBatch.prototype.update=function(){var worldTransform,width,height,aX,aY,w0,w1,h0,h1,index;var a,b,c,d,tx,ty;var indexRun=0;var displayObject=this.head;while(displayObject){if(displayObject.vcount===PIXI.visibleCount){width=displayObject.texture.frame.width;height=displayObject.texture.frame.height;aX=displayObject.anchor.x;aY=displayObject.anchor.y;w0=width*(1-aX);w1=width*-aX;h0=height*(1-aY);h1=height*-aY;index=indexRun*8;worldTransform=displayObject.worldTransform;a=worldTransform[0];b=worldTransform[3];c=worldTransform[1];d=worldTransform[4];tx=worldTransform[2];ty=worldTransform[5];if(displayObject.texture.trimmed){tx+=displayObject.texture.trim.x;ty+=displayObject.texture.trim.y}this.verticies[index+0]=a*w1+c*h1+tx;this.verticies[index+1]=d*h1+b*w1+ty;this.verticies[index+2]=a*w0+c*h1+tx;this.verticies[index+3]=d*h1+b*w0+ty;this.verticies[index+4]=a*w0+c*h0+tx;this.verticies[index+5]=d*h0+b*w0+ty;this.verticies[index+6]=a*w1+c*h0+tx;this.verticies[index+7]=d*h0+b*w1+ty;if(displayObject.updateFrame||displayObject.texture.updateFrame){this.dirtyUVS=true;var texture=displayObject.texture;var frame=texture.frame;var tw=texture.baseTexture.width;var th=texture.baseTexture.height;this.uvs[index+0]=frame.x/tw;this.uvs[index+1]=frame.y/th;this.uvs[index+2]=(frame.x+frame.width)/tw;this.uvs[index+3]=frame.y/th;this.uvs[index+4]=(frame.x+frame.width)/tw;this.uvs[index+5]=(frame.y+frame.height)/th;this.uvs[index+6]=frame.x/tw;this.uvs[index+7]=(frame.y+frame.height)/th;displayObject.updateFrame=false}if(displayObject.cacheAlpha!=displayObject.worldAlpha){displayObject.cacheAlpha=displayObject.worldAlpha;var colorIndex=indexRun*4;this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=displayObject.worldAlpha;this.dirtyColors=true}}else{index=indexRun*8;this.verticies[index+0]=0;this.verticies[index+1]=0;this.verticies[index+2]=0;this.verticies[index+3]=0;this.verticies[index+4]=0;this.verticies[index+5]=0;this.verticies[index+6]=0;this.verticies[index+7]=0}indexRun++;displayObject=displayObject.__next}};return Phaser});